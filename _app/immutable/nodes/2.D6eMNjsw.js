var Ug=Object.defineProperty;var Ng=(V,m,I)=>m in V?Ug(V,m,{enumerable:!0,configurable:!0,writable:!0,value:I}):V[m]=I;var Ma=(V,m,I)=>Ng(V,typeof m!="symbol"?m+"":m,I);import{r as Jo,y as Es,s as os,n as Pi,c as Cn,o as gh,z as Sd,e as ou,A as ZA,f as Og,h as qg}from"../chunks/CSkVN5vT.js";import{l as Dr,S as ls,i as cs,d as He,a as Ft,w as Te,c as et,e as Pt,g as Dt,o as Cr,h as tt,j as Mt,y as li,s as tn,b as Ge,f as ji,t as Ji,x as kd,z as Ti,A as Dd,B as lc,C as Vg,D as Rc,E as Lc,F as Ta,G as $A,q as vs,k as dn,u as xs,v as Bs,r as Cs,H as Hg,m as Md,n as Td,I as XA,J as jg}from"../chunks/CeV1JoeD.js";import{d as Pd,w as Pa}from"../chunks/Cvbv6IRb.js";import{p as Jg}from"../chunks/D-VgUmzM.js";function fh(V){return(V==null?void 0:V.length)!==void 0?V:Array.from(V)}function Yg(V,m){V.d(1),m.delete(V.key)}function Kg(V,m,I,E,P,Z,S,c,he,Ee,Fe,Qe){let me=V.length,$e=Z.length,rt=me;const je={};for(;rt--;)je[V[rt].key]=rt;const bt=[],Bt=new Map,ht=new Map,Xe=[];for(rt=$e;rt--;){const ut=Qe(P,Z,rt),ft=I(ut);let Nt=S.get(ft);Nt?Xe.push(()=>Nt.p(ut,m)):(Nt=Ee(ft,ut),Nt.c()),Bt.set(ft,bt[rt]=Nt),ft in je&&ht.set(ft,Math.abs(rt-je[ft]))}const We=new Set,dt=new Set;function zt(ut){Dr(ut,1),ut.m(c,Fe),S.set(ut.key,ut),Fe=ut.first,$e--}for(;me&&$e;){const ut=bt[$e-1],ft=V[me-1],Nt=ut.key,Gt=ft.key;ut===ft?(Fe=ut.first,me--,$e--):Bt.has(Gt)?!S.has(Nt)||We.has(Nt)?zt(ut):dt.has(Gt)?me--:ht.get(Nt)>ht.get(Gt)?(dt.add(Nt),zt(ut)):(We.add(Gt),me--):(he(ft,S),me--)}for(;me--;){const ut=V[me];Bt.has(ut.key)||he(ut,S)}for(;$e;)zt(bt[$e-1]);return Jo(Xe),bt}var Rd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Zg(V){return V&&V.__esModule&&Object.prototype.hasOwnProperty.call(V,"default")?V.default:V}var Ld={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(V,m){(function(I,E){V.exports=E()})(Rd,function(){var I={},E={};function P(S,c,he){if(E[S]=he,S==="index"){var Ee="var sharedModule = {}; ("+E.shared+")(sharedModule); ("+E.worker+")(sharedModule);",Fe={};return E.shared(Fe),E.index(I,Fe),typeof window<"u"&&I.setWorkerUrl(window.URL.createObjectURL(new Blob([Ee],{type:"text/javascript"}))),I}}P("shared",["exports"],function(S){function c(i,t,r,s){return new(r||(r=Promise))(function(l,d){function f(C){try{b(s.next(C))}catch(D){d(D)}}function y(C){try{b(s.throw(C))}catch(D){d(D)}}function b(C){var D;C.done?l(C.value):(D=C.value,D instanceof r?D:new r(function(R){R(D)})).then(f,y)}b((s=s.apply(i,t||[])).next())})}function he(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var Ee=Fe;function Fe(i,t){this.x=i,this.y=t}Fe.prototype={clone:function(){return new Fe(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,r=i.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),r=Math.sin(i),s=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=s,this},_rotateAround:function(i,t){var r=Math.cos(i),s=Math.sin(i),l=t.y+s*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-s*(this.y-t.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Fe.convert=function(i){return i instanceof Fe?i:Array.isArray(i)?new Fe(i[0],i[1]):i};var Qe=he(Ee),me=$e;function $e(i,t,r,s){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(s-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=r,this.p2y=s}$e.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,s=0;s<8;s++){var l=this.sampleCurveX(r)-i;if(Math.abs(l)<t)return r;var d=this.sampleCurveDerivativeX(r);if(Math.abs(d)<1e-6)break;r-=l/d}var f=0,y=1;for(r=i,s=0;s<20&&(l=this.sampleCurveX(r),!(Math.abs(l-i)<t));s++)i>l?f=r:y=r,r=.5*(y-f)+f;return r},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var rt=he(me);let je,bt;function Bt(){return je==null&&(je=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),je}function ht(){if(bt==null&&(bt=!1,Bt())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let s=0;s<5*5;s++){const l=4*s;t.fillStyle=`rgb(${l},${l+1},${l+2})`,t.fillRect(s%5,Math.floor(s/5),1,1)}const r=t.getImageData(0,0,5,5).data;for(let s=0;s<5*5*4;s++)if(s%4!=3&&r[s]!==s){bt=!0;break}}}return bt||!1}function Xe(i,t,r,s){const l=new rt(i,t,r,s);return d=>l.solve(d)}const We=Xe(.25,.1,.25,1);function dt(i,t,r){return Math.min(r,Math.max(t,i))}function zt(i,t,r){const s=r-t,l=((i-t)%s+s)%s+t;return l===t?r:l}function ut(i,...t){for(const r of t)for(const s in r)i[s]=r[s];return i}let ft=1;function Nt(i,t,r){const s={};for(const l in i)s[l]=t.call(this,i[l],l,i);return s}function Gt(i,t,r){const s={};for(const l in i)t.call(this,i[l],l,i)&&(s[l]=i[l]);return s}function St(i){return Array.isArray(i)?i.map(St):typeof i=="object"&&i?Nt(i,St):i}const nr={};function mi(i){nr[i]||(typeof console<"u"&&console.warn(i),nr[i]=!0)}function ri(i,t,r){return(r.y-i.y)*(t.x-i.x)>(t.y-i.y)*(r.x-i.x)}function Xt(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let Ei=null;function ni(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Oi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Yi(i,t,r,s,l){return c(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const d=new VideoFrame(i,{timestamp:0});try{const f=d==null?void 0:d.format;if(!f||!f.startsWith("BGR")&&!f.startsWith("RGB"))throw new Error(`Unrecognized format ${f}`);const y=f.startsWith("BGR"),b=new Uint8ClampedArray(s*l*4);if(yield d.copyTo(b,function(C,D,R,N,J){const X=4*Math.max(-D,0),W=(Math.max(0,R)-R)*N*4+X,fe=4*N,ye=Math.max(0,D),Me=Math.max(0,R);return{rect:{x:ye,y:Me,width:Math.min(C.width,D+N)-ye,height:Math.min(C.height,R+J)-Me},layout:[{offset:W,stride:fe}]}}(i,t,r,s,l)),y)for(let C=0;C<b.length;C+=4){const D=b[C];b[C]=b[C+2],b[C+2]=D}return b}finally{d.close()}})}let Si,Qi;const $i="AbortError";function ur(){return new Error($i)}const qi={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function vi(i){return qi.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const Wi="global-dispatcher";class Vi extends Error{constructor(t,r,s,l){super(`AJAXError: ${r} (${t}): ${s}`),this.status=t,this.statusText=r,this.url=s,this.body=l}}const yi=()=>Xt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,pi=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const s=vi(i.url);if(s)return s(i,t);if(Xt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:Wi},t)}if(!(/^file:/.test(r=i.url)||/^file:/.test(yi())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(s,l){return c(this,void 0,void 0,function*(){const d=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,cache:s.cache,referrer:yi(),signal:l.signal});s.type!=="json"||d.headers.has("Accept")||d.headers.set("Accept","application/json");const f=yield fetch(d);if(!f.ok){const C=yield f.blob();throw new Vi(f.status,f.statusText,s.url,C)}let y;y=s.type==="arrayBuffer"||s.type==="image"?f.arrayBuffer():s.type==="json"?f.json():f.text();const b=yield y;if(l.signal.aborted)throw ur();return{data:b,cacheControl:f.headers.get("Cache-Control"),expires:f.headers.get("Expires")}})}(i,t);if(Xt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:Wi},t)}var r;return function(s,l){return new Promise((d,f)=>{var y;const b=new XMLHttpRequest;b.open(s.method||"GET",s.url,!0),s.type!=="arrayBuffer"&&s.type!=="image"||(b.responseType="arraybuffer");for(const C in s.headers)b.setRequestHeader(C,s.headers[C]);s.type==="json"&&(b.responseType="text",!((y=s.headers)===null||y===void 0)&&y.Accept||b.setRequestHeader("Accept","application/json")),b.withCredentials=s.credentials==="include",b.onerror=()=>{f(new Error(b.statusText))},b.onload=()=>{if(!l.signal.aborted)if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){let C=b.response;if(s.type==="json")try{C=JSON.parse(b.response)}catch(D){return void f(D)}d({data:C,cacheControl:b.getResponseHeader("Cache-Control"),expires:b.getResponseHeader("Expires")})}else{const C=new Blob([b.response],{type:b.getResponseHeader("Content-Type")});f(new Vi(b.status,b.statusText,s.url,C))}},l.signal.addEventListener("abort",()=>{b.abort(),f(ur())}),b.send(s.body)})}(i,t)};function yr(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const t=new URL(i),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function _r(i,t,r){r[i]&&r[i].indexOf(t)!==-1||(r[i]=r[i]||[],r[i].push(t))}function Gi(i,t,r){if(r&&r[i]){const s=r[i].indexOf(t);s!==-1&&r[i].splice(s,1)}}class Kt{constructor(t,r={}){ut(this,r),this.type=t}}class hi extends Kt{constructor(t,r={}){super("error",ut({error:t},r))}}class si{on(t,r){return this._listeners=this._listeners||{},_r(t,r,this._listeners),this}off(t,r){return Gi(t,r,this._listeners),Gi(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},_r(t,r,this._oneTimeListeners),this):new Promise(s=>this.once(t,s))}fire(t,r){typeof t=="string"&&(t=new Kt(t,r||{}));const s=t.type;if(this.listens(s)){t.target=this;const l=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const y of l)y.call(this,t);const d=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const y of d)Gi(s,y,this._oneTimeListeners),y.call(this,t);const f=this._eventedParent;f&&(ut(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),f.fire(t))}else t instanceof hi&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var Re={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ri=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Mr(i,t){const r={};for(const s in i)s!=="ref"&&(r[s]=i[s]);return Ri.forEach(s=>{s in t&&(r[s]=t[s])}),r}function Wt(i,t){if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let r=0;r<i.length;r++)if(!Wt(i[r],t[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&t!==null){if(typeof t!="object"||Object.keys(i).length!==Object.keys(t).length)return!1;for(const r in i)if(!Wt(i[r],t[r]))return!1;return!0}return i===t}function Ii(i,t){i.push(t)}function Un(i,t,r){Ii(r,{command:"addSource",args:[i,t[i]]})}function Ir(i,t,r){Ii(t,{command:"removeSource",args:[i]}),r[i]=!0}function qr(i,t,r,s){Ir(i,r,s),Un(i,t,r)}function ra(i,t,r){let s;for(s in i[r])if(Object.prototype.hasOwnProperty.call(i[r],s)&&s!=="data"&&!Wt(i[r][s],t[r][s]))return!1;for(s in t[r])if(Object.prototype.hasOwnProperty.call(t[r],s)&&s!=="data"&&!Wt(i[r][s],t[r][s]))return!1;return!0}function rn(i,t,r,s,l,d){i=i||{},t=t||{};for(const f in i)Object.prototype.hasOwnProperty.call(i,f)&&(Wt(i[f],t[f])||r.push({command:d,args:[s,f,t[f],l]}));for(const f in t)Object.prototype.hasOwnProperty.call(t,f)&&!Object.prototype.hasOwnProperty.call(i,f)&&(Wt(i[f],t[f])||r.push({command:d,args:[s,f,t[f],l]}))}function Ss(i){return i.id}function na(i,t){return i[t.id]=t,i}class lt{constructor(t,r,s,l){this.message=(t?`${t}: `:"")+s,l&&(this.identifier=l),r!=null&&r.__line__&&(this.line=r.__line__)}}function En(i,...t){for(const r of t)for(const s in r)i[s]=r[s];return i}class br extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class Qn{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[s,l]of r)this.bindings[s]=l}concat(t){return new Qn(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const nn={kind:"null"},at={kind:"number"},ei={kind:"string"},Vt={kind:"boolean"},Ht={kind:"color"},sn={kind:"object"},Yt={kind:"value"},Sn={kind:"collator"},kn={kind:"formatted"},Nn={kind:"padding"},fn={kind:"resolvedImage"},ge={kind:"variableAnchorOffsetCollection"};function j(i,t){return{kind:"array",itemType:i,N:t}}function H(i){if(i.kind==="array"){const t=H(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const ee=[nn,at,ei,Vt,Ht,kn,sn,j(Yt),Nn,fn,ge];function de(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!de(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const r of ee)if(!de(r,t))return null}}return`Expected ${H(i)} but found ${H(t)} instead.`}function we(i,t){return t.some(r=>r.kind===i.kind)}function Se(i,t){return t.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function De(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}const _e=.96422,Ne=.82521,Ze=4/29,Le=6/29,At=3*Le*Le,Rt=Le*Le*Le,Ot=Math.PI/180,ui=180/Math.PI;function Zt(i){return(i%=360)<0&&(i+=360),i}function fi([i,t,r,s]){let l,d;const f=sr((.2225045*(i=ai(i))+.7168786*(t=ai(t))+.0606169*(r=ai(r)))/1);i===t&&t===r?l=d=f:(l=sr((.4360747*i+.3850649*t+.1430804*r)/_e),d=sr((.0139322*i+.0971045*t+.7141733*r)/Ne));const y=116*f-16;return[y<0?0:y,500*(l-f),200*(f-d),s]}function ai(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function sr(i){return i>Rt?Math.pow(i,1/3):i/At+Ze}function Ki([i,t,r,s]){let l=(i+16)/116,d=isNaN(t)?l:l+t/500,f=isNaN(r)?l:l-r/200;return l=1*xi(l),d=_e*xi(d),f=Ne*xi(f),[ii(3.1338561*d-1.6168667*l-.4906146*f),ii(-.9787684*d+1.9161415*l+.033454*f),ii(.0719453*d-.2289914*l+1.4052427*f),s]}function ii(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function xi(i){return i>Le?i*i*i:At*(i-Ze)}function Ui(i){return parseInt(i.padEnd(2,i),16)/255}function ar(i,t){return Ar(t?i/100:i,0,1)}function Ar(i,t,r){return Math.min(Math.max(t,i),r)}function dr(i){return!i.some(Number.isNaN)}const gn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Bi{constructor(t,r,s,l=1,d=!0){this.r=t,this.g=r,this.b=s,this.a=l,d||(this.r*=l,this.g*=l,this.b*=l,l||this.overwriteGetter("rgb",[t,r,s,l]))}static parse(t){if(t instanceof Bi)return t;if(typeof t!="string")return;const r=function(s){if((s=s.toLowerCase().trim())==="transparent")return[0,0,0,0];const l=gn[s];if(l){const[f,y,b]=l;return[f/255,y/255,b/255,1]}if(s.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(s)){const f=s.length<6?1:2;let y=1;return[Ui(s.slice(y,y+=f)),Ui(s.slice(y,y+=f)),Ui(s.slice(y,y+=f)),Ui(s.slice(y,y+f)||"ff")]}if(s.startsWith("rgb")){const f=s.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[y,b,C,D,R,N,J,X,W,fe,ye,Me]=f,ve=[D||" ",J||" ",fe].join("");if(ve==="  "||ve==="  /"||ve===",,"||ve===",,,"){const ke=[C,N,W].join(""),Oe=ke==="%%%"?100:ke===""?255:0;if(Oe){const it=[Ar(+b/Oe,0,1),Ar(+R/Oe,0,1),Ar(+X/Oe,0,1),ye?ar(+ye,Me):1];if(dr(it))return it}}return}}const d=s.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(d){const[f,y,b,C,D,R,N,J,X]=d,W=[b||" ",D||" ",N].join("");if(W==="  "||W==="  /"||W===",,"||W===",,,"){const fe=[+y,Ar(+C,0,100),Ar(+R,0,100),J?ar(+J,X):1];if(dr(fe))return function([ye,Me,ve,ke]){function Oe(it){const wt=(it+ye/30)%12,qt=Me*Math.min(ve,1-ve);return ve-qt*Math.max(-1,Math.min(wt-3,9-wt,1))}return ye=Zt(ye),Me/=100,ve/=100,[Oe(0),Oe(8),Oe(4),ke]}(fe)}}}(t);return r?new Bi(...r,!1):void 0}get rgb(){const{r:t,g:r,b:s,a:l}=this,d=l||1/0;return this.overwriteGetter("rgb",[t/d,r/d,s/d,l])}get hcl(){return this.overwriteGetter("hcl",function(t){const[r,s,l,d]=fi(t),f=Math.sqrt(s*s+l*l);return[Math.round(1e4*f)?Zt(Math.atan2(l,s)*ui):NaN,f,r,d]}(this.rgb))}get lab(){return this.overwriteGetter("lab",fi(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){const[t,r,s,l]=this.rgb;return`rgba(${[t,r,s].map(d=>Math.round(255*d)).join(",")},${l})`}}Bi.black=new Bi(0,0,0,1),Bi.white=new Bi(1,1,1,1),Bi.transparent=new Bi(0,0,0,0),Bi.red=new Bi(1,0,0,1);class Yo{constructor(t,r,s){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ko{constructor(t,r,s,l,d){this.text=t,this.image=r,this.scale=s,this.fontStack=l,this.textColor=d}}class Tr{constructor(t){this.sections=t}static fromString(t){return new Tr([new Ko(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Tr?t:Tr.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class Vr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Vr)return t;if(typeof t=="number")return new Vr([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Vr(t)}}toString(){return JSON.stringify(this.values)}}const Zo=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Pr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Pr)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){const s=t[r],l=t[r+1];if(typeof s!="string"||!Zo.has(s)||!Array.isArray(l)||l.length!==2||typeof l[0]!="number"||typeof l[1]!="number")return}return new Pr(t)}}toString(){return JSON.stringify(this.values)}}class Hr{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Hr({name:t,available:!1}):null}}function sa(i,t,r,s){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[i,t,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[i,t,r,s]:[i,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ks(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Bi||i instanceof Yo||i instanceof Tr||i instanceof Vr||i instanceof Pr||i instanceof Hr)return!0;if(Array.isArray(i)){for(const t of i)if(!ks(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!ks(i[t]))return!1;return!0}return!1}function or(i){if(i===null)return nn;if(typeof i=="string")return ei;if(typeof i=="boolean")return Vt;if(typeof i=="number")return at;if(i instanceof Bi)return Ht;if(i instanceof Yo)return Sn;if(i instanceof Tr)return kn;if(i instanceof Vr)return Nn;if(i instanceof Pr)return ge;if(i instanceof Hr)return fn;if(Array.isArray(i)){const t=i.length;let r;for(const s of i){const l=or(s);if(r){if(r===l)continue;r=Yt;break}r=l}return j(r||Yt,t)}return sn}function aa(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof Bi||i instanceof Tr||i instanceof Vr||i instanceof Pr||i instanceof Hr?i.toString():JSON.stringify(i)}class pn{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!ks(t[1]))return r.error("invalid value");const s=t[1];let l=or(s);const d=r.expectedType;return l.kind!=="array"||l.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(l=d),new pn(l,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class er{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const oa={string:ei,number:at,boolean:Vt,object:sn};class jr{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let s,l=1;const d=t[0];if(d==="array"){let y,b;if(t.length>2){const C=t[1];if(typeof C!="string"||!(C in oa)||C==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);y=oa[C],l++}else y=Yt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);b=t[2],l++}s=j(y,b)}else{if(!oa[d])throw new Error(`Types doesn't contain name = ${d}`);s=oa[d]}const f=[];for(;l<t.length;l++){const y=r.parse(t[l],l,Yt);if(!y)return null;f.push(y)}return new jr(s,f)}evaluate(t){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(t);if(!de(this.type,or(s)))return s;if(r===this.args.length-1)throw new er(`Expected value to be of type ${H(this.type)}, but found ${H(or(s))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const $o={"to-boolean":Vt,"to-color":Ht,"to-number":at,"to-string":ei};class mn{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const s=t[0];if(!$o[s])throw new Error(`Can't parse ${s} as it is not part of the known types`);if((s==="to-boolean"||s==="to-string")&&t.length!==2)return r.error("Expected one argument.");const l=$o[s],d=[];for(let f=1;f<t.length;f++){const y=r.parse(t[f],f,Yt);if(!y)return null;d.push(y)}return new mn(l,d)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,s;for(const l of this.args){if(r=l.evaluate(t),s=null,r instanceof Bi)return r;if(typeof r=="string"){const d=t.parseColor(r);if(d)return d}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:sa(r[0],r[1],r[2],r[3]),!s))return new Bi(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new er(s||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const s of this.args){r=s.evaluate(t);const l=Vr.parse(r);if(l)return l}throw new er(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const s of this.args){r=s.evaluate(t);const l=Pr.parse(r);if(l)return l}throw new er(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const s of this.args){if(r=s.evaluate(t),r===null)return 0;const l=Number(r);if(!isNaN(l))return l}throw new er(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return Tr.fromString(aa(this.args[0].evaluate(t)));case"resolvedImage":return Hr.fromString(aa(this.args[0].evaluate(t)));default:return aa(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const uc=["Unknown","Point","LineString","Polygon"];class Dn{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?uc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache[t];return r||(r=this._parseColorCache[t]=Bi.parse(t)),r}}class On{constructor(t,r,s=[],l,d=new Qn,f=[]){this.registry=t,this.path=s,this.key=s.map(y=>`[${y}]`).join(""),this.scope=d,this.errors=f,this.expectedType=l,this._isConstant=r}parse(t,r,s,l,d={}){return r?this.concat(r,s,l)._parse(t,d):this._parse(t,d)}_parse(t,r){function s(l,d,f){return f==="assert"?new jr(d,[l]):f==="coerce"?new mn(d,[l]):l}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=t[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const d=this.registry[l];if(d){let f=d.parse(t,this);if(!f)return null;if(this.expectedType){const y=this.expectedType,b=f.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||b.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string")if(y.kind!=="padding"||b.kind!=="value"&&b.kind!=="number"&&b.kind!=="array")if(y.kind!=="variableAnchorOffsetCollection"||b.kind!=="value"&&b.kind!=="array"){if(this.checkSubtype(y,b))return null}else f=s(f,y,r.typeAnnotation||"coerce");else f=s(f,y,r.typeAnnotation||"coerce");else f=s(f,y,r.typeAnnotation||"coerce");else f=s(f,y,r.typeAnnotation||"assert")}if(!(f instanceof pn)&&f.type.kind!=="resolvedImage"&&this._isConstant(f)){const y=new Dn;try{f=new pn(f.type,f.evaluate(y))}catch(b){return this.error(b.message),null}}return f}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,s){const l=typeof t=="number"?this.path.concat(t):this.path,d=s?this.scope.concat(s):this.scope;return new On(this.registry,this._isConstant,l,r||null,d,this.errors)}error(t,...r){const s=`${this.key}${r.map(l=>`[${l}]`).join("")}`;this.errors.push(new br(s,t))}checkSubtype(t,r){const s=de(t,r);return s&&this.error(s),s}}class Jr{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const s=[];for(let d=1;d<t.length-1;d+=2){const f=t[d];if(typeof f!="string")return r.error(`Expected string, but found ${typeof f} instead.`,d);if(/[^a-zA-Z0-9_]/.test(f))return r.error("Variable names must contain only alphanumeric characters or '_'.",d);const y=r.parse(t[d+1],d+1);if(!y)return null;s.push([f,y])}const l=r.parse(t[t.length-1],t.length-1,r.expectedType,s);return l?new Jr(s,l):null}outputDefined(){return this.result.outputDefined()}}class _i{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const s=t[1];return r.scope.has(s)?new _i(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class la{constructor(t,r,s){this.type=t,this.index=r,this.input=s}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,at),l=r.parse(t[2],2,j(r.expectedType||Yt));return s&&l?new la(l.type.itemType,s,l):null}evaluate(t){const r=this.index.evaluate(t),s=this.input.evaluate(t);if(r<0)throw new er(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new er(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new er(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Xo{constructor(t,r){this.type=Vt,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,Yt),l=r.parse(t[2],2,Yt);return s&&l?we(s.type,[Vt,ei,at,nn,Yt])?new Xo(s,l):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${H(s.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!s)return!1;if(!Se(r,["boolean","string","number","null"]))throw new er(`Expected first argument to be of type boolean, string, number or null, but found ${H(or(r))} instead.`);if(!Se(s,["string","array"]))throw new er(`Expected second argument to be of type array or string, but found ${H(or(s))} instead.`);return s.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class hs{constructor(t,r,s){this.type=at,this.needle=t,this.haystack=r,this.fromIndex=s}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,Yt),l=r.parse(t[2],2,Yt);if(!s||!l)return null;if(!we(s.type,[Vt,ei,at,nn,Yt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${H(s.type)} instead`);if(t.length===4){const d=r.parse(t[3],3,at);return d?new hs(s,l,d):null}return new hs(s,l)}evaluate(t){const r=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!Se(r,["boolean","string","number","null"]))throw new er(`Expected first argument to be of type boolean, string, number or null, but found ${H(or(r))} instead.`);let l;if(this.fromIndex&&(l=this.fromIndex.evaluate(t)),Se(s,["string"])){const d=s.indexOf(r,l);return d===-1?-1:[...s.slice(0,d)].length}if(Se(s,["array"]))return s.indexOf(r,l);throw new er(`Expected second argument to be of type array or string, but found ${H(or(s))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class so{constructor(t,r,s,l,d,f){this.inputType=t,this.type=r,this.input=s,this.cases=l,this.outputs=d,this.otherwise=f}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let s,l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const d={},f=[];for(let C=2;C<t.length-1;C+=2){let D=t[C];const R=t[C+1];Array.isArray(D)||(D=[D]);const N=r.concat(C);if(D.length===0)return N.error("Expected at least one branch label.");for(const X of D){if(typeof X!="number"&&typeof X!="string")return N.error("Branch labels must be numbers or strings.");if(typeof X=="number"&&Math.abs(X)>Number.MAX_SAFE_INTEGER)return N.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof X=="number"&&Math.floor(X)!==X)return N.error("Numeric branch labels must be integer values.");if(s){if(N.checkSubtype(s,or(X)))return null}else s=or(X);if(d[String(X)]!==void 0)return N.error("Branch labels must be unique.");d[String(X)]=f.length}const J=r.parse(R,C,l);if(!J)return null;l=l||J.type,f.push(J)}const y=r.parse(t[1],1,Yt);if(!y)return null;const b=r.parse(t[t.length-1],t.length-1,l);return b?y.type.kind!=="value"&&r.concat(1).checkSubtype(s,y.type)?null:new so(s,l,y,d,f,b):null}evaluate(t){const r=this.input.evaluate(t);return(or(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class yn{constructor(t,r,s){this.type=t,this.branches=r,this.otherwise=s}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const l=[];for(let f=1;f<t.length-1;f+=2){const y=r.parse(t[f],f,Vt);if(!y)return null;const b=r.parse(t[f+1],f+1,s);if(!b)return null;l.push([y,b]),s=s||b.type}const d=r.parse(t[t.length-1],t.length-1,s);if(!d)return null;if(!s)throw new Error("Can't infer output type");return new yn(s,l,d)}evaluate(t){for(const[r,s]of this.branches)if(r.evaluate(t))return s.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,s]of this.branches)t(r),t(s);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class qn{constructor(t,r,s,l){this.type=t,this.input=r,this.beginIndex=s,this.endIndex=l}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,Yt),l=r.parse(t[2],2,at);if(!s||!l)return null;if(!we(s.type,[j(Yt),ei,Yt]))return r.error(`Expected first argument to be of type array or string, but found ${H(s.type)} instead`);if(t.length===4){const d=r.parse(t[3],3,at);return d?new qn(s.type,s,l,d):null}return new qn(s.type,s,l)}evaluate(t){const r=this.input.evaluate(t),s=this.beginIndex.evaluate(t);let l;if(this.endIndex&&(l=this.endIndex.evaluate(t)),Se(r,["string"]))return[...r].slice(s,l).join("");if(Se(r,["array"]))return r.slice(s,l);throw new er(`Expected first argument to be of type array or string, but found ${H(or(r))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Ds(i,t){const r=i.length-1;let s,l,d=0,f=r,y=0;for(;d<=f;)if(y=Math.floor((d+f)/2),s=i[y],l=i[y+1],s<=t){if(y===r||t<l)return y;d=y+1}else{if(!(s>t))throw new er("Input is not a number.");f=y-1}return 0}class ca{constructor(t,r,s){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[l,d]of s)this.labels.push(l),this.outputs.push(d)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(t[1],1,at);if(!s)return null;const l=[];let d=null;r.expectedType&&r.expectedType.kind!=="value"&&(d=r.expectedType);for(let f=1;f<t.length;f+=2){const y=f===1?-1/0:t[f],b=t[f+1],C=f,D=f+1;if(typeof y!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(l.length&&l[l.length-1][0]>=y)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const R=r.parse(b,D,d);if(!R)return null;d=d||R.type,l.push([y,R])}return new ca(d,s,l)}evaluate(t){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(t);const l=this.input.evaluate(t);if(l<=r[0])return s[0].evaluate(t);const d=r.length;return l>=r[d-1]?s[d-1].evaluate(t):s[Ds(r,l)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function ao(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Wo=el;function el(i,t,r,s){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(s-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=r,this.p2y=s}el.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,s=0;s<8;s++){var l=this.sampleCurveX(r)-i;if(Math.abs(l)<t)return r;var d=this.sampleCurveDerivativeX(r);if(Math.abs(d)<1e-6)break;r-=l/d}var f=0,y=1;for(r=i,s=0;s<20&&(l=this.sampleCurveX(r),!(Math.abs(l-i)<t));s++)i>l?f=r:y=r,r=.5*(y-f)+f;return r},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var Rl=ao(Wo);function us(i,t,r){return i+r*(t-i)}function Ms(i,t,r){return i.map((s,l)=>us(s,t[l],r))}const pr={number:us,color:function(i,t,r,s="rgb"){switch(s){case"rgb":{const[l,d,f,y]=Ms(i.rgb,t.rgb,r);return new Bi(l,d,f,y,!1)}case"hcl":{const[l,d,f,y]=i.hcl,[b,C,D,R]=t.hcl;let N,J;if(isNaN(l)||isNaN(b))isNaN(l)?isNaN(b)?N=NaN:(N=b,f!==1&&f!==0||(J=C)):(N=l,D!==1&&D!==0||(J=d));else{let Me=b-l;b>l&&Me>180?Me-=360:b<l&&l-b>180&&(Me+=360),N=l+r*Me}const[X,W,fe,ye]=function([Me,ve,ke,Oe]){return Me=isNaN(Me)?0:Me*Ot,Ki([ke,Math.cos(Me)*ve,Math.sin(Me)*ve,Oe])}([N,J??us(d,C,r),us(f,D,r),us(y,R,r)]);return new Bi(X,W,fe,ye,!1)}case"lab":{const[l,d,f,y]=Ki(Ms(i.lab,t.lab,r));return new Bi(l,d,f,y,!1)}}},array:Ms,padding:function(i,t,r){return new Vr(Ms(i.values,t.values,r))},variableAnchorOffsetCollection:function(i,t,r){const s=i.values,l=t.values;if(s.length!==l.length)throw new er(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${t.toString()}`);const d=[];for(let f=0;f<s.length;f+=2){if(s[f]!==l[f])throw new er(`Cannot interpolate values containing mismatched anchors. from[${f}]: ${s[f]}, to[${f}]: ${l[f]}`);d.push(s[f]);const[y,b]=s[f+1],[C,D]=l[f+1];d.push([us(y,C,r),us(b,D,r)])}return new Pr(d)}};class Rr{constructor(t,r,s,l,d){this.type=t,this.operator=r,this.interpolation=s,this.input=l,this.labels=[],this.outputs=[];for(const[f,y]of d)this.labels.push(f),this.outputs.push(y)}static interpolationFactor(t,r,s,l){let d=0;if(t.name==="exponential")d=Ra(r,t.base,s,l);else if(t.name==="linear")d=Ra(r,1,s,l);else if(t.name==="cubic-bezier"){const f=t.controlPoints;d=new Rl(f[0],f[1],f[2],f[3]).solve(Ra(r,1,s,l))}return d}static parse(t,r){let[s,l,d,...f]=t;if(!Array.isArray(l)||l.length===0)return r.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const C=l[1];if(typeof C!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:C}}else{if(l[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const C=l.slice(1);if(C.length!==4||C.some(D=>typeof D!="number"||D<0||D>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:C}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(d=r.parse(d,2,at),!d)return null;const y=[];let b=null;s==="interpolate-hcl"||s==="interpolate-lab"?b=Ht:r.expectedType&&r.expectedType.kind!=="value"&&(b=r.expectedType);for(let C=0;C<f.length;C+=2){const D=f[C],R=f[C+1],N=C+3,J=C+4;if(typeof D!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(y.length&&y[y.length-1][0]>=D)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',N);const X=r.parse(R,J,b);if(!X)return null;b=b||X.type,y.push([D,X])}return De(b,at)||De(b,Ht)||De(b,Nn)||De(b,ge)||De(b,j(at))?new Rr(b,s,l,d,y):r.error(`Type ${H(b)} is not interpolatable.`)}evaluate(t){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(t);const l=this.input.evaluate(t);if(l<=r[0])return s[0].evaluate(t);const d=r.length;if(l>=r[d-1])return s[d-1].evaluate(t);const f=Ds(r,l),y=Rr.interpolationFactor(this.interpolation,l,r[f],r[f+1]),b=s[f].evaluate(t),C=s[f+1].evaluate(t);switch(this.operator){case"interpolate":return pr[this.type.kind](b,C,y);case"interpolate-hcl":return pr.color(b,C,y,"hcl");case"interpolate-lab":return pr.color(b,C,y,"lab")}}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Ra(i,t,r,s){const l=s-r,d=i-r;return l===0?0:t===1?d/l:(Math.pow(t,d)-1)/(Math.pow(t,l)-1)}class oo{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expectected at least one argument.");let s=null;const l=r.expectedType;l&&l.kind!=="value"&&(s=l);const d=[];for(const y of t.slice(1)){const b=r.parse(y,1+d.length,s,void 0,{typeAnnotation:"omit"});if(!b)return null;s=s||b.type,d.push(b)}if(!s)throw new Error("No output type");const f=l&&d.some(y=>de(l,y.type));return new oo(f?Yt:s,d)}evaluate(t){let r,s=null,l=0;for(const d of this.args)if(l++,s=d.evaluate(t),s&&s instanceof Hr&&!s.available&&(r||(r=s.name),s=null,l===this.args.length&&(s=r)),s!==null)break;return s}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function La(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Ll(i,t,r,s){return s.compare(t,r)===0}function ha(i,t,r){const s=i!=="=="&&i!=="!=";return class Fd{constructor(d,f,y){this.type=Vt,this.lhs=d,this.rhs=f,this.collator=y,this.hasUntypedArgument=d.type.kind==="value"||f.type.kind==="value"}static parse(d,f){if(d.length!==3&&d.length!==4)return f.error("Expected two or three arguments.");const y=d[0];let b=f.parse(d[1],1,Yt);if(!b)return null;if(!La(y,b.type))return f.concat(1).error(`"${y}" comparisons are not supported for type '${H(b.type)}'.`);let C=f.parse(d[2],2,Yt);if(!C)return null;if(!La(y,C.type))return f.concat(2).error(`"${y}" comparisons are not supported for type '${H(C.type)}'.`);if(b.type.kind!==C.type.kind&&b.type.kind!=="value"&&C.type.kind!=="value")return f.error(`Cannot compare types '${H(b.type)}' and '${H(C.type)}'.`);s&&(b.type.kind==="value"&&C.type.kind!=="value"?b=new jr(C.type,[b]):b.type.kind!=="value"&&C.type.kind==="value"&&(C=new jr(b.type,[C])));let D=null;if(d.length===4){if(b.type.kind!=="string"&&C.type.kind!=="string"&&b.type.kind!=="value"&&C.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(D=f.parse(d[3],3,Sn),!D)return null}return new Fd(b,C,D)}evaluate(d){const f=this.lhs.evaluate(d),y=this.rhs.evaluate(d);if(s&&this.hasUntypedArgument){const b=or(f),C=or(y);if(b.kind!==C.kind||b.kind!=="string"&&b.kind!=="number")throw new er(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${b.kind}, ${C.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const b=or(f),C=or(y);if(b.kind!=="string"||C.kind!=="string")return t(d,f,y)}return this.collator?r(d,f,y,this.collator.evaluate(d)):t(d,f,y)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}}}const Ac=ha("==",function(i,t,r){return t===r},Ll),Fa=ha("!=",function(i,t,r){return t!==r},function(i,t,r,s){return!Ll(0,t,r,s)}),lo=ha("<",function(i,t,r){return t<r},function(i,t,r,s){return s.compare(t,r)<0}),Fl=ha(">",function(i,t,r){return t>r},function(i,t,r,s){return s.compare(t,r)>0}),tl=ha("<=",function(i,t,r){return t<=r},function(i,t,r,s){return s.compare(t,r)<=0}),il=ha(">=",function(i,t,r){return t>=r},function(i,t,r,s){return s.compare(t,r)>=0});class Vn{constructor(t,r,s){this.type=Sn,this.locale=s,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const s=t[1];if(typeof s!="object"||Array.isArray(s))return r.error("Collator options argument must be an object.");const l=r.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,Vt);if(!l)return null;const d=r.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,Vt);if(!d)return null;let f=null;return s.locale&&(f=r.parse(s.locale,1,ei),!f)?null:new Vn(l,d,f)}evaluate(t){return new Yo(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Ts{constructor(t,r,s,l,d){this.type=ei,this.number=t,this.locale=r,this.currency=s,this.minFractionDigits=l,this.maxFractionDigits=d}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const s=r.parse(t[1],1,at);if(!s)return null;const l=t[2];if(typeof l!="object"||Array.isArray(l))return r.error("NumberFormat options argument must be an object.");let d=null;if(l.locale&&(d=r.parse(l.locale,1,ei),!d))return null;let f=null;if(l.currency&&(f=r.parse(l.currency,1,ei),!f))return null;let y=null;if(l["min-fraction-digits"]&&(y=r.parse(l["min-fraction-digits"],1,at),!y))return null;let b=null;return l["max-fraction-digits"]&&(b=r.parse(l["max-fraction-digits"],1,at),!b)?null:new Ts(s,d,f,y,b)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Ps{constructor(t){this.type=kn,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const s=t[1];if(!Array.isArray(s)&&typeof s=="object")return r.error("First argument must be an image or text section.");const l=[];let d=!1;for(let f=1;f<=t.length-1;++f){const y=t[f];if(d&&typeof y=="object"&&!Array.isArray(y)){d=!1;let b=null;if(y["font-scale"]&&(b=r.parse(y["font-scale"],1,at),!b))return null;let C=null;if(y["text-font"]&&(C=r.parse(y["text-font"],1,j(ei)),!C))return null;let D=null;if(y["text-color"]&&(D=r.parse(y["text-color"],1,Ht),!D))return null;const R=l[l.length-1];R.scale=b,R.font=C,R.textColor=D}else{const b=r.parse(t[f],1,Yt);if(!b)return null;const C=b.type.kind;if(C!=="string"&&C!=="value"&&C!=="null"&&C!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,l.push({content:b,scale:null,font:null,textColor:null})}}return new Ps(l)}evaluate(t){return new Tr(this.sections.map(r=>{const s=r.content.evaluate(t);return or(s)===fn?new Ko("",s,null,null,null):new Ko(aa(s),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null)}))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}outputDefined(){return!1}}class As{constructor(t){this.type=fn,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");const s=r.parse(t[1],1,ei);return s?new As(s):r.error("No image name provided.")}evaluate(t){const r=this.input.evaluate(t),s=Hr.fromString(r);return s&&t.availableImages&&(s.available=t.availableImages.indexOf(r)>-1),s}eachChild(t){t(this.input)}outputDefined(){return!1}}class Rs{constructor(t){this.type=at,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const s=r.parse(t[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${H(s.type)} instead.`):new Rs(s):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new er(`Expected value to be of type string or array, but found ${H(or(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const cr=8192;function dc(i,t){const r=(180+i[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,l=Math.pow(2,t.z);return[Math.round(r*l*cr),Math.round(s*l*cr)]}function rl(i,t){const r=Math.pow(2,t.z);return[(l=(i[0]/cr+t.x)/r,360*l-180),(s=(i[1]/cr+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90)];var s,l}function Ls(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function ds(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function bi(i,t,r){const s=i[0]-t[0],l=i[1]-t[1],d=i[0]-r[0],f=i[1]-r[1];return s*f-d*l==0&&s*d<=0&&l*f<=0}function co(i,t,r,s){return(l=[s[0]-r[0],s[1]-r[1]])[0]*(d=[t[0]-i[0],t[1]-i[1]])[1]-l[1]*d[0]!=0&&!(!sl(i,t,r,s)||!sl(r,s,i,t));var l,d}function fc(i,t,r){for(const s of r)for(let l=0;l<s.length-1;++l)if(co(i,t,s[l],s[l+1]))return!0;return!1}function Fs(i,t,r=!1){let s=!1;for(const y of t)for(let b=0;b<y.length-1;b++){if(bi(i,y[b],y[b+1]))return r;(d=y[b])[1]>(l=i)[1]!=(f=y[b+1])[1]>l[1]&&l[0]<(f[0]-d[0])*(l[1]-d[1])/(f[1]-d[1])+d[0]&&(s=!s)}var l,d,f;return s}function zl(i,t){for(const r of t)if(Fs(i,r))return!0;return!1}function nl(i,t){for(const r of i)if(!Fs(r,t))return!1;for(let r=0;r<i.length-1;++r)if(fc(i[r],i[r+1],t))return!1;return!0}function za(i,t){for(const r of t)if(nl(i,r))return!0;return!1}function sl(i,t,r,s){const l=s[0]-r[0],d=s[1]-r[1],f=(i[0]-r[0])*d-l*(i[1]-r[1]),y=(t[0]-r[0])*d-l*(t[1]-r[1]);return f>0&&y<0||f<0&&y>0}function ua(i,t,r){const s=[];for(let l=0;l<i.length;l++){const d=[];for(let f=0;f<i[l].length;f++){const y=dc(i[l][f],r);Ls(t,y),d.push(y)}s.push(d)}return s}function ho(i,t,r){const s=[];for(let l=0;l<i.length;l++){const d=ua(i[l],t,r);s.push(d)}return s}function Er(i,t,r,s){if(i[0]<r[0]||i[0]>r[2]){const l=.5*s;let d=i[0]-r[0]>l?-s:r[0]-i[0]>l?s:0;d===0&&(d=i[0]-r[2]>l?-s:r[2]-i[0]>l?s:0),i[0]+=d}Ls(t,i)}function al(i,t,r,s){const l=Math.pow(2,s.z)*cr,d=[s.x*cr,s.y*cr],f=[];for(const y of i)for(const b of y){const C=[b.x+d[0],b.y+d[1]];Er(C,t,r,l),f.push(C)}return f}function ol(i,t,r,s){const l=Math.pow(2,s.z)*cr,d=[s.x*cr,s.y*cr],f=[];for(const b of i){const C=[];for(const D of b){const R=[D.x+d[0],D.y+d[1]];Ls(t,R),C.push(R)}f.push(C)}if(t[2]-t[0]<=l/2){(y=t)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const b of f)for(const C of b)Er(C,t,r,l)}var y;return f}class Mn{constructor(t,r){this.type=Vt,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ks(t[1])){const s=t[1];if(s.type==="FeatureCollection"){const l=[];for(const d of s.features){const{type:f,coordinates:y}=d.geometry;f==="Polygon"&&l.push(y),f==="MultiPolygon"&&l.push(...y)}if(l.length)return new Mn(s,{type:"MultiPolygon",coordinates:l})}else if(s.type==="Feature"){const l=s.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new Mn(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new Mn(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,s){const l=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(s.type==="Polygon"){const y=ua(s.coordinates,d,f),b=al(r.geometry(),l,d,f);if(!ds(l,d))return!1;for(const C of b)if(!Fs(C,y))return!1}if(s.type==="MultiPolygon"){const y=ho(s.coordinates,d,f),b=al(r.geometry(),l,d,f);if(!ds(l,d))return!1;for(const C of b)if(!zl(C,y))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,s){const l=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(s.type==="Polygon"){const y=ua(s.coordinates,d,f),b=ol(r.geometry(),l,d,f);if(!ds(l,d))return!1;for(const C of b)if(!nl(C,y))return!1}if(s.type==="MultiPolygon"){const y=ho(s.coordinates,d,f),b=ol(r.geometry(),l,d,f);if(!ds(l,d))return!1;for(const C of b)if(!za(C,y))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let fs=class{constructor(i=[],t=(r,s)=>r<s?-1:r>s?1:0){if(this.data=i,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:t,compare:r}=this,s=t[i];for(;i>0;){const l=i-1>>1,d=t[l];if(r(s,d)>=0)break;t[i]=d,i=l}t[i]=s}_down(i){const{data:t,compare:r}=this,s=this.length>>1,l=t[i];for(;i<s;){let d=1+(i<<1);const f=d+1;if(f<this.length&&r(t[f],t[d])<0&&(d=f),r(t[d],l)>=0)break;t[i]=t[d],i=d}t[i]=l}};function zs(i,t,r,s,l){ll(i,t,r,s||i.length-1,l||_n)}function ll(i,t,r,s,l){for(;s>r;){if(s-r>600){var d=s-r+1,f=t-r+1,y=Math.log(d),b=.5*Math.exp(2*y/3),C=.5*Math.sqrt(y*b*(d-b)/d)*(f-d/2<0?-1:1);ll(i,t,Math.max(r,Math.floor(t-f*b/d+C)),Math.min(s,Math.floor(t+(d-f)*b/d+C)),l)}var D=i[t],R=r,N=s;for(Aa(i,r,t),l(i[s],D)>0&&Aa(i,r,s);R<N;){for(Aa(i,R,N),R++,N--;l(i[R],D)<0;)R++;for(;l(i[N],D)>0;)N--}l(i[r],D)===0?Aa(i,r,N):Aa(i,++N,s),N<=t&&(r=N+1),t<=N&&(s=N-1)}}function Aa(i,t,r){var s=i[t];i[t]=i[r],i[r]=s}function _n(i,t){return i<t?-1:i>t?1:0}function Ga(i,t){if(i.length<=1)return[i];const r=[];let s,l;for(const d of i){const f=cl(d);f!==0&&(d.area=Math.abs(f),l===void 0&&(l=f<0),l===f<0?(s&&r.push(s),s=[d]):s.push(d))}if(s&&r.push(s),t>1)for(let d=0;d<r.length;d++)r[d].length<=t||(zs(r[d],t,1,r[d].length-1,uo),r[d]=r[d].slice(0,t));return r}function uo(i,t){return t.area-i.area}function cl(i){let t=0;for(let r,s,l=0,d=i.length,f=d-1;l<d;f=l++)r=i[l],s=i[f],t+=(s.x-r.x)*(r.y+s.y);return t}const Ao=1/298.257223563,Gl=Ao*(2-Ao),hl=Math.PI/180;class fo{constructor(t){const r=6378.137*hl*1e3,s=Math.cos(t*hl),l=1/(1-Gl*(1-s*s)),d=Math.sqrt(l);this.kx=r*d*s,this.ky=r*d*l*(1-Gl)}distance(t,r){const s=this.wrap(t[0]-r[0])*this.kx,l=(t[1]-r[1])*this.ky;return Math.sqrt(s*s+l*l)}pointOnLine(t,r){let s,l,d,f,y=1/0;for(let b=0;b<t.length-1;b++){let C=t[b][0],D=t[b][1],R=this.wrap(t[b+1][0]-C)*this.kx,N=(t[b+1][1]-D)*this.ky,J=0;R===0&&N===0||(J=(this.wrap(r[0]-C)*this.kx*R+(r[1]-D)*this.ky*N)/(R*R+N*N),J>1?(C=t[b+1][0],D=t[b+1][1]):J>0&&(C+=R/this.kx*J,D+=N/this.ky*J)),R=this.wrap(r[0]-C)*this.kx,N=(r[1]-D)*this.ky;const X=R*R+N*N;X<y&&(y=X,s=C,l=D,d=b,f=J)}return{point:[s,l],index:d,t:Math.max(0,Math.min(1,f))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Ul(i,t){return t[0]-i[0]}function go(i){return i[1]-i[0]+1}function Hn(i,t){return i[1]>=i[0]&&i[1]<t}function da(i,t){if(i[0]>i[1])return[null,null];const r=go(i);if(t){if(r===2)return[i,null];const l=Math.floor(r/2);return[[i[0],i[0]+l],[i[0]+l,i[1]]]}if(r===1)return[i,null];const s=Math.floor(r/2)-1;return[[i[0],i[0]+s],[i[0]+s+1,i[1]]]}function ul(i,t){if(!Hn(t,i.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let s=t[0];s<=t[1];++s)Ls(r,i[s]);return r}function Ua(i){const t=[1/0,1/0,-1/0,-1/0];for(const r of i)for(const s of r)Ls(t,s);return t}function fa(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function Al(i,t,r){if(!fa(i)||!fa(t))return NaN;let s=0,l=0;return i[2]<t[0]&&(s=t[0]-i[2]),i[0]>t[2]&&(s=i[0]-t[2]),i[1]>t[3]&&(l=i[1]-t[3]),i[3]<t[1]&&(l=t[1]-i[3]),r.distance([0,0],[s,l])}function jn(i,t,r){const s=r.pointOnLine(t,i);return r.distance(i,s.point)}function dl(i,t,r,s,l){const d=Math.min(jn(i,[r,s],l),jn(t,[r,s],l)),f=Math.min(jn(r,[i,t],l),jn(s,[i,t],l));return Math.min(d,f)}function gc(i,t,r,s,l){if(!Hn(t,i.length)||!Hn(s,r.length))return 1/0;let d=1/0;for(let f=t[0];f<t[1];++f){const y=i[f],b=i[f+1];for(let C=s[0];C<s[1];++C){const D=r[C],R=r[C+1];if(co(y,b,D,R))return 0;d=Math.min(d,dl(y,b,D,R,l))}}return d}function Zi(i,t,r,s,l){if(!Hn(t,i.length)||!Hn(s,r.length))return NaN;let d=1/0;for(let f=t[0];f<=t[1];++f)for(let y=s[0];y<=s[1];++y)if(d=Math.min(d,l.distance(i[f],r[y])),d===0)return d;return d}function ga(i,t,r){if(Fs(i,t,!0))return 0;let s=1/0;for(const l of t){const d=l[0],f=l[l.length-1];if(d!==f&&(s=Math.min(s,jn(i,[f,d],r)),s===0))return s;const y=r.pointOnLine(l,i);if(s=Math.min(s,r.distance(i,y.point)),s===0)return s}return s}function ti(i,t,r,s){if(!Hn(t,i.length))return NaN;for(let d=t[0];d<=t[1];++d)if(Fs(i[d],r,!0))return 0;let l=1/0;for(let d=t[0];d<t[1];++d){const f=i[d],y=i[d+1];for(const b of r)for(let C=0,D=b.length,R=D-1;C<D;R=C++){const N=b[R],J=b[C];if(co(f,y,N,J))return 0;l=Math.min(l,dl(f,y,N,J,s))}}return l}function po(i,t){for(const r of i)for(const s of r)if(Fs(s,t,!0))return!0;return!1}function ki(i,t,r,s=1/0){const l=Ua(i),d=Ua(t);if(s!==1/0&&Al(l,d,r)>=s)return s;if(ds(l,d)){if(po(i,t))return 0}else if(po(t,i))return 0;let f=1/0;for(const y of i)for(let b=0,C=y.length,D=C-1;b<C;D=b++){const R=y[D],N=y[b];for(const J of t)for(let X=0,W=J.length,fe=W-1;X<W;fe=X++){const ye=J[fe],Me=J[X];if(co(R,N,ye,Me))return 0;f=Math.min(f,dl(R,N,ye,Me,r))}}return f}function Ci(i,t,r,s,l,d){if(!d)return;const f=Al(ul(s,d),l,r);f<t&&i.push([f,d,[0,0]])}function Tn(i,t,r,s,l,d,f){if(!d||!f)return;const y=Al(ul(s,d),ul(l,f),r);y<t&&i.push([y,d,f])}function Pn(i,t,r,s,l=1/0){let d=Math.min(s.distance(i[0],r[0][0]),l);if(d===0)return d;const f=new fs([[0,[0,i.length-1],[0,0]]],Ul),y=Ua(r);for(;f.length>0;){const b=f.pop();if(b[0]>=d)continue;const C=b[1],D=t?50:100;if(go(C)<=D){if(!Hn(C,i.length))return NaN;if(t){const R=ti(i,C,r,s);if(isNaN(R)||R===0)return R;d=Math.min(d,R)}else for(let R=C[0];R<=C[1];++R){const N=ga(i[R],r,s);if(d=Math.min(d,N),d===0)return 0}}else{const R=da(C,t);Ci(f,d,s,i,y,R[0]),Ci(f,d,s,i,y,R[1])}}return d}function pa(i,t,r,s,l,d=1/0){let f=Math.min(d,l.distance(i[0],r[0]));if(f===0)return f;const y=new fs([[0,[0,i.length-1],[0,r.length-1]]],Ul);for(;y.length>0;){const b=y.pop();if(b[0]>=f)continue;const C=b[1],D=b[2],R=t?50:100,N=s?50:100;if(go(C)<=R&&go(D)<=N){if(!Hn(C,i.length)&&Hn(D,r.length))return NaN;let J;if(t&&s)J=gc(i,C,r,D,l),f=Math.min(f,J);else if(t&&!s){const X=i.slice(C[0],C[1]+1);for(let W=D[0];W<=D[1];++W)if(J=jn(r[W],X,l),f=Math.min(f,J),f===0)return f}else if(!t&&s){const X=r.slice(D[0],D[1]+1);for(let W=C[0];W<=C[1];++W)if(J=jn(i[W],X,l),f=Math.min(f,J),f===0)return f}else J=Zi(i,C,r,D,l),f=Math.min(f,J)}else{const J=da(C,t),X=da(D,s);Tn(y,f,l,i,r,J[0],X[0]),Tn(y,f,l,i,r,J[0],X[1]),Tn(y,f,l,i,r,J[1],X[0]),Tn(y,f,l,i,r,J[1],X[1])}}return f}function fl(i){return i.type==="MultiPolygon"?i.coordinates.map(t=>({type:"Polygon",coordinates:t})):i.type==="MultiLineString"?i.coordinates.map(t=>({type:"LineString",coordinates:t})):i.type==="MultiPoint"?i.coordinates.map(t=>({type:"Point",coordinates:t})):[i]}class Rn{constructor(t,r){this.type=at,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ks(t[1])){const s=t[1];if(s.type==="FeatureCollection")return new Rn(s,s.features.map(l=>fl(l.geometry)).flat());if(s.type==="Feature")return new Rn(s,fl(s.geometry));if("type"in s&&"coordinates"in s)return new Rn(s,fl(s))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,s){const l=r.geometry(),d=l.flat().map(b=>rl([b.x,b.y],r.canonical));if(l.length===0)return NaN;const f=new fo(d[0][1]);let y=1/0;for(const b of s){switch(b.type){case"Point":y=Math.min(y,pa(d,!1,[b.coordinates],!1,f,y));break;case"LineString":y=Math.min(y,pa(d,!1,b.coordinates,!0,f,y));break;case"Polygon":y=Math.min(y,Pn(d,!1,b.coordinates,f,y))}if(y===0)return y}return y}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,s){const l=r.geometry(),d=l.flat().map(b=>rl([b.x,b.y],r.canonical));if(l.length===0)return NaN;const f=new fo(d[0][1]);let y=1/0;for(const b of s){switch(b.type){case"Point":y=Math.min(y,pa(d,!0,[b.coordinates],!1,f,y));break;case"LineString":y=Math.min(y,pa(d,!0,b.coordinates,!0,f,y));break;case"Polygon":y=Math.min(y,Pn(d,!0,b.coordinates,f,y))}if(y===0)return y}return y}(t,this.geometries);if(t.geometryType()==="Polygon")return function(r,s){const l=r.geometry();if(l.length===0||l[0].length===0)return NaN;const d=Ga(l,0).map(b=>b.map(C=>C.map(D=>rl([D.x,D.y],r.canonical)))),f=new fo(d[0][0][0][1]);let y=1/0;for(const b of s)for(const C of d){switch(b.type){case"Point":y=Math.min(y,Pn([b.coordinates],!1,C,f,y));break;case"LineString":y=Math.min(y,Pn(b.coordinates,!0,C,f,y));break;case"Polygon":y=Math.min(y,ki(C,b.coordinates,f,y))}if(y===0)return y}return y}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const gs={"==":Ac,"!=":Fa,">":Fl,"<":lo,">=":il,"<=":tl,array:jr,at:la,boolean:jr,case:yn,coalesce:oo,collator:Vn,format:Ps,image:As,in:Xo,"index-of":hs,interpolate:Rr,"interpolate-hcl":Rr,"interpolate-lab":Rr,length:Rs,let:Jr,literal:pn,match:so,number:jr,"number-format":Ts,object:jr,slice:qn,step:ca,string:jr,"to-boolean":mn,"to-color":mn,"to-number":mn,"to-string":mn,var:_i,within:Mn,distance:Rn};class Yr{constructor(t,r,s,l){this.name=t,this.type=r,this._evaluate=s,this.args=l}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){const s=t[0],l=Yr.definitions[s];if(!l)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(l)?l[0]:l.type,f=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,y=f.filter(([C])=>!Array.isArray(C)||C.length===t.length-1);let b=null;for(const[C,D]of y){b=new On(r.registry,ma,r.path,null,r.scope);const R=[];let N=!1;for(let J=1;J<t.length;J++){const X=t[J],W=Array.isArray(C)?C[J-1]:C.type,fe=b.parse(X,1+R.length,W);if(!fe){N=!0;break}R.push(fe)}if(!N)if(Array.isArray(C)&&C.length!==R.length)b.error(`Expected ${C.length} arguments, but found ${R.length} instead.`);else{for(let J=0;J<R.length;J++){const X=Array.isArray(C)?C[J]:C.type,W=R[J];b.concat(J+1).checkSubtype(X,W.type)}if(b.errors.length===0)return new Yr(s,d,D,R)}}if(y.length===1)r.errors.push(...b.errors);else{const C=(y.length?y:f).map(([R])=>{return N=R,Array.isArray(N)?`(${N.map(H).join(", ")})`:`(${H(N.type)}...)`;var N}).join(" | "),D=[];for(let R=1;R<t.length;R++){const N=r.parse(t[R],1+D.length);if(!N)return null;D.push(H(N.type))}r.error(`Expected arguments of type ${C}, but found (${D.join(", ")}) instead.`)}return null}static register(t,r){Yr.definitions=r;for(const s in r)t[s]=Yr}}function mo(i,[t,r,s,l]){t=t.evaluate(i),r=r.evaluate(i),s=s.evaluate(i);const d=l?l.evaluate(i):1,f=sa(t,r,s,d);if(f)throw new er(f);return new Bi(t/255,r/255,s/255,d,!1)}function yo(i,t){return i in t}function Na(i,t){const r=t[i];return r===void 0?null:r}function ps(i){return{type:i}}function ma(i){if(i instanceof _i)return ma(i.boundExpression);if(i instanceof Yr&&i.name==="error"||i instanceof Vn||i instanceof Mn||i instanceof Rn)return!1;const t=i instanceof mn||i instanceof jr;let r=!0;return i.eachChild(s=>{r=t?r&&ma(s):r&&s instanceof pn}),!!r&&ya(i)&&Oa(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ya(i){if(i instanceof Yr&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Mn||i instanceof Rn)return!1;let t=!0;return i.eachChild(r=>{t&&!ya(r)&&(t=!1)}),t}function Gs(i){if(i instanceof Yr&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(r=>{t&&!Gs(r)&&(t=!1)}),t}function Oa(i,t){if(i instanceof Yr&&t.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(s=>{r&&!Oa(s,t)&&(r=!1)}),r}function _o(i){return{result:"success",value:i}}function _a(i){return{result:"error",value:i}}function Us(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function gl(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Io(i){return!!i.expression&&i.expression.interpolated}function gi(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function bo(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function pc(i){return i}function pl(i,t){const r=t.type==="color",s=i.stops&&typeof i.stops[0][0]=="object",l=s||!(s||i.property!==void 0),d=i.type||(Io(t)?"exponential":"interval");if(r||t.type==="padding"){const D=r?Bi.parse:Vr.parse;(i=En({},i)).stops&&(i.stops=i.stops.map(R=>[R[0],D(R[1])])),i.default=D(i.default?i.default:t.default)}if(i.colorSpace&&(f=i.colorSpace)!=="rgb"&&f!=="hcl"&&f!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var f;let y,b,C;if(d==="exponential")y=Ol;else if(d==="interval")y=wo;else if(d==="categorical"){y=Nl,b=Object.create(null);for(const D of i.stops)b[D[0]]=D[1];C=typeof i.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);y=vo}if(s){const D={},R=[];for(let X=0;X<i.stops.length;X++){const W=i.stops[X],fe=W[0].zoom;D[fe]===void 0&&(D[fe]={zoom:fe,type:i.type,property:i.property,default:i.default,stops:[]},R.push(fe)),D[fe].stops.push([W[0].value,W[1]])}const N=[];for(const X of R)N.push([D[X].zoom,pl(D[X],t)]);const J={name:"linear"};return{kind:"composite",interpolationType:J,interpolationFactor:Rr.interpolationFactor.bind(void 0,J),zoomStops:N.map(X=>X[0]),evaluate:({zoom:X},W)=>Ol({stops:N,base:i.base},t,X).evaluate(X,W)}}if(l){const D=d==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:Rr.interpolationFactor.bind(void 0,D),zoomStops:i.stops.map(R=>R[0]),evaluate:({zoom:R})=>y(i,t,R,b,C)}}return{kind:"source",evaluate(D,R){const N=R&&R.properties?R.properties[i.property]:void 0;return N===void 0?Lr(i.default,t.default):y(i,t,N,b,C)}}}function Lr(i,t,r){return i!==void 0?i:t!==void 0?t:r!==void 0?r:void 0}function Nl(i,t,r,s,l){return Lr(typeof r===l?s[r]:void 0,i.default,t.default)}function wo(i,t,r){if(gi(r)!=="number")return Lr(i.default,t.default);const s=i.stops.length;if(s===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[s-1][0])return i.stops[s-1][1];const l=Ds(i.stops.map(d=>d[0]),r);return i.stops[l][1]}function Ol(i,t,r){const s=i.base!==void 0?i.base:1;if(gi(r)!=="number")return Lr(i.default,t.default);const l=i.stops.length;if(l===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[l-1][0])return i.stops[l-1][1];const d=Ds(i.stops.map(D=>D[0]),r),f=function(D,R,N,J){const X=J-N,W=D-N;return X===0?0:R===1?W/X:(Math.pow(R,W)-1)/(Math.pow(R,X)-1)}(r,s,i.stops[d][0],i.stops[d+1][0]),y=i.stops[d][1],b=i.stops[d+1][1],C=pr[t.type]||pc;return typeof y.evaluate=="function"?{evaluate(...D){const R=y.evaluate.apply(void 0,D),N=b.evaluate.apply(void 0,D);if(R!==void 0&&N!==void 0)return C(R,N,f,i.colorSpace)}}:C(y,b,f,i.colorSpace)}function vo(i,t,r){switch(t.type){case"color":r=Bi.parse(r);break;case"formatted":r=Tr.fromString(r.toString());break;case"resolvedImage":r=Hr.fromString(r.toString());break;case"padding":r=Vr.parse(r);break;default:gi(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return Lr(r,i.default,t.default)}Yr.register(gs,{error:[{kind:"error"},[ei],(i,[t])=>{throw new er(t.evaluate(i))}],typeof:[ei,[Yt],(i,[t])=>H(or(t.evaluate(i)))],"to-rgba":[j(at,4),[Ht],(i,[t])=>{const[r,s,l,d]=t.evaluate(i).rgb;return[255*r,255*s,255*l,d]}],rgb:[Ht,[at,at,at],mo],rgba:[Ht,[at,at,at,at],mo],has:{type:Vt,overloads:[[[ei],(i,[t])=>yo(t.evaluate(i),i.properties())],[[ei,sn],(i,[t,r])=>yo(t.evaluate(i),r.evaluate(i))]]},get:{type:Yt,overloads:[[[ei],(i,[t])=>Na(t.evaluate(i),i.properties())],[[ei,sn],(i,[t,r])=>Na(t.evaluate(i),r.evaluate(i))]]},"feature-state":[Yt,[ei],(i,[t])=>Na(t.evaluate(i),i.featureState||{})],properties:[sn,[],i=>i.properties()],"geometry-type":[ei,[],i=>i.geometryType()],id:[Yt,[],i=>i.id()],zoom:[at,[],i=>i.globals.zoom],"heatmap-density":[at,[],i=>i.globals.heatmapDensity||0],"line-progress":[at,[],i=>i.globals.lineProgress||0],accumulated:[Yt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[at,ps(at),(i,t)=>{let r=0;for(const s of t)r+=s.evaluate(i);return r}],"*":[at,ps(at),(i,t)=>{let r=1;for(const s of t)r*=s.evaluate(i);return r}],"-":{type:at,overloads:[[[at,at],(i,[t,r])=>t.evaluate(i)-r.evaluate(i)],[[at],(i,[t])=>-t.evaluate(i)]]},"/":[at,[at,at],(i,[t,r])=>t.evaluate(i)/r.evaluate(i)],"%":[at,[at,at],(i,[t,r])=>t.evaluate(i)%r.evaluate(i)],ln2:[at,[],()=>Math.LN2],pi:[at,[],()=>Math.PI],e:[at,[],()=>Math.E],"^":[at,[at,at],(i,[t,r])=>Math.pow(t.evaluate(i),r.evaluate(i))],sqrt:[at,[at],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[at,[at],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[at,[at],(i,[t])=>Math.log(t.evaluate(i))],log2:[at,[at],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[at,[at],(i,[t])=>Math.sin(t.evaluate(i))],cos:[at,[at],(i,[t])=>Math.cos(t.evaluate(i))],tan:[at,[at],(i,[t])=>Math.tan(t.evaluate(i))],asin:[at,[at],(i,[t])=>Math.asin(t.evaluate(i))],acos:[at,[at],(i,[t])=>Math.acos(t.evaluate(i))],atan:[at,[at],(i,[t])=>Math.atan(t.evaluate(i))],min:[at,ps(at),(i,t)=>Math.min(...t.map(r=>r.evaluate(i)))],max:[at,ps(at),(i,t)=>Math.max(...t.map(r=>r.evaluate(i)))],abs:[at,[at],(i,[t])=>Math.abs(t.evaluate(i))],round:[at,[at],(i,[t])=>{const r=t.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[at,[at],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[at,[at],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[Vt,[ei,Yt],(i,[t,r])=>i.properties()[t.value]===r.value],"filter-id-==":[Vt,[Yt],(i,[t])=>i.id()===t.value],"filter-type-==":[Vt,[ei],(i,[t])=>i.geometryType()===t.value],"filter-<":[Vt,[ei,Yt],(i,[t,r])=>{const s=i.properties()[t.value],l=r.value;return typeof s==typeof l&&s<l}],"filter-id-<":[Vt,[Yt],(i,[t])=>{const r=i.id(),s=t.value;return typeof r==typeof s&&r<s}],"filter->":[Vt,[ei,Yt],(i,[t,r])=>{const s=i.properties()[t.value],l=r.value;return typeof s==typeof l&&s>l}],"filter-id->":[Vt,[Yt],(i,[t])=>{const r=i.id(),s=t.value;return typeof r==typeof s&&r>s}],"filter-<=":[Vt,[ei,Yt],(i,[t,r])=>{const s=i.properties()[t.value],l=r.value;return typeof s==typeof l&&s<=l}],"filter-id-<=":[Vt,[Yt],(i,[t])=>{const r=i.id(),s=t.value;return typeof r==typeof s&&r<=s}],"filter->=":[Vt,[ei,Yt],(i,[t,r])=>{const s=i.properties()[t.value],l=r.value;return typeof s==typeof l&&s>=l}],"filter-id->=":[Vt,[Yt],(i,[t])=>{const r=i.id(),s=t.value;return typeof r==typeof s&&r>=s}],"filter-has":[Vt,[Yt],(i,[t])=>t.value in i.properties()],"filter-has-id":[Vt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Vt,[j(ei)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[Vt,[j(Yt)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[Vt,[ei,j(Yt)],(i,[t,r])=>r.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[Vt,[ei,j(Yt)],(i,[t,r])=>function(s,l,d,f){for(;d<=f;){const y=d+f>>1;if(l[y]===s)return!0;l[y]>s?f=y-1:d=y+1}return!1}(i.properties()[t.value],r.value,0,r.value.length-1)],all:{type:Vt,overloads:[[[Vt,Vt],(i,[t,r])=>t.evaluate(i)&&r.evaluate(i)],[ps(Vt),(i,t)=>{for(const r of t)if(!r.evaluate(i))return!1;return!0}]]},any:{type:Vt,overloads:[[[Vt,Vt],(i,[t,r])=>t.evaluate(i)||r.evaluate(i)],[ps(Vt),(i,t)=>{for(const r of t)if(r.evaluate(i))return!0;return!1}]]},"!":[Vt,[Vt],(i,[t])=>!t.evaluate(i)],"is-supported-script":[Vt,[ei],(i,[t])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(t.evaluate(i))}],upcase:[ei,[ei],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[ei,[ei],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[ei,ps(Yt),(i,t)=>t.map(r=>aa(r.evaluate(i))).join("")],"resolved-locale":[ei,[Sn],(i,[t])=>t.evaluate(i).resolvedLocale()]});class Ia{constructor(t,r){var s;this.expression=t,this._warningHistory={},this._evaluator=new Dn,this._defaultValue=r?(s=r).type==="color"&&bo(s.default)?new Bi(0,0,0,0):s.type==="color"?Bi.parse(s.default)||null:s.type==="padding"?Vr.parse(s.default)||null:s.type==="variableAnchorOffsetCollection"?Pr.parse(s.default)||null:s.default===void 0?null:s.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,s,l,d,f){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=l,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f,this.expression.evaluate(this._evaluator)}evaluate(t,r,s,l,d,f){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=l,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f||null;try{const y=this.expression.evaluate(this._evaluator);if(y==null||typeof y=="number"&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new er(`Expected value to be one of ${Object.keys(this._enumValues).map(b=>JSON.stringify(b)).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function xo(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in gs}function ba(i,t){const r=new On(gs,ma,[],t?function(l){const d={color:Ht,string:ei,number:at,enum:ei,boolean:Vt,formatted:kn,padding:Nn,resolvedImage:fn,variableAnchorOffsetCollection:ge};return l.type==="array"?j(d[l.value]||Yt,l.length):d[l.type]}(t):void 0),s=r.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?_o(new Ia(s,t)):_a(r.errors)}class Ln{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!Gs(r.expression)}evaluateWithoutErrorHandling(t,r,s,l,d,f){return this._styleExpression.evaluateWithoutErrorHandling(t,r,s,l,d,f)}evaluate(t,r,s,l,d,f){return this._styleExpression.evaluate(t,r,s,l,d,f)}}class Jn{constructor(t,r,s,l){this.kind=t,this.zoomStops=s,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!Gs(r.expression),this.interpolationType=l}evaluateWithoutErrorHandling(t,r,s,l,d,f){return this._styleExpression.evaluateWithoutErrorHandling(t,r,s,l,d,f)}evaluate(t,r,s,l,d,f){return this._styleExpression.evaluate(t,r,s,l,d,f)}interpolationFactor(t,r,s){return this.interpolationType?Rr.interpolationFactor(this.interpolationType,t,r,s):0}}function wa(i,t){const r=ba(i,t);if(r.result==="error")return r;const s=r.value.expression,l=ya(s);if(!l&&!Us(t))return _a([new br("","data expressions not supported")]);const d=Oa(s,["zoom"]);if(!d&&!gl(t))return _a([new br("","zoom expressions not supported")]);const f=ms(s);return f||d?f instanceof br?_a([f]):f instanceof Rr&&!Io(t)?_a([new br("",'"interpolate" expressions cannot be used with this property')]):_o(f?new Jn(l?"camera":"composite",r.value,f.labels,f instanceof Rr?f.interpolation:void 0):new Ln(l?"constant":"source",r.value)):_a([new br("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Yn{constructor(t,r){this._parameters=t,this._specification=r,En(this,pl(this._parameters,this._specification))}static deserialize(t){return new Yn(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function ms(i){let t=null;if(i instanceof Jr)t=ms(i.result);else if(i instanceof oo){for(const r of i.args)if(t=ms(r),t)break}else(i instanceof ca||i instanceof Rr)&&i.input instanceof Yr&&i.input.name==="zoom"&&(t=i);return t instanceof br||i.eachChild(r=>{const s=ms(r);s instanceof br?t=s:!t&&s?t=new br("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&s&&t!==s&&(t=new br("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Ns(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!Ns(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Os={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ys(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Ns(i)||(i=Co(i));const t=ba(i,Os);if(t.result==="error")throw new Error(t.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,s,l)=>t.value.evaluate(r,s,{},l),needGeometry:ml(i)}}function Bo(i,t){return i<t?-1:i>t?1:0}function ml(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let t=1;t<i.length;t++)if(ml(i[t]))return!0;return!1}function Co(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?yl(i[1],i[2],"=="):t==="!="?tr(yl(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?yl(i[1],i[2],t):t==="any"?(r=i.slice(1),["any"].concat(r.map(Co))):t==="all"?["all"].concat(i.slice(1).map(Co)):t==="none"?["all"].concat(i.slice(1).map(Co).map(tr)):t==="in"?qa(i[1],i.slice(2)):t==="!in"?tr(qa(i[1],i.slice(2))):t==="has"?Va(i[1]):t!=="!has"||tr(Va(i[1]));var r}function yl(i,t,r){switch(i){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,i,t]}}function qa(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",i,["literal",t.sort(Bo)]]:["filter-in-small",i,["literal",t]]}}function Va(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function tr(i){return["!",i]}function qs(i){const t=typeof i;if(t==="number"||t==="boolean"||t==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let l="[";for(const d of i)l+=`${qs(d)},`;return`${l}]`}const r=Object.keys(i).sort();let s="{";for(let l=0;l<r.length;l++)s+=`${JSON.stringify(r[l])}:${qs(i[r[l]])},`;return`${s}}`}function ql(i){let t="";for(const r of Ri)t+=`/${qs(i[r])}`;return t}function Vl(i){const t=i.value;return t?[new lt(i.key,t,"constants have been deprecated as of v8")]:[]}function Xi(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function In(i){if(Array.isArray(i))return i.map(In);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const r in i)t[r]=In(i[r]);return t}return Xi(i)}function Kr(i){const t=i.key,r=i.value,s=i.valueSpec||{},l=i.objectElementValidators||{},d=i.style,f=i.styleSpec,y=i.validateSpec;let b=[];const C=gi(r);if(C!=="object")return[new lt(t,r,`object expected, ${C} found`)];for(const D in r){const R=D.split(".")[0],N=s[R]||s["*"];let J;if(l[R])J=l[R];else if(s[R])J=y;else if(l["*"])J=l["*"];else{if(!s["*"]){b.push(new lt(t,r[D],`unknown property "${D}"`));continue}J=y}b=b.concat(J({key:(t&&`${t}.`)+D,value:r[D],valueSpec:N,style:d,styleSpec:f,object:r,objectKey:D,validateSpec:y},r))}for(const D in s)l[D]||s[D].required&&s[D].default===void 0&&r[D]===void 0&&b.push(new lt(t,r,`missing required property "${D}"`));return b}function Ha(i){const t=i.value,r=i.valueSpec,s=i.style,l=i.styleSpec,d=i.key,f=i.arrayElementValidator||i.validateSpec;if(gi(t)!=="array")return[new lt(d,t,`array expected, ${gi(t)} found`)];if(r.length&&t.length!==r.length)return[new lt(d,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new lt(d,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let y={type:r.value,values:r.values};l.$version<7&&(y.function=r.function),gi(r.value)==="object"&&(y=r.value);let b=[];for(let C=0;C<t.length;C++)b=b.concat(f({array:t,arrayIndex:C,value:t[C],valueSpec:y,validateSpec:i.validateSpec,style:s,styleSpec:l,key:`${d}[${C}]`}));return b}function ja(i){const t=i.key,r=i.value,s=i.valueSpec;let l=gi(r);return l==="number"&&r!=r&&(l="NaN"),l!=="number"?[new lt(t,r,`number expected, ${l} found`)]:"minimum"in s&&r<s.minimum?[new lt(t,r,`${r} is less than the minimum value ${s.minimum}`)]:"maximum"in s&&r>s.maximum?[new lt(t,r,`${r} is greater than the maximum value ${s.maximum}`)]:[]}function Eo(i){const t=i.valueSpec,r=Xi(i.value.type);let s,l,d,f={};const y=r!=="categorical"&&i.value.property===void 0,b=!y,C=gi(i.value.stops)==="array"&&gi(i.value.stops[0])==="array"&&gi(i.value.stops[0][0])==="object",D=Kr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(J){if(r==="identity")return[new lt(J.key,J.value,'identity function may not have a "stops" property')];let X=[];const W=J.value;return X=X.concat(Ha({key:J.key,value:W,valueSpec:J.valueSpec,validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec,arrayElementValidator:R})),gi(W)==="array"&&W.length===0&&X.push(new lt(J.key,W,"array must have at least one stop")),X},default:function(J){return J.validateSpec({key:J.key,value:J.value,valueSpec:t,validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec})}}});return r==="identity"&&y&&D.push(new lt(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||D.push(new lt(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!Io(i.valueSpec)&&D.push(new lt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(b&&!Us(i.valueSpec)?D.push(new lt(i.key,i.value,"property functions not supported")):y&&!gl(i.valueSpec)&&D.push(new lt(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!C||i.value.property!==void 0||D.push(new lt(i.key,i.value,'"property" property is required')),D;function R(J){let X=[];const W=J.value,fe=J.key;if(gi(W)!=="array")return[new lt(fe,W,`array expected, ${gi(W)} found`)];if(W.length!==2)return[new lt(fe,W,`array length 2 expected, length ${W.length} found`)];if(C){if(gi(W[0])!=="object")return[new lt(fe,W,`object expected, ${gi(W[0])} found`)];if(W[0].zoom===void 0)return[new lt(fe,W,"object stop key must have zoom")];if(W[0].value===void 0)return[new lt(fe,W,"object stop key must have value")];if(d&&d>Xi(W[0].zoom))return[new lt(fe,W[0].zoom,"stop zoom values must appear in ascending order")];Xi(W[0].zoom)!==d&&(d=Xi(W[0].zoom),l=void 0,f={}),X=X.concat(Kr({key:`${fe}[0]`,value:W[0],valueSpec:{zoom:{}},validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec,objectElementValidators:{zoom:ja,value:N}}))}else X=X.concat(N({key:`${fe}[0]`,value:W[0],validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec},W));return xo(In(W[1]))?X.concat([new lt(`${fe}[1]`,W[1],"expressions are not allowed in function stops.")]):X.concat(J.validateSpec({key:`${fe}[1]`,value:W[1],valueSpec:t,validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec}))}function N(J,X){const W=gi(J.value),fe=Xi(J.value),ye=J.value!==null?J.value:X;if(s){if(W!==s)return[new lt(J.key,ye,`${W} stop domain type must match previous stop domain type ${s}`)]}else s=W;if(W!=="number"&&W!=="string"&&W!=="boolean")return[new lt(J.key,ye,"stop domain value must be a number, string, or boolean")];if(W!=="number"&&r!=="categorical"){let Me=`number expected, ${W} found`;return Us(t)&&r===void 0&&(Me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new lt(J.key,ye,Me)]}return r!=="categorical"||W!=="number"||isFinite(fe)&&Math.floor(fe)===fe?r!=="categorical"&&W==="number"&&l!==void 0&&fe<l?[new lt(J.key,ye,"stop domain values must appear in ascending order")]:(l=fe,r==="categorical"&&fe in f?[new lt(J.key,ye,"stop domain values must be unique")]:(f[fe]=!0,[])):[new lt(J.key,ye,`integer expected, found ${fe}`)]}}function Qr(i){const t=(i.expressionContext==="property"?wa:ba)(In(i.value),i.valueSpec);if(t.result==="error")return t.value.map(s=>new lt(`${i.key}${s.key}`,i.value,s.message));const r=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new lt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Gs(r))return[new lt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Gs(r))return[new lt(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Oa(r,["zoom","feature-state"]))return[new lt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!ya(r))return[new lt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function bn(i){const t=i.key,r=i.value,s=i.valueSpec,l=[];return Array.isArray(s.values)?s.values.indexOf(Xi(r))===-1&&l.push(new lt(t,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(s.values).indexOf(Xi(r))===-1&&l.push(new lt(t,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),l}function Qo(i){return Ns(In(i.value))?Qr(En({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):So(i)}function So(i){const t=i.value,r=i.key;if(gi(t)!=="array")return[new lt(r,t,`array expected, ${gi(t)} found`)];const s=i.styleSpec;let l,d=[];if(t.length<1)return[new lt(r,t,"filter array must have at least 1 element")];switch(d=d.concat(bn({key:`${r}[0]`,value:t[0],valueSpec:s.filter_operator,style:i.style,styleSpec:i.styleSpec})),Xi(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Xi(t[1])==="$type"&&d.push(new lt(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&d.push(new lt(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(l=gi(t[1]),l!=="string"&&d.push(new lt(`${r}[1]`,t[1],`string expected, ${l} found`)));for(let f=2;f<t.length;f++)l=gi(t[f]),Xi(t[1])==="$type"?d=d.concat(bn({key:`${r}[${f}]`,value:t[f],valueSpec:s.geometry_type,style:i.style,styleSpec:i.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&d.push(new lt(`${r}[${f}]`,t[f],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let f=1;f<t.length;f++)d=d.concat(So({key:`${r}[${f}]`,value:t[f],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":l=gi(t[1]),t.length!==2?d.push(new lt(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):l!=="string"&&d.push(new lt(`${r}[1]`,t[1],`string expected, ${l} found`))}return d}function ko(i,t){const r=i.key,s=i.validateSpec,l=i.style,d=i.styleSpec,f=i.value,y=i.objectKey,b=d[`${t}_${i.layerType}`];if(!b)return[];const C=y.match(/^(.*)-transition$/);if(t==="paint"&&C&&b[C[1]]&&b[C[1]].transition)return s({key:r,value:f,valueSpec:d.transition,style:l,styleSpec:d});const D=i.valueSpec||b[y];if(!D)return[new lt(r,f,`unknown property "${y}"`)];let R;if(gi(f)==="string"&&Us(D)&&!D.tokens&&(R=/^{([^}]+)}$/.exec(f)))return[new lt(r,f,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(R[1])} }\`.`)];const N=[];return i.layerType==="symbol"&&(y==="text-field"&&l&&!l.glyphs&&N.push(new lt(r,f,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&bo(In(f))&&Xi(f.type)==="identity"&&N.push(new lt(r,f,'"text-font" does not support identity functions'))),N.concat(s({key:i.key,value:f,valueSpec:D,style:l,styleSpec:d,expressionContext:"property",propertyType:t,propertyKey:y}))}function Ja(i){return ko(i,"paint")}function Vs(i){return ko(i,"layout")}function Ya(i){let t=[];const r=i.value,s=i.key,l=i.style,d=i.styleSpec;r.type||r.ref||t.push(new lt(s,r,'either "type" or "ref" is required'));let f=Xi(r.type);const y=Xi(r.ref);if(r.id){const b=Xi(r.id);for(let C=0;C<i.arrayIndex;C++){const D=l.layers[C];Xi(D.id)===b&&t.push(new lt(s,r.id,`duplicate layer id "${r.id}", previously used at line ${D.id.__line__}`))}}if("ref"in r){let b;["type","source","source-layer","filter","layout"].forEach(C=>{C in r&&t.push(new lt(s,r[C],`"${C}" is prohibited for ref layers`))}),l.layers.forEach(C=>{Xi(C.id)===y&&(b=C)}),b?b.ref?t.push(new lt(s,r.ref,"ref cannot reference another ref layer")):f=Xi(b.type):t.push(new lt(s,r.ref,`ref layer "${y}" not found`))}else if(f!=="background")if(r.source){const b=l.sources&&l.sources[r.source],C=b&&Xi(b.type);b?C==="vector"&&f==="raster"?t.push(new lt(s,r.source,`layer "${r.id}" requires a raster source`)):C!=="raster-dem"&&f==="hillshade"?t.push(new lt(s,r.source,`layer "${r.id}" requires a raster-dem source`)):C==="raster"&&f!=="raster"?t.push(new lt(s,r.source,`layer "${r.id}" requires a vector source`)):C!=="vector"||r["source-layer"]?C==="raster-dem"&&f!=="hillshade"?t.push(new lt(s,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):f!=="line"||!r.paint||!r.paint["line-gradient"]||C==="geojson"&&b.lineMetrics||t.push(new lt(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new lt(s,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new lt(s,r.source,`source "${r.source}" not found`))}else t.push(new lt(s,r,'missing required property "source"'));return t=t.concat(Kr({key:s,value:r,valueSpec:d.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${s}.type`,value:r.type,valueSpec:d.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:Qo,layout:b=>Kr({layer:r,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":C=>Vs(En({layerType:f},C))}}),paint:b=>Kr({layer:r,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":C=>Ja(En({layerType:f},C))}})}})),t}function Hs(i){const t=i.value,r=i.key,s=gi(t);return s!=="string"?[new lt(r,t,`string expected, ${s} found`)]:[]}const js={promoteId:function({key:i,value:t}){if(gi(t)==="string")return Hs({key:i,value:t});{const r=[];for(const s in t)r.push(...Hs({key:`${i}.${s}`,value:t[s]}));return r}}};function Ka(i){const t=i.value,r=i.key,s=i.styleSpec,l=i.style,d=i.validateSpec;if(!t.type)return[new lt(r,t,'"type" is required')];const f=Xi(t.type);let y;switch(f){case"vector":case"raster":return y=Kr({key:r,value:t,valueSpec:s[`source_${f.replace("-","_")}`],style:i.style,styleSpec:s,objectElementValidators:js,validateSpec:d}),y;case"raster-dem":return y=function(b){var C;const D=(C=b.sourceName)!==null&&C!==void 0?C:"",R=b.value,N=b.styleSpec,J=N.source_raster_dem,X=b.style;let W=[];const fe=gi(R);if(R===void 0)return W;if(fe!=="object")return W.push(new lt("source_raster_dem",R,`object expected, ${fe} found`)),W;const ye=Xi(R.encoding)==="custom",Me=["redFactor","greenFactor","blueFactor","baseShift"],ve=b.value.encoding?`"${b.value.encoding}"`:"Default";for(const ke in R)!ye&&Me.includes(ke)?W.push(new lt(ke,R[ke],`In "${D}": "${ke}" is only valid when "encoding" is set to "custom". ${ve} encoding found`)):J[ke]?W=W.concat(b.validateSpec({key:ke,value:R[ke],valueSpec:J[ke],validateSpec:b.validateSpec,style:X,styleSpec:N})):W.push(new lt(ke,R[ke],`unknown property "${ke}"`));return W}({sourceName:r,value:t,style:i.style,styleSpec:s,validateSpec:d}),y;case"geojson":if(y=Kr({key:r,value:t,valueSpec:s.source_geojson,style:l,styleSpec:s,validateSpec:d,objectElementValidators:js}),t.cluster)for(const b in t.clusterProperties){const[C,D]=t.clusterProperties[b],R=typeof C=="string"?[C,["accumulated"],["get",b]]:C;y.push(...Qr({key:`${r}.${b}.map`,value:D,expressionContext:"cluster-map"})),y.push(...Qr({key:`${r}.${b}.reduce`,value:R,expressionContext:"cluster-reduce"}))}return y;case"video":return Kr({key:r,value:t,valueSpec:s.source_video,style:l,validateSpec:d,styleSpec:s});case"image":return Kr({key:r,value:t,valueSpec:s.source_image,style:l,validateSpec:d,styleSpec:s});case"canvas":return[new lt(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return bn({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function va(i){const t=i.value,r=i.styleSpec,s=r.light,l=i.style;let d=[];const f=gi(t);if(t===void 0)return d;if(f!=="object")return d=d.concat([new lt("light",t,`object expected, ${f} found`)]),d;for(const y in t){const b=y.match(/^(.*)-transition$/);d=d.concat(b&&s[b[1]]&&s[b[1]].transition?i.validateSpec({key:y,value:t[y],valueSpec:r.transition,validateSpec:i.validateSpec,style:l,styleSpec:r}):s[y]?i.validateSpec({key:y,value:t[y],valueSpec:s[y],validateSpec:i.validateSpec,style:l,styleSpec:r}):[new lt(y,t[y],`unknown property "${y}"`)])}return d}function _l(i){const t=i.value,r=i.styleSpec,s=r.sky,l=i.style,d=gi(t);if(t===void 0)return[];if(d!=="object")return[new lt("sky",t,`object expected, ${d} found`)];let f=[];for(const y in t)f=f.concat(s[y]?i.validateSpec({key:y,value:t[y],valueSpec:s[y],style:l,styleSpec:r}):[new lt(y,t[y],`unknown property "${y}"`)]);return f}function Il(i){const t=i.value,r=i.styleSpec,s=r.terrain,l=i.style;let d=[];const f=gi(t);if(t===void 0)return d;if(f!=="object")return d=d.concat([new lt("terrain",t,`object expected, ${f} found`)]),d;for(const y in t)d=d.concat(s[y]?i.validateSpec({key:y,value:t[y],valueSpec:s[y],validateSpec:i.validateSpec,style:l,styleSpec:r}):[new lt(y,t[y],`unknown property "${y}"`)]);return d}function bl(i){let t=[];const r=i.value,s=i.key;if(Array.isArray(r)){const l=[],d=[];for(const f in r)r[f].id&&l.includes(r[f].id)&&t.push(new lt(s,r,`all the sprites' ids must be unique, but ${r[f].id} is duplicated`)),l.push(r[f].id),r[f].url&&d.includes(r[f].url)&&t.push(new lt(s,r,`all the sprites' URLs must be unique, but ${r[f].url} is duplicated`)),d.push(r[f].url),t=t.concat(Kr({key:`${s}[${f}]`,value:r[f],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return t}return Hs({key:s,value:r})}const Do={"*":()=>[],array:Ha,boolean:function(i){const t=i.value,r=i.key,s=gi(t);return s!=="boolean"?[new lt(r,t,`boolean expected, ${s} found`)]:[]},number:ja,color:function(i){const t=i.key,r=i.value,s=gi(r);return s!=="string"?[new lt(t,r,`color expected, ${s} found`)]:Bi.parse(String(r))?[]:[new lt(t,r,`color expected, "${r}" found`)]},constants:Vl,enum:bn,filter:Qo,function:Eo,layer:Ya,object:Kr,source:Ka,light:va,sky:_l,terrain:Il,projection:function(i){const t=i.value,r=i.styleSpec,s=r.projection,l=i.style,d=gi(t);if(t===void 0)return[];if(d!=="object")return[new lt("projection",t,`object expected, ${d} found`)];let f=[];for(const y in t)f=f.concat(s[y]?i.validateSpec({key:y,value:t[y],valueSpec:s[y],style:l,styleSpec:r}):[new lt(y,t[y],`unknown property "${y}"`)]);return f},string:Hs,formatted:function(i){return Hs(i).length===0?[]:Qr(i)},resolvedImage:function(i){return Hs(i).length===0?[]:Qr(i)},padding:function(i){const t=i.key,r=i.value;if(gi(r)==="array"){if(r.length<1||r.length>4)return[new lt(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];const s={type:"number"};let l=[];for(let d=0;d<r.length;d++)l=l.concat(i.validateSpec({key:`${t}[${d}]`,value:r[d],validateSpec:i.validateSpec,valueSpec:s}));return l}return ja({key:t,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const t=i.key,r=i.value,s=gi(r),l=i.styleSpec;if(s!=="array"||r.length<1||r.length%2!=0)return[new lt(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let d=[];for(let f=0;f<r.length;f+=2)d=d.concat(bn({key:`${t}[${f}]`,value:r[f],valueSpec:l.layout_symbol["text-anchor"]})),d=d.concat(Ha({key:`${t}[${f+1}]`,value:r[f+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:l}));return d},sprite:bl};function Kn(i){const t=i.value,r=i.valueSpec,s=i.styleSpec;return i.validateSpec=Kn,r.expression&&bo(Xi(t))?Eo(i):r.expression&&xo(In(t))?Qr(i):r.type&&Do[r.type]?Do[r.type](i):Kr(En({},i,{valueSpec:r.type?s[r.type]:r}))}function wl(i){const t=i.value,r=i.key,s=Hs(i);return s.length||(t.indexOf("{fontstack}")===-1&&s.push(new lt(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&s.push(new lt(r,t,'"glyphs" url must include a "{range}" token'))),s}function an(i,t=Re){let r=[];return r=r.concat(Kn({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:Kn,objectElementValidators:{glyphs:wl,"*":()=>[]}})),i.constants&&(r=r.concat(Vl({key:"constants",value:i.constants}))),Zn(r)}function Zr(i){return function(t){return i({...t,validateSpec:Kn})}}function Zn(i){return[].concat(i).sort((t,r)=>t.line-r.line)}function wn(i){return function(...t){return Zn(i.apply(this,t))}}an.source=wn(Zr(Ka)),an.sprite=wn(Zr(bl)),an.glyphs=wn(Zr(wl)),an.light=wn(Zr(va)),an.sky=wn(Zr(_l)),an.terrain=wn(Zr(Il)),an.layer=wn(Zr(Ya)),an.filter=wn(Zr(Qo)),an.paintProperty=wn(Zr(Ja)),an.layoutProperty=wn(Zr(Vs));const Js=an,on=Js.light,Hl=Js.sky,vl=Js.paintProperty,jl=Js.layoutProperty;function Mo(i,t){let r=!1;if(t&&t.length)for(const s of t)i.fire(new hi(new Error(s.message))),r=!0;return r}class $n{constructor(t,r,s){const l=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const f=new Int32Array(this.arrayBuffer);t=f[0],this.d=(r=f[1])+2*(s=f[2]);for(let b=0;b<this.d*this.d;b++){const C=f[3+b],D=f[3+b+1];l.push(C===D?null:f.subarray(C,D))}const y=f[3+l.length+1];this.keys=f.subarray(f[3+l.length],y),this.bboxes=f.subarray(y),this.insert=this._insertReadonly}else{this.d=r+2*s;for(let f=0;f<this.d*this.d;f++)l.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=s,this.scale=r/t,this.uid=0;const d=s/r*t;this.min=-d,this.max=t+d}insert(t,r,s,l,d){this._forEachCell(r,s,l,d,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(d)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,s,l,d,f){this.cells[d].push(f)}query(t,r,s,l,d){const f=this.min,y=this.max;if(t<=f&&r<=f&&y<=s&&y<=l&&!d)return Array.prototype.slice.call(this.keys);{const b=[];return this._forEachCell(t,r,s,l,this._queryCell,b,{},d),b}}_queryCell(t,r,s,l,d,f,y,b){const C=this.cells[d];if(C!==null){const D=this.keys,R=this.bboxes;for(let N=0;N<C.length;N++){const J=C[N];if(y[J]===void 0){const X=4*J;(b?b(R[X+0],R[X+1],R[X+2],R[X+3]):t<=R[X+2]&&r<=R[X+3]&&s>=R[X+0]&&l>=R[X+1])?(y[J]=!0,f.push(D[J])):y[J]=!1}}}}_forEachCell(t,r,s,l,d,f,y,b){const C=this._convertToCellCoord(t),D=this._convertToCellCoord(r),R=this._convertToCellCoord(s),N=this._convertToCellCoord(l);for(let J=C;J<=R;J++)for(let X=D;X<=N;X++){const W=this.d*X+J;if((!b||b(this._convertFromCellCoord(J),this._convertFromCellCoord(X),this._convertFromCellCoord(J+1),this._convertFromCellCoord(X+1)))&&d.call(this,t,r,s,l,W,f,y,b))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,r=3+this.cells.length+1+1;let s=0;for(let f=0;f<this.cells.length;f++)s+=this.cells[f].length;const l=new Int32Array(r+s+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;let d=r;for(let f=0;f<t.length;f++){const y=t[f];l[3+f]=d,l.set(y,d),d+=y.length}return l[3+t.length]=d,l.set(this.keys,d),d+=this.keys.length,l[3+t.length+1]=d,l.set(this.bboxes,d),d+=this.bboxes.length,l.buffer}static serialize(t,r){const s=t.toArrayBuffer();return r&&r.push(s),{buffer:s}}static deserialize(t){return new $n(t.buffer)}}const Sr={};function mt(i,t,r={}){if(Sr[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),Sr[i]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}mt("Object",Object),mt("TransferableGridIndex",$n),mt("Color",Bi),mt("Error",Error),mt("AJAXError",Vi),mt("ResolvedImage",Hr),mt("StylePropertyFunction",Yn),mt("StyleExpression",Ia,{omit:["_evaluator"]}),mt("ZoomDependentExpression",Jn),mt("ZoomConstantExpression",Ln),mt("CompoundExpression",Yr,{omit:["_evaluate"]});for(const i in gs)gs[i]._classRegistryKey||mt(`Expression_${i}`,gs[i]);function xa(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Za(i){return i.$name||i.constructor._classRegistryKey}function $a(i){return!function(t){if(t===null||typeof t!="object")return!1;const r=Za(t);return!(!r||r==="Object")}(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||xa(i)||ni(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function Xn(i,t){if($a(i))return(xa(i)||ni(i))&&t&&t.push(i),ArrayBuffer.isView(i)&&t&&t.push(i.buffer),i instanceof ImageData&&t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const d=[];for(const f of i)d.push(Xn(f,t));return d}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const r=Za(i);if(!r)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!Sr[r])throw new Error(`${r} is not registered.`);const{klass:s}=Sr[r],l=s.serialize?s.serialize(i,t):{};if(s.serialize){if(t&&l===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const d in i){if(!i.hasOwnProperty(d)||Sr[r].omit.indexOf(d)>=0)continue;const f=i[d];l[d]=Sr[r].shallow.indexOf(d)>=0?f:Xn(f,t)}i instanceof Error&&(l.message=i.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(l.$name=r),l}function _s(i){if($a(i))return i;if(Array.isArray(i))return i.map(_s);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const t=Za(i)||"Object";if(!Sr[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:r}=Sr[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(i);const s=Object.create(r.prototype);for(const l of Object.keys(i)){if(l==="$name")continue;const d=i[l];s[l]=Sr[t].shallow.indexOf(l)>=0?d:_s(d)}return s}class Li{constructor(){this.first=!0}update(t,r){const s=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=s,!0))}}const oi={"Latin-1 Supplement":i=>i>=128&&i<=255,"Hangul Jamo":i=>i>=4352&&i<=4607,Khmer:i=>i>=6016&&i<=6143,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Katakana:i=>i>=12448&&i<=12543,Kanbun:i=>i>=12688&&i<=12703,"CJK Strokes":i=>i>=12736&&i<=12783,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"Private Use Area":i=>i>=57344&&i<=63743,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function xl(i){for(const t of i)if(Xa(t.charCodeAt(0)))return!0;return!1}function Ys(i){for(const t of i)if(!Ks(t.charCodeAt(0)))return!1;return!0}function To(i){const t=i.map(r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}}).filter(r=>r);return new RegExp(t.join("|"),"u")}const Jl=To(["Arab","Dupl","Mong","Ougr","Syrc"]);function Ks(i){return!Jl.test(String.fromCodePoint(i))}const Bl=To(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Xa(i){return!(i!==746&&i!==747&&(i<4352||!(oi["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||oi["CJK Compatibility"](i)||oi["CJK Strokes"](i)||!(!oi["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||oi["Enclosed CJK Letters and Months"](i)||oi["Ideographic Description Characters"](i)||oi.Kanbun(i)||oi.Katakana(i)&&i!==12540||!(!oi["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!oi["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||oi["Vertical Forms"](i)||oi["Yijing Hexagram Symbols"](i)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(i))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(i))||Bl.test(String.fromCodePoint(i)))))}function Po(i){return!(Xa(i)||function(t){return!!(oi["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||oi["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||oi["Letterlike Symbols"](t)||oi["Number Forms"](t)||oi["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||oi["Control Pictures"](t)&&t!==9251||oi["Optical Character Recognition"](t)||oi["Enclosed Alphanumerics"](t)||oi["Geometric Shapes"](t)||oi["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||oi["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||oi["CJK Symbols and Punctuation"](t)||oi.Katakana(t)||oi["Private Use Area"](t)||oi["CJK Compatibility Forms"](t)||oi["Small Form Variants"](t)||oi["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}const Yl=To(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Cl(i){return Yl.test(String.fromCodePoint(i))}function Kl(i,t){return!(!t&&Cl(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||oi.Khmer(i))}function mc(i){for(const t of i)if(Cl(t.charCodeAt(0)))return!0;return!1}const ir=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Fi{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Li,this.transition={})}isSupportedScript(t){return function(r,s){for(const l of r)if(!Kl(l.charCodeAt(0),s))return!1;return!0}(t,ir.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,r=t-Math.floor(t),s=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*r}}}class Zs{constructor(t,r){this.property=t,this.value=r,this.expression=function(s,l){if(bo(s))return new Yn(s,l);if(xo(s)){const d=wa(s,l);if(d.result==="error")throw new Error(d.value.map(f=>`${f.key}: ${f.message}`).join(", "));return d.value}{let d=s;return l.type==="color"&&typeof s=="string"?d=Bi.parse(s):l.type!=="padding"||typeof s!="number"&&!Array.isArray(s)?l.type==="variableAnchorOffsetCollection"&&Array.isArray(s)&&(d=Pr.parse(s)):d=Vr.parse(s),{kind:"constant",evaluate:()=>d}}}(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,r,s){return this.property.possiblyEvaluate(this,t,r,s)}}class Ro{constructor(t){this.property=t,this.value=new Zs(t,void 0)}transitioned(t,r){return new Ba(this.property,this.value,r,ut({},t.transition,this.transition),t.now)}untransitioned(){return new Ba(this.property,this.value,null,{},0)}}class Lo{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return St(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Ro(this._values[t].property)),this._values[t].value=new Zs(this._values[t].property,r===null?void 0:St(r))}getTransition(t){return St(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Ro(this._values[t].property)),this._values[t].transition=St(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(t[r]=s);const l=this.getTransition(r);l!==void 0&&(t[`${r}-transition`]=l)}return t}transitioned(t,r){const s=new $s(this._properties);for(const l of Object.keys(this._values))s._values[l]=this._values[l].transitioned(t,r._values[l]);return s}untransitioned(){const t=new $s(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class Ba{constructor(t,r,s,l,d){this.property=t,this.value=r,this.begin=d+l.delay||0,this.end=this.begin+l.duration||0,t.specification.transition&&(l.delay||l.duration)&&(this.prior=s)}possiblyEvaluate(t,r,s){const l=t.now||0,d=this.value.possiblyEvaluate(t,r,s),f=this.prior;if(f){if(l>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(l<this.begin)return f.possiblyEvaluate(t,r,s);{const y=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(t,r,s),d,function(b){if(b<=0)return 0;if(b>=1)return 1;const C=b*b,D=C*b;return 4*(b<.5?D:3*(b-C)+D-.75)}(y))}}return d}}class $s{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,s){const l=new Ca(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].possiblyEvaluate(t,r,s);return l}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Xs{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return St(this._values[t].value)}setValue(t,r){this._values[t]=new Zs(this._values[t].property,r===null?void 0:St(r))}serialize(){const t={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(t[r]=s)}return t}possiblyEvaluate(t,r,s){const l=new Ca(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].possiblyEvaluate(t,r,s);return l}}class Fn{constructor(t,r,s){this.property=t,this.value=r,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,s,l){return this.property.evaluate(this.value,this.parameters,t,r,s,l)}}class Ca{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Qt{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,s){const l=pr[this.specification.type];return l?l(t,r,s):t}}class Ut{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,s,l){return new Fn(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},s,l)}:t.expression,r)}interpolate(t,r,s){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new Fn(this,{kind:"constant",value:void 0},t.parameters);const l=pr[this.specification.type];if(l){const d=l(t.value.value,r.value.value,s);return new Fn(this,{kind:"constant",value:d},t.parameters)}return t}evaluate(t,r,s,l,d,f){return t.kind==="constant"?t.value:t.evaluate(r,s,l,d,f)}}class Fo extends Ut{possiblyEvaluate(t,r,s,l){if(t.value===void 0)return new Fn(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){const d=t.expression.evaluate(r,null,{},s,l),f=t.property.specification.type==="resolvedImage"&&typeof d!="string"?d.name:d,y=this._calculate(f,f,f,r);return new Fn(this,{kind:"constant",value:y},r)}if(t.expression.kind==="camera"){const d=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new Fn(this,{kind:"constant",value:d},r)}return new Fn(this,t.expression,r)}evaluate(t,r,s,l,d,f){if(t.kind==="source"){const y=t.evaluate(r,s,l,d,f);return this._calculate(y,y,y,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},s,l),t.evaluate({zoom:Math.floor(r.zoom)},s,l),t.evaluate({zoom:Math.floor(r.zoom)+1},s,l),r):t.value}_calculate(t,r,s,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:s,to:r}}interpolate(t){return t}}class zo{constructor(t){this.specification=t}possiblyEvaluate(t,r,s,l){if(t.value!==void 0){if(t.expression.kind==="constant"){const d=t.expression.evaluate(r,null,{},s,l);return this._calculate(d,d,d,r)}return this._calculate(t.expression.evaluate(new Fi(Math.floor(r.zoom-1),r)),t.expression.evaluate(new Fi(Math.floor(r.zoom),r)),t.expression.evaluate(new Fi(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,s,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:s,to:r}}interpolate(t){return t}}class El{constructor(t){this.specification=t}possiblyEvaluate(t,r,s,l){return!!t.expression.evaluate(r,null,{},s,l)}interpolate(){return!1}}class u{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in t){const s=t[r];s.specification.overridable&&this.overridableProperties.push(r);const l=this.defaultPropertyValues[r]=new Zs(s,void 0),d=this.defaultTransitionablePropertyValues[r]=new Ro(s);this.defaultTransitioningPropertyValues[r]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=l.possiblyEvaluate({})}}}mt("DataDrivenProperty",Ut),mt("DataConstantProperty",Qt),mt("CrossFadedDataDrivenProperty",Fo),mt("CrossFadedProperty",zo),mt("ColorRampProperty",El);const e="-transition";class n extends si{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),r.layout&&(this._unevaluatedLayout=new Xs(r.layout)),r.paint)){this._transitionablePaint=new Lo(r.paint);for(const s in t.paint)this.setPaintProperty(s,t.paint[s],{validate:!1});for(const s in t.layout)this.setLayoutProperty(s,t.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ca(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r,s={}){r!=null&&this._validate(jl,`layers.${this.id}.layout.${t}`,t,r,s)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,s={}){if(r!=null&&this._validate(vl,`layers.${this.id}.paint.${t}`,t,r,s))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{const l=this._transitionablePaint._values[t],d=l.property.specification["property-type"]==="cross-faded-data-driven",f=l.value.isDataDriven(),y=l.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);const b=this._transitionablePaint._values[t].value;return b.isDataDriven()||f||d||this._handleOverridablePaintPropertyUpdate(t,y,b)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,s){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Gt(t,(r,s)=>!(r===void 0||s==="layout"&&!Object.keys(r).length||s==="paint"&&!Object.keys(r).length))}_validate(t,r,s,l,d={}){return(!d||d.validate!==!1)&&Mo(this,t.call(Js,{key:r,layerType:this.type,objectKey:s,value:l,styleSpec:Re,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof Fn&&Us(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const a={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class o{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class h{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function _(i,t=1){let r=0,s=0;return{members:i.map(l=>{const d=a[l.type].BYTES_PER_ELEMENT,f=r=w(r,Math.max(t,d)),y=l.components||1;return s=Math.max(s,d),r+=d*y,{name:l.name,type:l.type,components:y,offset:f}}),size:w(r,Math.max(s,t)),alignment:t}}function w(i,t){return Math.ceil(i/t)*t}class B extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const l=2*t;return this.int16[l+0]=r,this.int16[l+1]=s,t}}B.prototype.bytesPerElement=4,mt("StructArrayLayout2i4",B);class M extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const d=3*t;return this.int16[d+0]=r,this.int16[d+1]=s,this.int16[d+2]=l,t}}M.prototype.bytesPerElement=6,mt("StructArrayLayout3i6",M);class L extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,s,l)}emplace(t,r,s,l,d){const f=4*t;return this.int16[f+0]=r,this.int16[f+1]=s,this.int16[f+2]=l,this.int16[f+3]=d,t}}L.prototype.bytesPerElement=8,mt("StructArrayLayout4i8",L);class F extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,f){const y=this.length;return this.resize(y+1),this.emplace(y,t,r,s,l,d,f)}emplace(t,r,s,l,d,f,y){const b=6*t;return this.int16[b+0]=r,this.int16[b+1]=s,this.int16[b+2]=l,this.int16[b+3]=d,this.int16[b+4]=f,this.int16[b+5]=y,t}}F.prototype.bytesPerElement=12,mt("StructArrayLayout2i4i12",F);class $ extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,f){const y=this.length;return this.resize(y+1),this.emplace(y,t,r,s,l,d,f)}emplace(t,r,s,l,d,f,y){const b=4*t,C=8*t;return this.int16[b+0]=r,this.int16[b+1]=s,this.uint8[C+4]=l,this.uint8[C+5]=d,this.uint8[C+6]=f,this.uint8[C+7]=y,t}}$.prototype.bytesPerElement=8,mt("StructArrayLayout2i4ub8",$);class te extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const l=2*t;return this.float32[l+0]=r,this.float32[l+1]=s,t}}te.prototype.bytesPerElement=8,mt("StructArrayLayout2f8",te);class oe extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,f,y,b,C,D){const R=this.length;return this.resize(R+1),this.emplace(R,t,r,s,l,d,f,y,b,C,D)}emplace(t,r,s,l,d,f,y,b,C,D,R){const N=10*t;return this.uint16[N+0]=r,this.uint16[N+1]=s,this.uint16[N+2]=l,this.uint16[N+3]=d,this.uint16[N+4]=f,this.uint16[N+5]=y,this.uint16[N+6]=b,this.uint16[N+7]=C,this.uint16[N+8]=D,this.uint16[N+9]=R,t}}oe.prototype.bytesPerElement=20,mt("StructArrayLayout10ui20",oe);class p extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,f,y,b,C,D,R,N){const J=this.length;return this.resize(J+1),this.emplace(J,t,r,s,l,d,f,y,b,C,D,R,N)}emplace(t,r,s,l,d,f,y,b,C,D,R,N,J){const X=12*t;return this.int16[X+0]=r,this.int16[X+1]=s,this.int16[X+2]=l,this.int16[X+3]=d,this.uint16[X+4]=f,this.uint16[X+5]=y,this.uint16[X+6]=b,this.uint16[X+7]=C,this.int16[X+8]=D,this.int16[X+9]=R,this.int16[X+10]=N,this.int16[X+11]=J,t}}p.prototype.bytesPerElement=24,mt("StructArrayLayout4i4ui4i24",p);class g extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const d=3*t;return this.float32[d+0]=r,this.float32[d+1]=s,this.float32[d+2]=l,t}}g.prototype.bytesPerElement=12,mt("StructArrayLayout3f12",g);class A extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}A.prototype.bytesPerElement=4,mt("StructArrayLayout1ul4",A);class v extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,f,y,b,C){const D=this.length;return this.resize(D+1),this.emplace(D,t,r,s,l,d,f,y,b,C)}emplace(t,r,s,l,d,f,y,b,C,D){const R=10*t,N=5*t;return this.int16[R+0]=r,this.int16[R+1]=s,this.int16[R+2]=l,this.int16[R+3]=d,this.int16[R+4]=f,this.int16[R+5]=y,this.uint32[N+3]=b,this.uint16[R+8]=C,this.uint16[R+9]=D,t}}v.prototype.bytesPerElement=20,mt("StructArrayLayout6i1ul2ui20",v);class x extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,f){const y=this.length;return this.resize(y+1),this.emplace(y,t,r,s,l,d,f)}emplace(t,r,s,l,d,f,y){const b=6*t;return this.int16[b+0]=r,this.int16[b+1]=s,this.int16[b+2]=l,this.int16[b+3]=d,this.int16[b+4]=f,this.int16[b+5]=y,t}}x.prototype.bytesPerElement=12,mt("StructArrayLayout2i2i2i12",x);class Q extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,s,l,d)}emplace(t,r,s,l,d,f){const y=4*t,b=8*t;return this.float32[y+0]=r,this.float32[y+1]=s,this.float32[y+2]=l,this.int16[b+6]=d,this.int16[b+7]=f,t}}Q.prototype.bytesPerElement=16,mt("StructArrayLayout2f1f2i16",Q);class T extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,f){const y=this.length;return this.resize(y+1),this.emplace(y,t,r,s,l,d,f)}emplace(t,r,s,l,d,f,y){const b=16*t,C=4*t,D=8*t;return this.uint8[b+0]=r,this.uint8[b+1]=s,this.float32[C+1]=l,this.float32[C+2]=d,this.int16[D+6]=f,this.int16[D+7]=y,t}}T.prototype.bytesPerElement=16,mt("StructArrayLayout2ub2f2i16",T);class k extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const d=3*t;return this.uint16[d+0]=r,this.uint16[d+1]=s,this.uint16[d+2]=l,t}}k.prototype.bytesPerElement=6,mt("StructArrayLayout3ui6",k);class q extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,f,y,b,C,D,R,N,J,X,W,fe,ye){const Me=this.length;return this.resize(Me+1),this.emplace(Me,t,r,s,l,d,f,y,b,C,D,R,N,J,X,W,fe,ye)}emplace(t,r,s,l,d,f,y,b,C,D,R,N,J,X,W,fe,ye,Me){const ve=24*t,ke=12*t,Oe=48*t;return this.int16[ve+0]=r,this.int16[ve+1]=s,this.uint16[ve+2]=l,this.uint16[ve+3]=d,this.uint32[ke+2]=f,this.uint32[ke+3]=y,this.uint32[ke+4]=b,this.uint16[ve+10]=C,this.uint16[ve+11]=D,this.uint16[ve+12]=R,this.float32[ke+7]=N,this.float32[ke+8]=J,this.uint8[Oe+36]=X,this.uint8[Oe+37]=W,this.uint8[Oe+38]=fe,this.uint32[ke+10]=ye,this.int16[ve+22]=Me,t}}q.prototype.bytesPerElement=48,mt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",q);class G extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,f,y,b,C,D,R,N,J,X,W,fe,ye,Me,ve,ke,Oe,it,wt,qt,It,pt,Tt,Et){const xt=this.length;return this.resize(xt+1),this.emplace(xt,t,r,s,l,d,f,y,b,C,D,R,N,J,X,W,fe,ye,Me,ve,ke,Oe,it,wt,qt,It,pt,Tt,Et)}emplace(t,r,s,l,d,f,y,b,C,D,R,N,J,X,W,fe,ye,Me,ve,ke,Oe,it,wt,qt,It,pt,Tt,Et,xt){const Je=32*t,Lt=16*t;return this.int16[Je+0]=r,this.int16[Je+1]=s,this.int16[Je+2]=l,this.int16[Je+3]=d,this.int16[Je+4]=f,this.int16[Je+5]=y,this.int16[Je+6]=b,this.int16[Je+7]=C,this.uint16[Je+8]=D,this.uint16[Je+9]=R,this.uint16[Je+10]=N,this.uint16[Je+11]=J,this.uint16[Je+12]=X,this.uint16[Je+13]=W,this.uint16[Je+14]=fe,this.uint16[Je+15]=ye,this.uint16[Je+16]=Me,this.uint16[Je+17]=ve,this.uint16[Je+18]=ke,this.uint16[Je+19]=Oe,this.uint16[Je+20]=it,this.uint16[Je+21]=wt,this.uint16[Je+22]=qt,this.uint32[Lt+12]=It,this.float32[Lt+13]=pt,this.float32[Lt+14]=Tt,this.uint16[Je+30]=Et,this.uint16[Je+31]=xt,t}}G.prototype.bytesPerElement=64,mt("StructArrayLayout8i15ui1ul2f2ui64",G);class O extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}O.prototype.bytesPerElement=4,mt("StructArrayLayout1f4",O);class re extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const d=3*t;return this.uint16[6*t+0]=r,this.float32[d+1]=s,this.float32[d+2]=l,t}}re.prototype.bytesPerElement=12,mt("StructArrayLayout1ui2f12",re);class K extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const d=4*t;return this.uint32[2*t+0]=r,this.uint16[d+2]=s,this.uint16[d+3]=l,t}}K.prototype.bytesPerElement=8,mt("StructArrayLayout1ul2ui8",K);class U extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const l=2*t;return this.uint16[l+0]=r,this.uint16[l+1]=s,t}}U.prototype.bytesPerElement=4,mt("StructArrayLayout2ui4",U);class ne extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}ne.prototype.bytesPerElement=2,mt("StructArrayLayout1ui2",ne);class le extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,l){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,s,l)}emplace(t,r,s,l,d){const f=4*t;return this.float32[f+0]=r,this.float32[f+1]=s,this.float32[f+2]=l,this.float32[f+3]=d,t}}le.prototype.bytesPerElement=16,mt("StructArrayLayout4f16",le);class se extends o{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Qe(this.anchorPointX,this.anchorPointY)}}se.prototype.size=20;class ue extends v{get(t){return new se(this,t)}}mt("CollisionBoxArray",ue);class Ie extends o{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Ie.prototype.size=48;class pe extends q{get(t){return new Ie(this,t)}}mt("PlacedSymbolArray",pe);class Be extends o{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Be.prototype.size=64;class Y extends G{get(t){return new Be(this,t)}}mt("SymbolInstanceArray",Y);class z extends O{getoffsetX(t){return this.float32[1*t+0]}}mt("GlyphOffsetArray",z);class ce extends M{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}mt("SymbolLineVertexArray",ce);class ie extends o{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ie.prototype.size=12;class ae extends re{get(t){return new ie(this,t)}}mt("TextAnchorOffsetArray",ae);class Ae extends o{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ae.prototype.size=8;class Ce extends K{get(t){return new Ae(this,t)}}mt("FeatureIndexArray",Ce);class be extends B{}class xe extends B{}class ze extends B{}class qe extends F{}class Ve extends ${}class Ke extends te{}class ct extends oe{}class Ue extends p{}class Pe extends g{}class Ye extends A{}class vt extends x{}class ot extends T{}class Ct extends k{}class st extends U{}const yt=_([{name:"a_pos",components:2,type:"Int16"}],4),{members:gt}=yt;class nt{constructor(t=[]){this.segments=t}prepareSegment(t,r,s,l){let d=this.segments[this.segments.length-1];return t>nt.MAX_VERTEX_ARRAY_LENGTH&&mi(`Max vertices per segment is ${nt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!d||d.vertexLength+t>nt.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==l)&&(d={vertexOffset:r.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},l!==void 0&&(d.sortKey=l),this.segments.push(d)),d}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,s,l){return new nt([{vertexOffset:t,primitiveOffset:r,vertexLength:s,primitiveLength:l,vaos:{},sortKey:0}])}}function _t(i,t){return 256*(i=dt(Math.floor(i),0,255))+dt(Math.floor(t),0,255)}nt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,mt("SegmentVector",nt);const ci=_([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var $t={exports:{}},Ai={exports:{}};Ai.exports=function(i,t){var r,s,l,d,f,y,b,C;for(s=i.length-(r=3&i.length),l=t,f=3432918353,y=461845907,C=0;C<s;)b=255&i.charCodeAt(C)|(255&i.charCodeAt(++C))<<8|(255&i.charCodeAt(++C))<<16|(255&i.charCodeAt(++C))<<24,++C,l=27492+(65535&(d=5*(65535&(l=(l^=b=(65535&(b=(b=(65535&b)*f+(((b>>>16)*f&65535)<<16)&4294967295)<<15|b>>>17))*y+(((b>>>16)*y&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(d>>>16)&65535)<<16);switch(b=0,r){case 3:b^=(255&i.charCodeAt(C+2))<<16;case 2:b^=(255&i.charCodeAt(C+1))<<8;case 1:l^=b=(65535&(b=(b=(65535&(b^=255&i.charCodeAt(C)))*f+(((b>>>16)*f&65535)<<16)&4294967295)<<15|b>>>17))*y+(((b>>>16)*y&65535)<<16)&4294967295}return l^=i.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0};var di=Ai.exports,$r={exports:{}};$r.exports=function(i,t){for(var r,s=i.length,l=t^s,d=0;s>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(d)|(255&i.charCodeAt(++d))<<8|(255&i.charCodeAt(++d))<<16|(255&i.charCodeAt(++d))<<24))+((1540483477*(r>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),s-=4,++d;switch(s){case 3:l^=(255&i.charCodeAt(d+2))<<16;case 2:l^=(255&i.charCodeAt(d+1))<<8;case 1:l=1540483477*(65535&(l^=255&i.charCodeAt(d)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0};var wr=di,Is=$r.exports;$t.exports=wr,$t.exports.murmur3=wr,$t.exports.murmur2=Is;var jt=he($t.exports);class Xr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,s,l){this.ids.push(vn(t)),this.positions.push(r,s,l)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=vn(t);let s=0,l=this.ids.length-1;for(;s<l;){const f=s+l>>1;this.ids[f]>=r?l=f:s=f+1}const d=[];for(;this.ids[s]===r;)d.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return d}static serialize(t,r){const s=new Float64Array(t.ids),l=new Uint32Array(t.positions);return Wa(s,l,0,s.length-1),r&&r.push(s.buffer,l.buffer),{ids:s,positions:l}}static deserialize(t){const r=new Xr;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function vn(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:jt(String(i))}function Wa(i,t,r,s){for(;r<s;){const l=i[r+s>>1];let d=r-1,f=s+1;for(;;){do d++;while(i[d]<l);do f--;while(i[f]>l);if(d>=f)break;Wn(i,d,f),Wn(t,3*d,3*f),Wn(t,3*d+1,3*f+1),Wn(t,3*d+2,3*f+2)}f-r<s-f?(Wa(i,t,r,f),r=f+1):(Wa(i,t,f+1,s),s=f)}}function Wn(i,t,r){const s=i[t];i[t]=i[r],i[r]=s}mt("FeaturePositionMap",Xr);class fr{constructor(t,r){this.gl=t.gl,this.location=r}}class Ea extends fr{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class qc extends fr{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Vc extends fr{constructor(t,r){super(t,r),this.current=Bi.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Zl=new Float32Array(16);function zn(i){return[_t(255*i.r,255*i.g),_t(255*i.b,255*i.a)]}class Fr{constructor(t,r,s){this.value=t,this.uniformNames=r.map(l=>`u_${l}`),this.type=s}setUniform(t,r,s){t.set(s.constantOr(this.value))}getBinding(t,r,s){return this.type==="color"?new Vc(t,r):new Ea(t,r)}}class eo{constructor(t,r){this.uniformNames=r.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setUniform(t,r,s,l){const d=l==="u_pattern_to"?this.patternTo:l==="u_pattern_from"?this.patternFrom:l==="u_pixel_ratio_to"?this.pixelRatioTo:l==="u_pixel_ratio_from"?this.pixelRatioFrom:null;d&&t.set(d)}getBinding(t,r,s){return s.substr(0,9)==="u_pattern"?new qc(t,r):new Ea(t,r)}}class es{constructor(t,r,s,l){this.expression=t,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map(d=>({name:`a_${d}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(t,r,s,l,d){const f=this.paintVertexArray.length,y=this.expression.evaluate(new Fi(0),r,{},l,[],d);this.paintVertexArray.resize(t),this._setPaintValue(f,t,y)}updatePaintArray(t,r,s,l){const d=this.expression.evaluate({zoom:0},s,l);this._setPaintValue(t,r,d)}_setPaintValue(t,r,s){if(this.type==="color"){const l=zn(s);for(let d=t;d<r;d++)this.paintVertexArray.emplace(d,l[0],l[1])}else{for(let l=t;l<r;l++)this.paintVertexArray.emplace(l,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ws{constructor(t,r,s,l,d,f){this.expression=t,this.uniformNames=r.map(y=>`u_${y}_t`),this.type=s,this.useIntegerZoom=l,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=r.map(y=>({name:`a_${y}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(t,r,s,l,d){const f=this.expression.evaluate(new Fi(this.zoom),r,{},l,[],d),y=this.expression.evaluate(new Fi(this.zoom+1),r,{},l,[],d),b=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(b,t,f,y)}updatePaintArray(t,r,s,l){const d=this.expression.evaluate({zoom:this.zoom},s,l),f=this.expression.evaluate({zoom:this.zoom+1},s,l);this._setPaintValue(t,r,d,f)}_setPaintValue(t,r,s,l){if(this.type==="color"){const d=zn(s),f=zn(l);for(let y=t;y<r;y++)this.paintVertexArray.emplace(y,d[0],d[1],f[0],f[1])}else{for(let d=t;d<r;d++)this.paintVertexArray.emplace(d,s,l);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,l=dt(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);t.set(l)}getBinding(t,r,s){return new Ea(t,r)}}class Go{constructor(t,r,s,l,d,f){this.expression=t,this.type=r,this.useIntegerZoom=s,this.zoom=l,this.layerId=f,this.zoomInPaintVertexArray=new d,this.zoomOutPaintVertexArray=new d}populatePaintArray(t,r,s){const l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(l,t,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(t,r,s,l,d){this._setPaintValues(t,r,s.patterns&&s.patterns[this.layerId],d)}_setPaintValues(t,r,s,l){if(!l||!s)return;const{min:d,mid:f,max:y}=s,b=l[d],C=l[f],D=l[y];if(b&&C&&D)for(let R=t;R<r;R++)this.zoomInPaintVertexArray.emplace(R,C.tl[0],C.tl[1],C.br[0],C.br[1],b.tl[0],b.tl[1],b.br[0],b.br[1],C.pixelRatio,b.pixelRatio),this.zoomOutPaintVertexArray.emplace(R,C.tl[0],C.tl[1],C.br[0],C.br[1],D.tl[0],D.tl[1],D.br[0],D.br[1],C.pixelRatio,D.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,ci.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,ci.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class gu{constructor(t,r,s){this.binders={},this._buffers=[];const l=[];for(const d in t.paint._values){if(!s(d))continue;const f=t.paint.get(d);if(!(f instanceof Fn&&Us(f.property.specification)))continue;const y=Yd(d,t.type),b=f.value,C=f.property.specification.type,D=f.property.useIntegerZoom,R=f.property.specification["property-type"],N=R==="cross-faded"||R==="cross-faded-data-driven";if(b.kind==="constant")this.binders[d]=N?new eo(b.value,y):new Fr(b.value,y,C),l.push(`/u_${d}`);else if(b.kind==="source"||N){const J=pu(d,C,"source");this.binders[d]=N?new Go(b,C,D,r,J,t.id):new es(b,y,C,J),l.push(`/a_${d}`)}else{const J=pu(d,C,"composite");this.binders[d]=new Ws(b,y,C,D,r,J),l.push(`/z_${d}`)}}this.cacheKey=l.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof es||r instanceof Ws?r.maxValue:0}populatePaintArrays(t,r,s,l,d){for(const f in this.binders){const y=this.binders[f];(y instanceof es||y instanceof Ws||y instanceof Go)&&y.populatePaintArray(t,r,s,l,d)}}setConstantPatternPositions(t,r){for(const s in this.binders){const l=this.binders[s];l instanceof eo&&l.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,s,l,d){let f=!1;for(const y in t){const b=r.getPositions(y);for(const C of b){const D=s.feature(C.index);for(const R in this.binders){const N=this.binders[R];if((N instanceof es||N instanceof Ws||N instanceof Go)&&N.expression.isStateDependent===!0){const J=l.paint.get(R);N.expression=J.value,N.updatePaintArray(C.start,C.end,D,t[y],d),f=!0}}}}return f}defines(){const t=[];for(const r in this.binders){const s=this.binders[r];(s instanceof Fr||s instanceof eo)&&t.push(...s.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof es||s instanceof Ws)for(let l=0;l<s.paintVertexAttributes.length;l++)t.push(s.paintVertexAttributes[l].name);else if(s instanceof Go)for(let l=0;l<ci.members.length;l++)t.push(ci.members[l].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof Fr||s instanceof eo||s instanceof Ws)for(const l of s.uniformNames)t.push(l)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){const s=[];for(const l in this.binders){const d=this.binders[l];if(d instanceof Fr||d instanceof eo||d instanceof Ws){for(const f of d.uniformNames)if(r[f]){const y=d.getBinding(t,r[f],f);s.push({name:f,property:l,binding:y})}}}return s}setUniforms(t,r,s,l){for(const{name:d,property:f,binding:y}of r)this.binders[f].setUniform(y,l,s.get(f),d)}updatePaintBuffers(t){this._buffers=[];for(const r in this.binders){const s=this.binders[r];if(t&&s instanceof Go){const l=t.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(s instanceof es||s instanceof Ws)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(t){for(const r in this.binders){const s=this.binders[r];(s instanceof es||s instanceof Ws||s instanceof Go)&&s.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof es||r instanceof Ws||r instanceof Go)&&r.destroy()}}}class Ql{constructor(t,r,s=()=>!0){this.programConfigurations={};for(const l of t)this.programConfigurations[l.id]=new gu(l,r,s);this.needsUpload=!1,this._featureMap=new Xr,this._bufferOffset=0}populatePaintArrays(t,r,s,l,d,f){for(const y in this.programConfigurations)this.programConfigurations[y].populatePaintArrays(t,r,l,d,f);r.id!==void 0&&this._featureMap.add(r.id,s,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,s,l){for(const d of s)this.needsUpload=this.programConfigurations[d.id].updatePaintArrays(t,this._featureMap,r,d,l)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Yd(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function pu(i,t,r){const s={color:{source:te,composite:le},number:{source:O,composite:te}},l=function(d){return{"line-pattern":{source:ct,composite:ct},"fill-pattern":{source:ct,composite:ct},"fill-extrusion-pattern":{source:ct,composite:ct}}[d]}(i);return l&&l[r]||s[t][r]}mt("ConstantBinder",Fr),mt("CrossFadedConstantBinder",eo),mt("SourceExpressionBinder",es),mt("CrossFadedCompositeBinder",Go),mt("CompositeExpressionBinder",Ws),mt("ProgramConfiguration",gu,{omit:["_buffers"]}),mt("ProgramConfigurationSet",Ql);const gr=8192,ph=Math.pow(2,14)-1,mu=-ph-1;function Sl(i){const t=gr/i.extent,r=i.loadGeometry();for(let s=0;s<r.length;s++){const l=r[s];for(let d=0;d<l.length;d++){const f=l[d],y=Math.round(f.x*t),b=Math.round(f.y*t);f.x=dt(y,mu,ph),f.y=dt(b,mu,ph),(y<f.x||y>f.x+1||b<f.y||b>f.y+1)&&mi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function kl(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?Sl(i):[]}}function Hc(i,t,r,s,l){i.emplaceBack(2*t+(s+1)/2,2*r+(l+1)/2)}class mh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new xe,this.indexArray=new Ct,this.segments=new nt,this.programConfigurations=new Ql(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){const l=this.layers[0],d=[];let f=null,y=!1;l.type==="circle"&&(f=l.layout.get("circle-sort-key"),y=!f.isConstant());for(const{feature:b,id:C,index:D,sourceLayerIndex:R}of t){const N=this.layers[0]._featureFilter.needGeometry,J=kl(b,N);if(!this.layers[0]._featureFilter.filter(new Fi(this.zoom),J,s))continue;const X=y?f.evaluate(J,{},s):void 0,W={id:C,properties:b.properties,type:b.type,sourceLayerIndex:R,index:D,geometry:N?J.geometry:Sl(b),patterns:{},sortKey:X};d.push(W)}y&&d.sort((b,C)=>b.sortKey-C.sortKey);for(const b of d){const{geometry:C,index:D,sourceLayerIndex:R}=b,N=t[D].feature;this.addFeature(b,C,D,s),r.featureIndex.insert(N,C,D,R,this.index)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,gt),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,s,l){for(const d of r)for(const f of d){const y=f.x,b=f.y;if(y<0||y>=gr||b<0||b>=gr)continue;const C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),D=C.vertexLength;Hc(this.layoutVertexArray,y,b,-1,-1),Hc(this.layoutVertexArray,y,b,1,-1),Hc(this.layoutVertexArray,y,b,1,1),Hc(this.layoutVertexArray,y,b,-1,1),this.indexArray.emplaceBack(D,D+1,D+2),this.indexArray.emplaceBack(D,D+3,D+2),C.vertexLength+=4,C.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,{},l)}}function yu(i,t){for(let r=0;r<i.length;r++)if($l(t,i[r]))return!0;for(let r=0;r<t.length;r++)if($l(i,t[r]))return!0;return!!yh(i,t)}function Kd(i,t,r){return!!$l(i,t)||!!_h(t,i,r)}function _u(i,t){if(i.length===1)return bu(t,i[0]);for(let r=0;r<t.length;r++){const s=t[r];for(let l=0;l<s.length;l++)if($l(i,s[l]))return!0}for(let r=0;r<i.length;r++)if(bu(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(yh(i,t[r]))return!0;return!1}function Zd(i,t,r){if(i.length>1){if(yh(i,t))return!0;for(let s=0;s<t.length;s++)if(_h(t[s],i,r))return!0}for(let s=0;s<i.length;s++)if(_h(i[s],t,r))return!0;return!1}function yh(i,t){if(i.length===0||t.length===0)return!1;for(let r=0;r<i.length-1;r++){const s=i[r],l=i[r+1];for(let d=0;d<t.length-1;d++)if($d(s,l,t[d],t[d+1]))return!0}return!1}function $d(i,t,r,s){return ri(i,r,s)!==ri(t,r,s)&&ri(i,t,r)!==ri(i,t,s)}function _h(i,t,r){const s=r*r;if(t.length===1)return i.distSqr(t[0])<s;for(let l=1;l<t.length;l++)if(Iu(i,t[l-1],t[l])<s)return!0;return!1}function Iu(i,t,r){const s=t.distSqr(r);if(s===0)return i.distSqr(t);const l=((i.x-t.x)*(r.x-t.x)+(i.y-t.y)*(r.y-t.y))/s;return i.distSqr(l<0?t:l>1?r:r.sub(t)._mult(l)._add(t))}function bu(i,t){let r,s,l,d=!1;for(let f=0;f<i.length;f++){r=i[f];for(let y=0,b=r.length-1;y<r.length;b=y++)s=r[y],l=r[b],s.y>t.y!=l.y>t.y&&t.x<(l.x-s.x)*(t.y-s.y)/(l.y-s.y)+s.x&&(d=!d)}return d}function $l(i,t){let r=!1;for(let s=0,l=i.length-1;s<i.length;l=s++){const d=i[s],f=i[l];d.y>t.y!=f.y>t.y&&t.x<(f.x-d.x)*(t.y-d.y)/(f.y-d.y)+d.x&&(r=!r)}return r}function Xd(i,t,r){const s=r[0],l=r[2];if(i.x<s.x&&t.x<s.x||i.x>l.x&&t.x>l.x||i.y<s.y&&t.y<s.y||i.y>l.y&&t.y>l.y)return!1;const d=ri(i,t,r[0]);return d!==ri(i,t,r[1])||d!==ri(i,t,r[2])||d!==ri(i,t,r[3])}function yc(i,t,r){const s=t.paint.get(i).value;return s.kind==="constant"?s.value:r.programConfigurations.get(t.id).getMaxValue(i)}function jc(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Jc(i,t,r,s,l){if(!t[0]&&!t[1])return i;const d=Qe.convert(t)._mult(l);r==="viewport"&&d._rotate(-s);const f=[];for(let y=0;y<i.length;y++)f.push(i[y].sub(d));return f}let wu,vu;mt("CircleBucket",mh,{omit:["layers"]});var Wd={get paint(){return vu=vu||new u({"circle-radius":new Ut(Re.paint_circle["circle-radius"]),"circle-color":new Ut(Re.paint_circle["circle-color"]),"circle-blur":new Ut(Re.paint_circle["circle-blur"]),"circle-opacity":new Ut(Re.paint_circle["circle-opacity"]),"circle-translate":new Qt(Re.paint_circle["circle-translate"]),"circle-translate-anchor":new Qt(Re.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Qt(Re.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Qt(Re.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ut(Re.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ut(Re.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ut(Re.paint_circle["circle-stroke-opacity"])})},get layout(){return wu=wu||new u({"circle-sort-key":new Ut(Re.layout_circle["circle-sort-key"])})}},ln=1e-6,Xl=typeof Float32Array<"u"?Float32Array:Array;function Ih(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function xu(i,t,r){var s=t[0],l=t[1],d=t[2],f=t[3],y=t[4],b=t[5],C=t[6],D=t[7],R=t[8],N=t[9],J=t[10],X=t[11],W=t[12],fe=t[13],ye=t[14],Me=t[15],ve=r[0],ke=r[1],Oe=r[2],it=r[3];return i[0]=ve*s+ke*y+Oe*R+it*W,i[1]=ve*l+ke*b+Oe*N+it*fe,i[2]=ve*d+ke*C+Oe*J+it*ye,i[3]=ve*f+ke*D+Oe*X+it*Me,i[4]=(ve=r[4])*s+(ke=r[5])*y+(Oe=r[6])*R+(it=r[7])*W,i[5]=ve*l+ke*b+Oe*N+it*fe,i[6]=ve*d+ke*C+Oe*J+it*ye,i[7]=ve*f+ke*D+Oe*X+it*Me,i[8]=(ve=r[8])*s+(ke=r[9])*y+(Oe=r[10])*R+(it=r[11])*W,i[9]=ve*l+ke*b+Oe*N+it*fe,i[10]=ve*d+ke*C+Oe*J+it*ye,i[11]=ve*f+ke*D+Oe*X+it*Me,i[12]=(ve=r[12])*s+(ke=r[13])*y+(Oe=r[14])*R+(it=r[15])*W,i[13]=ve*l+ke*b+Oe*N+it*fe,i[14]=ve*d+ke*C+Oe*J+it*ye,i[15]=ve*f+ke*D+Oe*X+it*Me,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var _c,ef=xu;function Yc(i,t,r){var s=t[0],l=t[1],d=t[2],f=t[3];return i[0]=r[0]*s+r[4]*l+r[8]*d+r[12]*f,i[1]=r[1]*s+r[5]*l+r[9]*d+r[13]*f,i[2]=r[2]*s+r[6]*l+r[10]*d+r[14]*f,i[3]=r[3]*s+r[7]*l+r[11]*d+r[15]*f,i}_c=new Xl(4),Xl!=Float32Array&&(_c[0]=0,_c[1]=0,_c[2]=0,_c[3]=0);class tf extends n{constructor(t){super(t,Wd)}createBucket(t){return new mh(t)}queryRadius(t){const r=t;return yc("circle-radius",this,r)+yc("circle-stroke-width",this,r)+jc(this.paint.get("circle-translate"))}queryIntersectsFeature(t,r,s,l,d,f,y,b){const C=Jc(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,y),D=this.paint.get("circle-radius").evaluate(r,s)+this.paint.get("circle-stroke-width").evaluate(r,s),R=this.paint.get("circle-pitch-alignment")==="map",N=R?C:function(X,W){return X.map(fe=>Bu(fe,W))}(C,b),J=R?D*y:D;for(const X of l)for(const W of X){const fe=R?W:Bu(W,b);let ye=J;const Me=Yc([],[W.x,W.y,0,1],b);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ye*=Me[3]/f.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ye*=f.cameraToCenterDistance/Me[3]),Kd(N,fe,ye))return!0}return!1}}function Bu(i,t){const r=Yc([],[i.x,i.y,0,1],t);return new Qe(r[0]/r[3],r[1]/r[3])}class Cu extends mh{}let Eu;mt("HeatmapBucket",Cu,{omit:["layers"]});var rf={get paint(){return Eu=Eu||new u({"heatmap-radius":new Ut(Re.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ut(Re.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Qt(Re.paint_heatmap["heatmap-intensity"]),"heatmap-color":new El(Re.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Qt(Re.paint_heatmap["heatmap-opacity"])})}};function bh(i,{width:t,height:r},s,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==t*r*s)throw new RangeError(`mismatched image size. expected: ${l.length} but got: ${t*r*s}`)}else l=new Uint8Array(t*r*s);return i.width=t,i.height=r,i.data=l,i}function Qu(i,{width:t,height:r},s){if(t===i.width&&r===i.height)return;const l=bh({},{width:t,height:r},s);wh(i,l,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,r)},s),i.width=t,i.height=r,i.data=l.data}function wh(i,t,r,s,l,d){if(l.width===0||l.height===0)return t;if(l.width>i.width||l.height>i.height||r.x>i.width-l.width||r.y>i.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>t.width||l.height>t.height||s.x>t.width-l.width||s.y>t.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const f=i.data,y=t.data;if(f===y)throw new Error("srcData equals dstData, so image is already copied");for(let b=0;b<l.height;b++){const C=((r.y+b)*i.width+r.x)*d,D=((s.y+b)*t.width+s.x)*d;for(let R=0;R<l.width*d;R++)y[D+R]=f[C+R]}return t}class Ic{constructor(t,r){bh(this,t,1,r)}resize(t){Qu(this,t,1)}clone(){return new Ic({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,s,l,d){wh(t,r,s,l,d,1)}}class ts{constructor(t,r){bh(this,t,4,r)}resize(t){Qu(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new ts({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,s,l,d){wh(t,r,s,l,d,4)}}function Su(i){const t={},r=i.resolution||256,s=i.clips?i.clips.length:1,l=i.image||new ts({width:r,height:s});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const d=(f,y,b)=>{t[i.evaluationKey]=b;const C=i.expression.evaluate(t);l.data[f+y+0]=Math.floor(255*C.r/C.a),l.data[f+y+1]=Math.floor(255*C.g/C.a),l.data[f+y+2]=Math.floor(255*C.b/C.a),l.data[f+y+3]=Math.floor(255*C.a)};if(i.clips)for(let f=0,y=0;f<s;++f,y+=4*r)for(let b=0,C=0;b<r;b++,C+=4){const D=b/(r-1),{start:R,end:N}=i.clips[f];d(y,C,R*(1-D)+N*D)}else for(let f=0,y=0;f<r;f++,y+=4)d(0,y,f/(r-1));return l}mt("AlphaImage",Ic),mt("RGBAImage",ts);const vh="big-fb";class nf extends n{createBucket(t){return new Cu(t)}constructor(t){super(t,rf),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Su({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(vh)&&this.heatmapFbos.delete(vh)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let ku;var sf={get paint(){return ku=ku||new u({"hillshade-illumination-direction":new Qt(Re.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Qt(Re.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Qt(Re.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Qt(Re.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Qt(Re.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Qt(Re.paint_hillshade["hillshade-accent-color"])})}};class af extends n{constructor(t){super(t,sf)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const of=_([{name:"a_pos",components:2,type:"Int16"}],4),{members:lf}=of;function Du(i,t,r=2){const s=t&&t.length,l=s?t[0]*r:i.length;let d=Mu(i,0,l,r,!0);const f=[];if(!d||d.next===d.prev)return f;let y,b,C;if(s&&(d=function(D,R,N,J){const X=[];for(let W=0,fe=R.length;W<fe;W++){const ye=Mu(D,R[W]*J,W<fe-1?R[W+1]*J:D.length,J,!1);ye===ye.next&&(ye.steiner=!0),X.push(pf(ye))}X.sort(df);for(let W=0;W<X.length;W++)N=ff(X[W],N);return N}(i,t,d,r)),i.length>80*r){y=1/0,b=1/0;let D=-1/0,R=-1/0;for(let N=r;N<l;N+=r){const J=i[N],X=i[N+1];J<y&&(y=J),X<b&&(b=X),J>D&&(D=J),X>R&&(R=X)}C=Math.max(D-y,R-b),C=C!==0?32767/C:0}return bc(d,f,r,y,b,C,0),f}function Mu(i,t,r,s,l){let d;if(l===function(f,y,b,C){let D=0;for(let R=y,N=b-C;R<b;R+=C)D+=(f[N]-f[R])*(f[R+1]+f[N+1]),N=R;return D}(i,t,r,s)>0)for(let f=t;f<r;f+=s)d=Ru(f/s|0,i[f],i[f+1],d);else for(let f=r-s;f>=t;f-=s)d=Ru(f/s|0,i[f],i[f+1],d);return d&&Kc(d,d.next)&&(vc(d),d=d.next),d}function Dl(i,t){if(!i)return i;t||(t=i);let r,s=i;do if(r=!1,s.steiner||!Kc(s,s.next)&&hr(s.prev,s,s.next)!==0)s=s.next;else{if(vc(s),s=t=s.prev,s===s.next)break;r=!0}while(r||s!==t);return t}function bc(i,t,r,s,l,d,f){if(!i)return;!f&&d&&function(b,C,D,R){let N=b;do N.z===0&&(N.z=xh(N.x,N.y,C,D,R)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next;while(N!==b);N.prevZ.nextZ=null,N.prevZ=null,function(J){let X,W=1;do{let fe,ye=J;J=null;let Me=null;for(X=0;ye;){X++;let ve=ye,ke=0;for(let it=0;it<W&&(ke++,ve=ve.nextZ,ve);it++);let Oe=W;for(;ke>0||Oe>0&&ve;)ke!==0&&(Oe===0||!ve||ye.z<=ve.z)?(fe=ye,ye=ye.nextZ,ke--):(fe=ve,ve=ve.nextZ,Oe--),Me?Me.nextZ=fe:J=fe,fe.prevZ=Me,Me=fe;ye=ve}Me.nextZ=null,W*=2}while(X>1)}(N)}(i,s,l,d);let y=i;for(;i.prev!==i.next;){const b=i.prev,C=i.next;if(d?hf(i,s,l,d):cf(i))t.push(b.i,i.i,C.i),vc(i),i=C.next,y=C.next;else if((i=C)===y){f?f===1?bc(i=uf(Dl(i),t),t,r,s,l,d,2):f===2&&Af(i,t,r,s,l,d):bc(Dl(i),t,r,s,l,d,1);break}}}function cf(i){const t=i.prev,r=i,s=i.next;if(hr(t,r,s)>=0)return!1;const l=t.x,d=r.x,f=s.x,y=t.y,b=r.y,C=s.y,D=l<d?l<f?l:f:d<f?d:f,R=y<b?y<C?y:C:b<C?b:C,N=l>d?l>f?l:f:d>f?d:f,J=y>b?y>C?y:C:b>C?b:C;let X=s.next;for(;X!==t;){if(X.x>=D&&X.x<=N&&X.y>=R&&X.y<=J&&Wl(l,y,d,b,f,C,X.x,X.y)&&hr(X.prev,X,X.next)>=0)return!1;X=X.next}return!0}function hf(i,t,r,s){const l=i.prev,d=i,f=i.next;if(hr(l,d,f)>=0)return!1;const y=l.x,b=d.x,C=f.x,D=l.y,R=d.y,N=f.y,J=y<b?y<C?y:C:b<C?b:C,X=D<R?D<N?D:N:R<N?R:N,W=y>b?y>C?y:C:b>C?b:C,fe=D>R?D>N?D:N:R>N?R:N,ye=xh(J,X,t,r,s),Me=xh(W,fe,t,r,s);let ve=i.prevZ,ke=i.nextZ;for(;ve&&ve.z>=ye&&ke&&ke.z<=Me;){if(ve.x>=J&&ve.x<=W&&ve.y>=X&&ve.y<=fe&&ve!==l&&ve!==f&&Wl(y,D,b,R,C,N,ve.x,ve.y)&&hr(ve.prev,ve,ve.next)>=0||(ve=ve.prevZ,ke.x>=J&&ke.x<=W&&ke.y>=X&&ke.y<=fe&&ke!==l&&ke!==f&&Wl(y,D,b,R,C,N,ke.x,ke.y)&&hr(ke.prev,ke,ke.next)>=0))return!1;ke=ke.nextZ}for(;ve&&ve.z>=ye;){if(ve.x>=J&&ve.x<=W&&ve.y>=X&&ve.y<=fe&&ve!==l&&ve!==f&&Wl(y,D,b,R,C,N,ve.x,ve.y)&&hr(ve.prev,ve,ve.next)>=0)return!1;ve=ve.prevZ}for(;ke&&ke.z<=Me;){if(ke.x>=J&&ke.x<=W&&ke.y>=X&&ke.y<=fe&&ke!==l&&ke!==f&&Wl(y,D,b,R,C,N,ke.x,ke.y)&&hr(ke.prev,ke,ke.next)>=0)return!1;ke=ke.nextZ}return!0}function uf(i,t){let r=i;do{const s=r.prev,l=r.next.next;!Kc(s,l)&&Tu(s,r,r.next,l)&&wc(s,l)&&wc(l,s)&&(t.push(s.i,r.i,l.i),vc(r),vc(r.next),r=i=l),r=r.next}while(r!==i);return Dl(r)}function Af(i,t,r,s,l,d){let f=i;do{let y=f.next.next;for(;y!==f.prev;){if(f.i!==y.i&&mf(f,y)){let b=Pu(f,y);return f=Dl(f,f.next),b=Dl(b,b.next),bc(f,t,r,s,l,d,0),void bc(b,t,r,s,l,d,0)}y=y.next}f=f.next}while(f!==i)}function df(i,t){return i.x-t.x}function ff(i,t){const r=function(l,d){let f=d;const y=l.x,b=l.y;let C,D=-1/0;do{if(b<=f.y&&b>=f.next.y&&f.next.y!==f.y){const W=f.x+(b-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(W<=y&&W>D&&(D=W,C=f.x<f.next.x?f:f.next,W===y))return C}f=f.next}while(f!==d);if(!C)return null;const R=C,N=C.x,J=C.y;let X=1/0;f=C;do{if(y>=f.x&&f.x>=N&&y!==f.x&&Wl(b<J?y:D,b,N,J,b<J?D:y,b,f.x,f.y)){const W=Math.abs(b-f.y)/(y-f.x);wc(f,l)&&(W<X||W===X&&(f.x>C.x||f.x===C.x&&gf(C,f)))&&(C=f,X=W)}f=f.next}while(f!==R);return C}(i,t);if(!r)return t;const s=Pu(r,i);return Dl(s,s.next),Dl(r,r.next)}function gf(i,t){return hr(i.prev,i,t.prev)<0&&hr(t.next,i,i.next)<0}function xh(i,t,r,s,l){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*l|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-s)*l|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function pf(i){let t=i,r=i;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==i);return r}function Wl(i,t,r,s,l,d,f,y){return(l-f)*(t-y)>=(i-f)*(d-y)&&(i-f)*(s-y)>=(r-f)*(t-y)&&(r-f)*(d-y)>=(l-f)*(s-y)}function mf(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(r,s){let l=r;do{if(l.i!==r.i&&l.next.i!==r.i&&l.i!==s.i&&l.next.i!==s.i&&Tu(l,l.next,r,s))return!0;l=l.next}while(l!==r);return!1}(i,t)&&(wc(i,t)&&wc(t,i)&&function(r,s){let l=r,d=!1;const f=(r.x+s.x)/2,y=(r.y+s.y)/2;do l.y>y!=l.next.y>y&&l.next.y!==l.y&&f<(l.next.x-l.x)*(y-l.y)/(l.next.y-l.y)+l.x&&(d=!d),l=l.next;while(l!==r);return d}(i,t)&&(hr(i.prev,i,t.prev)||hr(i,t.prev,t))||Kc(i,t)&&hr(i.prev,i,i.next)>0&&hr(t.prev,t,t.next)>0)}function hr(i,t,r){return(t.y-i.y)*(r.x-t.x)-(t.x-i.x)*(r.y-t.y)}function Kc(i,t){return i.x===t.x&&i.y===t.y}function Tu(i,t,r,s){const l=$c(hr(i,t,r)),d=$c(hr(i,t,s)),f=$c(hr(r,s,i)),y=$c(hr(r,s,t));return l!==d&&f!==y||!(l!==0||!Zc(i,r,t))||!(d!==0||!Zc(i,s,t))||!(f!==0||!Zc(r,i,s))||!(y!==0||!Zc(r,t,s))}function Zc(i,t,r){return t.x<=Math.max(i.x,r.x)&&t.x>=Math.min(i.x,r.x)&&t.y<=Math.max(i.y,r.y)&&t.y>=Math.min(i.y,r.y)}function $c(i){return i>0?1:i<0?-1:0}function wc(i,t){return hr(i.prev,i,i.next)<0?hr(i,t,i.next)>=0&&hr(i,i.prev,t)>=0:hr(i,t,i.prev)<0||hr(i,i.next,t)<0}function Pu(i,t){const r=Bh(i.i,i.x,i.y),s=Bh(t.i,t.x,t.y),l=i.next,d=t.prev;return i.next=t,t.prev=i,r.next=l,l.prev=r,s.next=r,r.prev=s,d.next=s,s.prev=d,s}function Ru(i,t,r,s){const l=Bh(i,t,r);return s?(l.next=s.next,l.prev=s,s.next.prev=l,s.next=l):(l.prev=l,l.next=l),l}function vc(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Bh(i,t,r){return{i,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Ch(i,t,r){const s=r.patternDependencies;let l=!1;for(const d of t){const f=d.paint.get(`${i}-pattern`);f.isConstant()||(l=!0);const y=f.constantOr(null);y&&(l=!0,s[y.to]=!0,s[y.from]=!0)}return l}function Eh(i,t,r,s,l){const d=l.patternDependencies;for(const f of t){const y=f.paint.get(`${i}-pattern`).value;if(y.kind!=="constant"){let b=y.evaluate({zoom:s-1},r,{},l.availableImages),C=y.evaluate({zoom:s},r,{},l.availableImages),D=y.evaluate({zoom:s+1},r,{},l.availableImages);b=b&&b.name?b.name:b,C=C&&C.name?C.name:C,D=D&&D.name?D.name:D,d[b]=!0,d[C]=!0,d[D]=!0,r.patterns[f.id]={min:b,mid:C,max:D}}}return r}class Qh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ze,this.indexArray=new Ct,this.indexArray2=new st,this.programConfigurations=new Ql(t.layers,t.zoom),this.segments=new nt,this.segments2=new nt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){this.hasPattern=Ch("fill",this.layers,r);const l=this.layers[0].layout.get("fill-sort-key"),d=!l.isConstant(),f=[];for(const{feature:y,id:b,index:C,sourceLayerIndex:D}of t){const R=this.layers[0]._featureFilter.needGeometry,N=kl(y,R);if(!this.layers[0]._featureFilter.filter(new Fi(this.zoom),N,s))continue;const J=d?l.evaluate(N,{},s,r.availableImages):void 0,X={id:b,properties:y.properties,type:y.type,sourceLayerIndex:D,index:C,geometry:R?N.geometry:Sl(y),patterns:{},sortKey:J};f.push(X)}d&&f.sort((y,b)=>y.sortKey-b.sortKey);for(const y of f){const{geometry:b,index:C,sourceLayerIndex:D}=y;if(this.hasPattern){const R=Eh("fill",this.layers,y,this.zoom,r);this.patternFeatures.push(R)}else this.addFeature(y,b,C,s,{});r.featureIndex.insert(t[C].feature,b,C,D,this.index)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}addFeatures(t,r,s){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,lf),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,s,l,d){for(const f of Ga(r,500)){let y=0;for(const J of f)y+=J.length;const b=this.segments.prepareSegment(y,this.layoutVertexArray,this.indexArray),C=b.vertexLength,D=[],R=[];for(const J of f){if(J.length===0)continue;J!==f[0]&&R.push(D.length/2);const X=this.segments2.prepareSegment(J.length,this.layoutVertexArray,this.indexArray2),W=X.vertexLength;this.layoutVertexArray.emplaceBack(J[0].x,J[0].y),this.indexArray2.emplaceBack(W+J.length-1,W),D.push(J[0].x),D.push(J[0].y);for(let fe=1;fe<J.length;fe++)this.layoutVertexArray.emplaceBack(J[fe].x,J[fe].y),this.indexArray2.emplaceBack(W+fe-1,W+fe),D.push(J[fe].x),D.push(J[fe].y);X.vertexLength+=J.length,X.primitiveLength+=J.length}const N=Du(D,R);for(let J=0;J<N.length;J+=3)this.indexArray.emplaceBack(C+N[J],C+N[J+1],C+N[J+2]);b.vertexLength+=y,b.primitiveLength+=N.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,d,l)}}let Lu,Fu;mt("FillBucket",Qh,{omit:["layers","patternFeatures"]});var yf={get paint(){return Fu=Fu||new u({"fill-antialias":new Qt(Re.paint_fill["fill-antialias"]),"fill-opacity":new Ut(Re.paint_fill["fill-opacity"]),"fill-color":new Ut(Re.paint_fill["fill-color"]),"fill-outline-color":new Ut(Re.paint_fill["fill-outline-color"]),"fill-translate":new Qt(Re.paint_fill["fill-translate"]),"fill-translate-anchor":new Qt(Re.paint_fill["fill-translate-anchor"]),"fill-pattern":new Fo(Re.paint_fill["fill-pattern"])})},get layout(){return Lu=Lu||new u({"fill-sort-key":new Ut(Re.layout_fill["fill-sort-key"])})}};class _f extends n{constructor(t){super(t,yf)}recalculate(t,r){super.recalculate(t,r);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Qh(t)}queryRadius(){return jc(this.paint.get("fill-translate"))}queryIntersectsFeature(t,r,s,l,d,f,y){return _u(Jc(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,y),l)}isTileClipped(){return!0}}const If=_([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),bf=_([{name:"a_centroid",components:2,type:"Int16"}],4),{members:wf}=If;var Uo={},vf=Ee,zu=ec;function ec(i,t,r,s,l){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=s,this._values=l,i.readFields(xf,this,t)}function xf(i,t,r){i==1?t.id=r.readVarint():i==2?function(s,l){for(var d=s.readVarint()+s.pos;s.pos<d;){var f=l._keys[s.readVarint()],y=l._values[s.readVarint()];l.properties[f]=y}}(r,t):i==3?t.type=r.readVarint():i==4&&(t._geometry=r.pos)}function Bf(i){for(var t,r,s=0,l=0,d=i.length,f=d-1;l<d;f=l++)s+=((r=i[f]).x-(t=i[l]).x)*(t.y+r.y);return s}ec.types=["Unknown","Point","LineString","Polygon"],ec.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,r=i.readVarint()+i.pos,s=1,l=0,d=0,f=0,y=[];i.pos<r;){if(l<=0){var b=i.readVarint();s=7&b,l=b>>3}if(l--,s===1||s===2)d+=i.readSVarint(),f+=i.readSVarint(),s===1&&(t&&y.push(t),t=[]),t.push(new vf(d,f));else{if(s!==7)throw new Error("unknown command "+s);t&&t.push(t[0].clone())}}return t&&y.push(t),y},ec.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,r=1,s=0,l=0,d=0,f=1/0,y=-1/0,b=1/0,C=-1/0;i.pos<t;){if(s<=0){var D=i.readVarint();r=7&D,s=D>>3}if(s--,r===1||r===2)(l+=i.readSVarint())<f&&(f=l),l>y&&(y=l),(d+=i.readSVarint())<b&&(b=d),d>C&&(C=d);else if(r!==7)throw new Error("unknown command "+r)}return[f,b,y,C]},ec.prototype.toGeoJSON=function(i,t,r){var s,l,d=this.extent*Math.pow(2,r),f=this.extent*i,y=this.extent*t,b=this.loadGeometry(),C=ec.types[this.type];function D(J){for(var X=0;X<J.length;X++){var W=J[X];J[X]=[360*(W.x+f)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*(W.y+y)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var R=[];for(s=0;s<b.length;s++)R[s]=b[s][0];D(b=R);break;case 2:for(s=0;s<b.length;s++)D(b[s]);break;case 3:for(b=function(J){var X=J.length;if(X<=1)return[J];for(var W,fe,ye=[],Me=0;Me<X;Me++){var ve=Bf(J[Me]);ve!==0&&(fe===void 0&&(fe=ve<0),fe===ve<0?(W&&ye.push(W),W=[J[Me]]):W.push(J[Me]))}return W&&ye.push(W),ye}(b),s=0;s<b.length;s++)for(l=0;l<b[s].length;l++)D(b[s][l])}b.length===1?b=b[0]:C="Multi"+C;var N={type:"Feature",geometry:{type:C,coordinates:b},properties:this.properties};return"id"in this&&(N.id=this.id),N};var Cf=zu,Gu=Uu;function Uu(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Ef,this,t),this.length=this._features.length}function Ef(i,t,r){i===15?t.version=r.readVarint():i===1?t.name=r.readString():i===5?t.extent=r.readVarint():i===2?t._features.push(r.pos):i===3?t._keys.push(r.readString()):i===4&&t._values.push(function(s){for(var l=null,d=s.readVarint()+s.pos;s.pos<d;){var f=s.readVarint()>>3;l=f===1?s.readString():f===2?s.readFloat():f===3?s.readDouble():f===4?s.readVarint64():f===5?s.readVarint():f===6?s.readSVarint():f===7?s.readBoolean():null}return l}(r))}Uu.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new Cf(this._pbf,t,this.extent,this._keys,this._values)};var Qf=Gu;function Sf(i,t,r){if(i===3){var s=new Qf(r,r.readVarint()+r.pos);s.length&&(t[s.name]=s)}}Uo.VectorTile=function(i,t){this.layers=i.readFields(Sf,{},t)},Uo.VectorTileFeature=zu,Uo.VectorTileLayer=Gu;const kf=Uo.VectorTileFeature.types,Sh=Math.pow(2,13);function xc(i,t,r,s,l,d,f,y){i.emplaceBack(t,r,2*Math.floor(s*Sh)+f,l*Sh*2,d*Sh*2,Math.round(y))}class kh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new qe,this.centroidVertexArray=new be,this.indexArray=new Ct,this.programConfigurations=new Ql(t.layers,t.zoom),this.segments=new nt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){this.features=[],this.hasPattern=Ch("fill-extrusion",this.layers,r);for(const{feature:l,id:d,index:f,sourceLayerIndex:y}of t){const b=this.layers[0]._featureFilter.needGeometry,C=kl(l,b);if(!this.layers[0]._featureFilter.filter(new Fi(this.zoom),C,s))continue;const D={id:d,sourceLayerIndex:y,index:f,geometry:b?C.geometry:Sl(l),properties:l.properties,type:l.type,patterns:{}};this.hasPattern?this.features.push(Eh("fill-extrusion",this.layers,D,this.zoom,r)):this.addFeature(D,D.geometry,f,s,{}),r.featureIndex.insert(l,D.geometry,f,y,this.index,!0)}}addFeatures(t,r,s){for(const l of this.features){const{geometry:d}=l;this.addFeature(l,d,l.index,r,s)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,wf),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,bf.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,s,l,d){for(const f of Ga(r,500)){const y={x:0,y:0,vertexCount:0};let b=0;for(const X of f)b+=X.length;let C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const X of f){if(X.length===0||Mf(X))continue;let W=0;for(let fe=0;fe<X.length;fe++){const ye=X[fe];if(fe>=1){const Me=X[fe-1];if(!Df(ye,Me)){C.vertexLength+4>nt.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ve=ye.sub(Me)._perp()._unit(),ke=Me.dist(ye);W+ke>32768&&(W=0),xc(this.layoutVertexArray,ye.x,ye.y,ve.x,ve.y,0,0,W),xc(this.layoutVertexArray,ye.x,ye.y,ve.x,ve.y,0,1,W),y.x+=2*ye.x,y.y+=2*ye.y,y.vertexCount+=2,W+=ke,xc(this.layoutVertexArray,Me.x,Me.y,ve.x,ve.y,0,0,W),xc(this.layoutVertexArray,Me.x,Me.y,ve.x,ve.y,0,1,W),y.x+=2*Me.x,y.y+=2*Me.y,y.vertexCount+=2;const Oe=C.vertexLength;this.indexArray.emplaceBack(Oe,Oe+2,Oe+1),this.indexArray.emplaceBack(Oe+1,Oe+2,Oe+3),C.vertexLength+=4,C.primitiveLength+=2}}}}if(C.vertexLength+b>nt.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray)),kf[t.type]!=="Polygon")continue;const D=[],R=[],N=C.vertexLength;for(const X of f)if(X.length!==0){X!==f[0]&&R.push(D.length/2);for(let W=0;W<X.length;W++){const fe=X[W];xc(this.layoutVertexArray,fe.x,fe.y,0,0,1,1,0),y.x+=fe.x,y.y+=fe.y,y.vertexCount+=1,D.push(fe.x),D.push(fe.y)}}const J=Du(D,R);for(let X=0;X<J.length;X+=3)this.indexArray.emplaceBack(N+J[X],N+J[X+2],N+J[X+1]);C.primitiveLength+=J.length/3,C.vertexLength+=b;for(let X=0;X<y.vertexCount;X++){const W=Math.floor(y.x/y.vertexCount),fe=Math.floor(y.y/y.vertexCount);this.centroidVertexArray.emplaceBack(W,fe)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,d,l)}}function Df(i,t){return i.x===t.x&&(i.x<0||i.x>gr)||i.y===t.y&&(i.y<0||i.y>gr)}function Mf(i){return i.every(t=>t.x<0)||i.every(t=>t.x>gr)||i.every(t=>t.y<0)||i.every(t=>t.y>gr)}let Nu;mt("FillExtrusionBucket",kh,{omit:["layers","features"]});var Tf={get paint(){return Nu=Nu||new u({"fill-extrusion-opacity":new Qt(Re["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ut(Re["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Qt(Re["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Qt(Re["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Fo(Re["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ut(Re["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ut(Re["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Qt(Re["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Pf extends n{constructor(t){super(t,Tf)}createBucket(t){return new kh(t)}queryRadius(){return jc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,r,s,l,d,f,y,b){const C=Jc(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,y),D=this.paint.get("fill-extrusion-height").evaluate(r,s),R=this.paint.get("fill-extrusion-base").evaluate(r,s),N=function(X,W,fe,ye){const Me=[];for(const ve of X){const ke=[ve.x,ve.y,0,1];Yc(ke,ke,W),Me.push(new Qe(ke[0]/ke[3],ke[1]/ke[3]))}return Me}(C,b),J=function(X,W,fe,ye){const Me=[],ve=[],ke=ye[8]*W,Oe=ye[9]*W,it=ye[10]*W,wt=ye[11]*W,qt=ye[8]*fe,It=ye[9]*fe,pt=ye[10]*fe,Tt=ye[11]*fe;for(const Et of X){const xt=[],Je=[];for(const Lt of Et){const kt=Lt.x,Jt=Lt.y,zi=ye[0]*kt+ye[4]*Jt+ye[12],Mi=ye[1]*kt+ye[5]*Jt+ye[13],vr=ye[2]*kt+ye[6]*Jt+ye[14],bs=ye[3]*kt+ye[7]*Jt+ye[15],Gr=vr+it,xr=bs+wt,cn=zi+qt,hn=Mi+It,un=vr+pt,lr=bs+Tt,Br=new Qe((zi+ke)/xr,(Mi+Oe)/xr);Br.z=Gr/xr,xt.push(Br);const Wr=new Qe(cn/lr,hn/lr);Wr.z=un/lr,Je.push(Wr)}Me.push(xt),ve.push(Je)}return[Me,ve]}(l,R,D,b);return function(X,W,fe){let ye=1/0;_u(fe,W)&&(ye=Ou(fe,W[0]));for(let Me=0;Me<W.length;Me++){const ve=W[Me],ke=X[Me];for(let Oe=0;Oe<ve.length-1;Oe++){const it=ve[Oe],wt=[it,ve[Oe+1],ke[Oe+1],ke[Oe],it];yu(fe,wt)&&(ye=Math.min(ye,Ou(fe,wt)))}}return ye!==1/0&&ye}(J[0],J[1],N)}}function Bc(i,t){return i.x*t.x+i.y*t.y}function Ou(i,t){if(i.length===1){let r=0;const s=t[r++];let l;for(;!l||s.equals(l);)if(l=t[r++],!l)return 1/0;for(;r<t.length;r++){const d=t[r],f=i[0],y=l.sub(s),b=d.sub(s),C=f.sub(s),D=Bc(y,y),R=Bc(y,b),N=Bc(b,b),J=Bc(C,y),X=Bc(C,b),W=D*N-R*R,fe=(N*J-R*X)/W,ye=(D*X-R*J)/W,Me=s.z*(1-fe-ye)+l.z*fe+d.z*ye;if(isFinite(Me))return Me}return 1/0}{let r=1/0;for(const s of t)r=Math.min(r,s.z);return r}}const Rf=_([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Lf}=Rf,Ff=_([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:zf}=Ff,Gf=Uo.VectorTileFeature.types,Uf=Math.cos(Math.PI/180*37.5),qu=Math.pow(2,14)/.5;class Dh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Ve,this.layoutVertexArray2=new Ke,this.indexArray=new Ct,this.programConfigurations=new Ql(t.layers,t.zoom),this.segments=new nt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){this.hasPattern=Ch("line",this.layers,r);const l=this.layers[0].layout.get("line-sort-key"),d=!l.isConstant(),f=[];for(const{feature:y,id:b,index:C,sourceLayerIndex:D}of t){const R=this.layers[0]._featureFilter.needGeometry,N=kl(y,R);if(!this.layers[0]._featureFilter.filter(new Fi(this.zoom),N,s))continue;const J=d?l.evaluate(N,{},s):void 0,X={id:b,properties:y.properties,type:y.type,sourceLayerIndex:D,index:C,geometry:R?N.geometry:Sl(y),patterns:{},sortKey:J};f.push(X)}d&&f.sort((y,b)=>y.sortKey-b.sortKey);for(const y of f){const{geometry:b,index:C,sourceLayerIndex:D}=y;if(this.hasPattern){const R=Eh("line",this.layers,y,this.zoom,r);this.patternFeatures.push(R)}else this.addFeature(y,b,C,s,{});r.featureIndex.insert(t[C].feature,b,C,D,this.index)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}addFeatures(t,r,s){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,zf)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Lf),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,s,l,d){const f=this.layers[0].layout,y=f.get("line-join").evaluate(t,{}),b=f.get("line-cap"),C=f.get("line-miter-limit"),D=f.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const R of r)this.addLine(R,t,y,b,C,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,d,l)}addLine(t,r,s,l,d,f){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ye=0;ye<t.length-1;ye++)this.totalDistance+=t[ye].dist(t[ye+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y=Gf[r.type]==="Polygon";let b=t.length;for(;b>=2&&t[b-1].equals(t[b-2]);)b--;let C=0;for(;C<b-1&&t[C].equals(t[C+1]);)C++;if(b<(y?3:2))return;s==="bevel"&&(d=1.05);const D=this.overscaling<=16?15*gr/(512*this.overscaling):0,R=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let N,J,X,W,fe;this.e1=this.e2=-1,y&&(N=t[b-2],fe=t[C].sub(N)._unit()._perp());for(let ye=C;ye<b;ye++){if(X=ye===b-1?y?t[C+1]:void 0:t[ye+1],X&&t[ye].equals(X))continue;fe&&(W=fe),N&&(J=N),N=t[ye],fe=X?X.sub(N)._unit()._perp():W,W=W||fe;let Me=W.add(fe);Me.x===0&&Me.y===0||Me._unit();const ve=W.x*fe.x+W.y*fe.y,ke=Me.x*fe.x+Me.y*fe.y,Oe=ke!==0?1/ke:1/0,it=2*Math.sqrt(2-2*ke),wt=ke<Uf&&J&&X,qt=W.x*fe.y-W.y*fe.x>0;if(wt&&ye>C){const Tt=N.dist(J);if(Tt>2*D){const Et=N.sub(N.sub(J)._mult(D/Tt)._round());this.updateDistance(J,Et),this.addCurrentVertex(Et,W,0,0,R),J=Et}}const It=J&&X;let pt=It?s:y?"butt":l;if(It&&pt==="round"&&(Oe<f?pt="miter":Oe<=2&&(pt="fakeround")),pt==="miter"&&Oe>d&&(pt="bevel"),pt==="bevel"&&(Oe>2&&(pt="flipbevel"),Oe<d&&(pt="miter")),J&&this.updateDistance(J,N),pt==="miter")Me._mult(Oe),this.addCurrentVertex(N,Me,0,0,R);else if(pt==="flipbevel"){if(Oe>100)Me=fe.mult(-1);else{const Tt=Oe*W.add(fe).mag()/W.sub(fe).mag();Me._perp()._mult(Tt*(qt?-1:1))}this.addCurrentVertex(N,Me,0,0,R),this.addCurrentVertex(N,Me.mult(-1),0,0,R)}else if(pt==="bevel"||pt==="fakeround"){const Tt=-Math.sqrt(Oe*Oe-1),Et=qt?Tt:0,xt=qt?0:Tt;if(J&&this.addCurrentVertex(N,W,Et,xt,R),pt==="fakeround"){const Je=Math.round(180*it/Math.PI/20);for(let Lt=1;Lt<Je;Lt++){let kt=Lt/Je;if(kt!==.5){const zi=kt-.5;kt+=kt*zi*(kt-1)*((1.0904+ve*(ve*(3.55645-1.43519*ve)-3.2452))*zi*zi+(.848013+ve*(.215638*ve-1.06021)))}const Jt=fe.sub(W)._mult(kt)._add(W)._unit()._mult(qt?-1:1);this.addHalfVertex(N,Jt.x,Jt.y,!1,qt,0,R)}}X&&this.addCurrentVertex(N,fe,-Et,-xt,R)}else if(pt==="butt")this.addCurrentVertex(N,Me,0,0,R);else if(pt==="square"){const Tt=J?1:-1;this.addCurrentVertex(N,Me,Tt,Tt,R)}else pt==="round"&&(J&&(this.addCurrentVertex(N,W,0,0,R),this.addCurrentVertex(N,W,1,1,R,!0)),X&&(this.addCurrentVertex(N,fe,-1,-1,R,!0),this.addCurrentVertex(N,fe,0,0,R)));if(wt&&ye<b-1){const Tt=N.dist(X);if(Tt>2*D){const Et=N.add(X.sub(N)._mult(D/Tt)._round());this.updateDistance(N,Et),this.addCurrentVertex(Et,fe,0,0,R),N=Et}}}}addCurrentVertex(t,r,s,l,d,f=!1){const y=r.y*l-r.x,b=-r.y-r.x*l;this.addHalfVertex(t,r.x+r.y*s,r.y-r.x*s,f,!1,s,d),this.addHalfVertex(t,y,b,f,!0,-l,d),this.distance>qu/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,s,l,d,f))}addHalfVertex({x:t,y:r},s,l,d,f,y,b){const C=.5*(this.lineClips?this.scaledDistance*(qu-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(d?1:0),(r<<1)+(f?1:0),Math.round(63*s)+128,Math.round(63*l)+128,1+(y===0?0:y<0?-1:1)|(63&C)<<2,C>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const D=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),b.primitiveLength++),f?this.e2=D:this.e1=D}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}let Vu,Hu;mt("LineBucket",Dh,{omit:["layers","patternFeatures"]});var ju={get paint(){return Hu=Hu||new u({"line-opacity":new Ut(Re.paint_line["line-opacity"]),"line-color":new Ut(Re.paint_line["line-color"]),"line-translate":new Qt(Re.paint_line["line-translate"]),"line-translate-anchor":new Qt(Re.paint_line["line-translate-anchor"]),"line-width":new Ut(Re.paint_line["line-width"]),"line-gap-width":new Ut(Re.paint_line["line-gap-width"]),"line-offset":new Ut(Re.paint_line["line-offset"]),"line-blur":new Ut(Re.paint_line["line-blur"]),"line-dasharray":new zo(Re.paint_line["line-dasharray"]),"line-pattern":new Fo(Re.paint_line["line-pattern"]),"line-gradient":new El(Re.paint_line["line-gradient"])})},get layout(){return Vu=Vu||new u({"line-cap":new Qt(Re.layout_line["line-cap"]),"line-join":new Ut(Re.layout_line["line-join"]),"line-miter-limit":new Qt(Re.layout_line["line-miter-limit"]),"line-round-limit":new Qt(Re.layout_line["line-round-limit"]),"line-sort-key":new Ut(Re.layout_line["line-sort-key"])})}};class Nf extends Ut{possiblyEvaluate(t,r){return r=new Fi(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,s,l){return r=ut({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,s,l)}}let Xc;class Of extends n{constructor(t){super(t,ju),this.gradientVersion=0,Xc||(Xc=new Nf(ju.paint.properties["line-width"].specification),Xc.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(s){return s._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof ca,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=Xc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Dh(t)}queryRadius(t){const r=t,s=Ju(yc("line-width",this,r),yc("line-gap-width",this,r)),l=yc("line-offset",this,r);return s/2+Math.abs(l)+jc(this.paint.get("line-translate"))}queryIntersectsFeature(t,r,s,l,d,f,y){const b=Jc(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,y),C=y/2*Ju(this.paint.get("line-width").evaluate(r,s),this.paint.get("line-gap-width").evaluate(r,s)),D=this.paint.get("line-offset").evaluate(r,s);return D&&(l=function(R,N){const J=[];for(let X=0;X<R.length;X++){const W=R[X],fe=[];for(let ye=0;ye<W.length;ye++){const Me=W[ye-1],ve=W[ye],ke=W[ye+1],Oe=ye===0?new Qe(0,0):ve.sub(Me)._unit()._perp(),it=ye===W.length-1?new Qe(0,0):ke.sub(ve)._unit()._perp(),wt=Oe._add(it)._unit(),qt=wt.x*it.x+wt.y*it.y;qt!==0&&wt._mult(1/qt),fe.push(wt._mult(N)._add(ve))}J.push(fe)}return J}(l,D*y)),function(R,N,J){for(let X=0;X<N.length;X++){const W=N[X];if(R.length>=3){for(let fe=0;fe<W.length;fe++)if($l(R,W[fe]))return!0}if(Zd(R,W,J))return!0}return!1}(b,l,C)}isTileClipped(){return!0}}function Ju(i,t){return t>0?t+2*i:i}const qf=_([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Vf=_([{name:"a_projected_pos",components:3,type:"Float32"}],4);_([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Hf=_([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);_([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Yu=_([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),jf=_([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Jf(i,t,r){return i.sections.forEach(s=>{s.text=function(l,d,f){const y=d.layout.get("text-transform").evaluate(f,{});return y==="uppercase"?l=l.toLocaleUpperCase():y==="lowercase"&&(l=l.toLocaleLowerCase()),ir.applyArabicShaping&&(l=ir.applyArabicShaping(l)),l}(s.text,t,r)}),i}_([{name:"triangle",components:3,type:"Uint16"}]),_([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),_([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),_([{type:"Float32",name:"offsetX"}]),_([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),_([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Cc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var mr=24,Ku=Di,Zu=function(i,t,r,s,l){var d,f,y=8*l-s-1,b=(1<<y)-1,C=b>>1,D=-7,R=l-1,N=-1,J=i[t+R];for(R+=N,d=J&(1<<-D)-1,J>>=-D,D+=y;D>0;d=256*d+i[t+R],R+=N,D-=8);for(f=d&(1<<-D)-1,d>>=-D,D+=s;D>0;f=256*f+i[t+R],R+=N,D-=8);if(d===0)d=1-C;else{if(d===b)return f?NaN:1/0*(J?-1:1);f+=Math.pow(2,s),d-=C}return(J?-1:1)*f*Math.pow(2,d-s)},$u=function(i,t,r,s,l,d){var f,y,b,C=8*d-l-1,D=(1<<C)-1,R=D>>1,N=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,J=0,X=1,W=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(y=isNaN(t)?1:0,f=D):(f=Math.floor(Math.log(t)/Math.LN2),t*(b=Math.pow(2,-f))<1&&(f--,b*=2),(t+=f+R>=1?N/b:N*Math.pow(2,1-R))*b>=2&&(f++,b/=2),f+R>=D?(y=0,f=D):f+R>=1?(y=(t*b-1)*Math.pow(2,l),f+=R):(y=t*Math.pow(2,R-1)*Math.pow(2,l),f=0));l>=8;i[r+J]=255&y,J+=X,y/=256,l-=8);for(f=f<<l|y,C+=l;C>0;i[r+J]=255&f,J+=X,f/=256,C-=8);i[r+J-X]|=128*W};function Di(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Di.Varint=0,Di.Fixed64=1,Di.Bytes=2,Di.Fixed32=5;var Mh=4294967296,Xu=1/Mh,Wu=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function to(i){return i.type===Di.Bytes?i.readVarint()+i.pos:i.pos+1}function tc(i,t,r){return r?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function eA(i,t,r){var s=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(s);for(var l=r.pos-1;l>=i;l--)r.buf[l+s]=r.buf[l]}function Yf(i,t){for(var r=0;r<i.length;r++)t.writeVarint(i[r])}function Kf(i,t){for(var r=0;r<i.length;r++)t.writeSVarint(i[r])}function Zf(i,t){for(var r=0;r<i.length;r++)t.writeFloat(i[r])}function $f(i,t){for(var r=0;r<i.length;r++)t.writeDouble(i[r])}function Xf(i,t){for(var r=0;r<i.length;r++)t.writeBoolean(i[r])}function Wf(i,t){for(var r=0;r<i.length;r++)t.writeFixed32(i[r])}function eg(i,t){for(var r=0;r<i.length;r++)t.writeSFixed32(i[r])}function tg(i,t){for(var r=0;r<i.length;r++)t.writeFixed64(i[r])}function ig(i,t){for(var r=0;r<i.length;r++)t.writeSFixed64(i[r])}function Wc(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function ic(i,t,r){i[r]=t,i[r+1]=t>>>8,i[r+2]=t>>>16,i[r+3]=t>>>24}function tA(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}Di.prototype={destroy:function(){this.buf=null},readFields:function(i,t,r){for(r=r||this.length;this.pos<r;){var s=this.readVarint(),l=s>>3,d=this.pos;this.type=7&s,i(l,t,this),this.pos===d&&this.skip(s)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=Wc(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=tA(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Wc(this.buf,this.pos)+Wc(this.buf,this.pos+4)*Mh;return this.pos+=8,i},readSFixed64:function(){var i=Wc(this.buf,this.pos)+tA(this.buf,this.pos+4)*Mh;return this.pos+=8,i},readFloat:function(){var i=Zu(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Zu(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,r,s=this.buf;return t=127&(r=s[this.pos++]),r<128?t:(t|=(127&(r=s[this.pos++]))<<7,r<128?t:(t|=(127&(r=s[this.pos++]))<<14,r<128?t:(t|=(127&(r=s[this.pos++]))<<21,r<128?t:function(l,d,f){var y,b,C=f.buf;if(y=(112&(b=C[f.pos++]))>>4,b<128||(y|=(127&(b=C[f.pos++]))<<3,b<128)||(y|=(127&(b=C[f.pos++]))<<10,b<128)||(y|=(127&(b=C[f.pos++]))<<17,b<128)||(y|=(127&(b=C[f.pos++]))<<24,b<128)||(y|=(1&(b=C[f.pos++]))<<31,b<128))return tc(l,y,d);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=s[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&Wu?function(r,s,l){return Wu.decode(r.subarray(s,l))}(this.buf,t,i):function(r,s,l){for(var d="",f=s;f<l;){var y,b,C,D=r[f],R=null,N=D>239?4:D>223?3:D>191?2:1;if(f+N>l)break;N===1?D<128&&(R=D):N===2?(192&(y=r[f+1]))==128&&(R=(31&D)<<6|63&y)<=127&&(R=null):N===3?(b=r[f+2],(192&(y=r[f+1]))==128&&(192&b)==128&&((R=(15&D)<<12|(63&y)<<6|63&b)<=2047||R>=55296&&R<=57343)&&(R=null)):N===4&&(b=r[f+2],C=r[f+3],(192&(y=r[f+1]))==128&&(192&b)==128&&(192&C)==128&&((R=(15&D)<<18|(63&y)<<12|(63&b)<<6|63&C)<=65535||R>=1114112)&&(R=null)),R===null?(R=65533,N=1):R>65535&&(R-=65536,d+=String.fromCharCode(R>>>10&1023|55296),R=56320|1023&R),d+=String.fromCharCode(R),f+=N}return d}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==Di.Bytes)return i.push(this.readVarint(t));var r=to(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==Di.Bytes)return i.push(this.readSVarint());var t=to(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Di.Bytes)return i.push(this.readBoolean());var t=to(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Di.Bytes)return i.push(this.readFloat());var t=to(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Di.Bytes)return i.push(this.readDouble());var t=to(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Di.Bytes)return i.push(this.readFixed32());var t=to(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Di.Bytes)return i.push(this.readSFixed32());var t=to(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Di.Bytes)return i.push(this.readFixed64());var t=to(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Di.Bytes)return i.push(this.readSFixed64());var t=to(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===Di.Varint)for(;this.buf[this.pos++]>127;);else if(t===Di.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Di.Fixed32)this.pos+=4;else{if(t!==Di.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),ic(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),ic(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),ic(this.buf,-1&i,this.pos),ic(this.buf,Math.floor(i*Xu),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),ic(this.buf,-1&i,this.pos),ic(this.buf,Math.floor(i*Xu),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,r){var s,l;if(t>=0?(s=t%4294967296|0,l=t/4294967296|0):(l=~(-t/4294967296),4294967295^(s=~(-t%4294967296))?s=s+1|0:(s=0,l=l+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(d,f,y){y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,y.buf[y.pos]=127&(d>>>=7)}(s,0,r),function(d,f){var y=(7&d)<<4;f.buf[f.pos++]|=y|((d>>>=3)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d)))))}(l,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(s,l,d){for(var f,y,b=0;b<l.length;b++){if((f=l.charCodeAt(b))>55295&&f<57344){if(!y){f>56319||b+1===l.length?(s[d++]=239,s[d++]=191,s[d++]=189):y=f;continue}if(f<56320){s[d++]=239,s[d++]=191,s[d++]=189,y=f;continue}f=y-55296<<10|f-56320|65536,y=null}else y&&(s[d++]=239,s[d++]=191,s[d++]=189,y=null);f<128?s[d++]=f:(f<2048?s[d++]=f>>6|192:(f<65536?s[d++]=f>>12|224:(s[d++]=f>>18|240,s[d++]=f>>12&63|128),s[d++]=f>>6&63|128),s[d++]=63&f|128)}return d}(this.buf,i,this.pos);var r=this.pos-t;r>=128&&eA(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),$u(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),$u(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,t){this.pos++;var r=this.pos;i(t,this);var s=this.pos-r;s>=128&&eA(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeMessage:function(i,t,r){this.writeTag(i,Di.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,Yf,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,Kf,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,Xf,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,Zf,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,$f,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,Wf,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,eg,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,tg,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,ig,t)},writeBytesField:function(i,t){this.writeTag(i,Di.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,Di.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,Di.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,Di.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,Di.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,Di.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,Di.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,Di.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,Di.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,Di.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,!!t)}};var Th=he(Ku);const Ph=3;function rg(i,t,r){i===1&&r.readMessage(ng,t)}function ng(i,t,r){if(i===3){const{id:s,bitmap:l,width:d,height:f,left:y,top:b,advance:C}=r.readMessage(sg,{});t.push({id:s,bitmap:new Ic({width:d+2*Ph,height:f+2*Ph},l),metrics:{width:d,height:f,left:y,top:b,advance:C}})}}function sg(i,t,r){i===1?t.id=r.readVarint():i===2?t.bitmap=r.readBytes():i===3?t.width=r.readVarint():i===4?t.height=r.readVarint():i===5?t.left=r.readSVarint():i===6?t.top=r.readSVarint():i===7&&(t.advance=r.readVarint())}const iA=Ph;function rA(i){let t=0,r=0;for(const f of i)t+=f.w*f.h,r=Math.max(r,f.w);i.sort((f,y)=>y.h-f.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let l=0,d=0;for(const f of i)for(let y=s.length-1;y>=0;y--){const b=s[y];if(!(f.w>b.w||f.h>b.h)){if(f.x=b.x,f.y=b.y,d=Math.max(d,f.y+f.h),l=Math.max(l,f.x+f.w),f.w===b.w&&f.h===b.h){const C=s.pop();y<s.length&&(s[y]=C)}else f.h===b.h?(b.x+=f.w,b.w-=f.w):f.w===b.w?(b.y+=f.h,b.h-=f.h):(s.push({x:b.x+f.w,y:b.y,w:b.w-f.w,h:f.h}),b.y+=f.h,b.h-=f.h);break}}return{w:l,h:d,fill:t/(l*d)||0}}const xn=1;class Rh{constructor(t,{pixelRatio:r,version:s,stretchX:l,stretchY:d,content:f,textFitWidth:y,textFitHeight:b}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=l,this.stretchY=d,this.content=f,this.version=s,this.textFitWidth=y,this.textFitHeight=b}get tl(){return[this.paddedRect.x+xn,this.paddedRect.y+xn]}get br(){return[this.paddedRect.x+this.paddedRect.w-xn,this.paddedRect.y+this.paddedRect.h-xn]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*xn)/this.pixelRatio,(this.paddedRect.h-2*xn)/this.pixelRatio]}}class nA{constructor(t,r){const s={},l={};this.haveRenderCallbacks=[];const d=[];this.addImages(t,s,d),this.addImages(r,l,d);const{w:f,h:y}=rA(d),b=new ts({width:f||1,height:y||1});for(const C in t){const D=t[C],R=s[C].paddedRect;ts.copy(D.data,b,{x:0,y:0},{x:R.x+xn,y:R.y+xn},D.data)}for(const C in r){const D=r[C],R=l[C].paddedRect,N=R.x+xn,J=R.y+xn,X=D.data.width,W=D.data.height;ts.copy(D.data,b,{x:0,y:0},{x:N,y:J},D.data),ts.copy(D.data,b,{x:0,y:W-1},{x:N,y:J-1},{width:X,height:1}),ts.copy(D.data,b,{x:0,y:0},{x:N,y:J+W},{width:X,height:1}),ts.copy(D.data,b,{x:X-1,y:0},{x:N-1,y:J},{width:1,height:W}),ts.copy(D.data,b,{x:0,y:0},{x:N+X,y:J},{width:1,height:W})}this.image=b,this.iconPositions=s,this.patternPositions=l}addImages(t,r,s){for(const l in t){const d=t[l],f={x:0,y:0,w:d.data.width+2*xn,h:d.data.height+2*xn};s.push(f),r[l]=new Rh(f,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in t.updatedImages)this.patchUpdatedImage(this.iconPositions[s],t.getImage(s),r),this.patchUpdatedImage(this.patternPositions[s],t.getImage(s),r)}patchUpdatedImage(t,r,s){if(!t||!r||t.version===r.version)return;t.version=r.version;const[l,d]=t.tl;s.update(r.data,void 0,{x:l,y:d})}}var No;mt("ImagePosition",Rh),mt("ImageAtlas",nA),S.ah=void 0,(No=S.ah||(S.ah={}))[No.none=0]="none",No[No.horizontal=1]="horizontal",No[No.vertical=2]="vertical",No[No.horizontalOnly=3]="horizontalOnly";const Ec=-17;class Qc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,r){const s=new Qc;return s.scale=t||1,s.fontStack=r,s}static forImage(t){const r=new Qc;return r.imageName=t,r}}class rc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const s=new rc;for(let l=0;l<t.sections.length;l++){const d=t.sections[l];d.image?s.addImageSection(d):s.addTextSection(d,r)}return s}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let r="";for(let s=0;s<t.length;s++){const l=t.charCodeAt(s+1)||null,d=t.charCodeAt(s-1)||null;r+=l&&Po(l)&&!Cc[t[s+1]]||d&&Po(d)&&!Cc[t[s-1]]||!Cc[t[s]]?t[s]:Cc[t[s]]}return r}(this.text)}trim(){let t=0;for(let s=0;s<this.text.length&&th[this.text.charCodeAt(s)];s++)t++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=t&&th[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const s=new rc;return s.text=this.text.substring(t,r),s.sectionIndex=this.sectionIndex.slice(t,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}addTextSection(t,r){this.text+=t.text,this.sections.push(Qc.forText(t.scale,t.fontStack||r));const s=this.sections.length-1;for(let l=0;l<t.text.length;++l)this.sectionIndex.push(s)}addImageSection(t){const r=t.image?t.image.name:"";if(r.length===0)return void mi("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(Qc.forImage(r)),this.sectionIndex.push(this.sections.length-1)):mi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function eh(i,t,r,s,l,d,f,y,b,C,D,R,N,J,X){const W=rc.fromFeature(i,l);let fe;R===S.ah.vertical&&W.verticalizePunctuation();const{processBidirectionalText:ye,processStyledBidirectionalText:Me}=ir;if(ye&&W.sections.length===1){fe=[];const Oe=ye(W.toString(),Lh(W,C,d,t,s,J));for(const it of Oe){const wt=new rc;wt.text=it,wt.sections=W.sections;for(let qt=0;qt<it.length;qt++)wt.sectionIndex.push(0);fe.push(wt)}}else if(Me){fe=[];const Oe=Me(W.text,W.sectionIndex,Lh(W,C,d,t,s,J));for(const it of Oe){const wt=new rc;wt.text=it[0],wt.sectionIndex=it[1],wt.sections=W.sections,fe.push(wt)}}else fe=function(Oe,it){const wt=[],qt=Oe.text;let It=0;for(const pt of it)wt.push(Oe.substring(It,pt)),It=pt;return It<qt.length&&wt.push(Oe.substring(It,qt.length)),wt}(W,Lh(W,C,d,t,s,J));const ve=[],ke={positionedLines:ve,text:W.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:R,iconsInText:!1,verticalizable:!1};return function(Oe,it,wt,qt,It,pt,Tt,Et,xt,Je,Lt,kt){let Jt=0,zi=Ec,Mi=0,vr=0;const bs=Et==="right"?1:Et==="left"?0:.5;let Gr=0;for(const lr of It){lr.trim();const Br=lr.getMaxScale(),Wr=(Br-1)*mr,Ur={positionedGlyphs:[],lineOffset:0};Oe.positionedLines[Gr]=Ur;const An=Ur.positionedGlyphs;let Nr=0;if(!lr.length()){zi+=pt,++Gr;continue}for(let Bn=0;Bn<lr.length();Bn++){const wi=lr.getSection(Bn),Ni=lr.getSectionIndex(Bn),Hi=lr.getCharCode(Bn);let Gn=0,rr=null,oc=null,Sa=null,ka=mr;const ws=!(xt===S.ah.horizontal||!Lt&&!Xa(Hi)||Lt&&(th[Hi]||(xr=Hi,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(xr)))));if(wi.imageName){const ns=qt[wi.imageName];if(!ns)continue;Sa=wi.imageName,Oe.iconsInText=Oe.iconsInText||!0,oc=ns.paddedRect;const kr=ns.displaySize;wi.scale=wi.scale*mr/kt,rr={width:kr[0],height:kr[1],left:xn,top:-iA,advance:ws?kr[1]:kr[0]},Gn=Wr+(mr-kr[1]*wi.scale),ka=rr.advance;const io=ws?kr[0]*wi.scale-mr*Br:kr[1]*wi.scale-mr*Br;io>0&&io>Nr&&(Nr=io)}else{const ns=wt[wi.fontStack],kr=ns&&ns[Hi];if(kr&&kr.rect)oc=kr.rect,rr=kr.metrics;else{const io=it[wi.fontStack],Pc=io&&io[Hi];if(!Pc)continue;rr=Pc.metrics}Gn=(Br-wi.scale)*mr}ws?(Oe.verticalizable=!0,An.push({glyph:Hi,imageName:Sa,x:Jt,y:zi+Gn,vertical:ws,scale:wi.scale,fontStack:wi.fontStack,sectionIndex:Ni,metrics:rr,rect:oc}),Jt+=ka*wi.scale+Je):(An.push({glyph:Hi,imageName:Sa,x:Jt,y:zi+Gn,vertical:ws,scale:wi.scale,fontStack:wi.fontStack,sectionIndex:Ni,metrics:rr,rect:oc}),Jt+=rr.advance*wi.scale+Je)}An.length!==0&&(Mi=Math.max(Jt-Je,Mi),cg(An,0,An.length-1,bs,Nr)),Jt=0;const rs=pt*Br+Nr;Ur.lineOffset=Math.max(Nr,Wr),zi+=rs,vr=Math.max(rs,vr),++Gr}var xr;const cn=zi-Ec,{horizontalAlign:hn,verticalAlign:un}=Fh(Tt);(function(lr,Br,Wr,Ur,An,Nr,rs,Bn,wi){const Ni=(Br-Wr)*An;let Hi=0;Hi=Nr!==rs?-Bn*Ur-Ec:(-Ur*wi+.5)*rs;for(const Gn of lr)for(const rr of Gn.positionedGlyphs)rr.x+=Ni,rr.y+=Hi})(Oe.positionedLines,bs,hn,un,Mi,vr,pt,cn,It.length),Oe.top+=-un*cn,Oe.bottom=Oe.top+cn,Oe.left+=-hn*Mi,Oe.right=Oe.left+Mi}(ke,t,r,s,fe,f,y,b,R,C,N,X),!function(Oe){for(const it of Oe)if(it.positionedGlyphs.length!==0)return!1;return!0}(ve)&&ke}const th={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ag={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},og={40:!0};function sA(i,t,r,s,l,d){if(t.imageName){const f=s[t.imageName];return f?f.displaySize[0]*t.scale*mr/d+l:0}{const f=r[t.fontStack],y=f&&f[i];return y?y.metrics.advance*t.scale+l:0}}function aA(i,t,r,s){const l=Math.pow(i-t,2);return s?i<t?l/2:2*l:l+Math.abs(r)*r}function lg(i,t,r){let s=0;return i===10&&(s-=1e4),r&&(s+=150),i!==40&&i!==65288||(s+=50),t!==41&&t!==65289||(s+=50),s}function oA(i,t,r,s,l,d){let f=null,y=aA(t,r,l,d);for(const b of s){const C=aA(t-b.x,r,l,d)+b.badness;C<=y&&(f=b,y=C)}return{index:i,x:t,priorBreak:f,badness:y}}function lA(i){return i?lA(i.priorBreak).concat(i.index):[]}function Lh(i,t,r,s,l,d){if(!i)return[];const f=[],y=function(R,N,J,X,W,fe){let ye=0;for(let Me=0;Me<R.length();Me++){const ve=R.getSection(Me);ye+=sA(R.getCharCode(Me),ve,X,W,N,fe)}return ye/Math.max(1,Math.ceil(ye/J))}(i,t,r,s,l,d),b=i.text.indexOf("")>=0;let C=0;for(let R=0;R<i.length();R++){const N=i.getSection(R),J=i.getCharCode(R);if(th[J]||(C+=sA(J,N,s,l,t,d)),R<i.length()-1){const X=!((D=J)<11904)&&(!!oi["CJK Compatibility Forms"](D)||!!oi["CJK Compatibility"](D)||!!oi["CJK Strokes"](D)||!!oi["CJK Symbols and Punctuation"](D)||!!oi["Enclosed CJK Letters and Months"](D)||!!oi["Halfwidth and Fullwidth Forms"](D)||!!oi["Ideographic Description Characters"](D)||!!oi["Vertical Forms"](D)||Bl.test(String.fromCodePoint(D)));(ag[J]||X||N.imageName||R!==i.length()-2&&og[i.getCharCode(R+1)])&&f.push(oA(R+1,C,y,f,lg(J,i.getCharCode(R+1),X&&b),!1))}}var D;return lA(oA(i.length(),C,y,f,0,!0))}function Fh(i){let t=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function cg(i,t,r,s,l){if(!s&&!l)return;const d=i[r],f=(i[r].x+d.metrics.advance*d.scale)*s;for(let y=t;y<=r;y++)i[y].x-=f,i[y].y+=l}function hg(i,t,r){const{horizontalAlign:s,verticalAlign:l}=Fh(r),d=t[0]-i.displaySize[0]*s,f=t[1]-i.displaySize[1]*l;return{image:i,top:f,bottom:f+i.displaySize[1],left:d,right:d+i.displaySize[0]}}function cA(i){var t,r;let s=i.left,l=i.top,d=i.right-s,f=i.bottom-l;const y=(t=i.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",b=(r=i.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",C=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(b==="proportional"){if(y==="stretchOnly"&&d/f<C||y==="proportional"){const D=Math.ceil(f*C);s*=D/d,d=D}}else if(y==="proportional"&&b==="stretchOnly"&&C!==0&&d/f>C){const D=Math.ceil(d/C);l*=D/f,f=D}return{x1:s,y1:l,x2:s+d,y2:l+f}}function hA(i,t,r,s,l,d){const f=i.image;let y;if(f.content){const fe=f.content,ye=f.pixelRatio||1;y=[fe[0]/ye,fe[1]/ye,f.displaySize[0]-fe[2]/ye,f.displaySize[1]-fe[3]/ye]}const b=t.left*d,C=t.right*d;let D,R,N,J;r==="width"||r==="both"?(J=l[0]+b-s[3],R=l[0]+C+s[1]):(J=l[0]+(b+C-f.displaySize[0])/2,R=J+f.displaySize[0]);const X=t.top*d,W=t.bottom*d;return r==="height"||r==="both"?(D=l[1]+X-s[0],N=l[1]+W+s[2]):(D=l[1]+(X+W-f.displaySize[1])/2,N=D+f.displaySize[1]),{image:f,top:D,right:R,bottom:N,left:J,collisionPadding:y}}const Sc=255,Qa=128,Oo=Sc*Qa;function uA(i,t){const{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Fi(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:l}=r;let d=0;for(;d<s.length&&s[d]<=i;)d++;d=Math.max(0,d-1);let f=d;for(;f<s.length&&s[f]<i+1;)f++;f=Math.min(s.length-1,f);const y=s[d],b=s[f];return r.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:b,interpolationType:l}:{kind:"camera",minZoom:y,maxZoom:b,minSize:r.evaluate(new Fi(y)),maxSize:r.evaluate(new Fi(b)),interpolationType:l}}}function zh(i,t,r){let s="never";const l=i.get(t);return l?s=l:i.get(r)&&(s="always"),s}const ug=Uo.VectorTileFeature.types,Ag=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ih(i,t,r,s,l,d,f,y,b,C,D,R,N){const J=y?Math.min(Oo,Math.round(y[0])):0,X=y?Math.min(Oo,Math.round(y[1])):0;i.emplaceBack(t,r,Math.round(32*s),Math.round(32*l),d,f,(J<<1)+(b?1:0),X,16*C,16*D,256*R,256*N)}function Gh(i,t,r){i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r)}function dg(i){for(const t of i.sections)if(mc(t.text))return!0;return!1}class Uh{constructor(t){this.layoutVertexArray=new Ue,this.indexArray=new Ct,this.programConfigurations=t,this.segments=new nt,this.dynamicLayoutVertexArray=new Pe,this.opacityVertexArray=new Ye,this.hasVisibleVertices=!1,this.placedSymbolArray=new pe}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,s,l){this.isEmpty()||(s&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,qf.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Vf.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Ag,!0),this.opacityVertexBuffer.itemSize=1),(s||l)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}mt("SymbolBuffers",Uh);class Nh{constructor(t,r,s){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new s,this.segments=new nt,this.collisionVertexArray=new ot}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Hf.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}mt("CollisionBuffers",Nh);class nc{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(f=>f.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ih([]),this.placementViewportMatrix=Ih([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=uA(this.zoom,r["text-size"]),this.iconSizeData=uA(this.zoom,r["icon-size"]);const s=this.layers[0].layout,l=s.get("symbol-sort-key"),d=s.get("symbol-z-order");this.canOverlap=zh(s,"text-overlap","text-allow-overlap")!=="never"||zh(s,"icon-overlap","icon-allow-overlap")!=="never"||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&!l.isConstant(),this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(f=>S.ah[f])),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=t.sourceID}createArrays(){this.text=new Uh(new Ql(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Uh(new Ql(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new z,this.lineVertexArray=new ce,this.symbolInstances=new Y,this.textAnchorOffsets=new ae}calculateGlyphDependencies(t,r,s,l,d){for(let f=0;f<t.length;f++)if(r[t.charCodeAt(f)]=!0,(s||l)&&d){const y=Cc[t.charAt(f)];y&&(r[y.charCodeAt(0)]=!0)}}populate(t,r,s){const l=this.layers[0],d=l.layout,f=d.get("text-font"),y=d.get("text-field"),b=d.get("icon-image"),C=(y.value.kind!=="constant"||y.value.value instanceof Tr&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(f.value.kind!=="constant"||f.value.value.length>0),D=b.value.kind!=="constant"||!!b.value.value||Object.keys(b.parameters).length>0,R=d.get("symbol-sort-key");if(this.features=[],!C&&!D)return;const N=r.iconDependencies,J=r.glyphDependencies,X=r.availableImages,W=new Fi(this.zoom);for(const{feature:fe,id:ye,index:Me,sourceLayerIndex:ve}of t){const ke=l._featureFilter.needGeometry,Oe=kl(fe,ke);if(!l._featureFilter.filter(W,Oe,s))continue;let it,wt;if(ke||(Oe.geometry=Sl(fe)),C){const It=l.getValueAndResolveTokens("text-field",Oe,s,X),pt=Tr.factory(It),Tt=this.hasRTLText=this.hasRTLText||dg(pt);(!Tt||ir.getRTLTextPluginStatus()==="unavailable"||Tt&&ir.isParsed())&&(it=Jf(pt,l,Oe))}if(D){const It=l.getValueAndResolveTokens("icon-image",Oe,s,X);wt=It instanceof Hr?It:Hr.fromString(It)}if(!it&&!wt)continue;const qt=this.sortFeaturesByKey?R.evaluate(Oe,{},s):void 0;if(this.features.push({id:ye,text:it,icon:wt,index:Me,sourceLayerIndex:ve,geometry:Oe.geometry,properties:fe.properties,type:ug[fe.type],sortKey:qt}),wt&&(N[wt.name]=!0),it){const It=f.evaluate(Oe,{},s).join(","),pt=d.get("text-rotation-alignment")!=="viewport"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(S.ah.vertical)>=0;for(const Tt of it.sections)if(Tt.image)N[Tt.image.name]=!0;else{const Et=xl(it.toString()),xt=Tt.fontStack||It,Je=J[xt]=J[xt]||{};this.calculateGlyphDependencies(Tt.text,Je,pt,this.allowVerticalPlacement,Et)}}}d.get("symbol-placement")==="line"&&(this.features=function(fe){const ye={},Me={},ve=[];let ke=0;function Oe(It){ve.push(fe[It]),ke++}function it(It,pt,Tt){const Et=Me[It];return delete Me[It],Me[pt]=Et,ve[Et].geometry[0].pop(),ve[Et].geometry[0]=ve[Et].geometry[0].concat(Tt[0]),Et}function wt(It,pt,Tt){const Et=ye[pt];return delete ye[pt],ye[It]=Et,ve[Et].geometry[0].shift(),ve[Et].geometry[0]=Tt[0].concat(ve[Et].geometry[0]),Et}function qt(It,pt,Tt){const Et=Tt?pt[0][pt[0].length-1]:pt[0][0];return`${It}:${Et.x}:${Et.y}`}for(let It=0;It<fe.length;It++){const pt=fe[It],Tt=pt.geometry,Et=pt.text?pt.text.toString():null;if(!Et){Oe(It);continue}const xt=qt(Et,Tt),Je=qt(Et,Tt,!0);if(xt in Me&&Je in ye&&Me[xt]!==ye[Je]){const Lt=wt(xt,Je,Tt),kt=it(xt,Je,ve[Lt].geometry);delete ye[xt],delete Me[Je],Me[qt(Et,ve[kt].geometry,!0)]=kt,ve[Lt].geometry=null}else xt in Me?it(xt,Je,Tt):Je in ye?wt(xt,Je,Tt):(Oe(It),ye[xt]=ke-1,Me[Je]=ke-1)}return ve.filter(It=>It.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((fe,ye)=>fe.sortKey-ye.sortKey)}update(t,r,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,s),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,s))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const s=this.lineVertexArray.length;if(t.segment!==void 0){let l=t.dist(r[t.segment+1]),d=t.dist(r[t.segment]);const f={};for(let y=t.segment+1;y<r.length;y++)f[y]={x:r[y].x,y:r[y].y,tileUnitDistanceFromAnchor:l},y<r.length-1&&(l+=r[y+1].dist(r[y]));for(let y=t.segment||0;y>=0;y--)f[y]={x:r[y].x,y:r[y].y,tileUnitDistanceFromAnchor:d},y>0&&(d+=r[y-1].dist(r[y]));for(let y=0;y<r.length;y++){const b=f[y];this.lineVertexArray.emplaceBack(b.x,b.y,b.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(t,r,s,l,d,f,y,b,C,D,R,N){const J=t.indexArray,X=t.layoutVertexArray,W=t.segments.prepareSegment(4*r.length,X,J,this.canOverlap?f.sortKey:void 0),fe=this.glyphOffsetArray.length,ye=W.vertexLength,Me=this.allowVerticalPlacement&&y===S.ah.vertical?Math.PI/2:0,ve=f.text&&f.text.sections;for(let ke=0;ke<r.length;ke++){const{tl:Oe,tr:it,bl:wt,br:qt,tex:It,pixelOffsetTL:pt,pixelOffsetBR:Tt,minFontScaleX:Et,minFontScaleY:xt,glyphOffset:Je,isSDF:Lt,sectionIndex:kt}=r[ke],Jt=W.vertexLength,zi=Je[1];ih(X,b.x,b.y,Oe.x,zi+Oe.y,It.x,It.y,s,Lt,pt.x,pt.y,Et,xt),ih(X,b.x,b.y,it.x,zi+it.y,It.x+It.w,It.y,s,Lt,Tt.x,pt.y,Et,xt),ih(X,b.x,b.y,wt.x,zi+wt.y,It.x,It.y+It.h,s,Lt,pt.x,Tt.y,Et,xt),ih(X,b.x,b.y,qt.x,zi+qt.y,It.x+It.w,It.y+It.h,s,Lt,Tt.x,Tt.y,Et,xt),Gh(t.dynamicLayoutVertexArray,b,Me),J.emplaceBack(Jt,Jt+1,Jt+2),J.emplaceBack(Jt+1,Jt+2,Jt+3),W.vertexLength+=4,W.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Je[0]),ke!==r.length-1&&kt===r[ke+1].sectionIndex||t.programConfigurations.populatePaintArrays(X.length,f,f.index,{},N,ve&&ve[kt])}t.placedSymbolArray.emplaceBack(b.x,b.y,fe,this.glyphOffsetArray.length-fe,ye,C,D,b.segment,s?s[0]:0,s?s[1]:0,l[0],l[1],y,0,!1,0,R)}_addCollisionDebugVertex(t,r,s,l,d,f){return r.emplaceBack(0,0),t.emplaceBack(s.x,s.y,l,d,Math.round(f.x),Math.round(f.y))}addCollisionDebugVertices(t,r,s,l,d,f,y){const b=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),C=b.vertexLength,D=d.layoutVertexArray,R=d.collisionVertexArray,N=y.anchorX,J=y.anchorY;this._addCollisionDebugVertex(D,R,f,N,J,new Qe(t,r)),this._addCollisionDebugVertex(D,R,f,N,J,new Qe(s,r)),this._addCollisionDebugVertex(D,R,f,N,J,new Qe(s,l)),this._addCollisionDebugVertex(D,R,f,N,J,new Qe(t,l)),b.vertexLength+=4;const X=d.indexArray;X.emplaceBack(C,C+1),X.emplaceBack(C+1,C+2),X.emplaceBack(C+2,C+3),X.emplaceBack(C+3,C),b.primitiveLength+=4}addDebugCollisionBoxes(t,r,s,l){for(let d=t;d<r;d++){const f=this.collisionBoxArray.get(d);this.addCollisionDebugVertices(f.x1,f.y1,f.x2,f.y2,l?this.textCollisionBox:this.iconCollisionBox,f.anchorPoint,s)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Nh(vt,Yu.members,st),this.iconCollisionBox=new Nh(vt,Yu.members,st);for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,s,l,d,f,y,b,C){const D={};for(let R=r;R<s;R++){const N=t.get(R);D.textBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},D.textFeatureIndex=N.featureIndex;break}for(let R=l;R<d;R++){const N=t.get(R);D.verticalTextBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},D.verticalTextFeatureIndex=N.featureIndex;break}for(let R=f;R<y;R++){const N=t.get(R);D.iconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},D.iconFeatureIndex=N.featureIndex;break}for(let R=b;R<C;R++){const N=t.get(R);D.verticalIconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},D.verticalIconFeatureIndex=N.featureIndex;break}return D}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){const s=t.placedSymbolArray.get(r),l=s.vertexStartIndex+4*s.numGlyphs;for(let d=s.vertexStartIndex;d<l;d+=4)t.indexArray.emplaceBack(d,d+1,d+2),t.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),s=Math.cos(t),l=[],d=[],f=[];for(let y=0;y<this.symbolInstances.length;++y){f.push(y);const b=this.symbolInstances.get(y);l.push(0|Math.round(r*b.anchorX+s*b.anchorY)),d.push(b.featureIndex)}return f.sort((y,b)=>l[y]-l[b]||d[b]-d[y]),f}addToSortKeyRanges(t,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((l,d,f)=>{l>=0&&f.indexOf(l)===d&&this.addIndicesForPlacedSymbol(this.text,l)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let AA,dA;mt("SymbolBucket",nc,{omit:["layers","collisionBoxArray","features","compareText"]}),nc.MAX_GLYPHS=65535,nc.addDynamicAttributes=Gh;var Oh={get paint(){return dA=dA||new u({"icon-opacity":new Ut(Re.paint_symbol["icon-opacity"]),"icon-color":new Ut(Re.paint_symbol["icon-color"]),"icon-halo-color":new Ut(Re.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ut(Re.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ut(Re.paint_symbol["icon-halo-blur"]),"icon-translate":new Qt(Re.paint_symbol["icon-translate"]),"icon-translate-anchor":new Qt(Re.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ut(Re.paint_symbol["text-opacity"]),"text-color":new Ut(Re.paint_symbol["text-color"],{runtimeType:Ht,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Ut(Re.paint_symbol["text-halo-color"]),"text-halo-width":new Ut(Re.paint_symbol["text-halo-width"]),"text-halo-blur":new Ut(Re.paint_symbol["text-halo-blur"]),"text-translate":new Qt(Re.paint_symbol["text-translate"]),"text-translate-anchor":new Qt(Re.paint_symbol["text-translate-anchor"])})},get layout(){return AA=AA||new u({"symbol-placement":new Qt(Re.layout_symbol["symbol-placement"]),"symbol-spacing":new Qt(Re.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Qt(Re.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ut(Re.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Qt(Re.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Qt(Re.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Qt(Re.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Qt(Re.layout_symbol["icon-ignore-placement"]),"icon-optional":new Qt(Re.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Qt(Re.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ut(Re.layout_symbol["icon-size"]),"icon-text-fit":new Qt(Re.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Qt(Re.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ut(Re.layout_symbol["icon-image"]),"icon-rotate":new Ut(Re.layout_symbol["icon-rotate"]),"icon-padding":new Ut(Re.layout_symbol["icon-padding"]),"icon-keep-upright":new Qt(Re.layout_symbol["icon-keep-upright"]),"icon-offset":new Ut(Re.layout_symbol["icon-offset"]),"icon-anchor":new Ut(Re.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Qt(Re.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Qt(Re.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Qt(Re.layout_symbol["text-rotation-alignment"]),"text-field":new Ut(Re.layout_symbol["text-field"]),"text-font":new Ut(Re.layout_symbol["text-font"]),"text-size":new Ut(Re.layout_symbol["text-size"]),"text-max-width":new Ut(Re.layout_symbol["text-max-width"]),"text-line-height":new Qt(Re.layout_symbol["text-line-height"]),"text-letter-spacing":new Ut(Re.layout_symbol["text-letter-spacing"]),"text-justify":new Ut(Re.layout_symbol["text-justify"]),"text-radial-offset":new Ut(Re.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Qt(Re.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ut(Re.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ut(Re.layout_symbol["text-anchor"]),"text-max-angle":new Qt(Re.layout_symbol["text-max-angle"]),"text-writing-mode":new Qt(Re.layout_symbol["text-writing-mode"]),"text-rotate":new Ut(Re.layout_symbol["text-rotate"]),"text-padding":new Qt(Re.layout_symbol["text-padding"]),"text-keep-upright":new Qt(Re.layout_symbol["text-keep-upright"]),"text-transform":new Ut(Re.layout_symbol["text-transform"]),"text-offset":new Ut(Re.layout_symbol["text-offset"]),"text-allow-overlap":new Qt(Re.layout_symbol["text-allow-overlap"]),"text-overlap":new Qt(Re.layout_symbol["text-overlap"]),"text-ignore-placement":new Qt(Re.layout_symbol["text-ignore-placement"]),"text-optional":new Qt(Re.layout_symbol["text-optional"])})}};class fA{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:nn,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}mt("FormatSectionOverride",fA,{omit:["defaultValue"]});class rh extends n{constructor(t){super(t,Oh)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const s=this.layout.get("text-writing-mode");if(s){const l=[];for(const d of s)l.indexOf(d)<0&&l.push(d);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,s,l){const d=this.layout.get(t).evaluate(r,{},s,l),f=this._unevaluatedLayout._values[t];return f.isDataDriven()||xo(f.value)||!d?d:function(y,b){return b.replace(/{([^{}]+)}/g,(C,D)=>y&&D in y?String(y[D]):"")}(r.properties,d)}createBucket(t){return new nc(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Oh.paint.overridableProperties){if(!rh.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),s=new fA(r),l=new Ia(s,r.property.specification);let d=null;d=r.value.kind==="constant"||r.value.kind==="source"?new Ln("source",l):new Jn("composite",l,r.value.zoomStops),this.paint._values[t]=new Fn(r.property,d,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&rh.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const s=t.get("text-field"),l=Oh.paint.properties[r];let d=!1;const f=y=>{for(const b of y)if(l.overrides&&l.overrides.hasOverride(b))return void(d=!0)};if(s.value.kind==="constant"&&s.value.value instanceof Tr)f(s.value.value.sections);else if(s.value.kind==="source"){const y=C=>{d||(C instanceof pn&&or(C.value)===kn?f(C.value.sections):C instanceof Ps?f(C.sections):C.eachChild(y))},b=s.value;b._styleExpression&&y(b._styleExpression.expression)}return d}}let gA;var fg={get paint(){return gA=gA||new u({"background-color":new Qt(Re.paint_background["background-color"]),"background-pattern":new zo(Re.paint_background["background-pattern"]),"background-opacity":new Qt(Re.paint_background["background-opacity"])})}};class gg extends n{constructor(t){super(t,fg)}}let pA;var pg={get paint(){return pA=pA||new u({"raster-opacity":new Qt(Re.paint_raster["raster-opacity"]),"raster-hue-rotate":new Qt(Re.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Qt(Re.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Qt(Re.paint_raster["raster-brightness-max"]),"raster-saturation":new Qt(Re.paint_raster["raster-saturation"]),"raster-contrast":new Qt(Re.paint_raster["raster-contrast"]),"raster-resampling":new Qt(Re.paint_raster["raster-resampling"]),"raster-fade-duration":new Qt(Re.paint_raster["raster-fade-duration"])})}};class mg extends n{constructor(t){super(t,pg)}}class yg extends n{constructor(t){super(t,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class _g{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const qh=63710088e-1;class qo{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new qo(zt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,s=this.lat*r,l=t.lat*r,d=Math.sin(s)*Math.sin(l)+Math.cos(s)*Math.cos(l)*Math.cos((t.lng-this.lng)*r);return qh*Math.acos(Math.min(d,1))}static convert(t){if(t instanceof qo)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new qo(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new qo(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const mA=2*Math.PI*qh;function yA(i){return mA*Math.cos(i*Math.PI/180)}function _A(i){return(180+i)/360}function IA(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function bA(i,t){return i/yA(t)}function Vh(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class kc{constructor(t,r,s=0){this.x=+t,this.y=+r,this.z=+s}static fromLngLat(t,r=0){const s=qo.convert(t);return new kc(_A(s.lng),IA(s.lat),bA(r,s.lat))}toLngLat(){return new qo(360*this.x-180,Vh(this.y))}toAltitude(){return this.z*yA(Vh(this.y))}meterInMercatorCoordinateUnits(){return 1/mA*(t=Vh(this.y),1/Math.cos(t*Math.PI/180));var t}}function wA(i,t,r){var s=2*Math.PI*6378137/256/Math.pow(2,r);return[i*s-2*Math.PI*6378137/2,t*s-2*Math.PI*6378137/2]}class Hh{constructor(t,r,s){if(!function(l,d,f){return!(l<0||l>25||f<0||f>=Math.pow(2,l)||d<0||d>=Math.pow(2,l))}(t,r,s))throw new Error(`x=${r}, y=${s}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=s,this.key=Dc(0,t,t,r,s)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,s){const l=(f=this.y,y=this.z,b=wA(256*(d=this.x),256*(f=Math.pow(2,y)-f-1),y),C=wA(256*(d+1),256*(f+1),y),b[0]+","+b[1]+","+C[0]+","+C[1]);var d,f,y,b,C;const D=function(R,N,J){let X,W="";for(let fe=R;fe>0;fe--)X=1<<fe-1,W+=(N&X?1:0)+(J&X?2:0);return W}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,D).replace(/{bbox-epsg-3857}/g,l)}isChildOf(t){const r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){const r=Math.pow(2,this.z);return new Qe((t.x*r-this.x)*gr,(t.y*r-this.y)*gr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class vA{constructor(t,r){this.wrap=t,this.canonical=r,this.key=Dc(t,r.z,r.z,r.x,r.y)}}class is{constructor(t,r,s,l,d){if(t<s)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${s}`);this.overscaledZ=t,this.wrap=r,this.canonical=new Hh(s,+l,+d),this.key=Dc(r,t,s,l,d)}clone(){return new is(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-t;return t>this.canonical.z?new is(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new is(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-t;return t>this.canonical.z?Dc(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):Dc(this.wrap*+r,t,t,this.canonical.x>>s,this.canonical.y>>s)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new is(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,l=2*this.canonical.y;return[new is(r,this.wrap,r,s,l),new is(r,this.wrap,r,s+1,l),new is(r,this.wrap,r,s,l+1),new is(r,this.wrap,r,s+1,l+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new is(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new is(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new vA(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new kc(t.x-this.wrap,t.y))}}function Dc(i,t,r,s,l){(i*=2)<0&&(i=-1*i-1);const d=1<<r;return(d*d*i+d*l+s).toString(36)+r.toString(36)+t.toString(36)}mt("CanonicalTileID",Hh),mt("OverscaledTileID",is,{omit:["posMatrix"]});class xA{constructor(t,r,s,l=1,d=1,f=1,y=0){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&!["mapbox","terrarium","custom"].includes(s))return void mi(`"${s}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const b=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),s){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=l,this.greenFactor=d,this.blueFactor=f,this.baseShift=y;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let C=0;C<b;C++)this.data[this._idx(-1,C)]=this.data[this._idx(0,C)],this.data[this._idx(b,C)]=this.data[this._idx(b-1,C)],this.data[this._idx(C,-1)]=this.data[this._idx(C,0)],this.data[this._idx(C,b)]=this.data[this._idx(C,b-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(b,-1)]=this.data[this._idx(b-1,0)],this.data[this._idx(-1,b)]=this.data[this._idx(0,b-1)],this.data[this._idx(b,b)]=this.data[this._idx(b-1,b-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let C=0;C<b;C++)for(let D=0;D<b;D++){const R=this.get(C,D);R>this.max&&(this.max=R),R<this.min&&(this.min=R)}}get(t,r){const s=new Uint8Array(this.data.buffer),l=4*this._idx(t,r);return this.unpack(s[l],s[l+1],s[l+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}unpack(t,r,s){return t*this.redFactor+r*this.greenFactor+s*this.blueFactor-this.baseShift}getPixels(){return new ts({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,s){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let l=r*this.dim,d=r*this.dim+this.dim,f=s*this.dim,y=s*this.dim+this.dim;switch(r){case-1:l=d-1;break;case 1:d=l+1}switch(s){case-1:f=y-1;break;case 1:y=f+1}const b=-r*this.dim,C=-s*this.dim;for(let D=f;D<y;D++)for(let R=l;R<d;R++)this.data[this._idx(R,D)]=t.data[this._idx(R+b,D+C)]}}mt("DEMData",xA);class BA{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const s=t[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class CA{constructor(t,r,s,l,d){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=s,t._y=l,this.properties=t.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class EA{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new $n(gr,16,0),this.grid3D=new $n(gr,16,0),this.featureIndexArray=new Ce,this.promoteId=r}insert(t,r,s,l,d,f){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,l,d);const b=f?this.grid3D:this.grid;for(let C=0;C<r.length;C++){const D=r[C],R=[1/0,1/0,-1/0,-1/0];for(let N=0;N<D.length;N++){const J=D[N];R[0]=Math.min(R[0],J.x),R[1]=Math.min(R[1],J.y),R[2]=Math.max(R[2],J.x),R[3]=Math.max(R[3],J.y)}R[0]<gr&&R[1]<gr&&R[2]>=0&&R[3]>=0&&b.insert(y,R[0],R[1],R[2],R[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Uo.VectorTile(new Th(this.rawTileData)).layers,this.sourceLayerCoder=new BA(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,s,l){this.loadVTLayers();const d=t.params||{},f=gr/t.tileSize/t.scale,y=ys(d.filter),b=t.queryGeometry,C=t.queryPadding*f,D=SA(b),R=this.grid.query(D.minX-C,D.minY-C,D.maxX+C,D.maxY+C),N=SA(t.cameraQueryGeometry),J=this.grid3D.query(N.minX-C,N.minY-C,N.maxX+C,N.maxY+C,(fe,ye,Me,ve)=>function(ke,Oe,it,wt,qt){for(const pt of ke)if(Oe<=pt.x&&it<=pt.y&&wt>=pt.x&&qt>=pt.y)return!0;const It=[new Qe(Oe,it),new Qe(Oe,qt),new Qe(wt,qt),new Qe(wt,it)];if(ke.length>2){for(const pt of It)if($l(ke,pt))return!0}for(let pt=0;pt<ke.length-1;pt++)if(Xd(ke[pt],ke[pt+1],It))return!0;return!1}(t.cameraQueryGeometry,fe-C,ye-C,Me+C,ve+C));for(const fe of J)R.push(fe);R.sort(Ig);const X={};let W;for(let fe=0;fe<R.length;fe++){const ye=R[fe];if(ye===W)continue;W=ye;const Me=this.featureIndexArray.get(ye);let ve=null;this.loadMatchingFeature(X,Me.bucketIndex,Me.sourceLayerIndex,Me.featureIndex,y,d.layers,d.availableImages,r,s,l,(ke,Oe,it)=>(ve||(ve=Sl(ke)),Oe.queryIntersectsFeature(b,ke,it,ve,this.z,t.transform,f,t.pixelPosMatrix)))}return X}loadMatchingFeature(t,r,s,l,d,f,y,b,C,D,R){const N=this.bucketLayerIDs[r];if(f&&!function(fe,ye){for(let Me=0;Me<fe.length;Me++)if(ye.indexOf(fe[Me])>=0)return!0;return!1}(f,N))return;const J=this.sourceLayerCoder.decode(s),X=this.vtLayers[J].feature(l);if(d.needGeometry){const fe=kl(X,!0);if(!d.filter(new Fi(this.tileID.overscaledZ),fe,this.tileID.canonical))return}else if(!d.filter(new Fi(this.tileID.overscaledZ),X))return;const W=this.getId(X,J);for(let fe=0;fe<N.length;fe++){const ye=N[fe];if(f&&f.indexOf(ye)<0)continue;const Me=b[ye];if(!Me)continue;let ve={};W&&D&&(ve=D.getState(Me.sourceLayer||"_geojsonTileLayer",W));const ke=ut({},C[ye]);ke.paint=QA(ke.paint,Me.paint,X,ve,y),ke.layout=QA(ke.layout,Me.layout,X,ve,y);const Oe=!R||R(X,Me,ve);if(!Oe)continue;const it=new CA(X,this.z,this.x,this.y,W);it.layer=ke;let wt=t[ye];wt===void 0&&(wt=t[ye]=[]),wt.push({featureIndex:l,feature:it,intersectionZ:Oe})}}lookupSymbolFeatures(t,r,s,l,d,f,y,b){const C={};this.loadVTLayers();const D=ys(d);for(const R of t)this.loadMatchingFeature(C,s,l,R,D,f,y,b,r);return C}hasLayer(t){for(const r of this.bucketLayerIDs)for(const s of r)if(t===s)return!0;return!1}getId(t,r){let s=t.id;return this.promoteId&&(s=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof s=="boolean"&&(s=Number(s))),s}}function QA(i,t,r,s,l){return Nt(i,(d,f)=>{const y=t instanceof Ca?t.get(f):null;return y&&y.evaluate?y.evaluate(r,s,l):y})}function SA(i){let t=1/0,r=1/0,s=-1/0,l=-1/0;for(const d of i)t=Math.min(t,d.x),r=Math.min(r,d.y),s=Math.max(s,d.x),l=Math.max(l,d.y);return{minX:t,minY:r,maxX:s,maxY:l}}function Ig(i,t){return t-i}function kA(i,t,r,s,l){const d=[];for(let f=0;f<i.length;f++){const y=i[f];let b;for(let C=0;C<y.length-1;C++){let D=y[C],R=y[C+1];D.x<t&&R.x<t||(D.x<t?D=new Qe(t,D.y+(t-D.x)/(R.x-D.x)*(R.y-D.y))._round():R.x<t&&(R=new Qe(t,D.y+(t-D.x)/(R.x-D.x)*(R.y-D.y))._round()),D.y<r&&R.y<r||(D.y<r?D=new Qe(D.x+(r-D.y)/(R.y-D.y)*(R.x-D.x),r)._round():R.y<r&&(R=new Qe(D.x+(r-D.y)/(R.y-D.y)*(R.x-D.x),r)._round()),D.x>=s&&R.x>=s||(D.x>=s?D=new Qe(s,D.y+(s-D.x)/(R.x-D.x)*(R.y-D.y))._round():R.x>=s&&(R=new Qe(s,D.y+(s-D.x)/(R.x-D.x)*(R.y-D.y))._round()),D.y>=l&&R.y>=l||(D.y>=l?D=new Qe(D.x+(l-D.y)/(R.y-D.y)*(R.x-D.x),l)._round():R.y>=l&&(R=new Qe(D.x+(l-D.y)/(R.y-D.y)*(R.x-D.x),l)._round()),b&&D.equals(b[b.length-1])||(b=[D],d.push(b)),b.push(R)))))}}return d}mt("FeatureIndex",EA,{omit:["rawTileData","sourceLayerCoder"]});class Vo extends Qe{constructor(t,r,s,l){super(t,r),this.angle=s,l!==void 0&&(this.segment=l)}clone(){return new Vo(this.x,this.y,this.angle,this.segment)}}function DA(i,t,r,s,l){if(t.segment===void 0||r===0)return!0;let d=t,f=t.segment+1,y=0;for(;y>-r/2;){if(f--,f<0)return!1;y-=i[f].dist(d),d=i[f]}y+=i[f].dist(i[f+1]),f++;const b=[];let C=0;for(;y<r/2;){const D=i[f],R=i[f+1];if(!R)return!1;let N=i[f-1].angleTo(D)-D.angleTo(R);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:y,angleDelta:N}),C+=N;y-b[0].distance>s;)C-=b.shift().angleDelta;if(C>l)return!1;f++,y+=D.dist(R)}return!0}function MA(i){let t=0;for(let r=0;r<i.length-1;r++)t+=i[r].dist(i[r+1]);return t}function TA(i,t,r){return i?.6*t*r:0}function PA(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function bg(i,t,r,s,l,d){const f=TA(r,l,d),y=PA(r,s)*d;let b=0;const C=MA(i)/2;for(let D=0;D<i.length-1;D++){const R=i[D],N=i[D+1],J=R.dist(N);if(b+J>C){const X=(C-b)/J,W=pr.number(R.x,N.x,X),fe=pr.number(R.y,N.y,X),ye=new Vo(W,fe,N.angleTo(R),D);return ye._round(),!f||DA(i,ye,y,f,t)?ye:void 0}b+=J}}function wg(i,t,r,s,l,d,f,y,b){const C=TA(s,d,f),D=PA(s,l),R=D*f,N=i[0].x===0||i[0].x===b||i[0].y===0||i[0].y===b;return t-R<t/4&&(t=R+t/4),RA(i,N?t/2*y%t:(D/2+2*d)*f*y%t,t,C,r,R,N,!1,b)}function RA(i,t,r,s,l,d,f,y,b){const C=d/2,D=MA(i);let R=0,N=t-r,J=[];for(let X=0;X<i.length-1;X++){const W=i[X],fe=i[X+1],ye=W.dist(fe),Me=fe.angleTo(W);for(;N+r<R+ye;){N+=r;const ve=(N-R)/ye,ke=pr.number(W.x,fe.x,ve),Oe=pr.number(W.y,fe.y,ve);if(ke>=0&&ke<b&&Oe>=0&&Oe<b&&N-C>=0&&N+C<=D){const it=new Vo(ke,Oe,Me,X);it._round(),s&&!DA(i,it,d,s,l)||J.push(it)}}R+=ye}return y||J.length||f||(J=RA(i,R/2,r,s,l,d,f,!0,b)),J}mt("Anchor",Vo);const sc=xn;function LA(i,t,r,s){const l=[],d=i.image,f=d.pixelRatio,y=d.paddedRect.w-2*sc,b=d.paddedRect.h-2*sc;let C={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const D=d.stretchX||[[0,y]],R=d.stretchY||[[0,b]],N=(Je,Lt)=>Je+Lt[1]-Lt[0],J=D.reduce(N,0),X=R.reduce(N,0),W=y-J,fe=b-X;let ye=0,Me=J,ve=0,ke=X,Oe=0,it=W,wt=0,qt=fe;if(d.content&&s){const Je=d.content,Lt=Je[2]-Je[0],kt=Je[3]-Je[1];(d.textFitWidth||d.textFitHeight)&&(C=cA(i)),ye=nh(D,0,Je[0]),ve=nh(R,0,Je[1]),Me=nh(D,Je[0],Je[2]),ke=nh(R,Je[1],Je[3]),Oe=Je[0]-ye,wt=Je[1]-ve,it=Lt-Me,qt=kt-ke}const It=C.x1,pt=C.y1,Tt=C.x2-It,Et=C.y2-pt,xt=(Je,Lt,kt,Jt)=>{const zi=sh(Je.stretch-ye,Me,Tt,It),Mi=ah(Je.fixed-Oe,it,Je.stretch,J),vr=sh(Lt.stretch-ve,ke,Et,pt),bs=ah(Lt.fixed-wt,qt,Lt.stretch,X),Gr=sh(kt.stretch-ye,Me,Tt,It),xr=ah(kt.fixed-Oe,it,kt.stretch,J),cn=sh(Jt.stretch-ve,ke,Et,pt),hn=ah(Jt.fixed-wt,qt,Jt.stretch,X),un=new Qe(zi,vr),lr=new Qe(Gr,vr),Br=new Qe(Gr,cn),Wr=new Qe(zi,cn),Ur=new Qe(Mi/f,bs/f),An=new Qe(xr/f,hn/f),Nr=t*Math.PI/180;if(Nr){const wi=Math.sin(Nr),Ni=Math.cos(Nr),Hi=[Ni,-wi,wi,Ni];un._matMult(Hi),lr._matMult(Hi),Wr._matMult(Hi),Br._matMult(Hi)}const rs=Je.stretch+Je.fixed,Bn=Lt.stretch+Lt.fixed;return{tl:un,tr:lr,bl:Wr,br:Br,tex:{x:d.paddedRect.x+sc+rs,y:d.paddedRect.y+sc+Bn,w:kt.stretch+kt.fixed-rs,h:Jt.stretch+Jt.fixed-Bn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ur,pixelOffsetBR:An,minFontScaleX:it/f/Tt,minFontScaleY:qt/f/Et,isSDF:r}};if(s&&(d.stretchX||d.stretchY)){const Je=FA(D,W,J),Lt=FA(R,fe,X);for(let kt=0;kt<Je.length-1;kt++){const Jt=Je[kt],zi=Je[kt+1];for(let Mi=0;Mi<Lt.length-1;Mi++)l.push(xt(Jt,Lt[Mi],zi,Lt[Mi+1]))}}else l.push(xt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:b+1}));return l}function nh(i,t,r){let s=0;for(const l of i)s+=Math.max(t,Math.min(r,l[1]))-Math.max(t,Math.min(r,l[0]));return s}function FA(i,t,r){const s=[{fixed:-sc,stretch:0}];for(const[l,d]of i){const f=s[s.length-1];s.push({fixed:l-f.stretch,stretch:f.stretch}),s.push({fixed:l-f.stretch,stretch:f.stretch+(d-l)})}return s.push({fixed:t+sc,stretch:r}),s}function sh(i,t,r,s){return i/t*r+s}function ah(i,t,r,s){return i-t*r/s}class oh{constructor(t,r,s,l,d,f,y,b,C,D){var R;if(this.boxStartIndex=t.length,C){let N=f.top,J=f.bottom;const X=f.collisionPadding;X&&(N-=X[1],J+=X[3]);let W=J-N;W>0&&(W=Math.max(10,W),this.circleDiameter=W)}else{const N=!((R=f.image)===null||R===void 0)&&R.content&&(f.image.textFitWidth||f.image.textFitHeight)?cA(f):{x1:f.left,y1:f.top,x2:f.right,y2:f.bottom};N.y1=N.y1*y-b[0],N.y2=N.y2*y+b[2],N.x1=N.x1*y-b[3],N.x2=N.x2*y+b[1];const J=f.collisionPadding;if(J&&(N.x1-=J[0]*y,N.y1-=J[1]*y,N.x2+=J[2]*y,N.y2+=J[3]*y),D){const X=new Qe(N.x1,N.y1),W=new Qe(N.x2,N.y1),fe=new Qe(N.x1,N.y2),ye=new Qe(N.x2,N.y2),Me=D*Math.PI/180;X._rotate(Me),W._rotate(Me),fe._rotate(Me),ye._rotate(Me),N.x1=Math.min(X.x,W.x,fe.x,ye.x),N.x2=Math.max(X.x,W.x,fe.x,ye.x),N.y1=Math.min(X.y,W.y,fe.y,ye.y),N.y2=Math.max(X.y,W.y,fe.y,ye.y)}t.emplaceBack(r.x,r.y,N.x1,N.y1,N.x2,N.y2,s,l,d)}this.boxEndIndex=t.length}}class vg{constructor(t=[],r=(s,l)=>s<l?-1:s>l?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:s}=this,l=r[t];for(;t>0;){const d=t-1>>1,f=r[d];if(s(l,f)>=0)break;r[t]=f,t=d}r[t]=l}_down(t){const{data:r,compare:s}=this,l=this.length>>1,d=r[t];for(;t<l;){let f=1+(t<<1);const y=f+1;if(y<this.length&&s(r[y],r[f])<0&&(f=y),s(r[f],d)>=0)break;r[t]=r[f],t=f}r[t]=d}}function xg(i,t=1,r=!1){let s=1/0,l=1/0,d=-1/0,f=-1/0;const y=i[0];for(let J=0;J<y.length;J++){const X=y[J];(!J||X.x<s)&&(s=X.x),(!J||X.y<l)&&(l=X.y),(!J||X.x>d)&&(d=X.x),(!J||X.y>f)&&(f=X.y)}const b=Math.min(d-s,f-l);let C=b/2;const D=new vg([],Bg);if(b===0)return new Qe(s,l);for(let J=s;J<d;J+=b)for(let X=l;X<f;X+=b)D.push(new ac(J+C,X+C,C,i));let R=function(J){let X=0,W=0,fe=0;const ye=J[0];for(let Me=0,ve=ye.length,ke=ve-1;Me<ve;ke=Me++){const Oe=ye[Me],it=ye[ke],wt=Oe.x*it.y-it.x*Oe.y;W+=(Oe.x+it.x)*wt,fe+=(Oe.y+it.y)*wt,X+=3*wt}return new ac(W/X,fe/X,0,J)}(i),N=D.length;for(;D.length;){const J=D.pop();(J.d>R.d||!R.d)&&(R=J,r&&console.log("found best %d after %d probes",Math.round(1e4*J.d)/1e4,N)),J.max-R.d<=t||(C=J.h/2,D.push(new ac(J.p.x-C,J.p.y-C,C,i)),D.push(new ac(J.p.x+C,J.p.y-C,C,i)),D.push(new ac(J.p.x-C,J.p.y+C,C,i)),D.push(new ac(J.p.x+C,J.p.y+C,C,i)),N+=4)}return r&&(console.log(`num probes: ${N}`),console.log(`best distance: ${R.d}`)),R.p}function Bg(i,t){return t.max-i.max}function ac(i,t,r,s){this.p=new Qe(i,t),this.h=r,this.d=function(l,d){let f=!1,y=1/0;for(let b=0;b<d.length;b++){const C=d[b];for(let D=0,R=C.length,N=R-1;D<R;N=D++){const J=C[D],X=C[N];J.y>l.y!=X.y>l.y&&l.x<(X.x-J.x)*(l.y-J.y)/(X.y-J.y)+J.x&&(f=!f),y=Math.min(y,Iu(l,J,X))}}return(f?1:-1)*Math.sqrt(y)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}var zr;S.aq=void 0,(zr=S.aq||(S.aq={}))[zr.center=1]="center",zr[zr.left=2]="left",zr[zr.right=3]="right",zr[zr.top=4]="top",zr[zr.bottom=5]="bottom",zr[zr["top-left"]=6]="top-left",zr[zr["top-right"]=7]="top-right",zr[zr["bottom-left"]=8]="bottom-left",zr[zr["bottom-right"]=9]="bottom-right";const Ho=7,jh=Number.POSITIVE_INFINITY;function zA(i,t){return t[1]!==jh?function(r,s,l){let d=0,f=0;switch(s=Math.abs(s),l=Math.abs(l),r){case"top-right":case"top-left":case"top":f=l-Ho;break;case"bottom-right":case"bottom-left":case"bottom":f=-l+Ho}switch(r){case"top-right":case"bottom-right":case"right":d=-s;break;case"top-left":case"bottom-left":case"left":d=s}return[d,f]}(i,t[0],t[1]):function(r,s){let l=0,d=0;s<0&&(s=0);const f=s/Math.SQRT2;switch(r){case"top-right":case"top-left":d=f-Ho;break;case"bottom-right":case"bottom-left":d=-f+Ho;break;case"bottom":d=-s+Ho;break;case"top":d=s-Ho}switch(r){case"top-right":case"bottom-right":l=-f;break;case"top-left":case"bottom-left":l=f;break;case"left":l=s;break;case"right":l=-s}return[l,d]}(i,t[0])}function GA(i,t,r){var s;const l=i.layout,d=(s=l.get("text-variable-anchor-offset"))===null||s===void 0?void 0:s.evaluate(t,{},r);if(d){const y=d.values,b=[];for(let C=0;C<y.length;C+=2){const D=b[C]=y[C],R=y[C+1].map(N=>N*mr);D.startsWith("top")?R[1]-=Ho:D.startsWith("bottom")&&(R[1]+=Ho),b[C+1]=R}return new Pr(b)}const f=l.get("text-variable-anchor");if(f){let y;y=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[l.get("text-radial-offset").evaluate(t,{},r)*mr,jh]:l.get("text-offset").evaluate(t,{},r).map(C=>C*mr);const b=[];for(const C of f)b.push(C,zA(C,y));return new Pr(b)}return null}function Jh(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Cg(i,t,r,s,l,d,f,y,b,C,D){let R=d.textMaxSize.evaluate(t,{});R===void 0&&(R=f);const N=i.layers[0].layout,J=N.get("icon-offset").evaluate(t,{},D),X=NA(r.horizontal),W=f/24,fe=i.tilePixelRatio*W,ye=i.tilePixelRatio*R/24,Me=i.tilePixelRatio*y,ve=i.tilePixelRatio*N.get("symbol-spacing"),ke=N.get("text-padding")*i.tilePixelRatio,Oe=function(Je,Lt,kt,Jt=1){const zi=Je.get("icon-padding").evaluate(Lt,{},kt),Mi=zi&&zi.values;return[Mi[0]*Jt,Mi[1]*Jt,Mi[2]*Jt,Mi[3]*Jt]}(N,t,D,i.tilePixelRatio),it=N.get("text-max-angle")/180*Math.PI,wt=N.get("text-rotation-alignment")!=="viewport"&&N.get("symbol-placement")!=="point",qt=N.get("icon-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",It=N.get("symbol-placement"),pt=ve/2,Tt=N.get("icon-text-fit");let Et;s&&Tt!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(Et=hA(s,r.vertical,Tt,N.get("icon-text-fit-padding"),J,W)),X&&(s=hA(s,X,Tt,N.get("icon-text-fit-padding"),J,W)));const xt=(Je,Lt)=>{Lt.x<0||Lt.x>=gr||Lt.y<0||Lt.y>=gr||function(kt,Jt,zi,Mi,vr,bs,Gr,xr,cn,hn,un,lr,Br,Wr,Ur,An,Nr,rs,Bn,wi,Ni,Hi,Gn,rr,oc){const Sa=kt.addToLineVertexArray(Jt,zi);let ka,ws,ns,kr,io=0,Pc=0,HA=0,jA=0,tu=-1,iu=-1;const ro={};let JA=jt("");if(kt.allowVerticalPlacement&&Mi.vertical){const en=xr.layout.get("text-rotate").evaluate(Ni,{},rr)+90;ns=new oh(cn,Jt,hn,un,lr,Mi.vertical,Br,Wr,Ur,en),Gr&&(kr=new oh(cn,Jt,hn,un,lr,Gr,Nr,rs,Ur,en))}if(vr){const en=xr.layout.get("icon-rotate").evaluate(Ni,{}),ss=xr.layout.get("icon-text-fit")!=="none",Ml=LA(vr,en,Gn,ss),ta=Gr?LA(Gr,en,Gn,ss):void 0;ws=new oh(cn,Jt,hn,un,lr,vr,Nr,rs,!1,en),io=4*Ml.length;const Tl=kt.iconSizeData;let Da=null;Tl.kind==="source"?(Da=[Qa*xr.layout.get("icon-size").evaluate(Ni,{})],Da[0]>Oo&&mi(`${kt.layerIds[0]}: Value for "icon-size" is >= ${Sc}. Reduce your "icon-size".`)):Tl.kind==="composite"&&(Da=[Qa*Hi.compositeIconSizes[0].evaluate(Ni,{},rr),Qa*Hi.compositeIconSizes[1].evaluate(Ni,{},rr)],(Da[0]>Oo||Da[1]>Oo)&&mi(`${kt.layerIds[0]}: Value for "icon-size" is >= ${Sc}. Reduce your "icon-size".`)),kt.addSymbols(kt.icon,Ml,Da,wi,Bn,Ni,S.ah.none,Jt,Sa.lineStartIndex,Sa.lineLength,-1,rr),tu=kt.icon.placedSymbolArray.length-1,ta&&(Pc=4*ta.length,kt.addSymbols(kt.icon,ta,Da,wi,Bn,Ni,S.ah.vertical,Jt,Sa.lineStartIndex,Sa.lineLength,-1,rr),iu=kt.icon.placedSymbolArray.length-1)}const YA=Object.keys(Mi.horizontal);for(const en of YA){const ss=Mi.horizontal[en];if(!ka){JA=jt(ss.text);const ta=xr.layout.get("text-rotate").evaluate(Ni,{},rr);ka=new oh(cn,Jt,hn,un,lr,ss,Br,Wr,Ur,ta)}const Ml=ss.positionedLines.length===1;if(HA+=UA(kt,Jt,ss,bs,xr,Ur,Ni,An,Sa,Mi.vertical?S.ah.horizontal:S.ah.horizontalOnly,Ml?YA:[en],ro,tu,Hi,rr),Ml)break}Mi.vertical&&(jA+=UA(kt,Jt,Mi.vertical,bs,xr,Ur,Ni,An,Sa,S.ah.vertical,["vertical"],ro,iu,Hi,rr));const Sg=ka?ka.boxStartIndex:kt.collisionBoxArray.length,kg=ka?ka.boxEndIndex:kt.collisionBoxArray.length,Dg=ns?ns.boxStartIndex:kt.collisionBoxArray.length,Mg=ns?ns.boxEndIndex:kt.collisionBoxArray.length,Tg=ws?ws.boxStartIndex:kt.collisionBoxArray.length,Pg=ws?ws.boxEndIndex:kt.collisionBoxArray.length,Rg=kr?kr.boxStartIndex:kt.collisionBoxArray.length,Lg=kr?kr.boxEndIndex:kt.collisionBoxArray.length;let ea=-1;const ch=(en,ss)=>en&&en.circleDiameter?Math.max(en.circleDiameter,ss):ss;ea=ch(ka,ea),ea=ch(ns,ea),ea=ch(ws,ea),ea=ch(kr,ea);const KA=ea>-1?1:0;KA&&(ea*=oc/mr),kt.glyphOffsetArray.length>=nc.MAX_GLYPHS&&mi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ni.sortKey!==void 0&&kt.addToSortKeyRanges(kt.symbolInstances.length,Ni.sortKey);const Fg=GA(xr,Ni,rr),[zg,Gg]=function(en,ss){const Ml=en.length,ta=ss==null?void 0:ss.values;if((ta==null?void 0:ta.length)>0)for(let Tl=0;Tl<ta.length;Tl+=2){const Da=ta[Tl+1];en.emplaceBack(S.aq[ta[Tl]],Da[0],Da[1])}return[Ml,en.length]}(kt.textAnchorOffsets,Fg);kt.symbolInstances.emplaceBack(Jt.x,Jt.y,ro.right>=0?ro.right:-1,ro.center>=0?ro.center:-1,ro.left>=0?ro.left:-1,ro.vertical||-1,tu,iu,JA,Sg,kg,Dg,Mg,Tg,Pg,Rg,Lg,hn,HA,jA,io,Pc,KA,0,Br,ea,zg,Gg)}(i,Lt,Je,r,s,l,Et,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,fe,[ke,ke,ke,ke],wt,b,Me,Oe,qt,J,t,d,C,D,f)};if(It==="line")for(const Je of kA(t.geometry,0,0,gr,gr)){const Lt=wg(Je,ve,it,r.vertical||X,s,24,ye,i.overscaling,gr);for(const kt of Lt)X&&Eg(i,X.text,pt,kt)||xt(Je,kt)}else if(It==="line-center"){for(const Je of t.geometry)if(Je.length>1){const Lt=bg(Je,it,r.vertical||X,s,24,ye);Lt&&xt(Je,Lt)}}else if(t.type==="Polygon")for(const Je of Ga(t.geometry,0)){const Lt=xg(Je,16);xt(Je[0],new Vo(Lt.x,Lt.y,0))}else if(t.type==="LineString")for(const Je of t.geometry)xt(Je,new Vo(Je[0].x,Je[0].y,0));else if(t.type==="Point")for(const Je of t.geometry)for(const Lt of Je)xt([Lt],new Vo(Lt.x,Lt.y,0))}function UA(i,t,r,s,l,d,f,y,b,C,D,R,N,J,X){const W=function(Me,ve,ke,Oe,it,wt,qt,It){const pt=Oe.layout.get("text-rotate").evaluate(wt,{})*Math.PI/180,Tt=[];for(const Et of ve.positionedLines)for(const xt of Et.positionedGlyphs){if(!xt.rect)continue;const Je=xt.rect||{};let Lt=iA+1,kt=!0,Jt=1,zi=0;const Mi=(it||It)&&xt.vertical,vr=xt.metrics.advance*xt.scale/2;if(It&&ve.verticalizable&&(zi=Et.lineOffset/2-(xt.imageName?-(mr-xt.metrics.width*xt.scale)/2:(xt.scale-1)*mr)),xt.imageName){const wi=qt[xt.imageName];kt=wi.sdf,Jt=wi.pixelRatio,Lt=xn/Jt}const bs=it?[xt.x+vr,xt.y]:[0,0];let Gr=it?[0,0]:[xt.x+vr+ke[0],xt.y+ke[1]-zi],xr=[0,0];Mi&&(xr=Gr,Gr=[0,0]);const cn=xt.metrics.isDoubleResolution?2:1,hn=(xt.metrics.left-Lt)*xt.scale-vr+Gr[0],un=(-xt.metrics.top-Lt)*xt.scale+Gr[1],lr=hn+Je.w/cn*xt.scale/Jt,Br=un+Je.h/cn*xt.scale/Jt,Wr=new Qe(hn,un),Ur=new Qe(lr,un),An=new Qe(hn,Br),Nr=new Qe(lr,Br);if(Mi){const wi=new Qe(-vr,vr-Ec),Ni=-Math.PI/2,Hi=mr/2-vr,Gn=new Qe(5-Ec-Hi,-(xt.imageName?Hi:0)),rr=new Qe(...xr);Wr._rotateAround(Ni,wi)._add(Gn)._add(rr),Ur._rotateAround(Ni,wi)._add(Gn)._add(rr),An._rotateAround(Ni,wi)._add(Gn)._add(rr),Nr._rotateAround(Ni,wi)._add(Gn)._add(rr)}if(pt){const wi=Math.sin(pt),Ni=Math.cos(pt),Hi=[Ni,-wi,wi,Ni];Wr._matMult(Hi),Ur._matMult(Hi),An._matMult(Hi),Nr._matMult(Hi)}const rs=new Qe(0,0),Bn=new Qe(0,0);Tt.push({tl:Wr,tr:Ur,bl:An,br:Nr,tex:Je,writingMode:ve.writingMode,glyphOffset:bs,sectionIndex:xt.sectionIndex,isSDF:kt,pixelOffsetTL:rs,pixelOffsetBR:Bn,minFontScaleX:0,minFontScaleY:0})}return Tt}(0,r,y,l,d,f,s,i.allowVerticalPlacement),fe=i.textSizeData;let ye=null;fe.kind==="source"?(ye=[Qa*l.layout.get("text-size").evaluate(f,{})],ye[0]>Oo&&mi(`${i.layerIds[0]}: Value for "text-size" is >= ${Sc}. Reduce your "text-size".`)):fe.kind==="composite"&&(ye=[Qa*J.compositeTextSizes[0].evaluate(f,{},X),Qa*J.compositeTextSizes[1].evaluate(f,{},X)],(ye[0]>Oo||ye[1]>Oo)&&mi(`${i.layerIds[0]}: Value for "text-size" is >= ${Sc}. Reduce your "text-size".`)),i.addSymbols(i.text,W,ye,y,d,f,C,t,b.lineStartIndex,b.lineLength,N,X);for(const Me of D)R[Me]=i.text.placedSymbolArray.length-1;return 4*W.length}function NA(i){for(const t in i)return i[t];return null}function Eg(i,t,r,s){const l=i.compareText;if(t in l){const d=l[t];for(let f=d.length-1;f>=0;f--)if(s.dist(d[f])<r)return!0}else l[t]=[];return l[t].push(s),!1}const OA=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Yh{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,s]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=s>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const d=OA[15&s];if(!d)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(t,2,1),[y]=new Uint32Array(t,4,1);return new Yh(y,f,d,t)}constructor(t,r=64,s=Float64Array,l){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=s,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const d=OA.indexOf(this.ArrayType),f=2*t*this.ArrayType.BYTES_PER_ELEMENT,y=t*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-y%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${s}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+b,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+f+y+b),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+b,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=t,this.coords[this._pos++]=r,s}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Kh(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,s,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:f,nodeSize:y}=this,b=[0,d.length-1,0],C=[];for(;b.length;){const D=b.pop()||0,R=b.pop()||0,N=b.pop()||0;if(R-N<=y){for(let fe=N;fe<=R;fe++){const ye=f[2*fe],Me=f[2*fe+1];ye>=t&&ye<=s&&Me>=r&&Me<=l&&C.push(d[fe])}continue}const J=N+R>>1,X=f[2*J],W=f[2*J+1];X>=t&&X<=s&&W>=r&&W<=l&&C.push(d[J]),(D===0?t<=X:r<=W)&&(b.push(N),b.push(J-1),b.push(1-D)),(D===0?s>=X:l>=W)&&(b.push(J+1),b.push(R),b.push(1-D))}return C}within(t,r,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:d,nodeSize:f}=this,y=[0,l.length-1,0],b=[],C=s*s;for(;y.length;){const D=y.pop()||0,R=y.pop()||0,N=y.pop()||0;if(R-N<=f){for(let fe=N;fe<=R;fe++)VA(d[2*fe],d[2*fe+1],t,r)<=C&&b.push(l[fe]);continue}const J=N+R>>1,X=d[2*J],W=d[2*J+1];VA(X,W,t,r)<=C&&b.push(l[J]),(D===0?t-s<=X:r-s<=W)&&(y.push(N),y.push(J-1),y.push(1-D)),(D===0?t+s>=X:r+s>=W)&&(y.push(J+1),y.push(R),y.push(1-D))}return b}}function Kh(i,t,r,s,l,d){if(l-s<=r)return;const f=s+l>>1;qA(i,t,f,s,l,d),Kh(i,t,r,s,f-1,1-d),Kh(i,t,r,f+1,l,1-d)}function qA(i,t,r,s,l,d){for(;l>s;){if(l-s>600){const C=l-s+1,D=r-s+1,R=Math.log(C),N=.5*Math.exp(2*R/3),J=.5*Math.sqrt(R*N*(C-N)/C)*(D-C/2<0?-1:1);qA(i,t,r,Math.max(s,Math.floor(r-D*N/C+J)),Math.min(l,Math.floor(r+(C-D)*N/C+J)),d)}const f=t[2*r+d];let y=s,b=l;for(Mc(i,t,s,r),t[2*l+d]>f&&Mc(i,t,s,l);y<b;){for(Mc(i,t,y,b),y++,b--;t[2*y+d]<f;)y++;for(;t[2*b+d]>f;)b--}t[2*s+d]===f?Mc(i,t,s,b):(b++,Mc(i,t,b,l)),b<=r&&(s=b+1),r<=b&&(l=b-1)}}function Mc(i,t,r,s){Zh(i,r,s),Zh(t,2*r,2*s),Zh(t,2*r+1,2*s+1)}function Zh(i,t,r){const s=i[t];i[t]=i[r],i[r]=s}function VA(i,t,r,s){const l=i-r,d=t-s;return l*l+d*d}var $h;S.bg=void 0,($h=S.bg||(S.bg={})).create="create",$h.load="load",$h.fullLoad="fullLoad";let lh=null,Tc=[];const Xh=1e3/60,Wh="loadTime",eu="fullLoadTime",Qg={mark(i){performance.mark(i)},frame(i){const t=i;lh!=null&&Tc.push(t-lh),lh=t},clearMetrics(){lh=null,Tc=[],performance.clearMeasures(Wh),performance.clearMeasures(eu);for(const i in S.bg)performance.clearMarks(S.bg[i])},getPerformanceMetrics(){performance.measure(Wh,S.bg.create,S.bg.load),performance.measure(eu,S.bg.create,S.bg.fullLoad);const i=performance.getEntriesByName(Wh)[0].duration,t=performance.getEntriesByName(eu)[0].duration,r=Tc.length,s=1/(Tc.reduce((d,f)=>d+f,0)/r/1e3),l=Tc.filter(d=>d>Xh).reduce((d,f)=>d+(f-Xh)/Xh,0);return{loadTime:i,fullLoadTime:t,fps:s,percentDroppedFrames:l/(r+l)*100,totalFrames:r}}};S.$=class extends L{},S.A=Xl,S.B=Hl,S.C=function(i){if(Ei==null){const t=i.navigator?i.navigator.userAgent:null;Ei=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Ei},S.D=Qt,S.E=si,S.F=class{constructor(i,t){this.target=i,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new _g(()=>this.process()),this.subscription=function(r,s,l,d){return r.addEventListener(s,l,!1),{unsubscribe:()=>{r.removeEventListener(s,l,!1)}}}(this.target,"message",r=>this.receive(r)),this.globalScope=Xt(self)?i:window}registerMessageHandler(i,t){this.messageHandlers[i]=t}sendAsync(i,t){return new Promise((r,s)=>{const l=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[l]={resolve:r,reject:s},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[l];const y={id:l,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(y)},{once:!0});const d=[],f=Object.assign(Object.assign({},i),{id:l,sourceMapId:this.mapId,origin:location.origin,data:Xn(i.data,d)});this.target.postMessage(f,{transfer:d})})}receive(i){const t=i.data,r=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[r];const s=this.abortControllers[r];return delete this.abortControllers[r],void(s&&s.abort())}if(Xt(self)||t.mustQueue)return this.tasks[r]=t,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,t)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){return c(this,void 0,void 0,function*(){if(t.type==="<response>"){const l=this.resolveRejects[i];return delete this.resolveRejects[i],l?void(t.error?l.reject(_s(t.error)):l.resolve(_s(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=_s(t.data),s=new AbortController;this.abortControllers[i]=s;try{const l=yield this.messageHandlers[t.type](t.sourceMapId,r,s);this.completeTask(i,null,l)}catch(l){this.completeTask(i,l)}})}completeTask(i,t,r){const s=[];delete this.abortControllers[i];const l={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Xn(t):null,data:Xn(r,s)};this.target.postMessage(l,{transfer:s})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},S.G=Wi,S.H=function(){var i=new Xl(16);return Xl!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},S.I=Rh,S.J=function(i,t,r){var s,l,d,f,y,b,C,D,R,N,J,X,W=r[0],fe=r[1],ye=r[2];return t===i?(i[12]=t[0]*W+t[4]*fe+t[8]*ye+t[12],i[13]=t[1]*W+t[5]*fe+t[9]*ye+t[13],i[14]=t[2]*W+t[6]*fe+t[10]*ye+t[14],i[15]=t[3]*W+t[7]*fe+t[11]*ye+t[15]):(l=t[1],d=t[2],f=t[3],y=t[4],b=t[5],C=t[6],D=t[7],R=t[8],N=t[9],J=t[10],X=t[11],i[0]=s=t[0],i[1]=l,i[2]=d,i[3]=f,i[4]=y,i[5]=b,i[6]=C,i[7]=D,i[8]=R,i[9]=N,i[10]=J,i[11]=X,i[12]=s*W+y*fe+R*ye+t[12],i[13]=l*W+b*fe+N*ye+t[13],i[14]=d*W+C*fe+J*ye+t[14],i[15]=f*W+D*fe+X*ye+t[15]),i},S.K=function(i,t,r){var s=r[0],l=r[1],d=r[2];return i[0]=t[0]*s,i[1]=t[1]*s,i[2]=t[2]*s,i[3]=t[3]*s,i[4]=t[4]*l,i[5]=t[5]*l,i[6]=t[6]*l,i[7]=t[7]*l,i[8]=t[8]*d,i[9]=t[9]*d,i[10]=t[10]*d,i[11]=t[11]*d,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},S.L=xu,S.M=function(i,t){const r={};for(let s=0;s<t.length;s++){const l=t[s];l in i&&(r[l]=i[l])}return r},S.N=qo,S.O=_A,S.P=Qe,S.Q=IA,S.R=ts,S.S=is,S.T=Lo,S.U=Bt,S.V=ht,S.W=Yi,S.X=gr,S.Y=_,S.Z=kc,S._=c,S.a=qi,S.a$=function(i,t){var r=i[0],s=i[1],l=i[2],d=i[3],f=i[4],y=i[5],b=i[6],C=i[7],D=i[8],R=i[9],N=i[10],J=i[11],X=i[12],W=i[13],fe=i[14],ye=i[15],Me=t[0],ve=t[1],ke=t[2],Oe=t[3],it=t[4],wt=t[5],qt=t[6],It=t[7],pt=t[8],Tt=t[9],Et=t[10],xt=t[11],Je=t[12],Lt=t[13],kt=t[14],Jt=t[15];return Math.abs(r-Me)<=ln*Math.max(1,Math.abs(r),Math.abs(Me))&&Math.abs(s-ve)<=ln*Math.max(1,Math.abs(s),Math.abs(ve))&&Math.abs(l-ke)<=ln*Math.max(1,Math.abs(l),Math.abs(ke))&&Math.abs(d-Oe)<=ln*Math.max(1,Math.abs(d),Math.abs(Oe))&&Math.abs(f-it)<=ln*Math.max(1,Math.abs(f),Math.abs(it))&&Math.abs(y-wt)<=ln*Math.max(1,Math.abs(y),Math.abs(wt))&&Math.abs(b-qt)<=ln*Math.max(1,Math.abs(b),Math.abs(qt))&&Math.abs(C-It)<=ln*Math.max(1,Math.abs(C),Math.abs(It))&&Math.abs(D-pt)<=ln*Math.max(1,Math.abs(D),Math.abs(pt))&&Math.abs(R-Tt)<=ln*Math.max(1,Math.abs(R),Math.abs(Tt))&&Math.abs(N-Et)<=ln*Math.max(1,Math.abs(N),Math.abs(Et))&&Math.abs(J-xt)<=ln*Math.max(1,Math.abs(J),Math.abs(xt))&&Math.abs(X-Je)<=ln*Math.max(1,Math.abs(X),Math.abs(Je))&&Math.abs(W-Lt)<=ln*Math.max(1,Math.abs(W),Math.abs(Lt))&&Math.abs(fe-kt)<=ln*Math.max(1,Math.abs(fe),Math.abs(kt))&&Math.abs(ye-Jt)<=ln*Math.max(1,Math.abs(ye),Math.abs(Jt))},S.a0=nt,S.a1=Hh,S.a2=lt,S.a3=i=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(r=>{t.onloadstart=()=>{r(t)};for(const s of i){const l=window.document.createElement("source");yr(s)||(t.crossOrigin="Anonymous"),l.src=s,t.appendChild(l)}})},S.a4=function(){return ft++},S.a5=ue,S.a6=nc,S.a7=ys,S.a8=kl,S.a9=CA,S.aA=function(i){if(i.type==="custom")return new yg(i);switch(i.type){case"background":return new gg(i);case"circle":return new tf(i);case"fill":return new _f(i);case"fill-extrusion":return new Pf(i);case"heatmap":return new nf(i);case"hillshade":return new af(i);case"line":return new Of(i);case"raster":return new mg(i);case"symbol":return new rh(i)}},S.aB=St,S.aC=function(i,t){if(!i)return[{command:"setStyle",args:[t]}];let r=[];try{if(!Wt(i.version,t.version))return[{command:"setStyle",args:[t]}];Wt(i.center,t.center)||r.push({command:"setCenter",args:[t.center]}),Wt(i.zoom,t.zoom)||r.push({command:"setZoom",args:[t.zoom]}),Wt(i.bearing,t.bearing)||r.push({command:"setBearing",args:[t.bearing]}),Wt(i.pitch,t.pitch)||r.push({command:"setPitch",args:[t.pitch]}),Wt(i.sprite,t.sprite)||r.push({command:"setSprite",args:[t.sprite]}),Wt(i.glyphs,t.glyphs)||r.push({command:"setGlyphs",args:[t.glyphs]}),Wt(i.transition,t.transition)||r.push({command:"setTransition",args:[t.transition]}),Wt(i.light,t.light)||r.push({command:"setLight",args:[t.light]}),Wt(i.terrain,t.terrain)||r.push({command:"setTerrain",args:[t.terrain]}),Wt(i.sky,t.sky)||r.push({command:"setSky",args:[t.sky]}),Wt(i.projection,t.projection)||r.push({command:"setProjection",args:[t.projection]});const s={},l=[];(function(f,y,b,C){let D;for(D in y=y||{},f=f||{})Object.prototype.hasOwnProperty.call(f,D)&&(Object.prototype.hasOwnProperty.call(y,D)||Ir(D,b,C));for(D in y)Object.prototype.hasOwnProperty.call(y,D)&&(Object.prototype.hasOwnProperty.call(f,D)?Wt(f[D],y[D])||(f[D].type==="geojson"&&y[D].type==="geojson"&&ra(f,y,D)?Ii(b,{command:"setGeoJSONSourceData",args:[D,y[D].data]}):qr(D,y,b,C)):Un(D,y,b))})(i.sources,t.sources,l,s);const d=[];i.layers&&i.layers.forEach(f=>{"source"in f&&s[f.source]?r.push({command:"removeLayer",args:[f.id]}):d.push(f)}),r=r.concat(l),function(f,y,b){y=y||[];const C=(f=f||[]).map(Ss),D=y.map(Ss),R=f.reduce(na,{}),N=y.reduce(na,{}),J=C.slice(),X=Object.create(null);let W,fe,ye,Me,ve;for(let ke=0,Oe=0;ke<C.length;ke++)W=C[ke],Object.prototype.hasOwnProperty.call(N,W)?Oe++:(Ii(b,{command:"removeLayer",args:[W]}),J.splice(J.indexOf(W,Oe),1));for(let ke=0,Oe=0;ke<D.length;ke++)W=D[D.length-1-ke],J[J.length-1-ke]!==W&&(Object.prototype.hasOwnProperty.call(R,W)?(Ii(b,{command:"removeLayer",args:[W]}),J.splice(J.lastIndexOf(W,J.length-Oe),1)):Oe++,Me=J[J.length-ke],Ii(b,{command:"addLayer",args:[N[W],Me]}),J.splice(J.length-ke,0,W),X[W]=!0);for(let ke=0;ke<D.length;ke++)if(W=D[ke],fe=R[W],ye=N[W],!X[W]&&!Wt(fe,ye))if(Wt(fe.source,ye.source)&&Wt(fe["source-layer"],ye["source-layer"])&&Wt(fe.type,ye.type)){for(ve in rn(fe.layout,ye.layout,b,W,null,"setLayoutProperty"),rn(fe.paint,ye.paint,b,W,null,"setPaintProperty"),Wt(fe.filter,ye.filter)||Ii(b,{command:"setFilter",args:[W,ye.filter]}),Wt(fe.minzoom,ye.minzoom)&&Wt(fe.maxzoom,ye.maxzoom)||Ii(b,{command:"setLayerZoomRange",args:[W,ye.minzoom,ye.maxzoom]}),fe)Object.prototype.hasOwnProperty.call(fe,ve)&&ve!=="layout"&&ve!=="paint"&&ve!=="filter"&&ve!=="metadata"&&ve!=="minzoom"&&ve!=="maxzoom"&&(ve.indexOf("paint.")===0?rn(fe[ve],ye[ve],b,W,ve.slice(6),"setPaintProperty"):Wt(fe[ve],ye[ve])||Ii(b,{command:"setLayerProperty",args:[W,ve,ye[ve]]}));for(ve in ye)Object.prototype.hasOwnProperty.call(ye,ve)&&!Object.prototype.hasOwnProperty.call(fe,ve)&&ve!=="layout"&&ve!=="paint"&&ve!=="filter"&&ve!=="metadata"&&ve!=="minzoom"&&ve!=="maxzoom"&&(ve.indexOf("paint.")===0?rn(fe[ve],ye[ve],b,W,ve.slice(6),"setPaintProperty"):Wt(fe[ve],ye[ve])||Ii(b,{command:"setLayerProperty",args:[W,ve,ye[ve]]}))}else Ii(b,{command:"removeLayer",args:[W]}),Me=J[J.lastIndexOf(W)+1],Ii(b,{command:"addLayer",args:[ye,Me]})}(d,t.layers,r)}catch(s){console.warn("Unable to compute style diff:",s),r=[{command:"setStyle",args:[t]}]}return r},S.aD=function(i){const t=[],r=i.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},S.aE=function i(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(!i(t[s],r[s]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(const s in t)if(!i(t[s],r[s]))return!1;return!0}return t===r},S.aF=Nt,S.aG=Gt,S.aH=class extends fr{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},S.aI=Ea,S.aJ=class extends fr{constructor(i,t){super(i,t),this.current=Zl}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},S.aK=qc,S.aL=Vc,S.aM=Bi,S.aN=class extends fr{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},S.aO=class extends fr{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},S.aP=function(i,t,r,s,l,d,f){var y=1/(t-r),b=1/(s-l),C=1/(d-f);return i[0]=-2*y,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*b,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*C,i[11]=0,i[12]=(t+r)*y,i[13]=(l+s)*b,i[14]=(f+d)*C,i[15]=1,i},S.aQ=ef,S.aR=class extends Q{},S.aS=jf,S.aT=class extends k{},S.aU=vh,S.aV=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},S.aW=Su,S.aX=be,S.aY=Ct,S.aZ=class extends ne{},S.a_=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]},S.aa=function(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,s,l,d)=>{const f=l||d;return t[s]=!f||f.toLowerCase(),""}),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},S.ab=function(i,t){const r=[];for(const s in i)s in t||r.push(s);return r},S.ac=dt,S.ad=function(i,t,r){var s=Math.sin(r),l=Math.cos(r),d=t[0],f=t[1],y=t[2],b=t[3],C=t[4],D=t[5],R=t[6],N=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=d*l+C*s,i[1]=f*l+D*s,i[2]=y*l+R*s,i[3]=b*l+N*s,i[4]=C*l-d*s,i[5]=D*l-f*s,i[6]=R*l-y*s,i[7]=N*l-b*s,i},S.ae=function(i){var t=new Xl(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},S.af=Yc,S.ag=function(i,t){let r=0,s=0;if(i.kind==="constant")s=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:l,minZoom:d,maxZoom:f}=i,y=l?dt(Rr.interpolationFactor(l,t,d,f),0,1):0;i.kind==="camera"?s=pr.number(i.minSize,i.maxSize,y):r=y}return{uSizeT:r,uSize:s}},S.ai=function(i,{uSize:t,uSizeT:r},{lowerSize:s,upperSize:l}){return i.kind==="source"?s/Qa:i.kind==="composite"?pr.number(s/Qa,l/Qa,r):t},S.aj=Gh,S.ak=function(i,t,r,s){const l=t.y-i.y,d=t.x-i.x,f=s.y-r.y,y=s.x-r.x,b=f*d-y*l;if(b===0)return null;const C=(y*(i.y-r.y)-f*(i.x-r.x))/b;return new Qe(i.x+C*d,i.y+C*l)},S.al=kA,S.am=yu,S.an=Ih,S.ao=function(i){let t=1/0,r=1/0,s=-1/0,l=-1/0;for(const d of i)t=Math.min(t,d.x),r=Math.min(r,d.y),s=Math.max(s,d.x),l=Math.max(l,d.y);return[t,r,s,l]},S.ap=mr,S.ar=zh,S.as=function(i,t){var r=t[0],s=t[1],l=t[2],d=t[3],f=t[4],y=t[5],b=t[6],C=t[7],D=t[8],R=t[9],N=t[10],J=t[11],X=t[12],W=t[13],fe=t[14],ye=t[15],Me=r*y-s*f,ve=r*b-l*f,ke=r*C-d*f,Oe=s*b-l*y,it=s*C-d*y,wt=l*C-d*b,qt=D*W-R*X,It=D*fe-N*X,pt=D*ye-J*X,Tt=R*fe-N*W,Et=R*ye-J*W,xt=N*ye-J*fe,Je=Me*xt-ve*Et+ke*Tt+Oe*pt-it*It+wt*qt;return Je?(i[0]=(y*xt-b*Et+C*Tt)*(Je=1/Je),i[1]=(l*Et-s*xt-d*Tt)*Je,i[2]=(W*wt-fe*it+ye*Oe)*Je,i[3]=(N*it-R*wt-J*Oe)*Je,i[4]=(b*pt-f*xt-C*It)*Je,i[5]=(r*xt-l*pt+d*It)*Je,i[6]=(fe*ke-X*wt-ye*ve)*Je,i[7]=(D*wt-N*ke+J*ve)*Je,i[8]=(f*Et-y*pt+C*qt)*Je,i[9]=(s*pt-r*Et-d*qt)*Je,i[10]=(X*it-W*ke+ye*Me)*Je,i[11]=(R*ke-D*it-J*Me)*Je,i[12]=(y*It-f*Tt-b*qt)*Je,i[13]=(r*Tt-s*It+l*qt)*Je,i[14]=(W*ve-X*Oe-fe*Me)*Je,i[15]=(D*Oe-R*ve+N*Me)*Je,i):null},S.at=Jh,S.au=Fh,S.av=Yh,S.aw=function(){const i={},t=Re.$version;for(const r in Re.$root){const s=Re.$root[r];if(s.required){let l=null;l=r==="version"?t:s.type==="array"?[]:{},l!=null&&(i[r]=l)}}return i},S.ax=Li,S.ay=yi,S.az=function(i){i=i.slice();const t=Object.create(null);for(let r=0;r<i.length;r++)t[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=Mr(i[r],t[i[r].ref]));return i},S.b=ni,S.b0=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},S.b1=function(i,t,r){return i[0]=t[0]*r[0],i[1]=t[1]*r[1],i[2]=t[2]*r[2],i[3]=t[3]*r[3],i},S.b2=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},S.b3=zt,S.b4=vA,S.b5=bA,S.b6=function(i,t,r,s,l){var d,f=1/Math.tan(t/2);return i[0]=f/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=f,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,l!=null&&l!==1/0?(i[10]=(l+s)*(d=1/(s-l)),i[14]=2*l*s*d):(i[10]=-1,i[14]=-2*s),i},S.b7=function(i,t,r){var s=Math.sin(r),l=Math.cos(r),d=t[4],f=t[5],y=t[6],b=t[7],C=t[8],D=t[9],R=t[10],N=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=d*l+C*s,i[5]=f*l+D*s,i[6]=y*l+R*s,i[7]=b*l+N*s,i[8]=C*l-d*s,i[9]=D*l-f*s,i[10]=R*l-y*s,i[11]=N*l-b*s,i},S.b8=Xe,S.b9=We,S.bA=Ku,S.bB=function(i){return i.message===$i},S.bC=ba,S.bD=ir,S.ba=function(i){return i*Math.PI/180},S.bb=function(i,t){const{x:r,y:s}=kc.fromLngLat(t);return!(i<0||i>25||s<0||s>=1||r<0||r>=1)},S.bc=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},S.bd=class extends M{},S.be=qh,S.bf=Qg,S.bh=Vi,S.bi=function(i,t){qi.REGISTERED_PROTOCOLS[i]=t},S.bj=function(i){delete qi.REGISTERED_PROTOCOLS[i]},S.bk=function(i,t){const r={};for(let l=0;l<i.length;l++){const d=t&&t[i[l].id]||ql(i[l]);t&&(t[i[l].id]=d);let f=r[d];f||(f=r[d]=[]),f.push(i[l])}const s=[];for(const l in r)s.push(r[l]);return s},S.bl=mt,S.bm=BA,S.bn=EA,S.bo=nA,S.bp=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=gr/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const t=i.bucket.layers[0],r=t.layout,s=t._unevaluatedLayout._values,l={layoutIconSize:s["icon-size"].possiblyEvaluate(new Fi(i.bucket.zoom+1),i.canonical),layoutTextSize:s["text-size"].possiblyEvaluate(new Fi(i.bucket.zoom+1),i.canonical),textMaxSize:s["text-size"].possiblyEvaluate(new Fi(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:C,maxZoom:D}=i.bucket.textSizeData;l.compositeTextSizes=[s["text-size"].possiblyEvaluate(new Fi(C),i.canonical),s["text-size"].possiblyEvaluate(new Fi(D),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:C,maxZoom:D}=i.bucket.iconSizeData;l.compositeIconSizes=[s["icon-size"].possiblyEvaluate(new Fi(C),i.canonical),s["icon-size"].possiblyEvaluate(new Fi(D),i.canonical)]}const d=r.get("text-line-height")*mr,f=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",y=r.get("text-keep-upright"),b=r.get("text-size");for(const C of i.bucket.features){const D=r.get("text-font").evaluate(C,{},i.canonical).join(","),R=b.evaluate(C,{},i.canonical),N=l.layoutTextSize.evaluate(C,{},i.canonical),J=l.layoutIconSize.evaluate(C,{},i.canonical),X={horizontal:{},vertical:void 0},W=C.text;let fe,ye=[0,0];if(W){const ke=W.toString(),Oe=r.get("text-letter-spacing").evaluate(C,{},i.canonical)*mr,it=Ys(ke)?Oe:0,wt=r.get("text-anchor").evaluate(C,{},i.canonical),qt=GA(t,C,i.canonical);if(!qt){const Et=r.get("text-radial-offset").evaluate(C,{},i.canonical);ye=Et?zA(wt,[Et*mr,jh]):r.get("text-offset").evaluate(C,{},i.canonical).map(xt=>xt*mr)}let It=f?"center":r.get("text-justify").evaluate(C,{},i.canonical);const pt=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(C,{},i.canonical)*mr:1/0,Tt=()=>{i.bucket.allowVerticalPlacement&&xl(ke)&&(X.vertical=eh(W,i.glyphMap,i.glyphPositions,i.imagePositions,D,pt,d,wt,"left",it,ye,S.ah.vertical,!0,N,R))};if(!f&&qt){const Et=new Set;if(It==="auto")for(let Je=0;Je<qt.values.length;Je+=2)Et.add(Jh(qt.values[Je]));else Et.add(It);let xt=!1;for(const Je of Et)if(!X.horizontal[Je])if(xt)X.horizontal[Je]=X.horizontal[0];else{const Lt=eh(W,i.glyphMap,i.glyphPositions,i.imagePositions,D,pt,d,"center",Je,it,ye,S.ah.horizontal,!1,N,R);Lt&&(X.horizontal[Je]=Lt,xt=Lt.positionedLines.length===1)}Tt()}else{It==="auto"&&(It=Jh(wt));const Et=eh(W,i.glyphMap,i.glyphPositions,i.imagePositions,D,pt,d,wt,It,it,ye,S.ah.horizontal,!1,N,R);Et&&(X.horizontal[It]=Et),Tt(),xl(ke)&&f&&y&&(X.vertical=eh(W,i.glyphMap,i.glyphPositions,i.imagePositions,D,pt,d,wt,It,it,ye,S.ah.vertical,!1,N,R))}}let Me=!1;if(C.icon&&C.icon.name){const ke=i.imageMap[C.icon.name];ke&&(fe=hg(i.imagePositions[C.icon.name],r.get("icon-offset").evaluate(C,{},i.canonical),r.get("icon-anchor").evaluate(C,{},i.canonical)),Me=!!ke.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=Me:i.bucket.sdfIcons!==Me&&mi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ke.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const ve=NA(X.horizontal)||X.vertical;i.bucket.iconsInText=!!ve&&ve.iconsInText,(ve||fe)&&Cg(i.bucket,C,X,fe,i.imageMap,l,N,J,ye,Me,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},S.bq=Dh,S.br=Qh,S.bs=kh,S.bt=Uo,S.bu=Th,S.bv=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},S.bw=function(i,t,r,s,l){return c(this,void 0,void 0,function*(){if(ht())try{return yield Yi(i,t,r,s,l)}catch{}return function(d,f,y,b,C){const D=d.width,R=d.height;Si&&Qi||(Si=new OffscreenCanvas(D,R),Qi=Si.getContext("2d",{willReadFrequently:!0})),Si.width=D,Si.height=R,Qi.drawImage(d,0,0,D,R);const N=Qi.getImageData(f,y,b,C);return Qi.clearRect(0,0,D,R),N.data}(i,t,r,s,l)})},S.bx=xA,S.by=he,S.bz=Ee,S.c=ur,S.d=i=>c(void 0,void 0,void 0,function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(t)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),S.e=ut,S.f=i=>new Promise((t,r)=>{const s=new Image;s.onload=()=>{t(s),URL.revokeObjectURL(s.src),s.onload=null,window.requestAnimationFrame(()=>{s.src=Oi})},s.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const l=new Blob([new Uint8Array(i)],{type:"image/png"});s.src=i.byteLength?URL.createObjectURL(l):Oi}),S.g=vi,S.h=(i,t)=>pi(ut(i,{type:"json"}),t),S.i=Xt,S.j=hi,S.k=Kt,S.l=(i,t)=>pi(ut(i,{type:"arrayBuffer"}),t),S.m=pi,S.n=function(i){return new Th(i).readFields(rg,[])},S.o=Ic,S.p=rA,S.q=u,S.r=on,S.s=yr,S.t=Mo,S.u=Js,S.v=Re,S.w=mi,S.x=function([i,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(r),y:i*Math.sin(t)*Math.sin(r),z:i*Math.cos(r)}},S.y=pr,S.z=Fi}),P("worker",["./shared"],function(S){class c{constructor(j){this.keyCache={},j&&this.replace(j)}replace(j){this._layerConfigs={},this._layers={},this.update(j,[])}update(j,H){for(const de of j){this._layerConfigs[de.id]=de;const we=this._layers[de.id]=S.aA(de);we._featureFilter=S.a7(we.filter),this.keyCache[de.id]&&delete this.keyCache[de.id]}for(const de of H)delete this.keyCache[de],delete this._layerConfigs[de],delete this._layers[de];this.familiesBySource={};const ee=S.bk(Object.values(this._layerConfigs),this.keyCache);for(const de of ee){const we=de.map(Le=>this._layers[Le.id]),Se=we[0];if(Se.visibility==="none")continue;const De=Se.source||"";let _e=this.familiesBySource[De];_e||(_e=this.familiesBySource[De]={});const Ne=Se.sourceLayer||"_geojsonTileLayer";let Ze=_e[Ne];Ze||(Ze=_e[Ne]=[]),Ze.push(we)}}}class he{constructor(j){const H={},ee=[];for(const De in j){const _e=j[De],Ne=H[De]={};for(const Ze in _e){const Le=_e[+Ze];if(!Le||Le.bitmap.width===0||Le.bitmap.height===0)continue;const At={x:0,y:0,w:Le.bitmap.width+2,h:Le.bitmap.height+2};ee.push(At),Ne[Ze]={rect:At,metrics:Le.metrics}}}const{w:de,h:we}=S.p(ee),Se=new S.o({width:de||1,height:we||1});for(const De in j){const _e=j[De];for(const Ne in _e){const Ze=_e[+Ne];if(!Ze||Ze.bitmap.width===0||Ze.bitmap.height===0)continue;const Le=H[De][Ne].rect;S.o.copy(Ze.bitmap,Se,{x:0,y:0},{x:Le.x+1,y:Le.y+1},Ze.bitmap)}}this.image=Se,this.positions=H}}S.bl("GlyphAtlas",he);class Ee{constructor(j){this.tileID=new S.S(j.tileID.overscaledZ,j.tileID.wrap,j.tileID.canonical.z,j.tileID.canonical.x,j.tileID.canonical.y),this.uid=j.uid,this.zoom=j.zoom,this.pixelRatio=j.pixelRatio,this.tileSize=j.tileSize,this.source=j.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=j.showCollisionBoxes,this.collectResourceTiming=!!j.collectResourceTiming,this.returnDependencies=!!j.returnDependencies,this.promoteId=j.promoteId,this.inFlightDependencies=[]}parse(j,H,ee,de){return S._(this,void 0,void 0,function*(){this.status="parsing",this.data=j,this.collisionBoxArray=new S.a5;const we=new S.bm(Object.keys(j.layers).sort()),Se=new S.bn(this.tileID,this.promoteId);Se.bucketLayerIDs=[];const De={},_e={featureIndex:Se,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ee},Ne=H.familiesBySource[this.source];for(const ii in Ne){const xi=j.layers[ii];if(!xi)continue;xi.version===1&&S.w(`Vector tile source "${this.source}" layer "${ii}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ui=we.encode(ii),ar=[];for(let Ar=0;Ar<xi.length;Ar++){const dr=xi.feature(Ar),gn=Se.getId(dr,ii);ar.push({feature:dr,id:gn,index:Ar,sourceLayerIndex:Ui})}for(const Ar of Ne[ii]){const dr=Ar[0];dr.source!==this.source&&S.w(`layer.source = ${dr.source} does not equal this.source = ${this.source}`),dr.minzoom&&this.zoom<Math.floor(dr.minzoom)||dr.maxzoom&&this.zoom>=dr.maxzoom||dr.visibility!=="none"&&(Fe(Ar,this.zoom,ee),(De[dr.id]=dr.createBucket({index:Se.bucketLayerIDs.length,layers:Ar,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ui,sourceID:this.source})).populate(ar,_e,this.tileID.canonical),Se.bucketLayerIDs.push(Ar.map(gn=>gn.id)))}}const Ze=S.aF(_e.glyphDependencies,ii=>Object.keys(ii).map(Number));this.inFlightDependencies.forEach(ii=>ii==null?void 0:ii.abort()),this.inFlightDependencies=[];let Le=Promise.resolve({});if(Object.keys(Ze).length){const ii=new AbortController;this.inFlightDependencies.push(ii),Le=de.sendAsync({type:"GG",data:{stacks:Ze,source:this.source,tileID:this.tileID,type:"glyphs"}},ii)}const At=Object.keys(_e.iconDependencies);let Rt=Promise.resolve({});if(At.length){const ii=new AbortController;this.inFlightDependencies.push(ii),Rt=de.sendAsync({type:"GI",data:{icons:At,source:this.source,tileID:this.tileID,type:"icons"}},ii)}const Ot=Object.keys(_e.patternDependencies);let ui=Promise.resolve({});if(Ot.length){const ii=new AbortController;this.inFlightDependencies.push(ii),ui=de.sendAsync({type:"GI",data:{icons:Ot,source:this.source,tileID:this.tileID,type:"patterns"}},ii)}const[Zt,fi,ai]=yield Promise.all([Le,Rt,ui]),sr=new he(Zt),Ki=new S.bo(fi,ai);for(const ii in De){const xi=De[ii];xi instanceof S.a6?(Fe(xi.layers,this.zoom,ee),S.bp({bucket:xi,glyphMap:Zt,glyphPositions:sr.positions,imageMap:fi,imagePositions:Ki.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):xi.hasPattern&&(xi instanceof S.bq||xi instanceof S.br||xi instanceof S.bs)&&(Fe(xi.layers,this.zoom,ee),xi.addFeatures(_e,this.tileID.canonical,Ki.patternPositions))}return this.status="done",{buckets:Object.values(De).filter(ii=>!ii.isEmpty()),featureIndex:Se,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:sr.image,imageAtlas:Ki,glyphMap:this.returnDependencies?Zt:null,iconMap:this.returnDependencies?fi:null,glyphPositions:this.returnDependencies?sr.positions:null}})}}function Fe(ge,j,H){const ee=new S.z(j);for(const de of ge)de.recalculate(ee,H)}class Qe{constructor(j,H,ee){this.actor=j,this.layerIndex=H,this.availableImages=ee,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(j,H){return S._(this,void 0,void 0,function*(){const ee=yield S.l(j.request,H);try{return{vectorTile:new S.bt.VectorTile(new S.bu(ee.data)),rawData:ee.data,cacheControl:ee.cacheControl,expires:ee.expires}}catch(de){const we=new Uint8Array(ee.data);let Se=`Unable to parse the tile at ${j.request.url}, `;throw Se+=we[0]===31&&we[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${de.message}`,new Error(Se)}})}loadTile(j){return S._(this,void 0,void 0,function*(){const H=j.uid,ee=!!(j&&j.request&&j.request.collectResourceTiming)&&new S.bv(j.request),de=new Ee(j);this.loading[H]=de;const we=new AbortController;de.abort=we;try{const Se=yield this.loadVectorTile(j,we);if(delete this.loading[H],!Se)return null;const De=Se.rawData,_e={};Se.expires&&(_e.expires=Se.expires),Se.cacheControl&&(_e.cacheControl=Se.cacheControl);const Ne={};if(ee){const Le=ee.finish();Le&&(Ne.resourceTiming=JSON.parse(JSON.stringify(Le)))}de.vectorTile=Se.vectorTile;const Ze=de.parse(Se.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[H]=de,this.fetching[H]={rawTileData:De,cacheControl:_e,resourceTiming:Ne};try{const Le=yield Ze;return S.e({rawTileData:De.slice(0)},Le,_e,Ne)}finally{delete this.fetching[H]}}catch(Se){throw delete this.loading[H],de.status="done",this.loaded[H]=de,Se}})}reloadTile(j){return S._(this,void 0,void 0,function*(){const H=j.uid;if(!this.loaded||!this.loaded[H])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ee=this.loaded[H];if(ee.showCollisionBoxes=j.showCollisionBoxes,ee.status==="parsing"){const de=yield ee.parse(ee.vectorTile,this.layerIndex,this.availableImages,this.actor);let we;if(this.fetching[H]){const{rawTileData:Se,cacheControl:De,resourceTiming:_e}=this.fetching[H];delete this.fetching[H],we=S.e({rawTileData:Se.slice(0)},de,De,_e)}else we=de;return we}if(ee.status==="done"&&ee.vectorTile)return ee.parse(ee.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(j){return S._(this,void 0,void 0,function*(){const H=this.loading,ee=j.uid;H&&H[ee]&&H[ee].abort&&(H[ee].abort.abort(),delete H[ee])})}removeTile(j){return S._(this,void 0,void 0,function*(){this.loaded&&this.loaded[j.uid]&&delete this.loaded[j.uid]})}}class me{constructor(){this.loaded={}}loadTile(j){return S._(this,void 0,void 0,function*(){const{uid:H,encoding:ee,rawImageData:de,redFactor:we,greenFactor:Se,blueFactor:De,baseShift:_e}=j,Ne=de.width+2,Ze=de.height+2,Le=S.b(de)?new S.R({width:Ne,height:Ze},yield S.bw(de,-1,-1,Ne,Ze)):de,At=new S.bx(H,Le,ee,we,Se,De,_e);return this.loaded=this.loaded||{},this.loaded[H]=At,At})}removeTile(j){const H=this.loaded,ee=j.uid;H&&H[ee]&&delete H[ee]}}function $e(ge,j){if(ge.length!==0){rt(ge[0],j);for(var H=1;H<ge.length;H++)rt(ge[H],!j)}}function rt(ge,j){for(var H=0,ee=0,de=0,we=ge.length,Se=we-1;de<we;Se=de++){var De=(ge[de][0]-ge[Se][0])*(ge[Se][1]+ge[de][1]),_e=H+De;ee+=Math.abs(H)>=Math.abs(De)?H-_e+De:De-_e+H,H=_e}H+ee>=0!=!!j&&ge.reverse()}var je=S.by(function ge(j,H){var ee,de=j&&j.type;if(de==="FeatureCollection")for(ee=0;ee<j.features.length;ee++)ge(j.features[ee],H);else if(de==="GeometryCollection")for(ee=0;ee<j.geometries.length;ee++)ge(j.geometries[ee],H);else if(de==="Feature")ge(j.geometry,H);else if(de==="Polygon")$e(j.coordinates,H);else if(de==="MultiPolygon")for(ee=0;ee<j.coordinates.length;ee++)$e(j.coordinates[ee],H);return j});const bt=S.bt.VectorTileFeature.prototype.toGeoJSON;var Bt={exports:{}},ht=S.bz,Xe=S.bt.VectorTileFeature,We=dt;function dt(ge,j){this.options=j||{},this.features=ge,this.length=ge.length}function zt(ge,j){this.id=typeof ge.id=="number"?ge.id:void 0,this.type=ge.type,this.rawGeometry=ge.type===1?[ge.geometry]:ge.geometry,this.properties=ge.tags,this.extent=j||4096}dt.prototype.feature=function(ge){return new zt(this.features[ge],this.options.extent)},zt.prototype.loadGeometry=function(){var ge=this.rawGeometry;this.geometry=[];for(var j=0;j<ge.length;j++){for(var H=ge[j],ee=[],de=0;de<H.length;de++)ee.push(new ht(H[de][0],H[de][1]));this.geometry.push(ee)}return this.geometry},zt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ge=this.geometry,j=1/0,H=-1/0,ee=1/0,de=-1/0,we=0;we<ge.length;we++)for(var Se=ge[we],De=0;De<Se.length;De++){var _e=Se[De];j=Math.min(j,_e.x),H=Math.max(H,_e.x),ee=Math.min(ee,_e.y),de=Math.max(de,_e.y)}return[j,ee,H,de]},zt.prototype.toGeoJSON=Xe.prototype.toGeoJSON;var ut=S.bA,ft=We;function Nt(ge){var j=new ut;return function(H,ee){for(var de in H.layers)ee.writeMessage(3,Gt,H.layers[de])}(ge,j),j.finish()}function Gt(ge,j){var H;j.writeVarintField(15,ge.version||1),j.writeStringField(1,ge.name||""),j.writeVarintField(5,ge.extent||4096);var ee={keys:[],values:[],keycache:{},valuecache:{}};for(H=0;H<ge.length;H++)ee.feature=ge.feature(H),j.writeMessage(2,St,ee);var de=ee.keys;for(H=0;H<de.length;H++)j.writeStringField(3,de[H]);var we=ee.values;for(H=0;H<we.length;H++)j.writeMessage(4,Ei,we[H])}function St(ge,j){var H=ge.feature;H.id!==void 0&&j.writeVarintField(1,H.id),j.writeMessage(2,nr,ge),j.writeVarintField(3,H.type),j.writeMessage(4,Xt,H)}function nr(ge,j){var H=ge.feature,ee=ge.keys,de=ge.values,we=ge.keycache,Se=ge.valuecache;for(var De in H.properties){var _e=H.properties[De],Ne=we[De];if(_e!==null){Ne===void 0&&(ee.push(De),we[De]=Ne=ee.length-1),j.writeVarint(Ne);var Ze=typeof _e;Ze!=="string"&&Ze!=="boolean"&&Ze!=="number"&&(_e=JSON.stringify(_e));var Le=Ze+":"+_e,At=Se[Le];At===void 0&&(de.push(_e),Se[Le]=At=de.length-1),j.writeVarint(At)}}}function mi(ge,j){return(j<<3)+(7&ge)}function ri(ge){return ge<<1^ge>>31}function Xt(ge,j){for(var H=ge.loadGeometry(),ee=ge.type,de=0,we=0,Se=H.length,De=0;De<Se;De++){var _e=H[De],Ne=1;ee===1&&(Ne=_e.length),j.writeVarint(mi(1,Ne));for(var Ze=ee===3?_e.length-1:_e.length,Le=0;Le<Ze;Le++){Le===1&&ee!==1&&j.writeVarint(mi(2,Ze-1));var At=_e[Le].x-de,Rt=_e[Le].y-we;j.writeVarint(ri(At)),j.writeVarint(ri(Rt)),de+=At,we+=Rt}ee===3&&j.writeVarint(mi(7,1))}}function Ei(ge,j){var H=typeof ge;H==="string"?j.writeStringField(1,ge):H==="boolean"?j.writeBooleanField(7,ge):H==="number"&&(ge%1!=0?j.writeDoubleField(3,ge):ge<0?j.writeSVarintField(6,ge):j.writeVarintField(5,ge))}Bt.exports=Nt,Bt.exports.fromVectorTileJs=Nt,Bt.exports.fromGeojsonVt=function(ge,j){j=j||{};var H={};for(var ee in ge)H[ee]=new ft(ge[ee].features,j),H[ee].name=ee,H[ee].version=j.version,H[ee].extent=j.extent;return Nt({layers:H})},Bt.exports.GeoJSONWrapper=ft;var ni=S.by(Bt.exports);const Oi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ge=>ge},Yi=Math.fround||(Si=new Float32Array(1),ge=>(Si[0]=+ge,Si[0]));var Si;const Qi=3,$i=5,ur=6;class qi{constructor(j){this.options=Object.assign(Object.create(Oi),j),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(j){const{log:H,minZoom:ee,maxZoom:de}=this.options;H&&console.time("total time");const we=`prepare ${j.length} points`;H&&console.time(we),this.points=j;const Se=[];for(let _e=0;_e<j.length;_e++){const Ne=j[_e];if(!Ne.geometry)continue;const[Ze,Le]=Ne.geometry.coordinates,At=Yi(Vi(Ze)),Rt=Yi(yi(Le));Se.push(At,Rt,1/0,_e,-1,1),this.options.reduce&&Se.push(0)}let De=this.trees[de+1]=this._createTree(Se);H&&console.timeEnd(we);for(let _e=de;_e>=ee;_e--){const Ne=+Date.now();De=this.trees[_e]=this._createTree(this._cluster(De,_e)),H&&console.log("z%d: %d clusters in %dms",_e,De.numItems,+Date.now()-Ne)}return H&&console.timeEnd("total time"),this}getClusters(j,H){let ee=((j[0]+180)%360+360)%360-180;const de=Math.max(-90,Math.min(90,j[1]));let we=j[2]===180?180:((j[2]+180)%360+360)%360-180;const Se=Math.max(-90,Math.min(90,j[3]));if(j[2]-j[0]>=360)ee=-180,we=180;else if(ee>we){const Le=this.getClusters([ee,de,180,Se],H),At=this.getClusters([-180,de,we,Se],H);return Le.concat(At)}const De=this.trees[this._limitZoom(H)],_e=De.range(Vi(ee),yi(Se),Vi(we),yi(de)),Ne=De.data,Ze=[];for(const Le of _e){const At=this.stride*Le;Ze.push(Ne[At+$i]>1?vi(Ne,At,this.clusterProps):this.points[Ne[At+Qi]])}return Ze}getChildren(j){const H=this._getOriginId(j),ee=this._getOriginZoom(j),de="No cluster with the specified id.",we=this.trees[ee];if(!we)throw new Error(de);const Se=we.data;if(H*this.stride>=Se.length)throw new Error(de);const De=this.options.radius/(this.options.extent*Math.pow(2,ee-1)),_e=we.within(Se[H*this.stride],Se[H*this.stride+1],De),Ne=[];for(const Ze of _e){const Le=Ze*this.stride;Se[Le+4]===j&&Ne.push(Se[Le+$i]>1?vi(Se,Le,this.clusterProps):this.points[Se[Le+Qi]])}if(Ne.length===0)throw new Error(de);return Ne}getLeaves(j,H,ee){const de=[];return this._appendLeaves(de,j,H=H||10,ee=ee||0,0),de}getTile(j,H,ee){const de=this.trees[this._limitZoom(j)],we=Math.pow(2,j),{extent:Se,radius:De}=this.options,_e=De/Se,Ne=(ee-_e)/we,Ze=(ee+1+_e)/we,Le={features:[]};return this._addTileFeatures(de.range((H-_e)/we,Ne,(H+1+_e)/we,Ze),de.data,H,ee,we,Le),H===0&&this._addTileFeatures(de.range(1-_e/we,Ne,1,Ze),de.data,we,ee,we,Le),H===we-1&&this._addTileFeatures(de.range(0,Ne,_e/we,Ze),de.data,-1,ee,we,Le),Le.features.length?Le:null}getClusterExpansionZoom(j){let H=this._getOriginZoom(j)-1;for(;H<=this.options.maxZoom;){const ee=this.getChildren(j);if(H++,ee.length!==1)break;j=ee[0].properties.cluster_id}return H}_appendLeaves(j,H,ee,de,we){const Se=this.getChildren(H);for(const De of Se){const _e=De.properties;if(_e&&_e.cluster?we+_e.point_count<=de?we+=_e.point_count:we=this._appendLeaves(j,_e.cluster_id,ee,de,we):we<de?we++:j.push(De),j.length===ee)break}return we}_createTree(j){const H=new S.av(j.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ee=0;ee<j.length;ee+=this.stride)H.add(j[ee],j[ee+1]);return H.finish(),H.data=j,H}_addTileFeatures(j,H,ee,de,we,Se){for(const De of j){const _e=De*this.stride,Ne=H[_e+$i]>1;let Ze,Le,At;if(Ne)Ze=Wi(H,_e,this.clusterProps),Le=H[_e],At=H[_e+1];else{const ui=this.points[H[_e+Qi]];Ze=ui.properties;const[Zt,fi]=ui.geometry.coordinates;Le=Vi(Zt),At=yi(fi)}const Rt={type:1,geometry:[[Math.round(this.options.extent*(Le*we-ee)),Math.round(this.options.extent*(At*we-de))]],tags:Ze};let Ot;Ot=Ne||this.options.generateId?H[_e+Qi]:this.points[H[_e+Qi]].id,Ot!==void 0&&(Rt.id=Ot),Se.features.push(Rt)}}_limitZoom(j){return Math.max(this.options.minZoom,Math.min(Math.floor(+j),this.options.maxZoom+1))}_cluster(j,H){const{radius:ee,extent:de,reduce:we,minPoints:Se}=this.options,De=ee/(de*Math.pow(2,H)),_e=j.data,Ne=[],Ze=this.stride;for(let Le=0;Le<_e.length;Le+=Ze){if(_e[Le+2]<=H)continue;_e[Le+2]=H;const At=_e[Le],Rt=_e[Le+1],Ot=j.within(_e[Le],_e[Le+1],De),ui=_e[Le+$i];let Zt=ui;for(const fi of Ot){const ai=fi*Ze;_e[ai+2]>H&&(Zt+=_e[ai+$i])}if(Zt>ui&&Zt>=Se){let fi,ai=At*ui,sr=Rt*ui,Ki=-1;const ii=((Le/Ze|0)<<5)+(H+1)+this.points.length;for(const xi of Ot){const Ui=xi*Ze;if(_e[Ui+2]<=H)continue;_e[Ui+2]=H;const ar=_e[Ui+$i];ai+=_e[Ui]*ar,sr+=_e[Ui+1]*ar,_e[Ui+4]=ii,we&&(fi||(fi=this._map(_e,Le,!0),Ki=this.clusterProps.length,this.clusterProps.push(fi)),we(fi,this._map(_e,Ui)))}_e[Le+4]=ii,Ne.push(ai/Zt,sr/Zt,1/0,ii,-1,Zt),we&&Ne.push(Ki)}else{for(let fi=0;fi<Ze;fi++)Ne.push(_e[Le+fi]);if(Zt>1)for(const fi of Ot){const ai=fi*Ze;if(!(_e[ai+2]<=H)){_e[ai+2]=H;for(let sr=0;sr<Ze;sr++)Ne.push(_e[ai+sr])}}}}return Ne}_getOriginId(j){return j-this.points.length>>5}_getOriginZoom(j){return(j-this.points.length)%32}_map(j,H,ee){if(j[H+$i]>1){const Se=this.clusterProps[j[H+ur]];return ee?Object.assign({},Se):Se}const de=this.points[j[H+Qi]].properties,we=this.options.map(de);return ee&&we===de?Object.assign({},we):we}}function vi(ge,j,H){return{type:"Feature",id:ge[j+Qi],properties:Wi(ge,j,H),geometry:{type:"Point",coordinates:[(ee=ge[j],360*(ee-.5)),pi(ge[j+1])]}};var ee}function Wi(ge,j,H){const ee=ge[j+$i],de=ee>=1e4?`${Math.round(ee/1e3)}k`:ee>=1e3?Math.round(ee/100)/10+"k":ee,we=ge[j+ur],Se=we===-1?{}:Object.assign({},H[we]);return Object.assign(Se,{cluster:!0,cluster_id:ge[j+Qi],point_count:ee,point_count_abbreviated:de})}function Vi(ge){return ge/360+.5}function yi(ge){const j=Math.sin(ge*Math.PI/180),H=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return H<0?0:H>1?1:H}function pi(ge){const j=(180-360*ge)*Math.PI/180;return 360*Math.atan(Math.exp(j))/Math.PI-90}function yr(ge,j,H,ee){let de=ee;const we=j+(H-j>>1);let Se,De=H-j;const _e=ge[j],Ne=ge[j+1],Ze=ge[H],Le=ge[H+1];for(let At=j+3;At<H;At+=3){const Rt=_r(ge[At],ge[At+1],_e,Ne,Ze,Le);if(Rt>de)Se=At,de=Rt;else if(Rt===de){const Ot=Math.abs(At-we);Ot<De&&(Se=At,De=Ot)}}de>ee&&(Se-j>3&&yr(ge,j,Se,ee),ge[Se+2]=de,H-Se>3&&yr(ge,Se,H,ee))}function _r(ge,j,H,ee,de,we){let Se=de-H,De=we-ee;if(Se!==0||De!==0){const _e=((ge-H)*Se+(j-ee)*De)/(Se*Se+De*De);_e>1?(H=de,ee=we):_e>0&&(H+=Se*_e,ee+=De*_e)}return Se=ge-H,De=j-ee,Se*Se+De*De}function Gi(ge,j,H,ee){const de={id:ge??null,type:j,geometry:H,tags:ee,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(j==="Point"||j==="MultiPoint"||j==="LineString")Kt(de,H);else if(j==="Polygon")Kt(de,H[0]);else if(j==="MultiLineString")for(const we of H)Kt(de,we);else if(j==="MultiPolygon")for(const we of H)Kt(de,we[0]);return de}function Kt(ge,j){for(let H=0;H<j.length;H+=3)ge.minX=Math.min(ge.minX,j[H]),ge.minY=Math.min(ge.minY,j[H+1]),ge.maxX=Math.max(ge.maxX,j[H]),ge.maxY=Math.max(ge.maxY,j[H+1])}function hi(ge,j,H,ee){if(!j.geometry)return;const de=j.geometry.coordinates;if(de&&de.length===0)return;const we=j.geometry.type,Se=Math.pow(H.tolerance/((1<<H.maxZoom)*H.extent),2);let De=[],_e=j.id;if(H.promoteId?_e=j.properties[H.promoteId]:H.generateId&&(_e=ee||0),we==="Point")si(de,De);else if(we==="MultiPoint")for(const Ne of de)si(Ne,De);else if(we==="LineString")Re(de,De,Se,!1);else if(we==="MultiLineString"){if(H.lineMetrics){for(const Ne of de)De=[],Re(Ne,De,Se,!1),ge.push(Gi(_e,"LineString",De,j.properties));return}Ri(de,De,Se,!1)}else if(we==="Polygon")Ri(de,De,Se,!0);else{if(we!=="MultiPolygon"){if(we==="GeometryCollection"){for(const Ne of j.geometry.geometries)hi(ge,{id:_e,geometry:Ne,properties:j.properties},H,ee);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ne of de){const Ze=[];Ri(Ne,Ze,Se,!0),De.push(Ze)}}ge.push(Gi(_e,we,De,j.properties))}function si(ge,j){j.push(Mr(ge[0]),Wt(ge[1]),0)}function Re(ge,j,H,ee){let de,we,Se=0;for(let _e=0;_e<ge.length;_e++){const Ne=Mr(ge[_e][0]),Ze=Wt(ge[_e][1]);j.push(Ne,Ze,0),_e>0&&(Se+=ee?(de*Ze-Ne*we)/2:Math.sqrt(Math.pow(Ne-de,2)+Math.pow(Ze-we,2))),de=Ne,we=Ze}const De=j.length-3;j[2]=1,yr(j,0,De,H),j[De+2]=1,j.size=Math.abs(Se),j.start=0,j.end=j.size}function Ri(ge,j,H,ee){for(let de=0;de<ge.length;de++){const we=[];Re(ge[de],we,H,ee),j.push(we)}}function Mr(ge){return ge/360+.5}function Wt(ge){const j=Math.sin(ge*Math.PI/180),H=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return H<0?0:H>1?1:H}function Ii(ge,j,H,ee,de,we,Se,De){if(ee/=j,we>=(H/=j)&&Se<ee)return ge;if(Se<H||we>=ee)return null;const _e=[];for(const Ne of ge){const Ze=Ne.geometry;let Le=Ne.type;const At=de===0?Ne.minX:Ne.minY,Rt=de===0?Ne.maxX:Ne.maxY;if(At>=H&&Rt<ee){_e.push(Ne);continue}if(Rt<H||At>=ee)continue;let Ot=[];if(Le==="Point"||Le==="MultiPoint")Un(Ze,Ot,H,ee,de);else if(Le==="LineString")Ir(Ze,Ot,H,ee,de,!1,De.lineMetrics);else if(Le==="MultiLineString")ra(Ze,Ot,H,ee,de,!1);else if(Le==="Polygon")ra(Ze,Ot,H,ee,de,!0);else if(Le==="MultiPolygon")for(const ui of Ze){const Zt=[];ra(ui,Zt,H,ee,de,!0),Zt.length&&Ot.push(Zt)}if(Ot.length){if(De.lineMetrics&&Le==="LineString"){for(const ui of Ot)_e.push(Gi(Ne.id,Le,ui,Ne.tags));continue}Le!=="LineString"&&Le!=="MultiLineString"||(Ot.length===1?(Le="LineString",Ot=Ot[0]):Le="MultiLineString"),Le!=="Point"&&Le!=="MultiPoint"||(Le=Ot.length===3?"Point":"MultiPoint"),_e.push(Gi(Ne.id,Le,Ot,Ne.tags))}}return _e.length?_e:null}function Un(ge,j,H,ee,de){for(let we=0;we<ge.length;we+=3){const Se=ge[we+de];Se>=H&&Se<=ee&&rn(j,ge[we],ge[we+1],ge[we+2])}}function Ir(ge,j,H,ee,de,we,Se){let De=qr(ge);const _e=de===0?Ss:na;let Ne,Ze,Le=ge.start;for(let Zt=0;Zt<ge.length-3;Zt+=3){const fi=ge[Zt],ai=ge[Zt+1],sr=ge[Zt+2],Ki=ge[Zt+3],ii=ge[Zt+4],xi=de===0?fi:ai,Ui=de===0?Ki:ii;let ar=!1;Se&&(Ne=Math.sqrt(Math.pow(fi-Ki,2)+Math.pow(ai-ii,2))),xi<H?Ui>H&&(Ze=_e(De,fi,ai,Ki,ii,H),Se&&(De.start=Le+Ne*Ze)):xi>ee?Ui<ee&&(Ze=_e(De,fi,ai,Ki,ii,ee),Se&&(De.start=Le+Ne*Ze)):rn(De,fi,ai,sr),Ui<H&&xi>=H&&(Ze=_e(De,fi,ai,Ki,ii,H),ar=!0),Ui>ee&&xi<=ee&&(Ze=_e(De,fi,ai,Ki,ii,ee),ar=!0),!we&&ar&&(Se&&(De.end=Le+Ne*Ze),j.push(De),De=qr(ge)),Se&&(Le+=Ne)}let At=ge.length-3;const Rt=ge[At],Ot=ge[At+1],ui=de===0?Rt:Ot;ui>=H&&ui<=ee&&rn(De,Rt,Ot,ge[At+2]),At=De.length-3,we&&At>=3&&(De[At]!==De[0]||De[At+1]!==De[1])&&rn(De,De[0],De[1],De[2]),De.length&&j.push(De)}function qr(ge){const j=[];return j.size=ge.size,j.start=ge.start,j.end=ge.end,j}function ra(ge,j,H,ee,de,we){for(const Se of ge)Ir(Se,j,H,ee,de,we,!1)}function rn(ge,j,H,ee){ge.push(j,H,ee)}function Ss(ge,j,H,ee,de,we){const Se=(we-j)/(ee-j);return rn(ge,we,H+(de-H)*Se,1),Se}function na(ge,j,H,ee,de,we){const Se=(we-H)/(de-H);return rn(ge,j+(ee-j)*Se,we,1),Se}function lt(ge,j){const H=[];for(let ee=0;ee<ge.length;ee++){const de=ge[ee],we=de.type;let Se;if(we==="Point"||we==="MultiPoint"||we==="LineString")Se=En(de.geometry,j);else if(we==="MultiLineString"||we==="Polygon"){Se=[];for(const De of de.geometry)Se.push(En(De,j))}else if(we==="MultiPolygon"){Se=[];for(const De of de.geometry){const _e=[];for(const Ne of De)_e.push(En(Ne,j));Se.push(_e)}}H.push(Gi(de.id,we,Se,de.tags))}return H}function En(ge,j){const H=[];H.size=ge.size,ge.start!==void 0&&(H.start=ge.start,H.end=ge.end);for(let ee=0;ee<ge.length;ee+=3)H.push(ge[ee]+j,ge[ee+1],ge[ee+2]);return H}function br(ge,j){if(ge.transformed)return ge;const H=1<<ge.z,ee=ge.x,de=ge.y;for(const we of ge.features){const Se=we.geometry,De=we.type;if(we.geometry=[],De===1)for(let _e=0;_e<Se.length;_e+=2)we.geometry.push(Qn(Se[_e],Se[_e+1],j,H,ee,de));else for(let _e=0;_e<Se.length;_e++){const Ne=[];for(let Ze=0;Ze<Se[_e].length;Ze+=2)Ne.push(Qn(Se[_e][Ze],Se[_e][Ze+1],j,H,ee,de));we.geometry.push(Ne)}}return ge.transformed=!0,ge}function Qn(ge,j,H,ee,de,we){return[Math.round(H*(ge*ee-de)),Math.round(H*(j*ee-we))]}function nn(ge,j,H,ee,de){const we=j===de.maxZoom?0:de.tolerance/((1<<j)*de.extent),Se={features:[],numPoints:0,numSimplified:0,numFeatures:ge.length,source:null,x:H,y:ee,z:j,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const De of ge)at(Se,De,we,de);return Se}function at(ge,j,H,ee){const de=j.geometry,we=j.type,Se=[];if(ge.minX=Math.min(ge.minX,j.minX),ge.minY=Math.min(ge.minY,j.minY),ge.maxX=Math.max(ge.maxX,j.maxX),ge.maxY=Math.max(ge.maxY,j.maxY),we==="Point"||we==="MultiPoint")for(let De=0;De<de.length;De+=3)Se.push(de[De],de[De+1]),ge.numPoints++,ge.numSimplified++;else if(we==="LineString")ei(Se,de,ge,H,!1,!1);else if(we==="MultiLineString"||we==="Polygon")for(let De=0;De<de.length;De++)ei(Se,de[De],ge,H,we==="Polygon",De===0);else if(we==="MultiPolygon")for(let De=0;De<de.length;De++){const _e=de[De];for(let Ne=0;Ne<_e.length;Ne++)ei(Se,_e[Ne],ge,H,!0,Ne===0)}if(Se.length){let De=j.tags||null;if(we==="LineString"&&ee.lineMetrics){De={};for(const Ne in j.tags)De[Ne]=j.tags[Ne];De.mapbox_clip_start=de.start/de.size,De.mapbox_clip_end=de.end/de.size}const _e={geometry:Se,type:we==="Polygon"||we==="MultiPolygon"?3:we==="LineString"||we==="MultiLineString"?2:1,tags:De};j.id!==null&&(_e.id=j.id),ge.features.push(_e)}}function ei(ge,j,H,ee,de,we){const Se=ee*ee;if(ee>0&&j.size<(de?Se:ee))return void(H.numPoints+=j.length/3);const De=[];for(let _e=0;_e<j.length;_e+=3)(ee===0||j[_e+2]>Se)&&(H.numSimplified++,De.push(j[_e],j[_e+1])),H.numPoints++;de&&function(_e,Ne){let Ze=0;for(let Le=0,At=_e.length,Rt=At-2;Le<At;Rt=Le,Le+=2)Ze+=(_e[Le]-_e[Rt])*(_e[Le+1]+_e[Rt+1]);if(Ze>0===Ne)for(let Le=0,At=_e.length;Le<At/2;Le+=2){const Rt=_e[Le],Ot=_e[Le+1];_e[Le]=_e[At-2-Le],_e[Le+1]=_e[At-1-Le],_e[At-2-Le]=Rt,_e[At-1-Le]=Ot}}(De,we),ge.push(De)}const Vt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ht{constructor(j,H){const ee=(H=this.options=function(we,Se){for(const De in Se)we[De]=Se[De];return we}(Object.create(Vt),H)).debug;if(ee&&console.time("preprocess data"),H.maxZoom<0||H.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(H.promoteId&&H.generateId)throw new Error("promoteId and generateId cannot be used together.");let de=function(we,Se){const De=[];if(we.type==="FeatureCollection")for(let _e=0;_e<we.features.length;_e++)hi(De,we.features[_e],Se,_e);else hi(De,we.type==="Feature"?we:{geometry:we},Se);return De}(j,H);this.tiles={},this.tileCoords=[],ee&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",H.indexMaxZoom,H.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),de=function(we,Se){const De=Se.buffer/Se.extent;let _e=we;const Ne=Ii(we,1,-1-De,De,0,-1,2,Se),Ze=Ii(we,1,1-De,2+De,0,-1,2,Se);return(Ne||Ze)&&(_e=Ii(we,1,-De,1+De,0,-1,2,Se)||[],Ne&&(_e=lt(Ne,1).concat(_e)),Ze&&(_e=_e.concat(lt(Ze,-1)))),_e}(de,H),de.length&&this.splitTile(de,0,0,0),ee&&(de.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(j,H,ee,de,we,Se,De){const _e=[j,H,ee,de],Ne=this.options,Ze=Ne.debug;for(;_e.length;){de=_e.pop(),ee=_e.pop(),H=_e.pop(),j=_e.pop();const Le=1<<H,At=sn(H,ee,de);let Rt=this.tiles[At];if(!Rt&&(Ze>1&&console.time("creation"),Rt=this.tiles[At]=nn(j,H,ee,de,Ne),this.tileCoords.push({z:H,x:ee,y:de}),Ze)){Ze>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",H,ee,de,Rt.numFeatures,Rt.numPoints,Rt.numSimplified),console.timeEnd("creation"));const ar=`z${H}`;this.stats[ar]=(this.stats[ar]||0)+1,this.total++}if(Rt.source=j,we==null){if(H===Ne.indexMaxZoom||Rt.numPoints<=Ne.indexMaxPoints)continue}else{if(H===Ne.maxZoom||H===we)continue;if(we!=null){const ar=we-H;if(ee!==Se>>ar||de!==De>>ar)continue}}if(Rt.source=null,j.length===0)continue;Ze>1&&console.time("clipping");const Ot=.5*Ne.buffer/Ne.extent,ui=.5-Ot,Zt=.5+Ot,fi=1+Ot;let ai=null,sr=null,Ki=null,ii=null,xi=Ii(j,Le,ee-Ot,ee+Zt,0,Rt.minX,Rt.maxX,Ne),Ui=Ii(j,Le,ee+ui,ee+fi,0,Rt.minX,Rt.maxX,Ne);j=null,xi&&(ai=Ii(xi,Le,de-Ot,de+Zt,1,Rt.minY,Rt.maxY,Ne),sr=Ii(xi,Le,de+ui,de+fi,1,Rt.minY,Rt.maxY,Ne),xi=null),Ui&&(Ki=Ii(Ui,Le,de-Ot,de+Zt,1,Rt.minY,Rt.maxY,Ne),ii=Ii(Ui,Le,de+ui,de+fi,1,Rt.minY,Rt.maxY,Ne),Ui=null),Ze>1&&console.timeEnd("clipping"),_e.push(ai||[],H+1,2*ee,2*de),_e.push(sr||[],H+1,2*ee,2*de+1),_e.push(Ki||[],H+1,2*ee+1,2*de),_e.push(ii||[],H+1,2*ee+1,2*de+1)}}getTile(j,H,ee){j=+j,H=+H,ee=+ee;const de=this.options,{extent:we,debug:Se}=de;if(j<0||j>24)return null;const De=1<<j,_e=sn(j,H=H+De&De-1,ee);if(this.tiles[_e])return br(this.tiles[_e],we);Se>1&&console.log("drilling down to z%d-%d-%d",j,H,ee);let Ne,Ze=j,Le=H,At=ee;for(;!Ne&&Ze>0;)Ze--,Le>>=1,At>>=1,Ne=this.tiles[sn(Ze,Le,At)];return Ne&&Ne.source?(Se>1&&(console.log("found parent tile z%d-%d-%d",Ze,Le,At),console.time("drilling down")),this.splitTile(Ne.source,Ze,Le,At,j,H,ee),Se>1&&console.timeEnd("drilling down"),this.tiles[_e]?br(this.tiles[_e],we):null):null}}function sn(ge,j,H){return 32*((1<<ge)*H+j)+ge}function Yt(ge,j){return j?ge.properties[j]:ge.id}function Sn(ge,j){if(ge==null)return!0;if(ge.type==="Feature")return Yt(ge,j)!=null;if(ge.type==="FeatureCollection"){const H=new Set;for(const ee of ge.features){const de=Yt(ee,j);if(de==null||H.has(de))return!1;H.add(de)}return!0}return!1}function kn(ge,j){const H=new Map;if(ge!=null)if(ge.type==="Feature")H.set(Yt(ge,j),ge);else for(const ee of ge.features)H.set(Yt(ee,j),ee);return H}class Nn extends Qe{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(j,H){return S._(this,void 0,void 0,function*(){const ee=j.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const de=this._geoJSONIndex.getTile(ee.z,ee.x,ee.y);if(!de)return null;const we=new class{constructor(De){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=S.X,this.length=De.length,this._features=De}feature(De){return new class{constructor(_e){this._feature=_e,this.extent=S.X,this.type=_e.type,this.properties=_e.tags,"id"in _e&&!isNaN(_e.id)&&(this.id=parseInt(_e.id,10))}loadGeometry(){if(this._feature.type===1){const _e=[];for(const Ne of this._feature.geometry)_e.push([new S.P(Ne[0],Ne[1])]);return _e}{const _e=[];for(const Ne of this._feature.geometry){const Ze=[];for(const Le of Ne)Ze.push(new S.P(Le[0],Le[1]));_e.push(Ze)}return _e}}toGeoJSON(_e,Ne,Ze){return bt.call(this,_e,Ne,Ze)}}(this._features[De])}}(de.features);let Se=ni(we);return Se.byteOffset===0&&Se.byteLength===Se.buffer.byteLength||(Se=new Uint8Array(Se)),{vectorTile:we,rawData:Se.buffer}})}loadData(j){return S._(this,void 0,void 0,function*(){var H;(H=this._pendingRequest)===null||H===void 0||H.abort();const ee=!!(j&&j.request&&j.request.collectResourceTiming)&&new S.bv(j.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(j,this._pendingRequest),this._geoJSONIndex=j.cluster?new qi(function({superclusterOptions:Se,clusterProperties:De}){if(!De||!Se)return Se;const _e={},Ne={},Ze={accumulated:null,zoom:0},Le={properties:null},At=Object.keys(De);for(const Rt of At){const[Ot,ui]=De[Rt],Zt=S.bC(ui),fi=S.bC(typeof Ot=="string"?[Ot,["accumulated"],["get",Rt]]:Ot);_e[Rt]=Zt.value,Ne[Rt]=fi.value}return Se.map=Rt=>{Le.properties=Rt;const Ot={};for(const ui of At)Ot[ui]=_e[ui].evaluate(Ze,Le);return Ot},Se.reduce=(Rt,Ot)=>{Le.properties=Ot;for(const ui of At)Ze.accumulated=Rt[ui],Rt[ui]=Ne[ui].evaluate(Ze,Le)},Se}(j)).load((yield this._pendingData).features):(de=yield this._pendingData,new Ht(de,j.geojsonVtOptions)),this.loaded={};const we={};if(ee){const Se=ee.finish();Se&&(we.resourceTiming={},we.resourceTiming[j.source]=JSON.parse(JSON.stringify(Se)))}return we}catch(we){if(delete this._pendingRequest,S.bB(we))return{abandoned:!0};throw we}var de})}getData(){return S._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(j){const H=this.loaded;return H&&H[j.uid]?super.reloadTile(j):this.loadTile(j)}loadAndProcessGeoJSON(j,H){return S._(this,void 0,void 0,function*(){let ee=yield this.loadGeoJSON(j,H);if(delete this._pendingRequest,typeof ee!="object")throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`);if(je(ee,!0),j.filter){const de=S.bC(j.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(de.result==="error")throw new Error(de.value.map(Se=>`${Se.key}: ${Se.message}`).join(", "));ee={type:"FeatureCollection",features:ee.features.filter(Se=>de.value.evaluate({zoom:0},Se))}}return ee})}loadGeoJSON(j,H){return S._(this,void 0,void 0,function*(){const{promoteId:ee}=j;if(j.request){const de=yield S.h(j.request,H);return this._dataUpdateable=Sn(de.data,ee)?kn(de.data,ee):void 0,de.data}if(typeof j.data=="string")try{const de=JSON.parse(j.data);return this._dataUpdateable=Sn(de,ee)?kn(de,ee):void 0,de}catch{throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`)}if(!j.dataDiff)throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${j.source}`);return function(de,we,Se){var De,_e,Ne,Ze;if(we.removeAll&&de.clear(),we.remove)for(const Le of we.remove)de.delete(Le);if(we.add)for(const Le of we.add){const At=Yt(Le,Se);At!=null&&de.set(At,Le)}if(we.update)for(const Le of we.update){let At=de.get(Le.id);if(At==null)continue;const Rt=!Le.removeAllProperties&&(((De=Le.removeProperties)===null||De===void 0?void 0:De.length)>0||((_e=Le.addOrUpdateProperties)===null||_e===void 0?void 0:_e.length)>0);if((Le.newGeometry||Le.removeAllProperties||Rt)&&(At=Object.assign({},At),de.set(Le.id,At),Rt&&(At.properties=Object.assign({},At.properties))),Le.newGeometry&&(At.geometry=Le.newGeometry),Le.removeAllProperties)At.properties={};else if(((Ne=Le.removeProperties)===null||Ne===void 0?void 0:Ne.length)>0)for(const Ot of Le.removeProperties)Object.prototype.hasOwnProperty.call(At.properties,Ot)&&delete At.properties[Ot];if(((Ze=Le.addOrUpdateProperties)===null||Ze===void 0?void 0:Ze.length)>0)for(const{key:Ot,value:ui}of Le.addOrUpdateProperties)At.properties[Ot]=ui}}(this._dataUpdateable,j.dataDiff,ee),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(j){return S._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(j){return this._geoJSONIndex.getClusterExpansionZoom(j.clusterId)}getClusterChildren(j){return this._geoJSONIndex.getChildren(j.clusterId)}getClusterLeaves(j){return this._geoJSONIndex.getLeaves(j.clusterId,j.limit,j.offset)}}class fn{constructor(j){this.self=j,this.actor=new S.F(j),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(H,ee)=>{if(this.externalWorkerSourceTypes[H])throw new Error(`Worker source with name "${H}" already registered.`);this.externalWorkerSourceTypes[H]=ee},this.self.addProtocol=S.bi,this.self.removeProtocol=S.bj,this.self.registerRTLTextPlugin=H=>{if(S.bD.isParsed())throw new Error("RTL text plugin already registered.");S.bD.setMethods(H)},this.actor.registerMessageHandler("LDT",(H,ee)=>this._getDEMWorkerSource(H,ee.source).loadTile(ee)),this.actor.registerMessageHandler("RDT",(H,ee)=>S._(this,void 0,void 0,function*(){this._getDEMWorkerSource(H,ee.source).removeTile(ee)})),this.actor.registerMessageHandler("GCEZ",(H,ee)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(H,ee.type,ee.source).getClusterExpansionZoom(ee)})),this.actor.registerMessageHandler("GCC",(H,ee)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(H,ee.type,ee.source).getClusterChildren(ee)})),this.actor.registerMessageHandler("GCL",(H,ee)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(H,ee.type,ee.source).getClusterLeaves(ee)})),this.actor.registerMessageHandler("LD",(H,ee)=>this._getWorkerSource(H,ee.type,ee.source).loadData(ee)),this.actor.registerMessageHandler("GD",(H,ee)=>this._getWorkerSource(H,ee.type,ee.source).getData()),this.actor.registerMessageHandler("LT",(H,ee)=>this._getWorkerSource(H,ee.type,ee.source).loadTile(ee)),this.actor.registerMessageHandler("RT",(H,ee)=>this._getWorkerSource(H,ee.type,ee.source).reloadTile(ee)),this.actor.registerMessageHandler("AT",(H,ee)=>this._getWorkerSource(H,ee.type,ee.source).abortTile(ee)),this.actor.registerMessageHandler("RMT",(H,ee)=>this._getWorkerSource(H,ee.type,ee.source).removeTile(ee)),this.actor.registerMessageHandler("RS",(H,ee)=>S._(this,void 0,void 0,function*(){if(!this.workerSources[H]||!this.workerSources[H][ee.type]||!this.workerSources[H][ee.type][ee.source])return;const de=this.workerSources[H][ee.type][ee.source];delete this.workerSources[H][ee.type][ee.source],de.removeSource!==void 0&&de.removeSource(ee)})),this.actor.registerMessageHandler("RM",H=>S._(this,void 0,void 0,function*(){delete this.layerIndexes[H],delete this.availableImages[H],delete this.workerSources[H],delete this.demWorkerSources[H]})),this.actor.registerMessageHandler("SR",(H,ee)=>S._(this,void 0,void 0,function*(){this.referrer=ee})),this.actor.registerMessageHandler("SRPS",(H,ee)=>this._syncRTLPluginState(H,ee)),this.actor.registerMessageHandler("IS",(H,ee)=>S._(this,void 0,void 0,function*(){this.self.importScripts(ee)})),this.actor.registerMessageHandler("SI",(H,ee)=>this._setImages(H,ee)),this.actor.registerMessageHandler("UL",(H,ee)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(H).update(ee.layers,ee.removedIds)})),this.actor.registerMessageHandler("SL",(H,ee)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(H).replace(ee)}))}_setImages(j,H){return S._(this,void 0,void 0,function*(){this.availableImages[j]=H;for(const ee in this.workerSources[j]){const de=this.workerSources[j][ee];for(const we in de)de[we].availableImages=H}})}_syncRTLPluginState(j,H){return S._(this,void 0,void 0,function*(){if(S.bD.isParsed())return S.bD.getState();if(H.pluginStatus!=="loading")return S.bD.setState(H),H;const ee=H.pluginURL;if(this.self.importScripts(ee),S.bD.isParsed()){const de={pluginStatus:"loaded",pluginURL:ee};return S.bD.setState(de),de}throw S.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${ee}`)})}_getAvailableImages(j){let H=this.availableImages[j];return H||(H=[]),H}_getLayerIndex(j){let H=this.layerIndexes[j];return H||(H=this.layerIndexes[j]=new c),H}_getWorkerSource(j,H,ee){if(this.workerSources[j]||(this.workerSources[j]={}),this.workerSources[j][H]||(this.workerSources[j][H]={}),!this.workerSources[j][H][ee]){const de={sendAsync:(we,Se)=>(we.targetMapId=j,this.actor.sendAsync(we,Se))};switch(H){case"vector":this.workerSources[j][H][ee]=new Qe(de,this._getLayerIndex(j),this._getAvailableImages(j));break;case"geojson":this.workerSources[j][H][ee]=new Nn(de,this._getLayerIndex(j),this._getAvailableImages(j));break;default:this.workerSources[j][H][ee]=new this.externalWorkerSourceTypes[H](de,this._getLayerIndex(j),this._getAvailableImages(j))}}return this.workerSources[j][H][ee]}_getDEMWorkerSource(j,H){return this.demWorkerSources[j]||(this.demWorkerSources[j]={}),this.demWorkerSources[j][H]||(this.demWorkerSources[j][H]=new me),this.demWorkerSources[j][H]}}return S.i(self)&&(self.worker=new fn(self)),fn}),P("index",["exports","./shared"],function(S,c){var he="4.7.1";let Ee,Fe;const Qe={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:u=>new Promise((e,n)=>{const a=requestAnimationFrame(e);u.signal.addEventListener("abort",()=>{cancelAnimationFrame(a),n(c.c())})}),getImageData(u,e=0){return this.getImageCanvasContext(u).getImageData(-e,-e,u.width+2*e,u.height+2*e)},getImageCanvasContext(u){const e=window.document.createElement("canvas"),n=e.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return e.width=u.width,e.height=u.height,n.drawImage(u,0,0,u.width,u.height),n},resolveURL:u=>(Ee||(Ee=document.createElement("a")),Ee.href=u,Ee.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Fe==null&&(Fe=matchMedia("(prefers-reduced-motion: reduce)")),Fe.matches)}};class me{static testProp(e){if(!me.docStyle)return e[0];for(let n=0;n<e.length;n++)if(e[n]in me.docStyle)return e[n];return e[0]}static create(e,n,a){const o=window.document.createElement(e);return n!==void 0&&(o.className=n),a&&a.appendChild(o),o}static createNS(e,n){return window.document.createElementNS(e,n)}static disableDrag(){me.docStyle&&me.selectProp&&(me.userSelect=me.docStyle[me.selectProp],me.docStyle[me.selectProp]="none")}static enableDrag(){me.docStyle&&me.selectProp&&(me.docStyle[me.selectProp]=me.userSelect)}static setTransform(e,n){e.style[me.transformProp]=n}static addEventListener(e,n,a,o={}){e.addEventListener(n,a,"passive"in o?o:o.capture)}static removeEventListener(e,n,a,o={}){e.removeEventListener(n,a,"passive"in o?o:o.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",me.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",me.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",me.suppressClickInternal,!0)},0)}static getScale(e){const n=e.getBoundingClientRect();return{x:n.width/e.offsetWidth||1,y:n.height/e.offsetHeight||1,boundingClientRect:n}}static getPoint(e,n,a){const o=n.boundingClientRect;return new c.P((a.clientX-o.left)/n.x-e.clientLeft,(a.clientY-o.top)/n.y-e.clientTop)}static mousePos(e,n){const a=me.getScale(e);return me.getPoint(e,a,n)}static touchPos(e,n){const a=[],o=me.getScale(e);for(let h=0;h<n.length;h++)a.push(me.getPoint(e,o,n[h]));return a}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}me.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,me.selectProp=me.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),me.transformProp=me.testProp(["transform","WebkitTransform"]);const $e={supported:!1,testSupport:function(u){!bt&&je&&(Bt?ht(u):rt=u)}};let rt,je,bt=!1,Bt=!1;function ht(u){const e=u.createTexture();u.bindTexture(u.TEXTURE_2D,e);try{if(u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,je),u.isContextLost())return;$e.supported=!0}catch{}u.deleteTexture(e),bt=!0}var Xe;typeof document<"u"&&(je=document.createElement("img"),je.onload=()=>{rt&&ht(rt),rt=null,Bt=!0},je.onerror=()=>{bt=!0,rt=null},je.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(u){let e,n,a,o;u.resetRequestQueue=()=>{e=[],n=0,a=0,o={}},u.addThrottleControl=B=>{const M=a++;return o[M]=B,M},u.removeThrottleControl=B=>{delete o[B],_()},u.getImage=(B,M,L=!0)=>new Promise((F,$)=>{$e.supported&&(B.headers||(B.headers={}),B.headers.accept="image/webp,*/*"),c.e(B,{type:"image"}),e.push({abortController:M,requestParameters:B,supportImageRefresh:L,state:"queued",onError:te=>{$(te)},onSuccess:te=>{F(te)}}),_()});const h=B=>c._(this,void 0,void 0,function*(){B.state="running";const{requestParameters:M,supportImageRefresh:L,onError:F,onSuccess:$,abortController:te}=B,oe=L===!1&&!c.i(self)&&!c.g(M.url)&&(!M.headers||Object.keys(M.headers).reduce((A,v)=>A&&v==="accept",!0));n++;const p=oe?w(M,te):c.m(M,te);try{const A=yield p;delete B.abortController,B.state="completed",A.data instanceof HTMLImageElement||c.b(A.data)?$(A):A.data&&$({data:yield(g=A.data,typeof createImageBitmap=="function"?c.d(g):c.f(g)),cacheControl:A.cacheControl,expires:A.expires})}catch(A){delete B.abortController,F(A)}finally{n--,_()}var g}),_=()=>{const B=(()=>{for(const M of Object.keys(o))if(o[M]())return!0;return!1})()?c.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let M=n;M<B&&e.length>0;M++){const L=e.shift();L.abortController.signal.aborted?M--:h(L)}},w=(B,M)=>new Promise((L,F)=>{const $=new Image,te=B.url,oe=B.credentials;oe&&oe==="include"?$.crossOrigin="use-credentials":(oe&&oe==="same-origin"||!c.s(te))&&($.crossOrigin="anonymous"),M.signal.addEventListener("abort",()=>{$.src="",F(c.c())}),$.fetchPriority="high",$.onload=()=>{$.onerror=$.onload=null,L({data:$})},$.onerror=()=>{$.onerror=$.onload=null,M.signal.aborted||F(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},$.src=te})}(Xe||(Xe={})),Xe.resetRequestQueue();class We{constructor(e){this._transformRequestFn=e}transformRequest(e,n){return this._transformRequestFn&&this._transformRequestFn(e,n)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function dt(u){var e=new c.A(3);return e[0]=u[0],e[1]=u[1],e[2]=u[2],e}var zt,ut=function(u,e,n){return u[0]=e[0]-n[0],u[1]=e[1]-n[1],u[2]=e[2]-n[2],u};zt=new c.A(3),c.A!=Float32Array&&(zt[0]=0,zt[1]=0,zt[2]=0);var ft=function(u){var e=u[0],n=u[1];return e*e+n*n};function Nt(u){const e=[];if(typeof u=="string")e.push({id:"default",url:u});else if(u&&u.length>0){const n=[];for(const{id:a,url:o}of u){const h=`${a}${o}`;n.indexOf(h)===-1&&(n.push(h),e.push({id:a,url:o}))}}return e}function Gt(u,e,n){const a=u.split("?");return a[0]+=`${e}${n}`,a.join("?")}(function(){var u=new c.A(2);c.A!=Float32Array&&(u[0]=0,u[1]=0)})();class St{constructor(e,n,a,o){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(n,o)}update(e,n,a){const{width:o,height:h}=e,_=!(this.size&&this.size[0]===o&&this.size[1]===h||a),{context:w}=this,{gl:B}=w;if(this.useMipmap=!!(n&&n.useMipmap),B.bindTexture(B.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===B.RGBA&&(!n||n.premultiply!==!1)),_)this.size=[o,h],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?B.texImage2D(B.TEXTURE_2D,0,this.format,this.format,B.UNSIGNED_BYTE,e):B.texImage2D(B.TEXTURE_2D,0,this.format,o,h,0,this.format,B.UNSIGNED_BYTE,e.data);else{const{x:M,y:L}=a||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?B.texSubImage2D(B.TEXTURE_2D,0,M,L,B.RGBA,B.UNSIGNED_BYTE,e):B.texSubImage2D(B.TEXTURE_2D,0,M,L,o,h,B.RGBA,B.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&B.generateMipmap(B.TEXTURE_2D)}bind(e,n,a){const{context:o}=this,{gl:h}=o;h.bindTexture(h.TEXTURE_2D,this.texture),a!==h.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=h.LINEAR),e!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,a||e),this.filter=e),n!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function nr(u){const{userImage:e}=u;return!!(e&&e.render&&e.render())&&(u.data.replace(new Uint8Array(e.data.buffer)),!0)}class mi extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:n,promiseResolve:a}of this.requestors)a(this._getImagesForIds(n));this.requestors=[]}}getImage(e){const n=this.images[e];if(n&&!n.data&&n.spriteData){const a=n.spriteData;n.data=new c.R({width:a.width,height:a.height},a.context.getImageData(a.x,a.y,a.width,a.height).data),n.spriteData=null}return n}addImage(e,n){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,n)&&(this.images[e]=n)}_validate(e,n){let a=!0;const o=n.data||n.spriteData;return this._validateStretch(n.stretchX,o&&o.width)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "stretchX" value`))),a=!1),this._validateStretch(n.stretchY,o&&o.height)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "stretchY" value`))),a=!1),this._validateContent(n.content,n)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "content" value`))),a=!1),a}_validateStretch(e,n){if(!e)return!0;let a=0;for(const o of e){if(o[0]<a||o[1]<o[0]||n<o[1])return!1;a=o[1]}return!0}_validateContent(e,n){if(!e)return!0;if(e.length!==4)return!1;const a=n.spriteData,o=a&&a.width||n.data.width,h=a&&a.height||n.data.height;return!(e[0]<0||o<e[0]||e[1]<0||h<e[1]||e[2]<0||o<e[2]||e[3]<0||h<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,n,a=!0){const o=this.getImage(e);if(a&&(o.data.width!==n.data.width||o.data.height!==n.data.height))throw new Error(`size mismatch between old image (${o.data.width}x${o.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=o.version+1,this.images[e]=n,this.updatedImages[e]=!0}removeImage(e){const n=this.images[e];delete this.images[e],delete this.patterns[e],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((n,a)=>{let o=!0;if(!this.isLoaded())for(const h of e)this.images[h]||(o=!1);this.isLoaded()||o?n(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:n})})}_getImagesForIds(e){const n={};for(const a of e){let o=this.getImage(a);o||(this.fire(new c.k("styleimagemissing",{id:a})),o=this.getImage(a)),o?n[a]={data:o.data.clone(),pixelRatio:o.pixelRatio,sdf:o.sdf,version:o.version,stretchX:o.stretchX,stretchY:o.stretchY,content:o.content,textFitWidth:o.textFitWidth,textFitHeight:o.textFitHeight,hasRenderCallback:!!(o.userImage&&o.userImage.render)}:c.w(`Image "${a}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return n}getPixelSize(){const{width:e,height:n}=this.atlasImage;return{width:e,height:n}}getPattern(e){const n=this.patterns[e],a=this.getImage(e);if(!a)return null;if(n&&n.position.version===a.version)return n.position;if(n)n.position.version=a.version;else{const o={w:a.data.width+2,h:a.data.height+2,x:0,y:0},h=new c.I(o,a);this.patterns[e]={bin:o,position:h}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const n=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new St(e,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const h in this.patterns)e.push(this.patterns[h].bin);const{w:n,h:a}=c.p(e),o=this.atlasImage;o.resize({width:n||1,height:a||1});for(const h in this.patterns){const{bin:_}=this.patterns[h],w=_.x+1,B=_.y+1,M=this.getImage(h).data,L=M.width,F=M.height;c.R.copy(M,o,{x:0,y:0},{x:w,y:B},{width:L,height:F}),c.R.copy(M,o,{x:0,y:F-1},{x:w,y:B-1},{width:L,height:1}),c.R.copy(M,o,{x:0,y:0},{x:w,y:B+F},{width:L,height:1}),c.R.copy(M,o,{x:L-1,y:0},{x:w-1,y:B},{width:1,height:F}),c.R.copy(M,o,{x:0,y:0},{x:w+L,y:B},{width:1,height:F})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const n of e){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const a=this.getImage(n);a||c.w(`Image with ID: "${n}" was not found`),nr(a)&&this.updateImage(n,a)}}}const ri=1e20;function Xt(u,e,n,a,o,h,_,w,B){for(let M=e;M<e+a;M++)Ei(u,n*h+M,h,o,_,w,B);for(let M=n;M<n+o;M++)Ei(u,M*h+e,1,a,_,w,B)}function Ei(u,e,n,a,o,h,_){h[0]=0,_[0]=-ri,_[1]=ri,o[0]=u[e];for(let w=1,B=0,M=0;w<a;w++){o[w]=u[e+w*n];const L=w*w;do{const F=h[B];M=(o[w]-o[F]+L-F*F)/(w-F)/2}while(M<=_[B]&&--B>-1);B++,h[B]=w,_[B]=M,_[B+1]=ri}for(let w=0,B=0;w<a;w++){for(;_[B+1]<w;)B++;const M=h[B],L=w-M;u[e+w*n]=o[M]+L*L}}class ni{constructor(e,n){this.requestManager=e,this.localIdeographFontFamily=n,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return c._(this,void 0,void 0,function*(){const n=[];for(const h in e)for(const _ of e[h])n.push(this._getAndCacheGlyphsPromise(h,_));const a=yield Promise.all(n),o={};for(const{stack:h,id:_,glyph:w}of a)o[h]||(o[h]={}),o[h][_]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics};return o})}_getAndCacheGlyphsPromise(e,n){return c._(this,void 0,void 0,function*(){let a=this.entries[e];a||(a=this.entries[e]={glyphs:{},requests:{},ranges:{}});let o=a.glyphs[n];if(o!==void 0)return{stack:e,id:n,glyph:o};if(o=this._tinySDF(a,e,n),o)return a.glyphs[n]=o,{stack:e,id:n,glyph:o};const h=Math.floor(n/256);if(256*h>65535)throw new Error("glyphs > 65535 not supported");if(a.ranges[h])return{stack:e,id:n,glyph:o};if(!this.url)throw new Error("glyphsUrl is not set");if(!a.requests[h]){const w=ni.loadGlyphRange(e,h,this.url,this.requestManager);a.requests[h]=w}const _=yield a.requests[h];for(const w in _)this._doesCharSupportLocalGlyph(+w)||(a.glyphs[+w]=_[+w]);return a.ranges[h]=!0,{stack:e,id:n,glyph:_[n]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,n,a){const o=this.localIdeographFontFamily;if(!o||!this._doesCharSupportLocalGlyph(a))return;let h=e.tinySDF;if(!h){let w="400";/bold/i.test(n)?w="900":/medium/i.test(n)?w="500":/light/i.test(n)&&(w="200"),h=e.tinySDF=new ni.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:o,fontWeight:w})}const _=h.draw(String.fromCharCode(a));return{id:a,bitmap:new c.o({width:_.width||60,height:_.height||60},_.data),metrics:{width:_.glyphWidth/2||24,height:_.glyphHeight/2||24,left:_.glyphLeft/2+.5||0,top:_.glyphTop/2-27.5||-8,advance:_.glyphAdvance/2||24,isDoubleResolution:!0}}}}ni.loadGlyphRange=function(u,e,n,a){return c._(this,void 0,void 0,function*(){const o=256*e,h=o+255,_=a.transformRequest(n.replace("{fontstack}",u).replace("{range}",`${o}-${h}`),"Glyphs"),w=yield c.l(_,new AbortController);if(!w||!w.data)throw new Error(`Could not load glyph range. range: ${e}, ${o}-${h}`);const B={};for(const M of c.n(w.data))B[M.id]=M;return B})},ni.TinySDF=class{constructor({fontSize:u=24,buffer:e=3,radius:n=8,cutoff:a=.25,fontFamily:o="sans-serif",fontWeight:h="normal",fontStyle:_="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=n;const w=this.size=u+4*e,B=this._createCanvas(w),M=this.ctx=B.getContext("2d",{willReadFrequently:!0});M.font=`${_} ${h} ${u}px ${o}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(u){const e=document.createElement("canvas");return e.width=e.height=u,e}draw(u){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:a,actualBoundingBoxLeft:o,actualBoundingBoxRight:h}=this.ctx.measureText(u),_=Math.ceil(n),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-o))),B=Math.min(this.size-this.buffer,_+Math.ceil(a)),M=w+2*this.buffer,L=B+2*this.buffer,F=Math.max(M*L,0),$=new Uint8ClampedArray(F),te={data:$,width:M,height:L,glyphWidth:w,glyphHeight:B,glyphTop:_,glyphLeft:0,glyphAdvance:e};if(w===0||B===0)return te;const{ctx:oe,buffer:p,gridInner:g,gridOuter:A}=this;oe.clearRect(p,p,w,B),oe.fillText(u,p,p+_);const v=oe.getImageData(p,p,w,B);A.fill(ri,0,F),g.fill(0,0,F);for(let x=0;x<B;x++)for(let Q=0;Q<w;Q++){const T=v.data[4*(x*w+Q)+3]/255;if(T===0)continue;const k=(x+p)*M+Q+p;if(T===1)A[k]=0,g[k]=ri;else{const q=.5-T;A[k]=q>0?q*q:0,g[k]=q<0?q*q:0}}Xt(A,0,0,M,L,M,this.f,this.v,this.z),Xt(g,p,p,w,B,M,this.f,this.v,this.z);for(let x=0;x<F;x++){const Q=Math.sqrt(A[x])-Math.sqrt(g[x]);$[x]=Math.round(255-255*(Q/this.radius+this.cutoff))}return te}};class Oi{constructor(){this.specification=c.v.light.position}possiblyEvaluate(e,n){return c.x(e.expression.evaluate(n))}interpolate(e,n,a){return{x:c.y.number(e.x,n.x,a),y:c.y.number(e.y,n.y,a),z:c.y.number(e.z,n.z,a)}}}let Yi;class Si extends c.E{constructor(e){super(),Yi=Yi||new c.q({anchor:new c.D(c.v.light.anchor),position:new Oi,color:new c.D(c.v.light.color),intensity:new c.D(c.v.light.intensity)}),this._transitionable=new c.T(Yi),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,n={}){if(!this._validate(c.r,e,n))for(const a in e){const o=e[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),o):this._transitionable.setValue(a,o)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,a){return(!a||a.validate!==!1)&&c.t(this,e.call(c.u,{value:n,style:{glyphs:!0,sprite:!0},styleSpec:c.v}))}}const Qi=new c.q({"sky-color":new c.D(c.v.sky["sky-color"]),"horizon-color":new c.D(c.v.sky["horizon-color"]),"fog-color":new c.D(c.v.sky["fog-color"]),"fog-ground-blend":new c.D(c.v.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.v.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.v.sky["atmosphere-blend"])});class $i extends c.E{constructor(e){super(),this._transitionable=new c.T(Qi),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.z(0))}setSky(e,n={}){if(!this._validate(c.B,e,n)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const a in e){const o=e[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),o):this._transitionable.setValue(a,o)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,a={}){return(a==null?void 0:a.validate)!==!1&&c.t(this,e.call(c.u,c.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:c.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class ur{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,n){const a=e.join(",")+String(n);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(e,n)),this.dashEntry[a]}getDashRanges(e,n,a){const o=[];let h=e.length%2==1?-e[e.length-1]*a:0,_=e[0]*a,w=!0;o.push({left:h,right:_,isDash:w,zeroLength:e[0]===0});let B=e[0];for(let M=1;M<e.length;M++){w=!w;const L=e[M];h=B*a,B+=L,_=B*a,o.push({left:h,right:_,isDash:w,zeroLength:L===0})}return o}addRoundDash(e,n,a){const o=n/2;for(let h=-a;h<=a;h++){const _=this.width*(this.nextRow+a+h);let w=0,B=e[w];for(let M=0;M<this.width;M++){M/B.right>1&&(B=e[++w]);const L=Math.abs(M-B.left),F=Math.abs(M-B.right),$=Math.min(L,F);let te;const oe=h/a*(o+1);if(B.isDash){const p=o-Math.abs(oe);te=Math.sqrt($*$+p*p)}else te=o-Math.sqrt($*$+oe*oe);this.data[_+M]=Math.max(0,Math.min(255,te+128))}}}addRegularDash(e){for(let w=e.length-1;w>=0;--w){const B=e[w],M=e[w+1];B.zeroLength?e.splice(w,1):M&&M.isDash===B.isDash&&(M.left=B.left,e.splice(w,1))}const n=e[0],a=e[e.length-1];n.isDash===a.isDash&&(n.left=a.left-this.width,a.right=n.right+this.width);const o=this.width*this.nextRow;let h=0,_=e[h];for(let w=0;w<this.width;w++){w/_.right>1&&(_=e[++h]);const B=Math.abs(w-_.left),M=Math.abs(w-_.right),L=Math.min(B,M);this.data[o+w]=Math.max(0,Math.min(255,(_.isDash?L:-L)+128))}}addDash(e,n){const a=n?7:0,o=2*a+1;if(this.nextRow+o>this.height)return c.w("LineAtlas out of space"),null;let h=0;for(let w=0;w<e.length;w++)h+=e[w];if(h!==0){const w=this.width/h,B=this.getDashRanges(e,this.width,w);n?this.addRoundDash(B,w,a):this.addRegularDash(B)}const _={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:h};return this.nextRow+=o,this.dirty=!0,_}bind(e){const n=e.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}const qi="maplibre_preloaded_worker_pool";class vi{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<vi.workerCount;)this.workers.push(new Worker(c.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[qi]}numActive(){return Object.keys(this.active).length}}const Wi=Math.floor(Qe.hardwareConcurrency/2);let Vi,yi;function pi(){return Vi||(Vi=new vi),Vi}vi.workerCount=c.C(globalThis)?Math.max(Math.min(Wi,3),1):1;class yr{constructor(e,n){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=n;const a=this.workerPool.acquire(n);for(let o=0;o<a.length;o++){const h=new c.F(a[o],n);h.name=`Worker ${o}`,this.actors.push(h)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,n){const a=[];for(const o of this.actors)a.push(o.sendAsync({type:e,data:n}));return Promise.all(a)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(n=>{n.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,n){for(const a of this.actors)a.registerMessageHandler(e,n)}}function _r(){return yi||(yi=new yr(pi(),c.G),yi.registerMessageHandler("GR",(u,e,n)=>c.m(e,n))),yi}function Gi(u,e){const n=c.H();return c.J(n,n,[1,1,0]),c.K(n,n,[.5*u.width,.5*u.height,1]),c.L(n,n,u.calculatePosMatrix(e.toUnwrapped()))}function Kt(u,e,n,a,o,h){const _=function(F,$,te){if(F)for(const oe of F){const p=$[oe];if(p&&p.source===te&&p.type==="fill-extrusion")return!0}else for(const oe in $){const p=$[oe];if(p.source===te&&p.type==="fill-extrusion")return!0}return!1}(o&&o.layers,e,u.id),w=h.maxPitchScaleFactor(),B=u.tilesIn(a,w,_);B.sort(hi);const M=[];for(const F of B)M.push({wrappedTileID:F.tileID.wrapped().key,queryResults:F.tile.queryRenderedFeatures(e,n,u._state,F.queryGeometry,F.cameraQueryGeometry,F.scale,o,h,w,Gi(u.transform,F.tileID))});const L=function(F){const $={},te={};for(const oe of F){const p=oe.queryResults,g=oe.wrappedTileID,A=te[g]=te[g]||{};for(const v in p){const x=p[v],Q=A[v]=A[v]||{},T=$[v]=$[v]||[];for(const k of x)Q[k.featureIndex]||(Q[k.featureIndex]=!0,T.push(k))}}return $}(M);for(const F in L)L[F].forEach($=>{const te=$.feature,oe=u.getFeatureState(te.layer["source-layer"],te.id);te.source=te.layer.source,te.layer["source-layer"]&&(te.sourceLayer=te.layer["source-layer"]),te.state=oe});return L}function hi(u,e){const n=u.tileID,a=e.tileID;return n.overscaledZ-a.overscaledZ||n.canonical.y-a.canonical.y||n.wrap-a.wrap||n.canonical.x-a.canonical.x}function si(u,e,n){return c._(this,void 0,void 0,function*(){let a=u;if(u.url?a=(yield c.h(e.transformRequest(u.url,"Source"),n)).data:yield Qe.frameAsync(n),!a)return null;const o=c.M(c.e(a,u),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in a&&a.vector_layers&&(o.vectorLayerIds=a.vector_layers.map(h=>h.id)),o})}class Re{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof c.N?new c.N(e.lng,e.lat):c.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof c.N?new c.N(e.lng,e.lat):c.N.convert(e),this}extend(e){const n=this._sw,a=this._ne;let o,h;if(e instanceof c.N)o=e,h=e;else{if(!(e instanceof Re))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Re.convert(e)):this.extend(c.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(c.N.convert(e)):this;if(o=e._sw,h=e._ne,!o||!h)return this}return n||a?(n.lng=Math.min(o.lng,n.lng),n.lat=Math.min(o.lat,n.lat),a.lng=Math.max(h.lng,a.lng),a.lat=Math.max(h.lat,a.lat)):(this._sw=new c.N(o.lng,o.lat),this._ne=new c.N(h.lng,h.lat)),this}getCenter(){return new c.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.N(this.getWest(),this.getNorth())}getSouthEast(){return new c.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:a}=c.N.convert(e);let o=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(o=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&o}static convert(e){return e instanceof Re?e:e&&new Re(e)}static fromLngLat(e,n=0){const a=360*n/40075017,o=a/Math.cos(Math.PI/180*e.lat);return new Re(new c.N(e.lng-o,e.lat-a),new c.N(e.lng+o,e.lat+a))}adjustAntiMeridian(){const e=new c.N(this._sw.lng,this._sw.lat),n=new c.N(this._ne.lng,this._ne.lat);return new Re(e,e.lng>n.lng?new c.N(n.lng+360,n.lat):n)}}class Ri{constructor(e,n,a){this.bounds=Re.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=a||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const n=Math.pow(2,e.z),a=Math.floor(c.O(this.bounds.getWest())*n),o=Math.floor(c.Q(this.bounds.getNorth())*n),h=Math.ceil(c.O(this.bounds.getEast())*n),_=Math.ceil(c.Q(this.bounds.getSouth())*n);return e.x>=a&&e.x<h&&e.y>=o&&e.y<_}}class Mr extends c.E{constructor(e,n,a,o){if(super(),this.id=e,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.M(n,["url","scheme","tileSize","promoteId"])),this._options=c.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(o)}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield si(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(c.e(this,e),e.bounds&&(this.tileBounds=new Ri(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a={request:this.map._requestManager.transformRequest(n,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};a.request.collectResourceTiming=this._collectResourceTiming;let o="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((h,_)=>{e.reloadPromise={resolve:h,reject:_}})}else e.actor=this.dispatcher.getActor(),o="LT";e.abortController=new AbortController;try{const h=yield e.actor.sendAsync({type:o,data:a},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,h)}catch(h){if(delete e.abortController,e.aborted)return;if(h&&h.status!==404)throw h;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,n){if(n&&n.resourceTiming&&(e.resourceTiming=n.resourceTiming),n&&this.map._refreshExpiredTiles&&e.setExpiryData(n),e.loadVectorData(n,this.map.painter),e.reloadPromise){const a=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(a.resolve).catch(a.reject)}}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Wt extends c.E{constructor(e,n,a,o){super(),this.id=e,this.dispatcher=a,this.setEventedParent(o),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},n),c.e(this,c.M(n,["url","scheme","tileSize"]))}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield si(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(c.e(this,e),e.bounds&&(this.tileBounds=new Ri(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return c.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const a=yield Xe.getImage(this.map._requestManager.transformRequest(n,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(a&&a.data){this.map._refreshExpiredTiles&&a.cacheControl&&a.expires&&e.setExpiryData({cacheControl:a.cacheControl,expires:a.expires});const o=this.map.painter.context,h=o.gl,_=a.data;e.texture=this.map.painter.getTileTexture(_.width),e.texture?e.texture.update(_,{useMipmap:!0}):(e.texture=new St(o,_,h.RGBA,{useMipmap:!0}),e.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE,h.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(a){if(delete e.abortController,e.aborted)e.state="unloaded";else if(a)throw e.state="errored",a}})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class Ii extends Wt{constructor(e,n,a,o){super(e,n,a,o),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a=this.map._requestManager.transformRequest(n,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const o=yield Xe.getImage(a,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(o&&o.data){const h=o.data;this.map._refreshExpiredTiles&&o.cacheControl&&o.expires&&e.setExpiryData({cacheControl:o.cacheControl,expires:o.expires});const _=c.b(h)&&c.U()?h:yield this.readImageNow(h),w={type:this.type,uid:e.uid,source:this.id,rawImageData:_,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const B=yield e.actor.sendAsync({type:"LDT",data:w});e.dem=B,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(o){if(delete e.abortController,e.aborted)e.state="unloaded";else if(o)throw e.state="errored",o}})}readImageNow(e){return c._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&c.V()){const n=e.width+2,a=e.height+2;try{return new c.R({width:n,height:a},yield c.W(e,-1,-1,n,a))}catch{}}return Qe.getImageData(e,1)})}_getNeighboringTiles(e){const n=e.canonical,a=Math.pow(2,n.z),o=(n.x-1+a)%a,h=n.x===0?e.wrap-1:e.wrap,_=(n.x+1+a)%a,w=n.x+1===a?e.wrap+1:e.wrap,B={};return B[new c.S(e.overscaledZ,h,n.z,o,n.y).key]={backfilled:!1},B[new c.S(e.overscaledZ,w,n.z,_,n.y).key]={backfilled:!1},n.y>0&&(B[new c.S(e.overscaledZ,h,n.z,o,n.y-1).key]={backfilled:!1},B[new c.S(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},B[new c.S(e.overscaledZ,w,n.z,_,n.y-1).key]={backfilled:!1}),n.y+1<a&&(B[new c.S(e.overscaledZ,h,n.z,o,n.y+1).key]={backfilled:!1},B[new c.S(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},B[new c.S(e.overscaledZ,w,n.z,_,n.y+1).key]={backfilled:!1}),B}unloadTile(e){return c._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class Un extends c.E{constructor(e,n,a,o){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=a.getActor(),this.setEventedParent(o),this._data=n.data,this._options=c.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const h=c.X/this.tileSize;n.clusterMaxZoom!==void 0&&this.maxzoom<=n.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${n.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*h,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*h,extent:c.X,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:c.X,radius:(n.clusterRadius||50)*h,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return c._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return c._(this,void 0,void 0,function*(){const e=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,n,a){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:n,offset:a}})}_updateWorkerData(e){return c._(this,void 0,void 0,function*(){const n=c.e({type:this.type},this.workerOptions);e?n.dataDiff=e:typeof this._data=="string"?(n.request=this.map._requestManager.transformRequest(Qe.resolveURL(this._data),"Source"),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new c.k("dataloading",{dataType:"source"}));try{const a=yield this.actor.sendAsync({type:"LD",data:n});if(this._pendingLoads--,this._removed||a.abandoned)return void this.fire(new c.k("dataabort",{dataType:"source"}));let o=null;a.resourceTiming&&a.resourceTiming[this.id]&&(o=a.resourceTiming[this.id].slice(0));const h={dataType:"source"};this._collectResourceTiming&&o&&o.length>0&&c.e(h,{resourceTiming:o}),this.fire(new c.k("data",Object.assign(Object.assign({},h),{sourceDataType:"metadata"}))),this.fire(new c.k("data",Object.assign(Object.assign({},h),{sourceDataType:"content"})))}catch(a){if(this._pendingLoads--,this._removed)return void this.fire(new c.k("dataabort",{dataType:"source"}));this.fire(new c.j(a))}})}loaded(){return this._pendingLoads===0}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.actor?"RT":"LT";e.actor=this.actor;const a={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const o=yield this.actor.sendAsync({type:n,data:a},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(o,this.map.painter,n==="RT")})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Ir=c.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class qr extends c.E{constructor(e,n,a,o){super(),this.id=e,this.dispatcher=a,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(o),this.options=n}load(e){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const n=yield Xe.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,n&&n.data&&(this.image=n.data,e&&(this.coordinates=e),this._finishLoading())}catch(n){this._request=null,this._loaded=!0,this.fire(new c.j(n))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const n=e.map(c.Z.fromLngLat);this.tileID=function(o){let h=1/0,_=1/0,w=-1/0,B=-1/0;for(const $ of o)h=Math.min(h,$.x),_=Math.min(_,$.y),w=Math.max(w,$.x),B=Math.max(B,$.y);const M=Math.max(w-h,B-_),L=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),F=Math.pow(2,L);return new c.a1(L,Math.floor((h+w)/2*F),Math.floor((_+B)/2*F))}(n),this.minzoom=this.maxzoom=this.tileID.z;const a=n.map(o=>this.tileID.getTilePoint(o)._round());return this._boundsArray=new c.$,this._boundsArray.emplaceBack(a[0].x,a[0].y,0,0),this._boundsArray.emplaceBack(a[1].x,a[1].y,c.X,0),this._boundsArray.emplaceBack(a[3].x,a[3].y,0,c.X),this._boundsArray.emplaceBack(a[2].x,a[2].y,c.X,c.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,n=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Ir.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new St(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let a=!1;for(const o in this.tiles){const h=this.tiles[o];h.state!=="loaded"&&(h.state="loaded",h.texture=this.texture,a=!0)}a&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return c._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class ra extends qr{constructor(e,n,a,o){super(e,n,a,o),this.roundZoom=!0,this.type="video",this.options=n}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const n of e.urls)this.urls.push(this.map._requestManager.transformRequest(n,"Source").url);try{const n=yield c.a3(this.urls);if(this._loaded=!0,!n)return;this.video=n,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(n){this.fire(new c.j(n))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const n=this.video.seekable;e<n.start(0)||e>n.end(0)?this.fire(new c.j(new c.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,n=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Ir.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new St(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let a=!1;for(const o in this.tiles){const h=this.tiles[o];h.state!=="loaded"&&(h.state="loaded",h.texture=this.texture,a=!0)}a&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class rn extends qr{constructor(e,n,a,o){super(e,n,a,o),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(h=>!Array.isArray(h)||h.length!==2||h.some(_=>typeof _!="number"))||this.fire(new c.j(new c.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.j(new c.a2(`sources.${e}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new c.j(new c.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new c.j(new c.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.j(new c.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){return c._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context,a=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,Ir.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new St(n,this.canvas,a.RGBA,{premultiply:!0});let o=!1;for(const h in this.tiles){const _=this.tiles[h];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,o=!0)}o&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Ss={},na=u=>{switch(u){case"geojson":return Un;case"image":return qr;case"raster":return Wt;case"raster-dem":return Ii;case"vector":return Mr;case"video":return ra;case"canvas":return rn}return Ss[u]},lt="RTLPluginLoaded";class En extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=_r()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(n=>{throw this.status="error",n})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return c._(this,arguments,void 0,function*(n,a=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Qe.resolveURL(n),!this.url)throw new Error(`requested url ${n} is invalid`);if(this.status==="unavailable"){if(!a)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return c._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.k(lt))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let br=null;function Qn(){return br||(br=new En),br}class nn{constructor(e,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=c.a4(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const n=e+this.timeAdded;n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,n,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(o,h){const _={};if(!h)return _;for(const w of o){const B=w.layerIds.map(M=>h.getLayer(M)).filter(Boolean);if(B.length!==0){w.layers=B,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(M=>B.filter(L=>L.id===M)[0]));for(const M of B)_[M.id]=w}}return _}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const o in this.buckets){const h=this.buckets[o];if(h instanceof c.a6){if(this.hasSymbolBuckets=!0,!a)break;h.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const o in this.buckets){const h=this.buckets[o];if(h instanceof c.a6&&h.hasRTLText){this.hasRTLText=!0,Qn().lazyLoad();break}}this.queryPadding=0;for(const o in this.buckets){const h=this.buckets[o];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(o).queryRadius(h))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new c.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const a in this.buckets){const o=this.buckets[a];o.uploadPending()&&o.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new St(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new St(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,a,o,h,_,w,B,M,L){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:o,cameraQueryGeometry:h,scale:_,tileSize:this.tileSize,pixelPosMatrix:L,transform:B,params:w,queryPadding:this.queryPadding*M},e,n,a):{}}querySourceFeatures(e,n){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const o=a.loadVTLayers(),h=n&&n.sourceLayer?n.sourceLayer:"",_=o._geojsonTileLayer||o[h];if(!_)return;const w=c.a7(n&&n.filter),{z:B,x:M,y:L}=this.tileID.canonical,F={z:B,x:M,y:L};for(let $=0;$<_.length;$++){const te=_.feature($);if(w.needGeometry){const g=c.a8(te,!0);if(!w.filter(new c.z(this.tileID.overscaledZ),g,this.tileID.canonical))continue}else if(!w.filter(new c.z(this.tileID.overscaledZ),te))continue;const oe=a.getId(te,h),p=new c.a9(te,B,M,L,oe);p.tile=F,e.push(p)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const a=c.aa(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let o=!1;if(this.expirationTime>a)o=!1;else if(n)if(this.expirationTime<n)o=!0;else{const h=this.expirationTime-n;h?this.expirationTime=a+Math.max(h,3e4):o=!0}else o=!0;o?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const a=this.latestFeatureIndex.loadVTLayers();for(const o in this.buckets){if(!n.style.hasLayer(o))continue;const h=this.buckets[o],_=h.layers[0].sourceLayer||"_geojsonTileLayer",w=a[_],B=e[_];if(!w||!B||Object.keys(B).length===0)continue;h.update(B,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});const M=n&&n.style&&n.style.getLayer(o);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(h)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Qe.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Qe.now()+e}setDependencies(e,n){const a={};for(const o of n)a[o]=!0;this.dependencies[e]=a}hasDependency(e,n){for(const a of e){const o=this.dependencies[a];if(o){for(const h of n)if(o[h])return!0}}return!1}}class at{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,a){const o=e.wrapped().key;this.data[o]===void 0&&(this.data[o]=[]);const h={value:n,timeout:void 0};if(a!==void 0&&(h.timeout=setTimeout(()=>{this.remove(e,h)},a)),this.data[o].push(h),this.order.push(o),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const a=e.wrapped().key,o=n===void 0?0:this.data[a].indexOf(n),h=this.data[a][o];return this.data[a].splice(o,1),h.timeout&&clearTimeout(h.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(h.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const a in this.data)for(const o of this.data[a])e(o.value)||n.push(o);for(const a of n)this.remove(a.value.tileID,a)}}class ei{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,a){const o=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][o]=this.stateChanges[e][o]||{},c.e(this.stateChanges[e][o],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(const h in this.state[e])h!==o&&(this.deletedStates[e][h]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][o]===null){this.deletedStates[e][o]={};for(const h in this.state[e][o])a[h]||(this.deletedStates[e][o][h]=null)}else for(const h in a)this.deletedStates[e]&&this.deletedStates[e][o]&&this.deletedStates[e][o][h]===null&&delete this.deletedStates[e][o][h]}removeFeatureState(e,n,a){if(this.deletedStates[e]===null)return;const o=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&n!==void 0)this.deletedStates[e][o]!==null&&(this.deletedStates[e][o]=this.deletedStates[e][o]||{},this.deletedStates[e][o][a]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][o])for(a in this.deletedStates[e][o]={},this.stateChanges[e][o])this.deletedStates[e][o][a]=null;else this.deletedStates[e][o]=null;else this.deletedStates[e]=null}getState(e,n){const a=String(n),o=c.e({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const h=this.deletedStates[e][n];if(h===null)return{};for(const _ in h)delete o[_]}return o}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const a={};for(const o in this.stateChanges){this.state[o]=this.state[o]||{};const h={};for(const _ in this.stateChanges[o])this.state[o][_]||(this.state[o][_]={}),c.e(this.state[o][_],this.stateChanges[o][_]),h[_]=this.state[o][_];a[o]=h}for(const o in this.deletedStates){this.state[o]=this.state[o]||{};const h={};if(this.deletedStates[o]===null)for(const _ in this.state[o])h[_]={},this.state[o][_]={};else for(const _ in this.deletedStates[o]){if(this.deletedStates[o][_]===null)this.state[o][_]={};else for(const w of Object.keys(this.deletedStates[o][_]))delete this.state[o][_][w];h[_]=this.state[o][_]}a[o]=a[o]||{},c.e(a[o],h)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const o in e)e[o].setFeatureState(a,n)}}class Vt extends c.E{constructor(e,n,a){super(),this.id=e,this.dispatcher=a,this.on("data",o=>this._dataHandler(o)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((o,h,_,w)=>{const B=new(na(h.type))(o,h,_,w);if(B.id!==o)throw new Error(`Expected Source id to be ${o} instead of ${B.id}`);return B})(e,n,a,this),this._tiles={},this._cache=new at(0,o=>this._unloadTile(o)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ei,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const n=this._tiles[e];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,n,a){return c._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,n,a)}catch(o){e.state="errored",o.status!==404?this._source.fire(new c.j(o,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new c.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const a=this._tiles[n];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Ht).map(e=>e.key)}getRenderableIds(e){const n=[];for(const a in this._tiles)this._isIdRenderable(a,e)&&n.push(this._tiles[a]);return e?n.sort((a,o)=>{const h=a.tileID,_=o.tileID,w=new c.P(h.canonical.x,h.canonical.y)._rotate(this.transform.angle),B=new c.P(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return h.overscaledZ-_.overscaledZ||B.y-w.y||B.x-w.x}).map(a=>a.tileID.key):n.map(a=>a.tileID).sort(Ht).map(a=>a.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,n){return c._(this,void 0,void 0,function*(){const a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=n),yield this._loadTile(a,e,n))})}_tileLoaded(e,n,a){e.timeAdded=Qe.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new c.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const n=this.getRenderableIds();for(let o=0;o<n.length;o++){const h=n[o];if(e.neighboringTiles&&e.neighboringTiles[h]){const _=this.getTileByID(h);a(e,_),a(_,e)}}function a(o,h){o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0;let _=h.tileID.canonical.x-o.tileID.canonical.x;const w=h.tileID.canonical.y-o.tileID.canonical.y,B=Math.pow(2,o.tileID.canonical.z),M=h.tileID.key;_===0&&w===0||Math.abs(w)>1||(Math.abs(_)>1&&(Math.abs(_+B)===1?_+=B:Math.abs(_-B)===1&&(_-=B)),h.dem&&o.dem&&(o.dem.backfillBorder(h.dem,_,w),o.neighboringTiles&&o.neighboringTiles[M]&&(o.neighboringTiles[M].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,a,o){for(const h in this._tiles){let _=this._tiles[h];if(o[h]||!_.hasData()||_.tileID.overscaledZ<=n||_.tileID.overscaledZ>a)continue;let w=_.tileID;for(;_&&_.tileID.overscaledZ>n+1;){const M=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[M.key],_&&_.hasData()&&(w=M)}let B=w;for(;B.overscaledZ>n;)if(B=B.scaledTo(B.overscaledZ-1),e[B.key]){o[w.key]=w;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=n?a:null}for(let a=e.overscaledZ-1;a>=n;a--){const o=e.scaledTo(a),h=this._getLoadedTile(o);if(h)return h}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const n=Math.ceil(e.width/this._source.tileSize)+1,a=Math.ceil(e.height/this._source.tileSize)+1,o=Math.floor(n*a*(this._maxTileCacheZoomLevels===null?c.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),h=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,o):o;this._cache.setMaxSize(h)}handleWrapJump(e){const n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){const a={};for(const o in this._tiles){const h=this._tiles[o];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+n),a[h.tileID.key]=h}this._tiles=a;for(const o in this._timers)clearTimeout(this._timers[o]),delete this._timers[o];for(const o in this._tiles)this._setTileReloadTimer(o,this._tiles[o])}}_updateCoveredAndRetainedTiles(e,n,a,o,h,_){const w={},B={},M=Object.keys(e),L=Qe.now();for(const F of M){const $=e[F],te=this._tiles[F];if(!te||te.fadeEndTime!==0&&te.fadeEndTime<=L)continue;const oe=this.findLoadedParent($,n),p=this.findLoadedSibling($),g=oe||p||null;g&&(this._addTile(g.tileID),w[g.tileID.key]=g.tileID),B[F]=$}this._retainLoadedChildren(B,o,a,e);for(const F in w)e[F]||(this._coveredTiles[F]=!0,e[F]=w[F]);if(_){const F={},$={};for(const te of h)this._tiles[te.key].hasData()?F[te.key]=te:$[te.key]=te;for(const te in $){const oe=$[te].children(this._source.maxzoom);this._tiles[oe[0].key]&&this._tiles[oe[1].key]&&this._tiles[oe[2].key]&&this._tiles[oe[3].key]&&(F[oe[0].key]=e[oe[0].key]=oe[0],F[oe[1].key]=e[oe[1].key]=oe[1],F[oe[2].key]=e[oe[2].key]=oe[2],F[oe[3].key]=e[oe[3].key]=oe[3],delete $[te])}for(const te in $){const oe=$[te],p=this.findLoadedParent(oe,this._source.minzoom),g=this.findLoadedSibling(oe),A=p||g||null;if(A){F[A.tileID.key]=e[A.tileID.key]=A.tileID;for(const v in F)F[v].isChildOf(A.tileID)&&delete F[v]}}for(const te in this._tiles)F[te]||(this._coveredTiles[te]=!0)}}update(e,n){if(!this._sourceLoaded||this._paused)return;let a;this.transform=e,this.terrain=n,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(L=>new c.S(L.canonical.z,L.wrap,L.canonical.z,L.canonical.x,L.canonical.y)):(a=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n}),this._source.hasTile&&(a=a.filter(L=>this._source.hasTile(L)))):a=[];const o=e.coveringZoomLevel(this._source),h=Math.max(o-Vt.maxOverzooming,this._source.minzoom),_=Math.max(o+Vt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const L={};for(const F of a)if(F.canonical.z>this._source.minzoom){const $=F.scaledTo(F.canonical.z-1);L[$.key]=$;const te=F.scaledTo(Math.max(this._source.minzoom,Math.min(F.canonical.z,5)));L[te.key]=te}a=a.concat(Object.values(L))}const w=a.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new c.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const B=this._updateRetainedTiles(a,o);sn(this._source.type)&&this._updateCoveredAndRetainedTiles(B,h,_,o,a,n);for(const L in B)this._tiles[L].clearFadeHold();const M=c.ab(this._tiles,B);for(const L of M){const F=this._tiles[L];F.hasSymbolBuckets&&!F.holdingForFade()?F.setHoldDuration(this.map._fadeDuration):F.hasSymbolBuckets&&!F.symbolFadeFinished()||this._removeTile(L)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,n){var a;const o={},h={},_=Math.max(n-Vt.maxOverzooming,this._source.minzoom),w=Math.max(n+Vt.maxUnderzooming,this._source.minzoom),B={};for(const M of e){const L=this._addTile(M);o[M.key]=M,L.hasData()||n<this._source.maxzoom&&(B[M.key]=M)}this._retainLoadedChildren(B,n,w,o);for(const M of e){let L=this._tiles[M.key];if(L.hasData())continue;if(n+1>this._source.maxzoom){const $=M.children(this._source.maxzoom)[0],te=this.getTile($);if(te&&te.hasData()){o[$.key]=$;continue}}else{const $=M.children(this._source.maxzoom);if(o[$[0].key]&&o[$[1].key]&&o[$[2].key]&&o[$[3].key])continue}let F=L.wasRequested();for(let $=M.overscaledZ-1;$>=_;--$){const te=M.scaledTo($);if(h[te.key])break;if(h[te.key]=!0,L=this.getTile(te),!L&&F&&(L=this._addTile(te)),L){const oe=L.hasData();if((oe||!(!((a=this.map)===null||a===void 0)&&a.cancelPendingTileRequestsWhileZooming)||F)&&(o[te.key]=te),F=L.wasRequested(),oe)break}}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let a,o=this._tiles[e].tileID;for(;o.overscaledZ>0;){if(o.key in this._loadedParentTiles){a=this._loadedParentTiles[o.key];break}n.push(o.key);const h=o.scaledTo(o.overscaledZ-1);if(a=this._getLoadedTile(h),a)break;o=h}for(const h of n)this._loadedParentTiles[h]=a}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const n=this._tiles[e].tileID,a=this._getLoadedTile(n);this._loadedSiblingTiles[n.key]=a}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const a=n;return n||(n=new nn(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(n,e.key,n.state)),n.uses++,this._tiles[e.key]=n,a||this._source.fire(new c.k("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=n.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}_dataHandler(e){const n=e.sourceDataType;e.dataType==="source"&&n==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&n==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,n,a){const o=[],h=this.transform;if(!h)return o;const _=a?h.getCameraQueryGeometry(e):e,w=e.map(oe=>h.pointCoordinate(oe,this.terrain)),B=_.map(oe=>h.pointCoordinate(oe,this.terrain)),M=this.getIds();let L=1/0,F=1/0,$=-1/0,te=-1/0;for(const oe of B)L=Math.min(L,oe.x),F=Math.min(F,oe.y),$=Math.max($,oe.x),te=Math.max(te,oe.y);for(let oe=0;oe<M.length;oe++){const p=this._tiles[M[oe]];if(p.holdingForFade())continue;const g=p.tileID,A=Math.pow(2,h.zoom-p.tileID.overscaledZ),v=n*p.queryPadding*c.X/p.tileSize/A,x=[g.getTilePoint(new c.Z(L,F)),g.getTilePoint(new c.Z($,te))];if(x[0].x-v<c.X&&x[0].y-v<c.X&&x[1].x+v>=0&&x[1].y+v>=0){const Q=w.map(k=>g.getTilePoint(k)),T=B.map(k=>g.getTilePoint(k));o.push({tile:p,tileID:g,queryGeometry:Q,cameraQueryGeometry:T,scale:A})}}return o}getVisibleCoordinates(e){const n=this.getRenderableIds(e).map(a=>this._tiles[a].tileID);for(const a of n)a.posMatrix=this.transform.calculatePosMatrix(a.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(sn(this._source.type)){const e=Qe.now();for(const n in this._tiles)if(this._tiles[n].fadeEndTime>=e)return!0}return!1}setFeatureState(e,n,a){this._state.updateState(e=e||"_geojsonTileLayer",n,a)}removeFeatureState(e,n,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,a)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,a){const o=this._tiles[e];o&&o.setDependencies(n,a)}reloadTilesForDependencies(e,n){for(const a in this._tiles)this._tiles[a].hasDependency(e,n)&&this._reloadTile(a,"reloading");this._cache.filter(a=>!a.hasDependency(e,n))}}function Ht(u,e){const n=Math.abs(2*u.wrap)-+(u.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return u.overscaledZ-e.overscaledZ||a-n||e.canonical.y-u.canonical.y||e.canonical.x-u.canonical.x}function sn(u){return u==="raster"||u==="image"||u==="video"}Vt.maxOverzooming=10,Vt.maxUnderzooming=3;class Yt{constructor(e,n){this.reset(e,n)}reset(e,n){this.points=e||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=c.ac(e,0,1);let n=1,a=this._distances[n];const o=e*this.paddedLength+this.padding;for(;a<o&&n<this._distances.length;)a=this._distances[++n];const h=n-1,_=this._distances[h],w=a-_,B=w>0?(o-_)/w:0;return this.points[h].mult(1-B).add(this.points[n].mult(B))}}function Sn(u,e){let n=!0;return u==="always"||u!=="never"&&e!=="never"||(n=!1),n}class kn{constructor(e,n,a){const o=this.boxCells=[],h=this.circleCells=[];this.xCellCount=Math.ceil(e/a),this.yCellCount=Math.ceil(n/a);for(let _=0;_<this.xCellCount*this.yCellCount;_++)o.push([]),h.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=n,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,n,a,o,h){this._forEachCell(n,a,o,h,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(o),this.bboxes.push(h)}insertCircle(e,n,a,o){this._forEachCell(n-o,a-o,n+o,a+o,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(n),this.circles.push(a),this.circles.push(o)}_insertBoxCell(e,n,a,o,h,_){this.boxCells[h].push(_)}_insertCircleCell(e,n,a,o,h,_){this.circleCells[h].push(_)}_query(e,n,a,o,h,_,w){if(a<0||e>this.width||o<0||n>this.height)return[];const B=[];if(e<=0&&n<=0&&this.width<=a&&this.height<=o){if(h)return[{key:null,x1:e,y1:n,x2:a,y2:o}];for(let M=0;M<this.boxKeys.length;M++)B.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const L=this.circles[3*M],F=this.circles[3*M+1],$=this.circles[3*M+2];B.push({key:this.circleKeys[M],x1:L-$,y1:F-$,x2:L+$,y2:F+$})}}else this._forEachCell(e,n,a,o,this._queryCell,B,{hitTest:h,overlapMode:_,seenUids:{box:{},circle:{}}},w);return B}query(e,n,a,o){return this._query(e,n,a,o,!1,null)}hitTest(e,n,a,o,h,_){return this._query(e,n,a,o,!0,h,_).length>0}hitTestCircle(e,n,a,o,h){const _=e-a,w=e+a,B=n-a,M=n+a;if(w<0||_>this.width||M<0||B>this.height)return!1;const L=[];return this._forEachCell(_,B,w,M,this._queryCellCircle,L,{hitTest:!0,overlapMode:o,circle:{x:e,y:n,radius:a},seenUids:{box:{},circle:{}}},h),L.length>0}_queryCell(e,n,a,o,h,_,w,B){const{seenUids:M,hitTest:L,overlapMode:F}=w,$=this.boxCells[h];if($!==null){const oe=this.bboxes;for(const p of $)if(!M.box[p]){M.box[p]=!0;const g=4*p,A=this.boxKeys[p];if(e<=oe[g+2]&&n<=oe[g+3]&&a>=oe[g+0]&&o>=oe[g+1]&&(!B||B(A))&&(!L||!Sn(F,A.overlapMode))&&(_.push({key:A,x1:oe[g],y1:oe[g+1],x2:oe[g+2],y2:oe[g+3]}),L))return!0}}const te=this.circleCells[h];if(te!==null){const oe=this.circles;for(const p of te)if(!M.circle[p]){M.circle[p]=!0;const g=3*p,A=this.circleKeys[p];if(this._circleAndRectCollide(oe[g],oe[g+1],oe[g+2],e,n,a,o)&&(!B||B(A))&&(!L||!Sn(F,A.overlapMode))){const v=oe[g],x=oe[g+1],Q=oe[g+2];if(_.push({key:A,x1:v-Q,y1:x-Q,x2:v+Q,y2:x+Q}),L)return!0}}}return!1}_queryCellCircle(e,n,a,o,h,_,w,B){const{circle:M,seenUids:L,overlapMode:F}=w,$=this.boxCells[h];if($!==null){const oe=this.bboxes;for(const p of $)if(!L.box[p]){L.box[p]=!0;const g=4*p,A=this.boxKeys[p];if(this._circleAndRectCollide(M.x,M.y,M.radius,oe[g+0],oe[g+1],oe[g+2],oe[g+3])&&(!B||B(A))&&!Sn(F,A.overlapMode))return _.push(!0),!0}}const te=this.circleCells[h];if(te!==null){const oe=this.circles;for(const p of te)if(!L.circle[p]){L.circle[p]=!0;const g=3*p,A=this.circleKeys[p];if(this._circlesCollide(oe[g],oe[g+1],oe[g+2],M.x,M.y,M.radius)&&(!B||B(A))&&!Sn(F,A.overlapMode))return _.push(!0),!0}}}_forEachCell(e,n,a,o,h,_,w,B){const M=this._convertToXCellCoord(e),L=this._convertToYCellCoord(n),F=this._convertToXCellCoord(a),$=this._convertToYCellCoord(o);for(let te=M;te<=F;te++)for(let oe=L;oe<=$;oe++)if(h.call(this,e,n,a,o,this.xCellCount*oe+te,_,w,B))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,n,a,o,h,_){const w=o-e,B=h-n,M=a+_;return M*M>w*w+B*B}_circleAndRectCollide(e,n,a,o,h,_,w){const B=(_-o)/2,M=Math.abs(e-(o+B));if(M>B+a)return!1;const L=(w-h)/2,F=Math.abs(n-(h+L));if(F>L+a)return!1;if(M<=B||F<=L)return!0;const $=M-B,te=F-L;return $*$+te*te<=a*a}}function Nn(u,e,n,a,o){const h=c.H();return e?(c.K(h,h,[1/o,1/o,1]),n||c.ad(h,h,a.angle)):c.L(h,a.labelPlaneMatrix,u),h}function fn(u,e,n,a,o){if(e){const h=c.ae(u);return c.K(h,h,[o,o,1]),n||c.ad(h,h,-a.angle),h}return a.glCoordMatrix}function ge(u,e,n,a){let o;a?(o=[u,e,a(u,e),1],c.af(o,o,n)):(o=[u,e,0,1],ui(o,o,n));const h=o[3];return{point:new c.P(o[0]/h,o[1]/h),signedDistanceFromCamera:h,isOccluded:!1}}function j(u,e){return .5+u/e*.5}function H(u,e){return u.x>=-e[0]&&u.x<=e[0]&&u.y>=-e[1]&&u.y<=e[1]}function ee(u,e,n,a,o,h,_,w,B,M,L,F,$,te,oe){const p=a?u.textSizeData:u.iconSizeData,g=c.ag(p,n.transform.zoom),A=[256/n.width*2+1,256/n.height*2+1],v=a?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;v.clear();const x=u.lineVertexArray,Q=a?u.text.placedSymbolArray:u.icon.placedSymbolArray,T=n.transform.width/n.transform.height;let k=!1;for(let q=0;q<Q.length;q++){const G=Q.get(q);if(G.hidden||G.writingMode===c.ah.vertical&&!k){Ot(G.numGlyphs,v);continue}k=!1;const O=ge(G.anchorX,G.anchorY,e,oe);if(!H(O.point,A)){Ot(G.numGlyphs,v);continue}const re=j(n.transform.cameraToCenterDistance,O.signedDistanceFromCamera),K=c.ai(p,g,G),U=_?K/re:K*re,ne={getElevation:oe,labelPlaneMatrix:o,lineVertexArray:x,pitchWithMap:_,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:M,tileAnchorPoint:new c.P(G.anchorX,G.anchorY),unwrappedTileID:L,width:F,height:$,translation:te},le=Se(ne,G,U,!1,w,e,h,u.glyphOffsetArray,v,T,B);k=le.useVertical,(le.notEnoughRoom||k||le.needsFlipping&&Se(ne,G,U,!0,w,e,h,u.glyphOffsetArray,v,T,B).notEnoughRoom)&&Ot(G.numGlyphs,v)}a?u.text.dynamicLayoutVertexBuffer.updateData(v):u.icon.dynamicLayoutVertexBuffer.updateData(v)}function de(u,e,n,a,o,h,_,w){const B=h.glyphStartIndex+h.numGlyphs,M=h.lineStartIndex,L=h.lineStartIndex+h.lineLength,F=e.getoffsetX(h.glyphStartIndex),$=e.getoffsetX(B-1),te=At(u*F,n,a,o,h.segment,M,L,w,_);if(!te)return null;const oe=At(u*$,n,a,o,h.segment,M,L,w,_);return oe?w.projectionCache.anyProjectionOccluded?null:{first:te,last:oe}:null}function we(u,e,n,a){return u===c.ah.horizontal&&Math.abs(n.y-e.y)>Math.abs(n.x-e.x)*a?{useVertical:!0}:(u===c.ah.vertical?e.y<n.y:e.x>n.x)?{needsFlipping:!0}:null}function Se(u,e,n,a,o,h,_,w,B,M,L){const F=n/24,$=e.lineOffsetX*F,te=e.lineOffsetY*F;let oe;if(e.numGlyphs>1){const p=e.glyphStartIndex+e.numGlyphs,g=e.lineStartIndex,A=e.lineStartIndex+e.lineLength,v=de(F,w,$,te,a,e,L,u);if(!v)return{notEnoughRoom:!0};const x=ge(v.first.point.x,v.first.point.y,_,u.getElevation).point,Q=ge(v.last.point.x,v.last.point.y,_,u.getElevation).point;if(o&&!a){const T=we(e.writingMode,x,Q,M);if(T)return T}oe=[v.first];for(let T=e.glyphStartIndex+1;T<p-1;T++)oe.push(At(F*w.getoffsetX(T),$,te,a,e.segment,g,A,u,L));oe.push(v.last)}else{if(o&&!a){const g=ge(u.tileAnchorPoint.x,u.tileAnchorPoint.y,h,u.getElevation).point,A=e.lineStartIndex+e.segment+1,v=new c.P(u.lineVertexArray.getx(A),u.lineVertexArray.gety(A)),x=ge(v.x,v.y,h,u.getElevation),Q=x.signedDistanceFromCamera>0?x.point:function(k,q,G,O,re,K){return De(k,q,G,1,re,K)}(u.tileAnchorPoint,v,g,0,h,u),T=we(e.writingMode,g,Q,M);if(T)return T}const p=At(F*w.getoffsetX(e.glyphStartIndex),$,te,a,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,u,L);if(!p||u.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};oe=[p]}for(const p of oe)c.aj(B,p.point,p.angle);return{}}function De(u,e,n,a,o,h){const _=u.add(u.sub(e)._unit()),w=o!==void 0?ge(_.x,_.y,o,h.getElevation).point:Ne(_.x,_.y,h).point,B=n.sub(w);return n.add(B._mult(a/B.mag()))}function _e(u,e,n){const a=e.projectionCache;if(a.projections[u])return a.projections[u];const o=new c.P(e.lineVertexArray.getx(u),e.lineVertexArray.gety(u)),h=Ne(o.x,o.y,e);if(h.signedDistanceFromCamera>0)return a.projections[u]=h.point,a.anyProjectionOccluded=a.anyProjectionOccluded||h.isOccluded,h.point;const _=u-n.direction;return function(w,B,M,L,F){return De(w,B,M,L,void 0,F)}(n.distanceFromAnchor===0?e.tileAnchorPoint:new c.P(e.lineVertexArray.getx(_),e.lineVertexArray.gety(_)),o,n.previousVertex,n.absOffsetX-n.distanceFromAnchor+1,e)}function Ne(u,e,n){const a=u+n.translation[0],o=e+n.translation[1];let h;return!n.pitchWithMap&&n.projection.useSpecialProjectionForSymbols?(h=n.projection.projectTileCoordinates(a,o,n.unwrappedTileID,n.getElevation),h.point.x=(.5*h.point.x+.5)*n.width,h.point.y=(.5*-h.point.y+.5)*n.height):(h=ge(a,o,n.labelPlaneMatrix,n.getElevation),h.isOccluded=!1),h}function Ze(u,e,n){return u._unit()._perp()._mult(e*n)}function Le(u,e,n,a,o,h,_,w,B){if(w.projectionCache.offsets[u])return w.projectionCache.offsets[u];const M=n.add(e);if(u+B.direction<a||u+B.direction>=o)return w.projectionCache.offsets[u]=M,M;const L=_e(u+B.direction,w,B),F=Ze(L.sub(n),_,B.direction),$=n.add(F),te=L.add(F);return w.projectionCache.offsets[u]=c.ak(h,M,$,te)||M,w.projectionCache.offsets[u]}function At(u,e,n,a,o,h,_,w,B){const M=a?u-e:u+e;let L=M>0?1:-1,F=0;a&&(L*=-1,F=Math.PI),L<0&&(F+=Math.PI);let $,te=L>0?h+o:h+o+1;w.projectionCache.cachedAnchorPoint?$=w.projectionCache.cachedAnchorPoint:($=Ne(w.tileAnchorPoint.x,w.tileAnchorPoint.y,w).point,w.projectionCache.cachedAnchorPoint=$);let oe,p,g=$,A=$,v=0,x=0;const Q=Math.abs(M),T=[];let k;for(;v+x<=Q;){if(te+=L,te<h||te>=_)return null;v+=x,A=g,p=oe;const O={absOffsetX:Q,direction:L,distanceFromAnchor:v,previousVertex:A};if(g=_e(te,w,O),n===0)T.push(A),k=g.sub(A);else{let re;const K=g.sub(A);re=K.mag()===0?Ze(_e(te+L,w,O).sub(g),n,L):Ze(K,n,L),p||(p=A.add(re)),oe=Le(te,re,g,h,_,p,n,w,O),T.push(p),k=oe.sub(p)}x=k.mag()}const q=k._mult((Q-v)/x)._add(p||A),G=F+Math.atan2(g.y-A.y,g.x-A.x);return T.push(q),{point:q,angle:B?G:0,path:T}}const Rt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ot(u,e){for(let n=0;n<u;n++){const a=e.length;e.resize(a+4),e.float32.set(Rt,3*a)}}function ui(u,e,n){const a=e[0],o=e[1];return u[0]=n[0]*a+n[4]*o+n[12],u[1]=n[1]*a+n[5]*o+n[13],u[3]=n[3]*a+n[7]*o+n[15],u}const Zt=100;class fi{constructor(e,n,a=new kn(e.width+200,e.height+200,25),o=new kn(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=n,this.grid=a,this.ignoredGrid=o,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Zt,this.screenBottomBoundary=e.height+Zt,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,n,a,o,h,_,w,B,M,L,F){const $=e.anchorPointX+B[0],te=e.anchorPointY+B[1],oe=this.projectAndGetPerspectiveRatio(o,$,te,h,L),p=a*oe.perspectiveRatio;let g;if(_||w)g=this._projectCollisionBox(e,p,o,h,_,w,B,oe,L,F);else{const T=oe.point.x+(F?F.x*p:0),k=oe.point.y+(F?F.y*p:0);g={allPointsOccluded:!1,box:[T+e.x1*p,k+e.y1*p,T+e.x2*p,k+e.y2*p]}}const[A,v,x,Q]=g.box;return this.mapProjection.useSpecialProjectionForSymbols&&(_?g.allPointsOccluded:this.mapProjection.isOccluded($,te,h))||oe.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(A,v,x,Q)||n!=="always"&&this.grid.hitTest(A,v,x,Q,n,M)?{box:[A,v,x,Q],placeable:!1,offscreen:!1}:{box:[A,v,x,Q],placeable:!0,offscreen:this.isOffscreen(A,v,x,Q)}}placeCollisionCircles(e,n,a,o,h,_,w,B,M,L,F,$,te,oe,p,g){const A=[],v=new c.P(n.anchorX,n.anchorY),x=this.getPerspectiveRatio(_,v.x,v.y,w,g),Q=(F?h/x:h*x)/c.ap,T={getElevation:g,labelPlaneMatrix:B,lineVertexArray:a,pitchWithMap:F,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:v,unwrappedTileID:w,width:this.transform.width,height:this.transform.height,translation:p},k=de(Q,o,n.lineOffsetX*Q,n.lineOffsetY*Q,!1,n,!1,T);let q=!1,G=!1,O=!0;if(k){const re=.5*te*x+oe,K=new c.P(-100,-100),U=new c.P(this.screenRightBoundary,this.screenBottomBoundary),ne=new Yt,le=k.first,se=k.last;let ue=[];for(let Be=le.path.length-1;Be>=1;Be--)ue.push(le.path[Be]);for(let Be=1;Be<se.path.length;Be++)ue.push(se.path[Be]);const Ie=2.5*re;if(M){const Be=this.projectPathToScreenSpace(ue,T,M);ue=Be.some(Y=>Y.signedDistanceFromCamera<=0)?[]:Be.map(Y=>Y.point)}let pe=[];if(ue.length>0){const Be=ue[0].clone(),Y=ue[0].clone();for(let z=1;z<ue.length;z++)Be.x=Math.min(Be.x,ue[z].x),Be.y=Math.min(Be.y,ue[z].y),Y.x=Math.max(Y.x,ue[z].x),Y.y=Math.max(Y.y,ue[z].y);pe=Be.x>=K.x&&Y.x<=U.x&&Be.y>=K.y&&Y.y<=U.y?[ue]:Y.x<K.x||Be.x>U.x||Y.y<K.y||Be.y>U.y?[]:c.al([ue],K.x,K.y,U.x,U.y)}for(const Be of pe){ne.reset(Be,.25*re);let Y=0;Y=ne.length<=.5*re?1:Math.ceil(ne.paddedLength/Ie)+1;for(let z=0;z<Y;z++){const ce=z/Math.max(Y-1,1),ie=ne.lerp(ce),ae=ie.x+Zt,Ae=ie.y+Zt;A.push(ae,Ae,re,0);const Ce=ae-re,be=Ae-re,xe=ae+re,ze=Ae+re;if(O=O&&this.isOffscreen(Ce,be,xe,ze),G=G||this.isInsideGrid(Ce,be,xe,ze),e!=="always"&&this.grid.hitTestCircle(ae,Ae,re,e,$)&&(q=!0,!L))return{circles:[],offscreen:!1,collisionDetected:q}}}}return{circles:!L&&q||!G||x<this.perspectiveRatioCutoff?[]:A,offscreen:O,collisionDetected:q}}projectPathToScreenSpace(e,n,a){return e.map(o=>ge(o.x,o.y,a,n.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let a=1/0,o=1/0,h=-1/0,_=-1/0;for(const L of e){const F=new c.P(L.x+Zt,L.y+Zt);a=Math.min(a,F.x),o=Math.min(o,F.y),h=Math.max(h,F.x),_=Math.max(_,F.y),n.push(F)}const w=this.grid.query(a,o,h,_).concat(this.ignoredGrid.query(a,o,h,_)),B={},M={};for(const L of w){const F=L.key;if(B[F.bucketInstanceId]===void 0&&(B[F.bucketInstanceId]={}),B[F.bucketInstanceId][F.featureIndex])continue;const $=[new c.P(L.x1,L.y1),new c.P(L.x2,L.y1),new c.P(L.x2,L.y2),new c.P(L.x1,L.y2)];c.am(n,$)&&(B[F.bucketInstanceId][F.featureIndex]=!0,M[F.bucketInstanceId]===void 0&&(M[F.bucketInstanceId]=[]),M[F.bucketInstanceId].push(F.featureIndex))}return M}insertCollisionBox(e,n,a,o,h,_){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:o,featureIndex:h,collisionGroupID:_,overlapMode:n},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,n,a,o,h,_){const w=a?this.ignoredGrid:this.grid,B={bucketInstanceId:o,featureIndex:h,collisionGroupID:_,overlapMode:n};for(let M=0;M<e.length;M+=4)w.insertCircle(B,e[M],e[M+1],e[M+2])}projectAndGetPerspectiveRatio(e,n,a,o,h){let _;h?(_=[n,a,h(n,a),1],c.af(_,_,e)):(_=[n,a,0,1],ui(_,_,e));const w=_[3];return{point:new c.P((_[0]/w+1)/2*this.transform.width+Zt,(-_[1]/w+1)/2*this.transform.height+Zt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/w*.5,isOccluded:!1,signedDistanceFromCamera:w}}getPerspectiveRatio(e,n,a,o,h){const _=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(n,a,o,h):ge(n,a,e,h);return .5+this.transform.cameraToCenterDistance/_.signedDistanceFromCamera*.5}isOffscreen(e,n,a,o){return a<Zt||e>=this.screenRightBoundary||o<Zt||n>this.screenBottomBoundary}isInsideGrid(e,n,a,o){return a>=0&&e<this.gridRightBoundary&&o>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const e=c.an([]);return c.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,n,a,o,h,_,w,B,M,L){let F=new c.P(1,0),$=new c.P(0,1);const te=new c.P(e.anchorPointX+w[0],e.anchorPointY+w[1]);if(_&&!h){const O=this.projectAndGetPerspectiveRatio(a,te.x+1,te.y,o,M).point.sub(B.point).unit(),re=Math.atan(O.y/O.x)+(O.x<0?Math.PI:0),K=Math.sin(re),U=Math.cos(re);F=new c.P(U,K),$=new c.P(-K,U)}else if(!_&&h){const O=-this.transform.angle,re=Math.sin(O),K=Math.cos(O);F=new c.P(K,re),$=new c.P(-re,K)}let oe=B.point,p=n;if(h){oe=te;const O=this.transform.zoom-Math.floor(this.transform.zoom);p=Math.pow(2,-O),p*=this.mapProjection.getPitchedTextCorrection(this.transform,te,o),L||(p*=c.ac(.5+B.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}L&&(oe=oe.add(F.mult(L.x*p)).add($.mult(L.y*p)));const g=e.x1*p,A=e.x2*p,v=(g+A)/2,x=e.y1*p,Q=e.y2*p,T=(x+Q)/2,k=[{offsetX:g,offsetY:x},{offsetX:v,offsetY:x},{offsetX:A,offsetY:x},{offsetX:A,offsetY:T},{offsetX:A,offsetY:Q},{offsetX:v,offsetY:Q},{offsetX:g,offsetY:Q},{offsetX:g,offsetY:T}];let q=[];for(const{offsetX:O,offsetY:re}of k)q.push(new c.P(oe.x+F.x*O+$.x*re,oe.y+F.y*O+$.y*re));let G=!1;if(h){const O=q.map(re=>this.projectAndGetPerspectiveRatio(a,re.x,re.y,o,M));G=O.some(re=>!re.isOccluded),q=O.map(re=>re.point)}else G=!0;return{box:c.ao(q),allPointsOccluded:!G}}}function ai(u,e,n){return e*(c.X/(u.tileSize*Math.pow(2,n-u.tileID.overscaledZ)))}class sr{constructor(e,n,a,o){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?n:-n))):o&&a?1:0,this.placed=a}isHidden(){return this.opacity===0&&!this.placed}}class Ki{constructor(e,n,a,o,h){this.text=new sr(e?e.text:null,n,a,h),this.icon=new sr(e?e.icon:null,n,o,h)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ii{constructor(e,n,a){this.text=e,this.icon=n,this.skipFade=a}}class xi{constructor(){this.invProjMatrix=c.H(),this.viewportMatrix=c.H(),this.circles=[]}}class Ui{constructor(e,n,a,o,h){this.bucketInstanceId=e,this.featureIndex=n,this.sourceLayerIndex=a,this.bucketIndex=o,this.tileID=h}}class ar{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const n=++this.maxGroupID;this.collisionGroups[e]={ID:n,predicate:a=>a.collisionGroupID===n}}return this.collisionGroups[e]}}function Ar(u,e,n,a,o){const{horizontalAlign:h,verticalAlign:_}=c.au(u);return new c.P(-(h-.5)*e+a[0]*o,-(_-.5)*n+a[1]*o)}class dr{constructor(e,n,a,o,h,_){this.transform=e.clone(),this.terrain=a,this.collisionIndex=new fi(this.transform,n),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new ar(h),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const n=this.terrain;return n?(a,o)=>n.getElevation(e,a,o):null}getBucketParts(e,n,a,o){const h=a.getBucket(n),_=a.latestFeatureIndex;if(!h||!_||n.id!==h.layerIds[0])return;const w=a.collisionBoxArray,B=h.layers[0].layout,M=h.layers[0].paint,L=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),F=a.tileSize/c.X,$=a.tileID.toUnwrapped(),te=this.transform.calculatePosMatrix($),oe=B.get("text-pitch-alignment")==="map",p=B.get("text-rotation-alignment")==="map",g=ai(a,1,this.transform.zoom),A=this.collisionIndex.mapProjection.translatePosition(this.transform,a,M.get("text-translate"),M.get("text-translate-anchor")),v=this.collisionIndex.mapProjection.translatePosition(this.transform,a,M.get("icon-translate"),M.get("icon-translate-anchor")),x=Nn(te,oe,p,this.transform,g);let Q=null;if(oe){const k=fn(te,oe,p,this.transform,g);Q=c.L([],this.transform.labelPlaneMatrix,k)}this.retainedQueryData[h.bucketInstanceId]=new Ui(h.bucketInstanceId,_,h.sourceLayerIndex,h.index,a.tileID);const T={bucket:h,layout:B,translationText:A,translationIcon:v,posMatrix:te,unwrappedTileID:$,textLabelPlaneMatrix:x,labelToScreenMatrix:Q,scale:L,textPixelRatio:F,holdingForFade:a.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:c.ag(h.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(h.sourceID)};if(o)for(const k of h.sortKeyRanges){const{sortKey:q,symbolInstanceStart:G,symbolInstanceEnd:O}=k;e.push({sortKey:q,symbolInstanceStart:G,symbolInstanceEnd:O,parameters:T})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:h.symbolInstances.length,parameters:T})}attemptAnchorPlacement(e,n,a,o,h,_,w,B,M,L,F,$,te,oe,p,g,A,v,x){const Q=c.aq[e.textAnchor],T=[e.textOffset0,e.textOffset1],k=Ar(Q,a,o,T,h),q=this.collisionIndex.placeCollisionBox(n,$,B,M,L,w,_,g,F.predicate,x,k);if((!v||this.collisionIndex.placeCollisionBox(v,$,B,M,L,w,_,A,F.predicate,x,k).placeable)&&q.placeable){let G;if(this.prevPlacement&&this.prevPlacement.variableOffsets[te.crossTileID]&&this.prevPlacement.placements[te.crossTileID]&&this.prevPlacement.placements[te.crossTileID].text&&(G=this.prevPlacement.variableOffsets[te.crossTileID].anchor),te.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[te.crossTileID]={textOffset:T,width:a,height:o,anchor:Q,textBoxScale:h,prevAnchor:G},this.markUsedJustification(oe,Q,te,p),oe.allowVerticalPlacement&&(this.markUsedOrientation(oe,p,te),this.placedOrientations[te.crossTileID]=p),{shift:k,placedGlyphBoxes:q}}}placeLayerBucketPart(e,n,a){const{bucket:o,layout:h,translationText:_,translationIcon:w,posMatrix:B,unwrappedTileID:M,textLabelPlaneMatrix:L,labelToScreenMatrix:F,textPixelRatio:$,holdingForFade:te,collisionBoxArray:oe,partiallyEvaluatedTextSize:p,collisionGroup:g}=e.parameters,A=h.get("text-optional"),v=h.get("icon-optional"),x=c.ar(h,"text-overlap","text-allow-overlap"),Q=x==="always",T=c.ar(h,"icon-overlap","icon-allow-overlap"),k=T==="always",q=h.get("text-rotation-alignment")==="map",G=h.get("text-pitch-alignment")==="map",O=h.get("icon-text-fit")!=="none",re=h.get("symbol-z-order")==="viewport-y",K=Q&&(k||!o.hasIconData()||v),U=k&&(Q||!o.hasTextData()||A);!o.collisionArrays&&oe&&o.deserializeCollisionBoxes(oe);const ne=this._getTerrainElevationFunc(this.retainedQueryData[o.bucketInstanceId].tileID),le=(se,ue,Ie)=>{var pe,Be;if(n[se.crossTileID])return;if(te)return void(this.placements[se.crossTileID]=new ii(!1,!1,!1));let Y=!1,z=!1,ce=!0,ie=null,ae={box:null,placeable:!1,offscreen:null},Ae={placeable:!1},Ce=null,be=null,xe=null,ze=0,qe=0,Ve=0;ue.textFeatureIndex?ze=ue.textFeatureIndex:se.useRuntimeCollisionCircles&&(ze=se.featureIndex),ue.verticalTextFeatureIndex&&(qe=ue.verticalTextFeatureIndex);const Ke=ue.textBox;if(Ke){const Ye=st=>{let yt=c.ah.horizontal;if(o.allowVerticalPlacement&&!st&&this.prevPlacement){const gt=this.prevPlacement.placedOrientations[se.crossTileID];gt&&(this.placedOrientations[se.crossTileID]=gt,yt=gt,this.markUsedOrientation(o,yt,se))}return yt},vt=(st,yt)=>{if(o.allowVerticalPlacement&&se.numVerticalGlyphVertices>0&&ue.verticalTextBox){for(const gt of o.writingModes)if(gt===c.ah.vertical?(ae=yt(),Ae=ae):ae=st(),ae&&ae.placeable)break}else ae=st()},ot=se.textAnchorOffsetStartIndex,Ct=se.textAnchorOffsetEndIndex;if(Ct===ot){const st=(yt,gt)=>{const nt=this.collisionIndex.placeCollisionBox(yt,x,$,B,M,G,q,_,g.predicate,ne);return nt&&nt.placeable&&(this.markUsedOrientation(o,gt,se),this.placedOrientations[se.crossTileID]=gt),nt};vt(()=>st(Ke,c.ah.horizontal),()=>{const yt=ue.verticalTextBox;return o.allowVerticalPlacement&&se.numVerticalGlyphVertices>0&&yt?st(yt,c.ah.vertical):{box:null,offscreen:null}}),Ye(ae&&ae.placeable)}else{let st=c.aq[(Be=(pe=this.prevPlacement)===null||pe===void 0?void 0:pe.variableOffsets[se.crossTileID])===null||Be===void 0?void 0:Be.anchor];const yt=(nt,_t,ci)=>{const $t=nt.x2-nt.x1,Ai=nt.y2-nt.y1,di=se.textBoxScale,$r=O&&T==="never"?_t:null;let wr=null,Is=x==="never"?1:2,jt="never";st&&Is++;for(let Xr=0;Xr<Is;Xr++){for(let vn=ot;vn<Ct;vn++){const Wa=o.textAnchorOffsets.get(vn);if(st&&Wa.textAnchor!==st)continue;const Wn=this.attemptAnchorPlacement(Wa,nt,$t,Ai,di,q,G,$,B,M,g,jt,se,o,ci,_,w,$r,ne);if(Wn&&(wr=Wn.placedGlyphBoxes,wr&&wr.placeable))return Y=!0,ie=Wn.shift,wr}st?st=null:jt=x}return a&&!wr&&(wr={box:this.collisionIndex.placeCollisionBox(Ke,"always",$,B,M,G,q,_,g.predicate,ne,new c.P(0,0)).box,offscreen:!1,placeable:!1}),wr};vt(()=>yt(Ke,ue.iconBox,c.ah.horizontal),()=>{const nt=ue.verticalTextBox;return o.allowVerticalPlacement&&(!ae||!ae.placeable)&&se.numVerticalGlyphVertices>0&&nt?yt(nt,ue.verticalIconBox,c.ah.vertical):{box:null,occluded:!0,offscreen:null}}),ae&&(Y=ae.placeable,ce=ae.offscreen);const gt=Ye(ae&&ae.placeable);if(!Y&&this.prevPlacement){const nt=this.prevPlacement.variableOffsets[se.crossTileID];nt&&(this.variableOffsets[se.crossTileID]=nt,this.markUsedJustification(o,nt.anchor,se,gt))}}}if(Ce=ae,Y=Ce&&Ce.placeable,ce=Ce&&Ce.offscreen,se.useRuntimeCollisionCircles){const Ye=o.text.placedSymbolArray.get(se.centerJustifiedTextSymbolIndex),vt=c.ai(o.textSizeData,p,Ye),ot=h.get("text-padding");be=this.collisionIndex.placeCollisionCircles(x,Ye,o.lineVertexArray,o.glyphOffsetArray,vt,B,M,L,F,a,G,g.predicate,se.collisionCircleDiameter,ot,_,ne),be.circles.length&&be.collisionDetected&&!a&&c.w("Collisions detected, but collision boxes are not shown"),Y=Q||be.circles.length>0&&!be.collisionDetected,ce=ce&&be.offscreen}if(ue.iconFeatureIndex&&(Ve=ue.iconFeatureIndex),ue.iconBox){const Ye=vt=>this.collisionIndex.placeCollisionBox(vt,T,$,B,M,G,q,w,g.predicate,ne,O&&ie?ie:void 0);Ae&&Ae.placeable&&ue.verticalIconBox?(xe=Ye(ue.verticalIconBox),z=xe.placeable):(xe=Ye(ue.iconBox),z=xe.placeable),ce=ce&&xe.offscreen}const ct=A||se.numHorizontalGlyphVertices===0&&se.numVerticalGlyphVertices===0,Ue=v||se.numIconVertices===0;ct||Ue?Ue?ct||(z=z&&Y):Y=z&&Y:z=Y=z&&Y;const Pe=z&&xe.placeable;if(Y&&Ce.placeable&&this.collisionIndex.insertCollisionBox(Ce.box,x,h.get("text-ignore-placement"),o.bucketInstanceId,Ae&&Ae.placeable&&qe?qe:ze,g.ID),Pe&&this.collisionIndex.insertCollisionBox(xe.box,T,h.get("icon-ignore-placement"),o.bucketInstanceId,Ve,g.ID),be&&Y&&this.collisionIndex.insertCollisionCircles(be.circles,x,h.get("text-ignore-placement"),o.bucketInstanceId,ze,g.ID),a&&this.storeCollisionData(o.bucketInstanceId,Ie,ue,Ce,xe,be),se.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(o.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[se.crossTileID]=new ii(Y||K,z||U,ce||o.justReloaded),n[se.crossTileID]=!0};if(re){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const se=o.getSortedSymbolIndexes(this.transform.angle);for(let ue=se.length-1;ue>=0;--ue){const Ie=se[ue];le(o.symbolInstances.get(Ie),o.collisionArrays[Ie],Ie)}}else for(let se=e.symbolInstanceStart;se<e.symbolInstanceEnd;se++)le(o.symbolInstances.get(se),o.collisionArrays[se],se);if(a&&o.bucketInstanceId in this.collisionCircleArrays){const se=this.collisionCircleArrays[o.bucketInstanceId];c.as(se.invProjMatrix,B),se.viewportMatrix=this.collisionIndex.getViewportMatrix()}o.justReloaded=!1}storeCollisionData(e,n,a,o,h,_){if(a.textBox||a.iconBox){let w,B;this.collisionBoxArrays.has(e)?w=this.collisionBoxArrays.get(e):(w=new Map,this.collisionBoxArrays.set(e,w)),w.has(n)?B=w.get(n):(B={text:null,icon:null},w.set(n,B)),a.textBox&&(B.text=o.box),a.iconBox&&(B.icon=h.box)}if(_){let w=this.collisionCircleArrays[e];w===void 0&&(w=this.collisionCircleArrays[e]=new xi);for(let B=0;B<_.circles.length;B+=4)w.circles.push(_.circles[B+0]),w.circles.push(_.circles[B+1]),w.circles.push(_.circles[B+2]),w.circles.push(_.collisionDetected?1:0)}}markUsedJustification(e,n,a,o){let h;h=o===c.ah.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[c.at(n)];const _=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];for(const w of _)w>=0&&(e.text.placedSymbolArray.get(w).crossTileID=h>=0&&w!==h?0:a.crossTileID)}markUsedOrientation(e,n,a){const o=n===c.ah.horizontal||n===c.ah.horizontalOnly?n:0,h=n===c.ah.vertical?n:0,_=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];for(const w of _)e.text.placedSymbolArray.get(w).placedOrientation=o;a.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=h)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let a=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const o=n?n.symbolFadeChange(e):1,h=n?n.opacities:{},_=n?n.variableOffsets:{},w=n?n.placedOrientations:{};for(const B in this.placements){const M=this.placements[B],L=h[B];L?(this.opacities[B]=new Ki(L,o,M.text,M.icon),a=a||M.text!==L.text.placed||M.icon!==L.icon.placed):(this.opacities[B]=new Ki(null,o,M.text,M.icon,M.skipFade),a=a||M.text||M.icon)}for(const B in h){const M=h[B];if(!this.opacities[B]){const L=new Ki(M,o,!1,!1);L.isHidden()||(this.opacities[B]=L,a=a||M.text.placed||M.icon.placed)}}for(const B in _)this.variableOffsets[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.variableOffsets[B]=_[B]);for(const B in w)this.placedOrientations[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.placedOrientations[B]=w[B]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");a?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:e)}updateLayerOpacities(e,n){const a={};for(const o of n){const h=o.getBucket(e);h&&o.latestFeatureIndex&&e.id===h.layerIds[0]&&this.updateBucketOpacities(h,o.tileID,a,o.collisionBoxArray)}}updateBucketOpacities(e,n,a,o){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const h=e.layers[0],_=h.layout,w=new Ki(null,0,!1,!1,!0),B=_.get("text-allow-overlap"),M=_.get("icon-allow-overlap"),L=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),F=_.get("text-rotation-alignment")==="map",$=_.get("text-pitch-alignment")==="map",te=_.get("icon-text-fit")!=="none",oe=new Ki(null,0,B&&(M||!e.hasIconData()||_.get("icon-optional")),M&&(B||!e.hasTextData()||_.get("text-optional")),!0);!e.collisionArrays&&o&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(o);const p=(A,v,x)=>{for(let Q=0;Q<v/4;Q++)A.opacityVertexArray.emplaceBack(x);A.hasVisibleVertices=A.hasVisibleVertices||x!==sa},g=this.collisionBoxArrays.get(e.bucketInstanceId);for(let A=0;A<e.symbolInstances.length;A++){const v=e.symbolInstances.get(A),{numHorizontalGlyphVertices:x,numVerticalGlyphVertices:Q,crossTileID:T}=v;let k=this.opacities[T];a[T]?k=w:k||(k=oe,this.opacities[T]=k),a[T]=!0;const q=v.numIconVertices>0,G=this.placedOrientations[v.crossTileID],O=G===c.ah.vertical,re=G===c.ah.horizontal||G===c.ah.horizontalOnly;if(x>0||Q>0){const U=Hr(k.text);p(e.text,x,O?sa:U),p(e.text,Q,re?sa:U);const ne=k.text.isHidden();[v.rightJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.leftJustifiedTextSymbolIndex].forEach(ue=>{ue>=0&&(e.text.placedSymbolArray.get(ue).hidden=ne||O?1:0)}),v.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(v.verticalPlacedTextSymbolIndex).hidden=ne||re?1:0);const le=this.variableOffsets[v.crossTileID];le&&this.markUsedJustification(e,le.anchor,v,G);const se=this.placedOrientations[v.crossTileID];se&&(this.markUsedJustification(e,"left",v,se),this.markUsedOrientation(e,se,v))}if(q){const U=Hr(k.icon),ne=!(te&&v.verticalPlacedIconSymbolIndex&&O);v.placedIconSymbolIndex>=0&&(p(e.icon,v.numIconVertices,ne?U:sa),e.icon.placedSymbolArray.get(v.placedIconSymbolIndex).hidden=k.icon.isHidden()),v.verticalPlacedIconSymbolIndex>=0&&(p(e.icon,v.numVerticalIconVertices,ne?sa:U),e.icon.placedSymbolArray.get(v.verticalPlacedIconSymbolIndex).hidden=k.icon.isHidden())}const K=g&&g.has(A)?g.get(A):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const U=e.collisionArrays[A];if(U){let ne=new c.P(0,0);if(U.textBox||U.verticalTextBox){let le=!0;if(L){const se=this.variableOffsets[T];se?(ne=Ar(se.anchor,se.width,se.height,se.textOffset,se.textBoxScale),F&&ne._rotate($?this.transform.angle:-this.transform.angle)):le=!1}if(U.textBox||U.verticalTextBox){let se;U.textBox&&(se=O),U.verticalTextBox&&(se=re),gn(e.textCollisionBox.collisionVertexArray,k.text.placed,!le||se,K.text,ne.x,ne.y)}}if(U.iconBox||U.verticalIconBox){const le=!!(!re&&U.verticalIconBox);let se;U.iconBox&&(se=le),U.verticalIconBox&&(se=!le),gn(e.iconCollisionBox.collisionVertexArray,k.icon.placed,se,K.icon,te?ne.x:0,te?ne.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const A=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=A.invProjMatrix,e.placementViewportMatrix=A.viewportMatrix,e.collisionCircleArray=A.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,n){const a=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*a>e}setStale(){this.stale=!0}}function gn(u,e,n,a,o,h){a&&a.length!==0||(a=[0,0,0,0]);const _=a[0]-Zt,w=a[1]-Zt,B=a[2]-Zt,M=a[3]-Zt;u.emplaceBack(e?1:0,n?1:0,o||0,h||0,_,w),u.emplaceBack(e?1:0,n?1:0,o||0,h||0,B,w),u.emplaceBack(e?1:0,n?1:0,o||0,h||0,B,M),u.emplaceBack(e?1:0,n?1:0,o||0,h||0,_,M)}const Bi=Math.pow(2,25),Yo=Math.pow(2,24),Ko=Math.pow(2,17),Tr=Math.pow(2,16),Vr=Math.pow(2,9),Zo=Math.pow(2,8),Pr=Math.pow(2,1);function Hr(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const e=u.placed?1:0,n=Math.floor(127*u.opacity);return n*Bi+e*Yo+n*Ko+e*Tr+n*Vr+e*Zo+n*Pr+e}const sa=0;function ks(){return{isOccluded:(u,e,n)=>!1,getPitchedTextCorrection:(u,e,n)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(u,e,n,a){throw new Error("Not implemented.")},translatePosition:(u,e,n,a)=>function(o,h,_,w,B=!1){if(!_[0]&&!_[1])return[0,0];const M=B?w==="map"?o.angle:0:w==="viewport"?-o.angle:0;if(M){const L=Math.sin(M),F=Math.cos(M);_=[_[0]*F-_[1]*L,_[0]*L+_[1]*F]}return[B?_[0]:ai(h,_[0],o.zoom),B?_[1]:ai(h,_[1],o.zoom)]}(u,e,n,a),getCircleRadiusCorrection:u=>1}}class or{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,n,a,o,h){const _=this._bucketParts;for(;this._currentTileIndex<e.length;)if(n.getBucketParts(_,o,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,h())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,_.sort((w,B)=>w.sortKey-B.sortKey));this._currentPartIndex<_.length;)if(n.placeLayerBucketPart(_[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,h())return!0;return!1}}class aa{constructor(e,n,a,o,h,_,w,B){this.placement=new dr(e,ks(),n,_,w,B),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=o,this._showCollisionBoxes=h,this._done=!1}isDone(){return this._done}continuePlacement(e,n,a){const o=Qe.now(),h=()=>!this._forceFullPlacement&&Qe.now()-o>2;for(;this._currentPlacementIndex>=0;){const _=n[e[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(_.type==="symbol"&&(!_.minzoom||_.minzoom<=w)&&(!_.maxzoom||_.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new or(_)),this._inProgressLayer.continuePlacement(a[_.source],this.placement,this._showCollisionBoxes,_,h))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const pn=512/c.X/2;class er{constructor(e,n,a){this.tileID=e,this.bucketInstanceId=a,this._symbolsByKey={};const o=new Map;for(let h=0;h<n.length;h++){const _=n.get(h),w=_.key,B=o.get(w);B?B.push(_):o.set(w,[_])}for(const[h,_]of o){const w={positions:_.map(B=>({x:Math.floor(B.anchorX*pn),y:Math.floor(B.anchorY*pn)})),crossTileIDs:_.map(B=>B.crossTileID)};if(w.positions.length>128){const B=new c.av(w.positions.length,16,Uint16Array);for(const{x:M,y:L}of w.positions)B.add(M,L);B.finish(),delete w.positions,w.index=B}this._symbolsByKey[h]=w}}getScaledCoordinates(e,n){const{x:a,y:o,z:h}=this.tileID.canonical,{x:_,y:w,z:B}=n.canonical,M=pn/Math.pow(2,B-h),L=(w*c.X+e.anchorY)*M,F=o*c.X*pn;return{x:Math.floor((_*c.X+e.anchorX)*M-a*c.X*pn),y:Math.floor(L-F)}}findMatches(e,n,a){const o=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let h=0;h<e.length;h++){const _=e.get(h);if(_.crossTileID)continue;const w=this._symbolsByKey[_.key];if(!w)continue;const B=this.getScaledCoordinates(_,n);if(w.index){const M=w.index.range(B.x-o,B.y-o,B.x+o,B.y+o).sort();for(const L of M){const F=w.crossTileIDs[L];if(!a[F]){a[F]=!0,_.crossTileID=F;break}}}else if(w.positions)for(let M=0;M<w.positions.length;M++){const L=w.positions[M],F=w.crossTileIDs[M];if(Math.abs(L.x-B.x)<=o&&Math.abs(L.y-B.y)<=o&&!a[F]){a[F]=!0,_.crossTileID=F;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class oa{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class jr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const n=Math.round((e-this.lng)/360);if(n!==0)for(const a in this.indexes){const o=this.indexes[a],h={};for(const _ in o){const w=o[_];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+n),h[w.tileID.key]=w}this.indexes[a]=h}this.lng=e}addBucket(e,n,a){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let h=0;h<n.symbolInstances.length;h++)n.symbolInstances.get(h).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const o=this.usedCrossTileIDs[e.overscaledZ];for(const h in this.indexes){const _=this.indexes[h];if(Number(h)>e.overscaledZ)for(const w in _){const B=_[w];B.tileID.isChildOf(e)&&B.findMatches(n.symbolInstances,e,o)}else{const w=_[e.scaledTo(Number(h)).key];w&&w.findMatches(n.symbolInstances,e,o)}}for(let h=0;h<n.symbolInstances.length;h++){const _=n.symbolInstances.get(h);_.crossTileID||(_.crossTileID=a.generate(),o[_.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new er(e,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(e,n){for(const a of n.getCrossTileIDsLists())for(const o of a)delete this.usedCrossTileIDs[e][o]}removeStaleBuckets(e){let n=!1;for(const a in this.indexes){const o=this.indexes[a];for(const h in o)e[o[h].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,o[h]),delete o[h],n=!0)}return n}}class $o{constructor(){this.layerIndexes={},this.crossTileIDs=new oa,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,n,a){let o=this.layerIndexes[e.id];o===void 0&&(o=this.layerIndexes[e.id]=new jr);let h=!1;const _={};o.handleWrapJump(a);for(const w of n){const B=w.getBucket(e);B&&e.id===B.layerIds[0]&&(B.bucketInstanceId||(B.bucketInstanceId=++this.maxBucketInstanceId),o.addBucket(w.tileID,B,this.crossTileIDs)&&(h=!0),_[B.bucketInstanceId]=!0)}return o.removeStaleBuckets(_)&&(h=!0),h}pruneUnusedLayers(e){const n={};e.forEach(a=>{n[a]=!0});for(const a in this.layerIndexes)n[a]||delete this.layerIndexes[a]}}const mn=(u,e)=>c.t(u,e&&e.filter(n=>n.identifier!=="source.canvas")),uc=c.aw();class Dn extends c.E{constructor(e,n={}){super(),this._rtlPluginLoaded=()=>{for(const a in this.sourceCaches){const o=this.sourceCaches[a].getSource().type;o!=="vector"&&o!=="geojson"||this.sourceCaches[a].reload()}},this.map=e,this.dispatcher=new yr(pi(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(a,o)=>this.getGlyphs(a,o)),this.dispatcher.registerMessageHandler("GI",(a,o)=>this.getImages(a,o)),this.imageManager=new mi,this.imageManager.setEventedParent(this),this.glyphManager=new ni(e._requestManager,n.localIdeographFontFamily),this.lineAtlas=new ur(256,512),this.crossTileSymbolIndex=new $o,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",c.ay()),Qn().on(lt,this._rtlPluginLoaded),this.on("data",a=>{if(a.dataType!=="source"||a.sourceDataType!=="metadata")return;const o=this.sourceCaches[a.sourceId];if(!o)return;const h=o.getSource();if(h&&h.vectorLayerIds)for(const _ in this._layers){const w=this._layers[_];w.source===h.id&&this._validateLayer(w)}})}loadURL(e,n={},a){this.fire(new c.k("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;const o=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const h=this._loadStyleRequest;c.h(o,this._loadStyleRequest).then(_=>{this._loadStyleRequest=null,this._load(_.data,n,a)}).catch(_=>{this._loadStyleRequest=null,_&&!h.signal.aborted&&this.fire(new c.j(_))})}loadJSON(e,n={},a){this.fire(new c.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Qe.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,n.validate=n.validate!==!1,this._load(e,n,a)}).catch(()=>{})}loadEmpty(){this.fire(new c.k("dataloading",{dataType:"style"})),this._load(uc,{validate:!1})}_load(e,n,a){var o;const h=n.transformStyle?n.transformStyle(a,e):e;if(!n.validate||!mn(this,c.u(h))){this._loaded=!0,this.stylesheet=h;for(const _ in h.sources)this.addSource(_,h.sources[_],{validate:!1});h.sprite?this._loadSprite(h.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(h.glyphs),this._createLayers(),this.light=new Si(this.stylesheet.light),this.sky=new $i(this.stylesheet.sky),this.map.setTerrain((o=this.stylesheet.terrain)!==null&&o!==void 0?o:null),this.fire(new c.k("data",{dataType:"style"})),this.fire(new c.k("style.load"))}}_createLayers(){const e=c.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(n=>n.id),this._layers={},this._serializedLayers=null;for(const n of e){const a=c.aA(n);a.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=a}}_loadSprite(e,n=!1,a=void 0){let o;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(h,_,w,B){return c._(this,void 0,void 0,function*(){const M=Nt(h),L=w>1?"@2x":"",F={},$={};for(const{id:te,url:oe}of M){const p=_.transformRequest(Gt(oe,L,".json"),"SpriteJSON");F[te]=c.h(p,B);const g=_.transformRequest(Gt(oe,L,".png"),"SpriteImage");$[te]=Xe.getImage(g,B)}return yield Promise.all([...Object.values(F),...Object.values($)]),function(te,oe){return c._(this,void 0,void 0,function*(){const p={};for(const g in te){p[g]={};const A=Qe.getImageCanvasContext((yield oe[g]).data),v=(yield te[g]).data;for(const x in v){const{width:Q,height:T,x:k,y:q,sdf:G,pixelRatio:O,stretchX:re,stretchY:K,content:U,textFitWidth:ne,textFitHeight:le}=v[x];p[g][x]={data:null,pixelRatio:O,sdf:G,stretchX:re,stretchY:K,content:U,textFitWidth:ne,textFitHeight:le,spriteData:{width:Q,height:T,x:k,y:q,context:A}}}}return p})}(F,$)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(h=>{if(this._spriteRequest=null,h)for(const _ in h){this._spritesImagesIds[_]=[];const w=this._spritesImagesIds[_]?this._spritesImagesIds[_].filter(B=>!(B in h)):[];for(const B of w)this.imageManager.removeImage(B),this._changedImages[B]=!0;for(const B in h[_]){const M=_==="default"?B:`${_}:${B}`;this._spritesImagesIds[_].push(M),M in this.imageManager.images?this.imageManager.updateImage(M,h[_][B],!1):this.imageManager.addImage(M,h[_][B]),n&&(this._changedImages[M]=!0)}}}).catch(h=>{this._spriteRequest=null,o=h,this.fire(new c.j(o))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"})),a&&a(o)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}_validateLayer(e){const n=this.sourceCaches[e.source];if(!n)return;const a=e.sourceLayer;if(!a)return;const o=n.getSource();(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(a)===-1)&&this.fire(new c.j(new Error(`Source layer "${a}" does not exist on source "${o.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,n=!1){const a=this._serializedAllLayers();if(!e||e.length===0)return Object.values(n?c.aB(a):a);const o=[];for(const h of e)if(a[h]){const _=n?c.aB(a[h]):a[h];o.push(_)}return o}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const n=Object.keys(this._layers);for(const a of n){const o=this._layers[a];o.type!=="custom"&&(e[a]=o.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const n=this._changed;if(n){const o=Object.keys(this._updatedLayers),h=Object.keys(this._removedLayers);(o.length||h.length)&&this._updateWorkerLayers(o,h);for(const _ in this._updatedSources){const w=this._updatedSources[_];if(w==="reload")this._reloadSource(_);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(_)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const _ in this._updatedPaintProps)this._layers[_].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const a={};for(const o in this.sourceCaches){const h=this.sourceCaches[o];a[o]=h.used,h.used=!1}for(const o of this._order){const h=this._layers[o];h.recalculate(e,this._availableImages),!h.isHidden(e.zoom)&&h.source&&(this.sourceCaches[h.source].used=!0)}for(const o in a){const h=this.sourceCaches[o];!!a[o]!=!!h.used&&h.fire(new c.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:o}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,n&&this.fire(new c.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,n){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,n={}){var a;this._checkLoaded();const o=this.serialize();if(e=n.transformStyle?n.transformStyle(o,e):e,((a=n.validate)===null||a===void 0||a)&&mn(this,c.u(e)))return!1;(e=c.aB(e)).layers=c.az(e.layers);const h=c.aC(o,e),_=this._getOperationsToPerform(h);if(_.unimplemented.length>0)throw new Error(`Unimplemented: ${_.unimplemented.join(", ")}.`);if(_.operations.length===0)return!1;for(const w of _.operations)w();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const n=[],a=[];for(const o of e)switch(o.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":n.push(()=>this.addLayer.apply(this,o.args));break;case"removeLayer":n.push(()=>this.removeLayer.apply(this,o.args));break;case"setPaintProperty":n.push(()=>this.setPaintProperty.apply(this,o.args));break;case"setLayoutProperty":n.push(()=>this.setLayoutProperty.apply(this,o.args));break;case"setFilter":n.push(()=>this.setFilter.apply(this,o.args));break;case"addSource":n.push(()=>this.addSource.apply(this,o.args));break;case"removeSource":n.push(()=>this.removeSource.apply(this,o.args));break;case"setLayerZoomRange":n.push(()=>this.setLayerZoomRange.apply(this,o.args));break;case"setLight":n.push(()=>this.setLight.apply(this,o.args));break;case"setGeoJSONSourceData":n.push(()=>this.setGeoJSONSourceData.apply(this,o.args));break;case"setGlyphs":n.push(()=>this.setGlyphs.apply(this,o.args));break;case"setSprite":n.push(()=>this.setSprite.apply(this,o.args));break;case"setSky":n.push(()=>this.setSky.apply(this,o.args));break;case"setTerrain":n.push(()=>this.map.setTerrain.apply(this,o.args));break;case"setTransition":n.push(()=>{});break;default:a.push(o.command)}return{operations:n,unimplemented:a}}addImage(e,n){if(this.getImage(e))return this.fire(new c.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,n),this._afterImageUpdated(e)}updateImage(e,n){this.imageManager.updateImage(e,n)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new c.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,n,a={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(c.u.source,`sources.${e}`,n,null,a))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const o=this.sourceCaches[e]=new Vt(e,n,this.dispatcher);o.style=this,o.setEventedParent(this,()=>({isSourceLoaded:o.loaded(),source:o.serialize(),sourceId:e})),o.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===e)return this.fire(new c.j(new Error(`Source "${e}" cannot be removed while layer "${a}" is using it.`)));const n=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],n.fire(new c.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,n){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const a=this.sourceCaches[e].getSource();if(a.type!=="geojson")throw new Error(`geojsonSource.type is ${a.type}, which is !== 'geojson`);a.setData(n),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,n,a={}){this._checkLoaded();const o=e.id;if(this.getLayer(o))return void this.fire(new c.j(new Error(`Layer "${o}" already exists on this map.`)));let h;if(e.type==="custom"){if(mn(this,c.aD(e)))return;h=c.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(o,e.source),e=c.aB(e),e=c.e(e,{source:o})),this._validate(c.u.layer,`layers.${o}`,e,{arrayIndex:-1},a))return;h=c.aA(e),this._validateLayer(h),h.setEventedParent(this,{layer:{id:o}})}const _=n?this._order.indexOf(n):this._order.length;if(n&&_===-1)this.fire(new c.j(new Error(`Cannot add layer "${o}" before non-existing layer "${n}".`)));else{if(this._order.splice(_,0,o),this._layerOrderChanged=!0,this._layers[o]=h,this._removedLayers[o]&&h.source&&h.type!=="custom"){const w=this._removedLayers[o];delete this._removedLayers[o],w.type!==h.type?this._updatedSources[h.source]="clear":(this._updatedSources[h.source]="reload",this.sourceCaches[h.source].pause())}this._updateLayer(h),h.onAdd&&h.onAdd(this.map)}}moveLayer(e,n){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new c.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===n)return;const a=this._order.indexOf(e);this._order.splice(a,1);const o=n?this._order.indexOf(n):this._order.length;n&&o===-1?this.fire(new c.j(new Error(`Cannot move layer "${e}" before non-existing layer "${n}".`))):(this._order.splice(o,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const n=this._layers[e];if(!n)return void this.fire(new c.j(new Error(`Cannot remove non-existing layer "${e}".`)));n.setEventedParent(null);const a=this._order.indexOf(e);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,n,a){this._checkLoaded();const o=this.getLayer(e);o?o.minzoom===n&&o.maxzoom===a||(n!=null&&(o.minzoom=n),a!=null&&(o.maxzoom=a),this._updateLayer(o)):this.fire(new c.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,n,a={}){this._checkLoaded();const o=this.getLayer(e);if(o){if(!c.aE(o.filter,n))return n==null?(o.filter=void 0,void this._updateLayer(o)):void(this._validate(c.u.filter,`layers.${o.id}.filter`,n,null,a)||(o.filter=c.aB(n),this._updateLayer(o)))}else this.fire(new c.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return c.aB(this.getLayer(e).filter)}setLayoutProperty(e,n,a,o={}){this._checkLoaded();const h=this.getLayer(e);h?c.aE(h.getLayoutProperty(n),a)||(h.setLayoutProperty(n,a,o),this._updateLayer(h)):this.fire(new c.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,n){const a=this.getLayer(e);if(a)return a.getLayoutProperty(n);this.fire(new c.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,n,a,o={}){this._checkLoaded();const h=this.getLayer(e);h?c.aE(h.getPaintProperty(n),a)||(h.setPaintProperty(n,a,o)&&this._updateLayer(h),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new c.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,n){return this.getLayer(e).getPaintProperty(n)}setFeatureState(e,n){this._checkLoaded();const a=e.source,o=e.sourceLayer,h=this.sourceCaches[a];if(h===void 0)return void this.fire(new c.j(new Error(`The source '${a}' does not exist in the map's style.`)));const _=h.getSource().type;_==="geojson"&&o?this.fire(new c.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):_!=="vector"||o?(e.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),h.setFeatureState(o,e.id,n)):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,n){this._checkLoaded();const a=e.source,o=this.sourceCaches[a];if(o===void 0)return void this.fire(new c.j(new Error(`The source '${a}' does not exist in the map's style.`)));const h=o.getSource().type,_=h==="vector"?e.sourceLayer:void 0;h!=="vector"||_?n&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new c.j(new Error("A feature id is required to remove its specific state property."))):o.removeFeatureState(_,e.id,n):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const n=e.source,a=e.sourceLayer,o=this.sourceCaches[n];if(o!==void 0)return o.getSource().type!=="vector"||a?(e.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),o.getFeatureState(a,e.id)):void this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.j(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=c.aF(this.sourceCaches,h=>h.serialize()),n=this._serializeByIds(this._order,!0),a=this.map.getTerrain()||void 0,o=this.stylesheet;return c.aG({version:o.version,name:o.name,metadata:o.metadata,light:o.light,sky:o.sky,center:o.center,zoom:o.zoom,bearing:o.bearing,pitch:o.pitch,sprite:o.sprite,glyphs:o.glyphs,transition:o.transition,sources:e,layers:n,terrain:a},h=>h!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const n=_=>this._layers[_].type==="fill-extrusion",a={},o=[];for(let _=this._order.length-1;_>=0;_--){const w=this._order[_];if(n(w)){a[w]=_;for(const B of e){const M=B[w];if(M)for(const L of M)o.push(L)}}}o.sort((_,w)=>w.intersectionZ-_.intersectionZ);const h=[];for(let _=this._order.length-1;_>=0;_--){const w=this._order[_];if(n(w))for(let B=o.length-1;B>=0;B--){const M=o[B].feature;if(a[M.layer.id]<_)break;h.push(M),o.pop()}else for(const B of e){const M=B[w];if(M)for(const L of M)h.push(L.feature)}}return h}queryRenderedFeatures(e,n,a){n&&n.filter&&this._validate(c.u.filter,"queryRenderedFeatures.filter",n.filter,null,n);const o={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new c.j(new Error("parameters.layers must be an Array."))),[];for(const w of n.layers){const B=this._layers[w];if(!B)return this.fire(new c.j(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];o[B.source]=!0}}const h=[];n.availableImages=this._availableImages;const _=this._serializedAllLayers();for(const w in this.sourceCaches)n.layers&&!o[w]||h.push(Kt(this.sourceCaches[w],this._layers,_,e,n,a));return this.placement&&h.push(function(w,B,M,L,F,$,te){const oe={},p=$.queryRenderedSymbols(L),g=[];for(const A of Object.keys(p).map(Number))g.push(te[A]);g.sort(hi);for(const A of g){const v=A.featureIndex.lookupSymbolFeatures(p[A.bucketInstanceId],B,A.bucketIndex,A.sourceLayerIndex,F.filter,F.layers,F.availableImages,w);for(const x in v){const Q=oe[x]=oe[x]||[],T=v[x];T.sort((k,q)=>{const G=A.featureSortOrder;if(G){const O=G.indexOf(k.featureIndex);return G.indexOf(q.featureIndex)-O}return q.featureIndex-k.featureIndex});for(const k of T)Q.push(k)}}for(const A in oe)oe[A].forEach(v=>{const x=v.feature,Q=M[w[A].source].getFeatureState(x.layer["source-layer"],x.id);x.source=x.layer.source,x.layer["source-layer"]&&(x.sourceLayer=x.layer["source-layer"]),x.state=Q});return oe}(this._layers,_,this.sourceCaches,e,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(h)}querySourceFeatures(e,n){n&&n.filter&&this._validate(c.u.filter,"querySourceFeatures.filter",n.filter,null,n);const a=this.sourceCaches[e];return a?function(o,h){const _=o.getRenderableIds().map(M=>o.getTileByID(M)),w=[],B={};for(let M=0;M<_.length;M++){const L=_[M],F=L.tileID.canonical.key;B[F]||(B[F]=!0,L.querySourceFeatures(w,h))}return w}(a,n):[]}getLight(){return this.light.getLight()}setLight(e,n={}){this._checkLoaded();const a=this.light.getLight();let o=!1;for(const _ in e)if(!c.aE(e[_],a[_])){o=!0;break}if(!o)return;const h={now:Qe.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(h)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,n={}){const a=this.getSky();let o=!1;if(!e&&!a)return;if(e&&!a)o=!0;else if(!e&&a)o=!0;else for(const _ in e)if(!c.aE(e[_],a[_])){o=!0;break}if(!o)return;const h={now:Qe.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,n),this.sky.updateTransitions(h)}_validate(e,n,a,o,h={}){return(!h||h.validate!==!1)&&mn(this,e.call(c.u,c.e({key:n,style:this.serialize(),value:a,styleSpec:c.v},o)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Qn().off(lt,this._rtlPluginLoaded);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this.sourceCaches){const a=this.sourceCaches[n];a.setEventedParent(null),a.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const n in this.sourceCaches)this.sourceCaches[n].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,n,a,o,h=!1){let _=!1,w=!1;const B={};for(const M of this._order){const L=this._layers[M];if(L.type!=="symbol")continue;if(!B[L.source]){const $=this.sourceCaches[L.source];B[L.source]=$.getRenderableIds(!0).map(te=>$.getTileByID(te)).sort((te,oe)=>oe.tileID.overscaledZ-te.tileID.overscaledZ||(te.tileID.isLessThan(oe.tileID)?-1:1))}const F=this.crossTileSymbolIndex.addLayer(L,B[L.source],e.center.lng);_=_||F}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((h=h||this._layerOrderChanged||a===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Qe.now(),e.zoom))&&(this.pauseablePlacement=new aa(e,this.map.terrain,this._order,h,n,a,o,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,B),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Qe.now()),w=!0),_&&this.pauseablePlacement.placement.setStale()),w||_)for(const M of this._order){const L=this._layers[M];L.type==="symbol"&&this.placement.updateLayerOpacities(L,B[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Qe.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,n){return c._(this,void 0,void 0,function*(){const a=yield this.imageManager.getImages(n.icons);this._updateTilesForChangedImages();const o=this.sourceCaches[n.source];return o&&o.setDependencies(n.tileID.key,n.type,n.icons),a})}getGlyphs(e,n){return c._(this,void 0,void 0,function*(){const a=yield this.glyphManager.getGlyphs(n.stacks),o=this.sourceCaches[n.source];return o&&o.setDependencies(n.tileID.key,n.type,[""]),a})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,n={}){this._checkLoaded(),e&&this._validate(c.u.glyphs,"glyphs",e,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,n,a={},o){this._checkLoaded();const h=[{id:e,url:n}],_=[...Nt(this.stylesheet.sprite),...h];this._validate(c.u.sprite,"sprite",_,null,a)||(this.stylesheet.sprite=_,this._loadSprite(h,!0,o))}removeSprite(e){this._checkLoaded();const n=Nt(this.stylesheet.sprite);if(n.find(a=>a.id===e)){if(this._spritesImagesIds[e])for(const a of this._spritesImagesIds[e])this.imageManager.removeImage(a),this._changedImages[a]=!0;n.splice(n.findIndex(a=>a.id===e),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}else this.fire(new c.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Nt(this.stylesheet.sprite)}setSprite(e,n={},a){this._checkLoaded(),e&&this._validate(c.u.sprite,"sprite",e,null,n)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,a):(this._unloadSprite(),a&&a(null)))}}var On=c.Y([{name:"a_pos",type:"Int16",components:2}]);const Jr={prelude:_i(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:_i(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:_i(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:_i(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:_i("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:_i(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:_i(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:_i("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:_i("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:_i("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:_i(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:_i(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:_i(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:_i(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:_i(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:_i(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:_i(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:_i(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:_i(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:_i(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:_i(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:_i(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:_i(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:_i(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:_i(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:_i(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:_i("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:_i("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:_i("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:_i("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function _i(u,e){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=e.match(/attribute ([\w]+) ([\w]+)/g),o=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),h=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=h?h.concat(o):o,w={};return{fragmentSource:u=u.replace(n,(B,M,L,F,$)=>(w[$]=!0,M==="define"?`
#ifndef HAS_UNIFORM_u_${$}
varying ${L} ${F} ${$};
#else
uniform ${L} ${F} u_${$};
#endif
`:`
#ifdef HAS_UNIFORM_u_${$}
    ${L} ${F} ${$} = u_${$};
#endif
`)),vertexSource:e=e.replace(n,(B,M,L,F,$)=>{const te=F==="float"?"vec2":"vec4",oe=$.match(/color/)?"color":te;return w[$]?M==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
attribute ${L} ${te} a_${$};
varying ${L} ${F} ${$};
#else
uniform ${L} ${F} u_${$};
#endif
`:oe==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = a_${$};
#else
    ${L} ${F} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = unpack_mix_${oe}(a_${$}, u_${$}_t);
#else
    ${L} ${F} ${$} = u_${$};
#endif
`:M==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
attribute ${L} ${te} a_${$};
#else
uniform ${L} ${F} u_${$};
#endif
`:oe==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${L} ${F} ${$} = a_${$};
#else
    ${L} ${F} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${L} ${F} ${$} = unpack_mix_${oe}(a_${$}, u_${$}_t);
#else
    ${L} ${F} ${$} = u_${$};
#endif
`}),staticAttributes:a,staticUniforms:_}}class la{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,n,a,o,h,_,w,B,M){this.context=e;let L=this.boundPaintVertexBuffers.length!==o.length;for(let F=0;!L&&F<o.length;F++)this.boundPaintVertexBuffers[F]!==o[F]&&(L=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==a||L||this.boundIndexBuffer!==h||this.boundVertexOffset!==_||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==B||this.boundDynamicVertexBuffer3!==M?this.freshBind(n,a,o,h,_,w,B,M):(e.bindVertexArray.set(this.vao),w&&w.bind(),h&&h.dynamicDraw&&h.bind(),B&&B.bind(),M&&M.bind())}freshBind(e,n,a,o,h,_,w,B){const M=e.numAttributes,L=this.context,F=L.gl;this.vao&&this.destroy(),this.vao=L.createVertexArray(),L.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=o,this.boundVertexOffset=h,this.boundDynamicVertexBuffer=_,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=B,n.enableAttributes(F,e);for(const $ of a)$.enableAttributes(F,e);_&&_.enableAttributes(F,e),w&&w.enableAttributes(F,e),B&&B.enableAttributes(F,e),n.bind(),n.setVertexAttribPointers(F,e,h);for(const $ of a)$.bind(),$.setVertexAttribPointers(F,e,h);_&&(_.bind(),_.setVertexAttribPointers(F,e,h)),o&&o.bind(),w&&(w.bind(),w.setVertexAttribPointers(F,e,h)),B&&(B.bind(),B.setVertexAttribPointers(F,e,h)),L.currentNumAttributes=M}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Xo=(u,e,n,a,o)=>({u_matrix:u,u_texture:0,u_ele_delta:e,u_fog_matrix:n,u_fog_color:a?a.properties.get("fog-color"):c.aM.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:a?a.calculateFogBlendOpacity(o):0,u_horizon_color:a?a.properties.get("horizon-color"):c.aM.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1});function hs(u){const e=[];for(let n=0;n<u.length;n++){if(u[n]===null)continue;const a=u[n].split(" ");e.push(a.pop())}return e}class so{constructor(e,n,a,o,h,_){const w=e.gl;this.program=w.createProgram();const B=hs(n.staticAttributes),M=a?a.getBinderAttributes():[],L=B.concat(M),F=Jr.prelude.staticUniforms?hs(Jr.prelude.staticUniforms):[],$=n.staticUniforms?hs(n.staticUniforms):[],te=a?a.getBinderUniforms():[],oe=F.concat($).concat(te),p=[];for(const k of oe)p.indexOf(k)<0&&p.push(k);const g=a?a.defines():[];h&&g.push("#define OVERDRAW_INSPECTOR;"),_&&g.push("#define TERRAIN3D;");const A=g.concat(Jr.prelude.fragmentSource,n.fragmentSource).join(`
`),v=g.concat(Jr.prelude.vertexSource,n.vertexSource).join(`
`),x=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(x,A),w.compileShader(x),!w.getShaderParameter(x,w.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${w.getShaderInfoLog(x)}`);w.attachShader(this.program,x);const Q=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(Q,v),w.compileShader(Q),!w.getShaderParameter(Q,w.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${w.getShaderInfoLog(Q)}`);w.attachShader(this.program,Q),this.attributes={};const T={};this.numAttributes=L.length;for(let k=0;k<this.numAttributes;k++)L[k]&&(w.bindAttribLocation(this.program,k,L[k]),this.attributes[L[k]]=k);if(w.linkProgram(this.program),!w.getProgramParameter(this.program,w.LINK_STATUS))throw new Error(`Program failed to link: ${w.getProgramInfoLog(this.program)}`);w.deleteShader(Q),w.deleteShader(x);for(let k=0;k<p.length;k++){const q=p[k];if(q&&!T[q]){const G=w.getUniformLocation(this.program,q);G&&(T[q]=G)}}this.fixedUniforms=o(e,T),this.terrainUniforms=((k,q)=>({u_depth:new c.aH(k,q.u_depth),u_terrain:new c.aH(k,q.u_terrain),u_terrain_dim:new c.aI(k,q.u_terrain_dim),u_terrain_matrix:new c.aJ(k,q.u_terrain_matrix),u_terrain_unpack:new c.aK(k,q.u_terrain_unpack),u_terrain_exaggeration:new c.aI(k,q.u_terrain_exaggeration)}))(e,T),this.binderUniforms=a?a.getUniforms(e,T):[]}draw(e,n,a,o,h,_,w,B,M,L,F,$,te,oe,p,g,A,v){const x=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(a),e.setStencilMode(o),e.setColorMode(h),e.setCullFace(_),B){e.activeTexture.set(x.TEXTURE2),x.bindTexture(x.TEXTURE_2D,B.depthTexture),e.activeTexture.set(x.TEXTURE3),x.bindTexture(x.TEXTURE_2D,B.texture);for(const T in this.terrainUniforms)this.terrainUniforms[T].set(B[T])}for(const T in this.fixedUniforms)this.fixedUniforms[T].set(w[T]);p&&p.setUniforms(e,this.binderUniforms,te,{zoom:oe});let Q=0;switch(n){case x.LINES:Q=2;break;case x.TRIANGLES:Q=3;break;case x.LINE_STRIP:Q=1}for(const T of $.get()){const k=T.vaos||(T.vaos={});(k[M]||(k[M]=new la)).bind(e,this,L,p?p.getPaintVertexBuffers():[],F,T.vertexOffset,g,A,v),x.drawElements(n,T.primitiveLength*Q,x.UNSIGNED_SHORT,T.primitiveOffset*Q*2)}}}function yn(u,e,n){const a=1/ai(n,1,e.transform.tileZoom),o=Math.pow(2,n.tileID.overscaledZ),h=n.tileSize*Math.pow(2,e.transform.tileZoom)/o,_=h*(n.tileID.canonical.x+n.tileID.wrap*o),w=h*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[a,u.fromScale,u.toScale],u_fade:u.t,u_pixel_coord_upper:[_>>16,w>>16],u_pixel_coord_lower:[65535&_,65535&w]}}const qn=(u,e,n,a)=>{const o=e.style.light,h=o.properties.get("position"),_=[h.x,h.y,h.z],w=function(){var M=new c.A(9);return c.A!=Float32Array&&(M[1]=0,M[2]=0,M[3]=0,M[5]=0,M[6]=0,M[7]=0),M[0]=1,M[4]=1,M[8]=1,M}();o.properties.get("anchor")==="viewport"&&function(M,L){var F=Math.sin(L),$=Math.cos(L);M[0]=$,M[1]=F,M[2]=0,M[3]=-F,M[4]=$,M[5]=0,M[6]=0,M[7]=0,M[8]=1}(w,-e.transform.angle),function(M,L,F){var $=L[0],te=L[1],oe=L[2];M[0]=$*F[0]+te*F[3]+oe*F[6],M[1]=$*F[1]+te*F[4]+oe*F[7],M[2]=$*F[2]+te*F[5]+oe*F[8]}(_,_,w);const B=o.properties.get("color");return{u_matrix:u,u_lightpos:_,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[B.r,B.g,B.b],u_vertical_gradient:+n,u_opacity:a}},Ds=(u,e,n,a,o,h,_)=>c.e(qn(u,e,n,a),yn(h,e,_),{u_height_factor:-Math.pow(2,o.overscaledZ)/_.tileSize/8}),ca=u=>({u_matrix:u}),ao=(u,e,n,a)=>c.e(ca(u),yn(n,e,a)),Wo=(u,e)=>({u_matrix:u,u_world:e}),el=(u,e,n,a,o)=>c.e(ao(u,e,n,a),{u_world:o}),Rl=(u,e,n,a)=>{const o=u.transform;let h,_;if(a.paint.get("circle-pitch-alignment")==="map"){const w=ai(n,1,o.zoom);h=!0,_=[w,w]}else h=!1,_=o.pixelsToGLUnits;return{u_camera_to_center_distance:o.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_matrix:u.translatePosMatrix(e.posMatrix,n,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_pitch_with_map:+h,u_device_pixel_ratio:u.pixelRatio,u_extrude_scale:_}},us=(u,e,n)=>({u_matrix:u,u_inv_matrix:e,u_camera_to_center_distance:n.cameraToCenterDistance,u_viewport_size:[n.width,n.height]}),Ms=(u,e,n=1)=>({u_matrix:u,u_color:e,u_overlay:0,u_overlay_scale:n}),pr=u=>({u_matrix:u}),Rr=(u,e,n,a)=>({u_matrix:u,u_extrude_scale:ai(e,1,n),u_intensity:a}),Ra=(u,e,n,a)=>{const o=c.H();c.aP(o,0,u.width,u.height,0,0,1);const h=u.context.gl;return{u_matrix:o,u_world:[h.drawingBufferWidth,h.drawingBufferHeight],u_image:n,u_color_ramp:a,u_opacity:e.paint.get("heatmap-opacity")}};function oo(u,e){const n=Math.pow(2,e.canonical.z),a=e.canonical.y;return[new c.Z(0,a/n).toLngLat().lat,new c.Z(0,(a+1)/n).toLngLat().lat]}const La=(u,e,n,a)=>{const o=u.transform;return{u_matrix:lo(u,e,n,a),u_ratio:1/ai(e,1,o.zoom),u_device_pixel_ratio:u.pixelRatio,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},Ll=(u,e,n,a,o)=>c.e(La(u,e,n,o),{u_image:0,u_image_height:a}),ha=(u,e,n,a,o)=>{const h=u.transform,_=Fa(e,h);return{u_matrix:lo(u,e,n,o),u_texsize:e.imageAtlasTexture.size,u_ratio:1/ai(e,1,h.zoom),u_device_pixel_ratio:u.pixelRatio,u_image:0,u_scale:[_,a.fromScale,a.toScale],u_fade:a.t,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Ac=(u,e,n,a,o,h)=>{const _=u.lineAtlas,w=Fa(e,u.transform),B=n.layout.get("line-cap")==="round",M=_.getDash(a.from,B),L=_.getDash(a.to,B),F=M.width*o.fromScale,$=L.width*o.toScale;return c.e(La(u,e,n,h),{u_patternscale_a:[w/F,-M.height/2],u_patternscale_b:[w/$,-L.height/2],u_sdfgamma:_.width/(256*Math.min(F,$)*u.pixelRatio)/2,u_image:0,u_tex_y_a:M.y,u_tex_y_b:L.y,u_mix:o.t})};function Fa(u,e){return 1/ai(u,1,e.tileZoom)}function lo(u,e,n,a){return u.translatePosMatrix(a?a.posMatrix:e.tileID.posMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Fl=(u,e,n,a,o)=>{return{u_matrix:u,u_tl_parent:e,u_scale_parent:n,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*o.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:o.paint.get("raster-brightness-min"),u_brightness_high:o.paint.get("raster-brightness-max"),u_saturation_factor:(_=o.paint.get("raster-saturation"),_>0?1-1/(1.001-_):-_),u_contrast_factor:(h=o.paint.get("raster-contrast"),h>0?1/(1-h):1+h),u_spin_weights:tl(o.paint.get("raster-hue-rotate"))};var h,_};function tl(u){u*=Math.PI/180;const e=Math.sin(u),n=Math.cos(u);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}const il=(u,e,n,a,o,h,_,w,B,M,L,F,$,te)=>{const oe=_.transform;return{u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:oe.cameraToCenterDistance,u_pitch:oe.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:oe.width/oe.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:B,u_coord_matrix:M,u_is_text:+F,u_pitch_with_map:+a,u_is_along_line:o,u_is_variable_anchor:h,u_texsize:$,u_texture:0,u_translation:L,u_pitched_scale:te}},Vn=(u,e,n,a,o,h,_,w,B,M,L,F,$,te,oe)=>{const p=_.transform;return c.e(il(u,e,n,a,o,h,_,w,B,M,L,F,$,oe),{u_gamma_scale:a?Math.cos(p._pitch)*p.cameraToCenterDistance:1,u_device_pixel_ratio:_.pixelRatio,u_is_halo:1})},Ts=(u,e,n,a,o,h,_,w,B,M,L,F,$,te)=>c.e(Vn(u,e,n,a,o,h,_,w,B,M,L,!0,F,!0,te),{u_texsize_icon:$,u_texture_icon:1}),Ps=(u,e,n)=>({u_matrix:u,u_opacity:e,u_color:n}),As=(u,e,n,a,o,h)=>c.e(function(_,w,B,M){const L=B.imageManager.getPattern(_.from.toString()),F=B.imageManager.getPattern(_.to.toString()),{width:$,height:te}=B.imageManager.getPixelSize(),oe=Math.pow(2,M.tileID.overscaledZ),p=M.tileSize*Math.pow(2,B.transform.tileZoom)/oe,g=p*(M.tileID.canonical.x+M.tileID.wrap*oe),A=p*M.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:L.tl,u_pattern_br_a:L.br,u_pattern_tl_b:F.tl,u_pattern_br_b:F.br,u_texsize:[$,te],u_mix:w.t,u_pattern_size_a:L.displaySize,u_pattern_size_b:F.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/ai(M,1,B.transform.tileZoom),u_pixel_coord_upper:[g>>16,A>>16],u_pixel_coord_lower:[65535&g,65535&A]}}(a,h,n,o),{u_matrix:u,u_opacity:e}),Rs={fillExtrusion:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_lightpos:new c.aN(u,e.u_lightpos),u_lightintensity:new c.aI(u,e.u_lightintensity),u_lightcolor:new c.aN(u,e.u_lightcolor),u_vertical_gradient:new c.aI(u,e.u_vertical_gradient),u_opacity:new c.aI(u,e.u_opacity)}),fillExtrusionPattern:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_lightpos:new c.aN(u,e.u_lightpos),u_lightintensity:new c.aI(u,e.u_lightintensity),u_lightcolor:new c.aN(u,e.u_lightcolor),u_vertical_gradient:new c.aI(u,e.u_vertical_gradient),u_height_factor:new c.aI(u,e.u_height_factor),u_image:new c.aH(u,e.u_image),u_texsize:new c.aO(u,e.u_texsize),u_pixel_coord_upper:new c.aO(u,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(u,e.u_pixel_coord_lower),u_scale:new c.aN(u,e.u_scale),u_fade:new c.aI(u,e.u_fade),u_opacity:new c.aI(u,e.u_opacity)}),fill:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix)}),fillPattern:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_image:new c.aH(u,e.u_image),u_texsize:new c.aO(u,e.u_texsize),u_pixel_coord_upper:new c.aO(u,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(u,e.u_pixel_coord_lower),u_scale:new c.aN(u,e.u_scale),u_fade:new c.aI(u,e.u_fade)}),fillOutline:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_world:new c.aO(u,e.u_world)}),fillOutlinePattern:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_world:new c.aO(u,e.u_world),u_image:new c.aH(u,e.u_image),u_texsize:new c.aO(u,e.u_texsize),u_pixel_coord_upper:new c.aO(u,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(u,e.u_pixel_coord_lower),u_scale:new c.aN(u,e.u_scale),u_fade:new c.aI(u,e.u_fade)}),circle:(u,e)=>({u_camera_to_center_distance:new c.aI(u,e.u_camera_to_center_distance),u_scale_with_map:new c.aH(u,e.u_scale_with_map),u_pitch_with_map:new c.aH(u,e.u_pitch_with_map),u_extrude_scale:new c.aO(u,e.u_extrude_scale),u_device_pixel_ratio:new c.aI(u,e.u_device_pixel_ratio),u_matrix:new c.aJ(u,e.u_matrix)}),collisionBox:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_pixel_extrude_scale:new c.aO(u,e.u_pixel_extrude_scale)}),collisionCircle:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_inv_matrix:new c.aJ(u,e.u_inv_matrix),u_camera_to_center_distance:new c.aI(u,e.u_camera_to_center_distance),u_viewport_size:new c.aO(u,e.u_viewport_size)}),debug:(u,e)=>({u_color:new c.aL(u,e.u_color),u_matrix:new c.aJ(u,e.u_matrix),u_overlay:new c.aH(u,e.u_overlay),u_overlay_scale:new c.aI(u,e.u_overlay_scale)}),clippingMask:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix)}),heatmap:(u,e)=>({u_extrude_scale:new c.aI(u,e.u_extrude_scale),u_intensity:new c.aI(u,e.u_intensity),u_matrix:new c.aJ(u,e.u_matrix)}),heatmapTexture:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_world:new c.aO(u,e.u_world),u_image:new c.aH(u,e.u_image),u_color_ramp:new c.aH(u,e.u_color_ramp),u_opacity:new c.aI(u,e.u_opacity)}),hillshade:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_image:new c.aH(u,e.u_image),u_latrange:new c.aO(u,e.u_latrange),u_light:new c.aO(u,e.u_light),u_shadow:new c.aL(u,e.u_shadow),u_highlight:new c.aL(u,e.u_highlight),u_accent:new c.aL(u,e.u_accent)}),hillshadePrepare:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_image:new c.aH(u,e.u_image),u_dimension:new c.aO(u,e.u_dimension),u_zoom:new c.aI(u,e.u_zoom),u_unpack:new c.aK(u,e.u_unpack)}),line:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_ratio:new c.aI(u,e.u_ratio),u_device_pixel_ratio:new c.aI(u,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(u,e.u_units_to_pixels)}),lineGradient:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_ratio:new c.aI(u,e.u_ratio),u_device_pixel_ratio:new c.aI(u,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(u,e.u_units_to_pixels),u_image:new c.aH(u,e.u_image),u_image_height:new c.aI(u,e.u_image_height)}),linePattern:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_texsize:new c.aO(u,e.u_texsize),u_ratio:new c.aI(u,e.u_ratio),u_device_pixel_ratio:new c.aI(u,e.u_device_pixel_ratio),u_image:new c.aH(u,e.u_image),u_units_to_pixels:new c.aO(u,e.u_units_to_pixels),u_scale:new c.aN(u,e.u_scale),u_fade:new c.aI(u,e.u_fade)}),lineSDF:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_ratio:new c.aI(u,e.u_ratio),u_device_pixel_ratio:new c.aI(u,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(u,e.u_units_to_pixels),u_patternscale_a:new c.aO(u,e.u_patternscale_a),u_patternscale_b:new c.aO(u,e.u_patternscale_b),u_sdfgamma:new c.aI(u,e.u_sdfgamma),u_image:new c.aH(u,e.u_image),u_tex_y_a:new c.aI(u,e.u_tex_y_a),u_tex_y_b:new c.aI(u,e.u_tex_y_b),u_mix:new c.aI(u,e.u_mix)}),raster:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_tl_parent:new c.aO(u,e.u_tl_parent),u_scale_parent:new c.aI(u,e.u_scale_parent),u_buffer_scale:new c.aI(u,e.u_buffer_scale),u_fade_t:new c.aI(u,e.u_fade_t),u_opacity:new c.aI(u,e.u_opacity),u_image0:new c.aH(u,e.u_image0),u_image1:new c.aH(u,e.u_image1),u_brightness_low:new c.aI(u,e.u_brightness_low),u_brightness_high:new c.aI(u,e.u_brightness_high),u_saturation_factor:new c.aI(u,e.u_saturation_factor),u_contrast_factor:new c.aI(u,e.u_contrast_factor),u_spin_weights:new c.aN(u,e.u_spin_weights)}),symbolIcon:(u,e)=>({u_is_size_zoom_constant:new c.aH(u,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(u,e.u_is_size_feature_constant),u_size_t:new c.aI(u,e.u_size_t),u_size:new c.aI(u,e.u_size),u_camera_to_center_distance:new c.aI(u,e.u_camera_to_center_distance),u_pitch:new c.aI(u,e.u_pitch),u_rotate_symbol:new c.aH(u,e.u_rotate_symbol),u_aspect_ratio:new c.aI(u,e.u_aspect_ratio),u_fade_change:new c.aI(u,e.u_fade_change),u_matrix:new c.aJ(u,e.u_matrix),u_label_plane_matrix:new c.aJ(u,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(u,e.u_coord_matrix),u_is_text:new c.aH(u,e.u_is_text),u_pitch_with_map:new c.aH(u,e.u_pitch_with_map),u_is_along_line:new c.aH(u,e.u_is_along_line),u_is_variable_anchor:new c.aH(u,e.u_is_variable_anchor),u_texsize:new c.aO(u,e.u_texsize),u_texture:new c.aH(u,e.u_texture),u_translation:new c.aO(u,e.u_translation),u_pitched_scale:new c.aI(u,e.u_pitched_scale)}),symbolSDF:(u,e)=>({u_is_size_zoom_constant:new c.aH(u,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(u,e.u_is_size_feature_constant),u_size_t:new c.aI(u,e.u_size_t),u_size:new c.aI(u,e.u_size),u_camera_to_center_distance:new c.aI(u,e.u_camera_to_center_distance),u_pitch:new c.aI(u,e.u_pitch),u_rotate_symbol:new c.aH(u,e.u_rotate_symbol),u_aspect_ratio:new c.aI(u,e.u_aspect_ratio),u_fade_change:new c.aI(u,e.u_fade_change),u_matrix:new c.aJ(u,e.u_matrix),u_label_plane_matrix:new c.aJ(u,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(u,e.u_coord_matrix),u_is_text:new c.aH(u,e.u_is_text),u_pitch_with_map:new c.aH(u,e.u_pitch_with_map),u_is_along_line:new c.aH(u,e.u_is_along_line),u_is_variable_anchor:new c.aH(u,e.u_is_variable_anchor),u_texsize:new c.aO(u,e.u_texsize),u_texture:new c.aH(u,e.u_texture),u_gamma_scale:new c.aI(u,e.u_gamma_scale),u_device_pixel_ratio:new c.aI(u,e.u_device_pixel_ratio),u_is_halo:new c.aH(u,e.u_is_halo),u_translation:new c.aO(u,e.u_translation),u_pitched_scale:new c.aI(u,e.u_pitched_scale)}),symbolTextAndIcon:(u,e)=>({u_is_size_zoom_constant:new c.aH(u,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(u,e.u_is_size_feature_constant),u_size_t:new c.aI(u,e.u_size_t),u_size:new c.aI(u,e.u_size),u_camera_to_center_distance:new c.aI(u,e.u_camera_to_center_distance),u_pitch:new c.aI(u,e.u_pitch),u_rotate_symbol:new c.aH(u,e.u_rotate_symbol),u_aspect_ratio:new c.aI(u,e.u_aspect_ratio),u_fade_change:new c.aI(u,e.u_fade_change),u_matrix:new c.aJ(u,e.u_matrix),u_label_plane_matrix:new c.aJ(u,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(u,e.u_coord_matrix),u_is_text:new c.aH(u,e.u_is_text),u_pitch_with_map:new c.aH(u,e.u_pitch_with_map),u_is_along_line:new c.aH(u,e.u_is_along_line),u_is_variable_anchor:new c.aH(u,e.u_is_variable_anchor),u_texsize:new c.aO(u,e.u_texsize),u_texsize_icon:new c.aO(u,e.u_texsize_icon),u_texture:new c.aH(u,e.u_texture),u_texture_icon:new c.aH(u,e.u_texture_icon),u_gamma_scale:new c.aI(u,e.u_gamma_scale),u_device_pixel_ratio:new c.aI(u,e.u_device_pixel_ratio),u_is_halo:new c.aH(u,e.u_is_halo),u_translation:new c.aO(u,e.u_translation),u_pitched_scale:new c.aI(u,e.u_pitched_scale)}),background:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_opacity:new c.aI(u,e.u_opacity),u_color:new c.aL(u,e.u_color)}),backgroundPattern:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_opacity:new c.aI(u,e.u_opacity),u_image:new c.aH(u,e.u_image),u_pattern_tl_a:new c.aO(u,e.u_pattern_tl_a),u_pattern_br_a:new c.aO(u,e.u_pattern_br_a),u_pattern_tl_b:new c.aO(u,e.u_pattern_tl_b),u_pattern_br_b:new c.aO(u,e.u_pattern_br_b),u_texsize:new c.aO(u,e.u_texsize),u_mix:new c.aI(u,e.u_mix),u_pattern_size_a:new c.aO(u,e.u_pattern_size_a),u_pattern_size_b:new c.aO(u,e.u_pattern_size_b),u_scale_a:new c.aI(u,e.u_scale_a),u_scale_b:new c.aI(u,e.u_scale_b),u_pixel_coord_upper:new c.aO(u,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(u,e.u_pixel_coord_lower),u_tile_units_to_pixels:new c.aI(u,e.u_tile_units_to_pixels)}),terrain:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_texture:new c.aH(u,e.u_texture),u_ele_delta:new c.aI(u,e.u_ele_delta),u_fog_matrix:new c.aJ(u,e.u_fog_matrix),u_fog_color:new c.aL(u,e.u_fog_color),u_fog_ground_blend:new c.aI(u,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.aI(u,e.u_fog_ground_blend_opacity),u_horizon_color:new c.aL(u,e.u_horizon_color),u_horizon_fog_blend:new c.aI(u,e.u_horizon_fog_blend)}),terrainDepth:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_ele_delta:new c.aI(u,e.u_ele_delta)}),terrainCoords:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_texture:new c.aH(u,e.u_texture),u_terrain_coords_id:new c.aI(u,e.u_terrain_coords_id),u_ele_delta:new c.aI(u,e.u_ele_delta)}),sky:(u,e)=>({u_sky_color:new c.aL(u,e.u_sky_color),u_horizon_color:new c.aL(u,e.u_horizon_color),u_horizon:new c.aI(u,e.u_horizon),u_sky_horizon_blend:new c.aI(u,e.u_sky_horizon_blend)})};class cr{constructor(e,n,a){this.context=e;const o=e.gl;this.buffer=o.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),o.bufferData(o.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?o.DYNAMIC_DRAW:o.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const dc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class rl{constructor(e,n,a,o){this.length=n.length,this.attributes=a,this.itemSize=n.bytesPerElement,this.dynamicDraw=o,this.context=e;const h=e.gl;this.buffer=h.createBuffer(),e.bindVertexBuffer.set(this.buffer),h.bufferData(h.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,n){for(let a=0;a<this.attributes.length;a++){const o=n.attributes[this.attributes[a].name];o!==void 0&&e.enableVertexAttribArray(o)}}setVertexAttribPointers(e,n,a){for(let o=0;o<this.attributes.length;o++){const h=this.attributes[o],_=n.attributes[h.name];_!==void 0&&e.vertexAttribPointer(_,h.components,e[dc[h.type]],!1,this.itemSize,h.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ls=new WeakMap;function ds(u){var e;if(Ls.has(u))return Ls.get(u);{const n=(e=u.getParameter(u.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Ls.set(u,n),n}}class bi{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class co extends bi{getDefault(){return c.aM.transparent}set(e){const n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class fc extends bi{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Fs extends bi{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class zl extends bi{getDefault(){return[!0,!0,!0,!0]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class nl extends bi{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class za extends bi{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class sl extends bi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const n=this.current;(e.func!==n.func||e.ref!==n.ref||e.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class ua extends bi{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class ho extends bi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=e,this.dirty=!1}}class Er extends bi{getDefault(){return[0,1]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class al extends bi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=e,this.dirty=!1}}class ol extends bi{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Mn extends bi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.BLEND):n.disable(n.BLEND),this.current=e,this.dirty=!1}}class fs extends bi{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class zs extends bi{getDefault(){return c.aM.transparent}set(e){const n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class ll extends bi{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Aa extends bi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=e,this.dirty=!1}}class _n extends bi{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Ga extends bi{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class uo extends bi{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class cl extends bi{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Ao extends bi{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Gl extends bi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class hl extends bi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class fo extends bi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Ul extends bi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class go extends bi{getDefault(){return null}set(e){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Hn extends bi{getDefault(){return null}set(e){var n;if(e===this.current&&!this.dirty)return;const a=this.gl;ds(a)?a.bindVertexArray(e):(n=a.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class da extends bi{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class ul extends bi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Ua extends bi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class fa extends bi{constructor(e,n){super(e),this.context=e,this.parent=n}getDefault(){return null}}class Al extends fa{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class jn extends fa{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class dl extends fa{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class gc{constructor(e,n,a,o,h){this.context=e,this.width=n,this.height=a;const _=e.gl,w=this.framebuffer=_.createFramebuffer();if(this.colorAttachment=new Al(e,w),o)this.depthAttachment=h?new dl(e,w):new jn(e,w);else if(h)throw new Error("Stencil cannot be set without depth");if(_.checkFramebufferStatus(_.FRAMEBUFFER)!==_.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,n=this.colorAttachment.get();if(n&&e.deleteTexture(n),this.depthAttachment){const a=this.depthAttachment.get();a&&e.deleteRenderbuffer(a)}e.deleteFramebuffer(this.framebuffer)}}class Zi{constructor(e,n,a){this.blendFunction=e,this.blendColor=n,this.mask=a}}Zi.Replace=[1,0],Zi.disabled=new Zi(Zi.Replace,c.aM.transparent,[!1,!1,!1,!1]),Zi.unblended=new Zi(Zi.Replace,c.aM.transparent,[!0,!0,!0,!0]),Zi.alphaBlended=new Zi([1,771],c.aM.transparent,[!0,!0,!0,!0]);class ga{constructor(e){var n,a;if(this.gl=e,this.clearColor=new co(this),this.clearDepth=new fc(this),this.clearStencil=new Fs(this),this.colorMask=new zl(this),this.depthMask=new nl(this),this.stencilMask=new za(this),this.stencilFunc=new sl(this),this.stencilOp=new ua(this),this.stencilTest=new ho(this),this.depthRange=new Er(this),this.depthTest=new al(this),this.depthFunc=new ol(this),this.blend=new Mn(this),this.blendFunc=new fs(this),this.blendColor=new zs(this),this.blendEquation=new ll(this),this.cullFace=new Aa(this),this.cullFaceSide=new _n(this),this.frontFace=new Ga(this),this.program=new uo(this),this.activeTexture=new cl(this),this.viewport=new Ao(this),this.bindFramebuffer=new Gl(this),this.bindRenderbuffer=new hl(this),this.bindTexture=new fo(this),this.bindVertexBuffer=new Ul(this),this.bindElementBuffer=new go(this),this.bindVertexArray=new Hn(this),this.pixelStoreUnpack=new da(this),this.pixelStoreUnpackPremultiplyAlpha=new ul(this),this.pixelStoreUnpackFlipY=new Ua(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),ds(e)){this.HALF_FLOAT=e.HALF_FLOAT;const o=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=e.RGBA16F)!==null&&n!==void 0?n:o==null?void 0:o.RGBA16F_EXT,this.RGB16F=(a=e.RGB16F)!==null&&a!==void 0?a:o==null?void 0:o.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const o=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=o==null?void 0:o.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,n){return new cr(this,e,n)}createVertexBuffer(e,n,a){return new rl(this,e,n,a)}createRenderbuffer(e,n,a){const o=this.gl,h=o.createRenderbuffer();return this.bindRenderbuffer.set(h),o.renderbufferStorage(o.RENDERBUFFER,e,n,a),this.bindRenderbuffer.set(null),h}createFramebuffer(e,n,a,o){return new gc(this,e,n,a,o)}clear({color:e,depth:n,stencil:a}){const o=this.gl;let h=0;e&&(h|=o.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(h|=o.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),a!==void 0&&(h|=o.STENCIL_BUFFER_BIT,this.clearStencil.set(a),this.stencilMask.set(255)),o.clear(h)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){c.aE(e.blendFunction,Zi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return ds(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var n;return ds(this.gl)?this.gl.deleteVertexArray(e):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class ti{constructor(e,n,a){this.func=e,this.mask=n,this.range=a}}ti.ReadOnly=!1,ti.ReadWrite=!0,ti.disabled=new ti(519,ti.ReadOnly,[0,1]);const po=7680;class ki{constructor(e,n,a,o,h,_){this.test=e,this.ref=n,this.mask=a,this.fail=o,this.depthFail=h,this.pass=_}}ki.disabled=new ki({func:519,mask:0},0,0,po,po,po);class Ci{constructor(e,n,a){this.enable=e,this.mode=n,this.frontFace=a}}let Tn;function Pn(u,e,n,a,o){const h=u.context,_=h.gl,w=u.useProgram("collisionBox"),B=[];let M=0,L=0;for(let A=0;A<a.length;A++){const v=a[A],x=e.getTile(v).getBucket(n);if(!x)continue;const Q=o?x.textCollisionBox:x.iconCollisionBox,T=x.collisionCircleArray;if(T.length>0){const k=c.H();c.aQ(k,x.placementInvProjMatrix,u.transform.glCoordMatrix),c.aQ(k,k,x.placementViewportMatrix),B.push({circleArray:T,circleOffset:L,transform:v.posMatrix,invTransform:k,coord:v}),M+=T.length/4,L=M}Q&&w.draw(h,_.LINES,ti.disabled,ki.disabled,u.colorModeForRenderPass(),Ci.disabled,{u_matrix:v.posMatrix,u_pixel_extrude_scale:[1/(F=u.transform).width,1/F.height]},u.style.map.terrain&&u.style.map.terrain.getTerrainData(v),n.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,null,u.transform.zoom,null,null,Q.collisionVertexBuffer)}var F;if(!o||!B.length)return;const $=u.useProgram("collisionCircle"),te=new c.aR;te.resize(4*M),te._trim();let oe=0;for(const A of B)for(let v=0;v<A.circleArray.length/4;v++){const x=4*v,Q=A.circleArray[x+0],T=A.circleArray[x+1],k=A.circleArray[x+2],q=A.circleArray[x+3];te.emplace(oe++,Q,T,k,q,0),te.emplace(oe++,Q,T,k,q,1),te.emplace(oe++,Q,T,k,q,2),te.emplace(oe++,Q,T,k,q,3)}(!Tn||Tn.length<2*M)&&(Tn=function(A){const v=2*A,x=new c.aT;x.resize(v),x._trim();for(let Q=0;Q<v;Q++){const T=6*Q;x.uint16[T+0]=4*Q+0,x.uint16[T+1]=4*Q+1,x.uint16[T+2]=4*Q+2,x.uint16[T+3]=4*Q+2,x.uint16[T+4]=4*Q+3,x.uint16[T+5]=4*Q+0}return x}(M));const p=h.createIndexBuffer(Tn,!0),g=h.createVertexBuffer(te,c.aS.members,!0);for(const A of B){const v=us(A.transform,A.invTransform,u.transform);$.draw(h,_.TRIANGLES,ti.disabled,ki.disabled,u.colorModeForRenderPass(),Ci.disabled,v,u.style.map.terrain&&u.style.map.terrain.getTerrainData(A.coord),n.id,g,p,c.a0.simpleSegment(0,2*A.circleOffset,A.circleArray.length,A.circleArray.length/2),null,u.transform.zoom,null,null,null)}g.destroy(),p.destroy()}Ci.disabled=new Ci(!1,1029,2305),Ci.backCCW=new Ci(!0,1029,2305);const pa=c.an(new Float32Array(16));function fl(u,e,n,a,o,h){const{horizontalAlign:_,verticalAlign:w}=c.au(u);return new c.P((-(_-.5)*e/o+a[0])*h,(-(w-.5)*n/o+a[1])*h)}function Rn(u,e,n,a,o,h){const _=e.tileAnchorPoint.add(new c.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let w=a.mult(h);n||(w=w.rotate(-o));const B=_.add(w);return ge(B.x,B.y,e.labelPlaneMatrix,e.getElevation).point}if(n){const w=Ne(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(u),B=Math.atan(w.y/w.x)+(w.x<0?Math.PI:0);return u.add(a.rotate(B))}return u.add(a)}function gs(u,e,n,a,o,h,_,w,B,M,L,F,$,te){const oe=u.text.placedSymbolArray,p=u.text.dynamicLayoutVertexArray,g=u.icon.dynamicLayoutVertexArray,A={};p.clear();for(let v=0;v<oe.length;v++){const x=oe.get(v),Q=x.hidden||!x.crossTileID||u.allowVerticalPlacement&&!x.placedOrientation?null:a[x.crossTileID];if(Q){const T=new c.P(x.anchorX,x.anchorY),k={getElevation:te,width:o.width,height:o.height,labelPlaneMatrix:h,pitchWithMap:n,projection:L,tileAnchorPoint:T,translation:F,unwrappedTileID:$},q=n?ge(T.x,T.y,_,te):Ne(T.x,T.y,k),G=j(o.cameraToCenterDistance,q.signedDistanceFromCamera);let O=c.ai(u.textSizeData,B,x)*G/c.ap;n&&(O*=u.tilePixelRatio/w);const{width:re,height:K,anchor:U,textOffset:ne,textBoxScale:le}=Q,se=fl(U,re,K,ne,le,O),ue=L.getPitchedTextCorrection(o,T.add(new c.P(F[0],F[1])),$),Ie=Rn(q.point,k,e,se,o.angle,ue),pe=u.allowVerticalPlacement&&x.placedOrientation===c.ah.vertical?Math.PI/2:0;for(let Be=0;Be<x.numGlyphs;Be++)c.aj(p,Ie,pe);M&&x.associatedIconIndex>=0&&(A[x.associatedIconIndex]={shiftedAnchor:Ie,angle:pe})}else Ot(x.numGlyphs,p)}if(M){g.clear();const v=u.icon.placedSymbolArray;for(let x=0;x<v.length;x++){const Q=v.get(x);if(Q.hidden)Ot(Q.numGlyphs,g);else{const T=A[x];if(T)for(let k=0;k<Q.numGlyphs;k++)c.aj(g,T.shiftedAnchor,T.angle);else Ot(Q.numGlyphs,g)}}u.icon.dynamicLayoutVertexBuffer.updateData(g)}u.text.dynamicLayoutVertexBuffer.updateData(p)}function Yr(u,e,n){return n.iconsInText&&e?"symbolTextAndIcon":u?"symbolSDF":"symbolIcon"}function mo(u,e,n,a,o,h,_,w,B,M,L,F){const $=u.context,te=$.gl,oe=u.transform,p=ks(),g=w==="map",A=B==="map",v=w!=="viewport"&&n.layout.get("symbol-placement")!=="point",x=g&&!A&&!v,Q=!A&&v,T=!n.layout.get("symbol-sort-key").isConstant();let k=!1;const q=u.depthModeForSublayer(0,ti.ReadOnly),G=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),O=[],re=p.getCircleRadiusCorrection(oe);for(const K of a){const U=e.getTile(K),ne=U.getBucket(n);if(!ne)continue;const le=o?ne.text:ne.icon;if(!le||!le.segments.get().length||!le.hasVisibleVertices)continue;const se=le.programConfigurations.get(n.id),ue=o||ne.sdfIcons,Ie=o?ne.textSizeData:ne.iconSizeData,pe=A||oe.pitch!==0,Be=u.useProgram(Yr(ue,o,ne),se),Y=c.ag(Ie,oe.zoom),z=u.style.map.terrain&&u.style.map.terrain.getTerrainData(K);let ce,ie,ae,Ae,Ce=[0,0],be=null;if(o)ie=U.glyphAtlasTexture,ae=te.LINEAR,ce=U.glyphAtlasTexture.size,ne.iconsInText&&(Ce=U.imageAtlasTexture.size,be=U.imageAtlasTexture,Ae=pe||u.options.rotating||u.options.zooming||Ie.kind==="composite"||Ie.kind==="camera"?te.LINEAR:te.NEAREST);else{const nt=n.layout.get("icon-size").constantOr(0)!==1||ne.iconsNeedLinear;ie=U.imageAtlasTexture,ae=ue||u.options.rotating||u.options.zooming||nt||pe?te.LINEAR:te.NEAREST,ce=U.imageAtlasTexture.size}const xe=ai(U,1,u.transform.zoom),ze=Q?K.posMatrix:pa,qe=Nn(ze,A,g,u.transform,xe),Ve=fn(ze,A,g,u.transform,xe),Ke=fn(K.posMatrix,A,g,u.transform,xe),ct=p.translatePosition(u.transform,U,h,_),Ue=G&&ne.hasTextData(),Pe=n.layout.get("icon-text-fit")!=="none"&&Ue&&ne.hasIconData();if(v){const nt=u.style.map.terrain?(ci,$t)=>u.style.map.terrain.getElevation(K,ci,$t):null,_t=n.layout.get("text-rotation-alignment")==="map";ee(ne,K.posMatrix,u,o,qe,Ke,A,M,_t,p,K.toUnwrapped(),oe.width,oe.height,ct,nt)}const Ye=K.posMatrix,vt=o&&G||Pe,ot=v||vt?pa:qe,Ct=Ve,st=ue&&n.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let yt;yt=ue?ne.iconsInText?Ts(Ie.kind,Y,x,A,v,vt,u,Ye,ot,Ct,ct,ce,Ce,re):Vn(Ie.kind,Y,x,A,v,vt,u,Ye,ot,Ct,ct,o,ce,!0,re):il(Ie.kind,Y,x,A,v,vt,u,Ye,ot,Ct,ct,o,ce,re);const gt={program:Be,buffers:le,uniformValues:yt,atlasTexture:ie,atlasTextureIcon:be,atlasInterpolation:ae,atlasInterpolationIcon:Ae,isSDF:ue,hasHalo:st};if(T&&ne.canOverlap){k=!0;const nt=le.segments.get();for(const _t of nt)O.push({segments:new c.a0([_t]),sortKey:_t.sortKey,state:gt,terrainData:z})}else O.push({segments:le.segments,sortKey:0,state:gt,terrainData:z})}k&&O.sort((K,U)=>K.sortKey-U.sortKey);for(const K of O){const U=K.state;if($.activeTexture.set(te.TEXTURE0),U.atlasTexture.bind(U.atlasInterpolation,te.CLAMP_TO_EDGE),U.atlasTextureIcon&&($.activeTexture.set(te.TEXTURE1),U.atlasTextureIcon&&U.atlasTextureIcon.bind(U.atlasInterpolationIcon,te.CLAMP_TO_EDGE)),U.isSDF){const ne=U.uniformValues;U.hasHalo&&(ne.u_is_halo=1,yo(U.buffers,K.segments,n,u,U.program,q,L,F,ne,K.terrainData)),ne.u_is_halo=0}yo(U.buffers,K.segments,n,u,U.program,q,L,F,U.uniformValues,K.terrainData)}}function yo(u,e,n,a,o,h,_,w,B,M){const L=a.context;o.draw(L,L.gl.TRIANGLES,h,_,w,Ci.disabled,B,M,n.id,u.layoutVertexBuffer,u.indexBuffer,e,n.paint,a.transform.zoom,u.programConfigurations.get(n.id),u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer)}function Na(u,e,n,a){const o=u.context,h=o.gl,_=ki.disabled,w=new Zi([h.ONE,h.ONE],c.aM.transparent,[!0,!0,!0,!0]),B=e.getBucket(n);if(!B)return;const M=a.key;let L=n.heatmapFbos.get(M);L||(L=ma(o,e.tileSize,e.tileSize),n.heatmapFbos.set(M,L)),o.bindFramebuffer.set(L.framebuffer),o.viewport.set([0,0,e.tileSize,e.tileSize]),o.clear({color:c.aM.transparent});const F=B.programConfigurations.get(n.id),$=u.useProgram("heatmap",F),te=u.style.map.terrain.getTerrainData(a);$.draw(o,h.TRIANGLES,ti.disabled,_,w,Ci.disabled,Rr(a.posMatrix,e,u.transform.zoom,n.paint.get("heatmap-intensity")),te,n.id,B.layoutVertexBuffer,B.indexBuffer,B.segments,n.paint,u.transform.zoom,F)}function ps(u,e,n){const a=u.context,o=a.gl;a.setColorMode(u.colorModeForRenderPass());const h=ya(a,e),_=n.key,w=e.heatmapFbos.get(_);w&&(a.activeTexture.set(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,w.colorAttachment.get()),a.activeTexture.set(o.TEXTURE1),h.bind(o.LINEAR,o.CLAMP_TO_EDGE),u.useProgram("heatmapTexture").draw(a,o.TRIANGLES,ti.disabled,ki.disabled,u.colorModeForRenderPass(),Ci.disabled,Ra(u,e,0,1),null,e.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments,e.paint,u.transform.zoom),w.destroy(),e.heatmapFbos.delete(_))}function ma(u,e,n){var a,o;const h=u.gl,_=h.createTexture();h.bindTexture(h.TEXTURE_2D,_),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR);const w=(a=u.HALF_FLOAT)!==null&&a!==void 0?a:h.UNSIGNED_BYTE,B=(o=u.RGBA16F)!==null&&o!==void 0?o:h.RGBA;h.texImage2D(h.TEXTURE_2D,0,B,e,n,0,h.RGBA,w,null);const M=u.createFramebuffer(e,n,!1,!1);return M.colorAttachment.set(_),M}function ya(u,e){return e.colorRampTexture||(e.colorRampTexture=new St(u,e.colorRamp,u.gl.RGBA)),e.colorRampTexture}function Gs(u,e,n,a,o){if(!n||!a||!a.imageAtlas)return;const h=a.imageAtlas.patternPositions;let _=h[n.to.toString()],w=h[n.from.toString()];if(!_&&w&&(_=w),!w&&_&&(w=_),!_||!w){const B=o.getPaintProperty(e);_=h[B],w=h[B]}_&&w&&u.setConstantPatternPositions(_,w)}function Oa(u,e,n,a,o,h,_){const w=u.context.gl,B="fill-pattern",M=n.paint.get(B),L=M&&M.constantOr(1),F=n.getCrossfadeParameters();let $,te,oe,p,g;_?(te=L&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",$=w.LINES):(te=L?"fillPattern":"fill",$=w.TRIANGLES);const A=M.constantOr(null);for(const v of a){const x=e.getTile(v);if(L&&!x.patternsLoaded())continue;const Q=x.getBucket(n);if(!Q)continue;const T=Q.programConfigurations.get(n.id),k=u.useProgram(te,T),q=u.style.map.terrain&&u.style.map.terrain.getTerrainData(v);L&&(u.context.activeTexture.set(w.TEXTURE0),x.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),T.updatePaintBuffers(F)),Gs(T,B,A,x,n);const G=q?v:null,O=u.translatePosMatrix(G?G.posMatrix:v.posMatrix,x,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(_){p=Q.indexBuffer2,g=Q.segments2;const re=[w.drawingBufferWidth,w.drawingBufferHeight];oe=te==="fillOutlinePattern"&&L?el(O,u,F,x,re):Wo(O,re)}else p=Q.indexBuffer,g=Q.segments,oe=L?ao(O,u,F,x):ca(O);k.draw(u.context,$,o,u.stencilModeForClipping(v),h,Ci.disabled,oe,q,n.id,Q.layoutVertexBuffer,p,g,n.paint,u.transform.zoom,T)}}function _o(u,e,n,a,o,h,_){const w=u.context,B=w.gl,M="fill-extrusion-pattern",L=n.paint.get(M),F=L.constantOr(1),$=n.getCrossfadeParameters(),te=n.paint.get("fill-extrusion-opacity"),oe=L.constantOr(null);for(const p of a){const g=e.getTile(p),A=g.getBucket(n);if(!A)continue;const v=u.style.map.terrain&&u.style.map.terrain.getTerrainData(p),x=A.programConfigurations.get(n.id),Q=u.useProgram(F?"fillExtrusionPattern":"fillExtrusion",x);F&&(u.context.activeTexture.set(B.TEXTURE0),g.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),x.updatePaintBuffers($)),Gs(x,M,oe,g,n);const T=u.translatePosMatrix(p.posMatrix,g,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),k=n.paint.get("fill-extrusion-vertical-gradient"),q=F?Ds(T,u,k,te,p,$,g):qn(T,u,k,te);Q.draw(w,w.gl.TRIANGLES,o,h,_,Ci.backCCW,q,v,n.id,A.layoutVertexBuffer,A.indexBuffer,A.segments,n.paint,u.transform.zoom,x,u.style.map.terrain&&A.centroidVertexBuffer)}}function _a(u,e,n,a,o,h,_){const w=u.context,B=w.gl,M=n.fbo;if(!M)return;const L=u.useProgram("hillshade"),F=u.style.map.terrain&&u.style.map.terrain.getTerrainData(e);w.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,M.colorAttachment.get()),L.draw(w,B.TRIANGLES,o,h,_,Ci.disabled,(($,te,oe,p)=>{const g=oe.paint.get("hillshade-shadow-color"),A=oe.paint.get("hillshade-highlight-color"),v=oe.paint.get("hillshade-accent-color");let x=oe.paint.get("hillshade-illumination-direction")*(Math.PI/180);oe.paint.get("hillshade-illumination-anchor")==="viewport"&&(x-=$.transform.angle);const Q=!$.options.moving;return{u_matrix:p?p.posMatrix:$.transform.calculatePosMatrix(te.tileID.toUnwrapped(),Q),u_image:0,u_latrange:oo(0,te.tileID),u_light:[oe.paint.get("hillshade-exaggeration"),x],u_shadow:g,u_highlight:A,u_accent:v}})(u,n,a,F?e:null),F,a.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments)}function Us(u,e,n,a,o,h){const _=u.context,w=_.gl,B=e.dem;if(B&&B.data){const M=B.dim,L=B.stride,F=B.getPixels();if(_.activeTexture.set(w.TEXTURE1),_.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||u.getTileTexture(L),e.demTexture){const te=e.demTexture;te.update(F,{premultiply:!1}),te.bind(w.NEAREST,w.CLAMP_TO_EDGE)}else e.demTexture=new St(_,F,w.RGBA,{premultiply:!1}),e.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);_.activeTexture.set(w.TEXTURE0);let $=e.fbo;if(!$){const te=new St(_,{width:M,height:M,data:null},w.RGBA);te.bind(w.LINEAR,w.CLAMP_TO_EDGE),$=e.fbo=_.createFramebuffer(M,M,!0,!1),$.colorAttachment.set(te.texture)}_.bindFramebuffer.set($.framebuffer),_.viewport.set([0,0,M,M]),u.useProgram("hillshadePrepare").draw(_,w.TRIANGLES,a,o,h,Ci.disabled,((te,oe)=>{const p=oe.stride,g=c.H();return c.aP(g,0,c.X,-c.X,0,0,1),c.J(g,g,[0,-c.X,0]),{u_matrix:g,u_image:1,u_dimension:[p,p],u_zoom:te.overscaledZ,u_unpack:oe.getUnpackVector()}})(e.tileID,B),null,n.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function gl(u,e,n,a,o,h){const _=a.paint.get("raster-fade-duration");if(!h&&_>0){const w=Qe.now(),B=(w-u.timeAdded)/_,M=e?(w-e.timeAdded)/_:-1,L=n.getSource(),F=o.coveringZoomLevel({tileSize:L.tileSize,roundZoom:L.roundZoom}),$=!e||Math.abs(e.tileID.overscaledZ-F)>Math.abs(u.tileID.overscaledZ-F),te=$&&u.refreshedUponExpiration?1:c.ac($?B:1-M,0,1);return u.refreshedUponExpiration&&B>=1&&(u.refreshedUponExpiration=!1),e?{opacity:1,mix:1-te}:{opacity:te,mix:0}}return{opacity:1,mix:0}}const Io=new c.aM(1,0,0,1),gi=new c.aM(0,1,0,1),bo=new c.aM(0,0,1,1),pc=new c.aM(1,0,1,1),pl=new c.aM(0,1,1,1);function Lr(u,e,n,a){wo(u,0,e+n/2,u.transform.width,n,a)}function Nl(u,e,n,a){wo(u,e-n/2,0,n,u.transform.height,a)}function wo(u,e,n,a,o,h){const _=u.context,w=_.gl;w.enable(w.SCISSOR_TEST),w.scissor(e*u.pixelRatio,n*u.pixelRatio,a*u.pixelRatio,o*u.pixelRatio),_.clear({color:h}),w.disable(w.SCISSOR_TEST)}function Ol(u,e,n){const a=u.context,o=a.gl,h=n.posMatrix,_=u.useProgram("debug"),w=ti.disabled,B=ki.disabled,M=u.colorModeForRenderPass(),L="$debug",F=u.style.map.terrain&&u.style.map.terrain.getTerrainData(n);a.activeTexture.set(o.TEXTURE0);const $=e.getTileByID(n.key).latestRawTileData,te=Math.floor(($&&$.byteLength||0)/1024),oe=e.getTile(n).tileSize,p=512/Math.min(oe,512)*(n.overscaledZ/u.transform.zoom)*.5;let g=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(g+=` => ${n.overscaledZ}`),function(A,v){A.initDebugOverlayCanvas();const x=A.debugOverlayCanvas,Q=A.context.gl,T=A.debugOverlayCanvas.getContext("2d");T.clearRect(0,0,x.width,x.height),T.shadowColor="white",T.shadowBlur=2,T.lineWidth=1.5,T.strokeStyle="white",T.textBaseline="top",T.font="bold 36px Open Sans, sans-serif",T.fillText(v,5,5),T.strokeText(v,5,5),A.debugOverlayTexture.update(x),A.debugOverlayTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE)}(u,`${g} ${te}kB`),_.draw(a,o.TRIANGLES,w,B,Zi.alphaBlended,Ci.disabled,Ms(h,c.aM.transparent,p),null,L,u.debugBuffer,u.quadTriangleIndexBuffer,u.debugSegments),_.draw(a,o.LINE_STRIP,w,B,M,Ci.disabled,Ms(h,c.aM.red),F,L,u.debugBuffer,u.tileBorderIndexBuffer,u.debugSegments)}function vo(u,e,n){const a=u.context,o=a.gl,h=u.colorModeForRenderPass(),_=new ti(o.LEQUAL,ti.ReadWrite,u.depthRangeFor3D),w=u.useProgram("terrain"),B=e.getTerrainMesh();a.bindFramebuffer.set(null),a.viewport.set([0,0,u.width,u.height]);for(const M of n){const L=u.renderToTexture.getTexture(M),F=e.getTerrainData(M.tileID);a.activeTexture.set(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,L.texture);const $=u.transform.calculatePosMatrix(M.tileID.toUnwrapped()),te=e.getMeshFrameDelta(u.transform.zoom),oe=u.transform.calculateFogMatrix(M.tileID.toUnwrapped()),p=Xo($,te,oe,u.style.sky,u.transform.pitch);w.draw(a,o.TRIANGLES,_,ki.disabled,h,Ci.backCCW,p,F,"terrain",B.vertexBuffer,B.indexBuffer,B.segments)}}class Ia{constructor(e,n,a){this.vertexBuffer=e,this.indexBuffer=n,this.segments=a}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class xo{constructor(e,n){this.context=new ga(e),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Vt.maxUnderzooming+Vt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new $o}resize(e,n,a){if(this.width=Math.floor(e*a),this.height=Math.floor(n*a),this.pixelRatio=a,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const o of this.style._order)this.style._layers[o].resize()}setup(){const e=this.context,n=new c.aX;n.emplaceBack(0,0),n.emplaceBack(c.X,0),n.emplaceBack(0,c.X),n.emplaceBack(c.X,c.X),this.tileExtentBuffer=e.createVertexBuffer(n,On.members),this.tileExtentSegments=c.a0.simpleSegment(0,0,4,2);const a=new c.aX;a.emplaceBack(0,0),a.emplaceBack(c.X,0),a.emplaceBack(0,c.X),a.emplaceBack(c.X,c.X),this.debugBuffer=e.createVertexBuffer(a,On.members),this.debugSegments=c.a0.simpleSegment(0,0,4,5);const o=new c.$;o.emplaceBack(0,0,0,0),o.emplaceBack(c.X,0,c.X,0),o.emplaceBack(0,c.X,0,c.X),o.emplaceBack(c.X,c.X,c.X,c.X),this.rasterBoundsBuffer=e.createVertexBuffer(o,Ir.members),this.rasterBoundsSegments=c.a0.simpleSegment(0,0,4,2);const h=new c.aX;h.emplaceBack(0,0),h.emplaceBack(1,0),h.emplaceBack(0,1),h.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(h,On.members),this.viewportSegments=c.a0.simpleSegment(0,0,4,2);const _=new c.aZ;_.emplaceBack(0),_.emplaceBack(1),_.emplaceBack(3),_.emplaceBack(2),_.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(_);const w=new c.aY;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(w);const B=this.context.gl;this.stencilClearMode=new ki({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO)}clearStencil(){const e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const a=c.H();c.aP(a,0,this.width,this.height,0,0,1),c.K(a,a,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,n.TRIANGLES,ti.disabled,this.stencilClearMode,Zi.disabled,Ci.disabled,pr(a),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,n){if(this.currentStencilSource===e.source||!e.isTileClipped()||!n||!n.length)return;this.currentStencilSource=e.source;const a=this.context,o=a.gl;this.nextStencilID+n.length>256&&this.clearStencil(),a.setColorMode(Zi.disabled),a.setDepthMode(ti.disabled);const h=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const _ of n){const w=this._tileClippingMaskIDs[_.key]=this.nextStencilID++,B=this.style.map.terrain&&this.style.map.terrain.getTerrainData(_);h.draw(a,o.TRIANGLES,ti.disabled,new ki({func:o.ALWAYS,mask:0},w,255,o.KEEP,o.KEEP,o.REPLACE),Zi.disabled,Ci.disabled,pr(_.posMatrix),B,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,n=this.context.gl;return new ki({func:n.NOTEQUAL,mask:255},e,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(e){const n=this.context.gl;return new ki({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(e){const n=this.context.gl,a=e.sort((_,w)=>w.overscaledZ-_.overscaledZ),o=a[a.length-1].overscaledZ,h=a[0].overscaledZ-o+1;if(h>1){this.currentStencilSource=void 0,this.nextStencilID+h>256&&this.clearStencil();const _={};for(let w=0;w<h;w++)_[w+o]=new ki({func:n.GEQUAL,mask:255},w+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=h,[_,a]}return[{[o]:ki.disabled},a]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Zi([e.CONSTANT_COLOR,e.ONE],new c.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Zi.unblended:Zi.alphaBlended}depthModeForSublayer(e,n,a){if(!this.opaquePassEnabledForLayer())return ti.disabled;const o=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new ti(a||this.context.gl.LEQUAL,n,[o,o])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(Qe.now()),this.imageManager.beginFrame();const a=this.style._order,o=this.style.sourceCaches,h={},_={},w={};for(const B in o){const M=o[B];M.used&&M.prepare(this.context),h[B]=M.getVisibleCoordinates(),_[B]=h[B].slice().reverse(),w[B]=M.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let B=0;B<a.length;B++)if(this.style._layers[a[B]].is3D()){this.opaquePassCutoff=B;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const B of a){const M=this.style._layers[B];if(!M.hasOffscreenPass()||M.isHidden(this.transform.zoom))continue;const L=_[M.source];(M.type==="custom"||L.length)&&this.renderLayer(this,o[M.source],M,L)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?c.aM.black:c.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(B,M){const L=B.context,F=L.gl,$=((A,v,x)=>({u_sky_color:A.properties.get("sky-color"),u_horizon_color:A.properties.get("horizon-color"),u_horizon:(v.height/2+v.getHorizon())*x,u_sky_horizon_blend:A.properties.get("sky-horizon-blend")*v.height/2*x}))(M,B.style.map.transform,B.pixelRatio),te=new ti(F.LEQUAL,ti.ReadWrite,[0,1]),oe=ki.disabled,p=B.colorModeForRenderPass(),g=B.useProgram("sky");if(!M.mesh){const A=new c.aX;A.emplaceBack(-1,-1),A.emplaceBack(1,-1),A.emplaceBack(1,1),A.emplaceBack(-1,1);const v=new c.aY;v.emplaceBack(0,1,2),v.emplaceBack(0,2,3),M.mesh=new Ia(L.createVertexBuffer(A,On.members),L.createIndexBuffer(v),c.a0.simpleSegment(0,0,A.length,v.length))}g.draw(L,F.TRIANGLES,te,oe,p,Ci.disabled,$,void 0,"sky",M.mesh.vertexBuffer,M.mesh.indexBuffer,M.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const B=this.style._layers[a[this.currentLayer]],M=o[B.source],L=h[B.source];this._renderTileClippingMasks(B,L),this.renderLayer(this,M,B,L)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const B=this.style._layers[a[this.currentLayer]],M=o[B.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(B))continue;const L=(B.type==="symbol"?w:_)[B.source];this._renderTileClippingMasks(B,h[B.source]),this.renderLayer(this,M,B,L)}if(this.options.showTileBoundaries){const B=function(M,L){let F=null;const $=Object.values(M._layers).flatMap(g=>g.source&&!g.isHidden(L)?[M.sourceCaches[g.source]]:[]),te=$.filter(g=>g.getSource().type==="vector"),oe=$.filter(g=>g.getSource().type!=="vector"),p=g=>{(!F||F.getSource().maxzoom<g.getSource().maxzoom)&&(F=g)};return te.forEach(g=>p(g)),F||oe.forEach(g=>p(g)),F}(this.style,this.transform.zoom);B&&function(M,L,F){for(let $=0;$<F.length;$++)Ol(M,L,F[$])}(this,B,B.getVisibleCoordinates())}this.options.showPadding&&function(B){const M=B.transform.padding;Lr(B,B.transform.height-(M.top||0),3,Io),Lr(B,M.bottom||0,3,gi),Nl(B,M.left||0,3,bo),Nl(B,B.transform.width-(M.right||0),3,pc);const L=B.transform.centerPoint;(function(F,$,te,oe){wo(F,$-1,te-10,2,20,oe),wo(F,$-10,te-1,20,2,oe)})(B,L.x,B.transform.height-L.y,pl)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const n=this.terrainFacilitator.matrix,a=this.transform.modelViewProjectionMatrix;let o=this.terrainFacilitator.dirty;o||(o=e?!c.a_(n,a):!c.a$(n,a)),o||(o=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),o&&(c.b0(n,a),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(h,_){const w=h.context,B=w.gl,M=Zi.unblended,L=new ti(B.LEQUAL,ti.ReadWrite,[0,1]),F=_.getTerrainMesh(),$=_.sourceCache.getRenderableTiles(),te=h.useProgram("terrainDepth");w.bindFramebuffer.set(_.getFramebuffer("depth").framebuffer),w.viewport.set([0,0,h.width/devicePixelRatio,h.height/devicePixelRatio]),w.clear({color:c.aM.transparent,depth:1});for(const oe of $){const p=_.getTerrainData(oe.tileID),g={u_matrix:h.transform.calculatePosMatrix(oe.tileID.toUnwrapped()),u_ele_delta:_.getMeshFrameDelta(h.transform.zoom)};te.draw(w,B.TRIANGLES,L,ki.disabled,M,Ci.backCCW,g,p,"terrain",F.vertexBuffer,F.indexBuffer,F.segments)}w.bindFramebuffer.set(null),w.viewport.set([0,0,h.width,h.height])}(this,this.style.map.terrain),function(h,_){const w=h.context,B=w.gl,M=Zi.unblended,L=new ti(B.LEQUAL,ti.ReadWrite,[0,1]),F=_.getTerrainMesh(),$=_.getCoordsTexture(),te=_.sourceCache.getRenderableTiles(),oe=h.useProgram("terrainCoords");w.bindFramebuffer.set(_.getFramebuffer("coords").framebuffer),w.viewport.set([0,0,h.width/devicePixelRatio,h.height/devicePixelRatio]),w.clear({color:c.aM.transparent,depth:1}),_.coordsIndex=[];for(const p of te){const g=_.getTerrainData(p.tileID);w.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,$.texture);const A={u_matrix:h.transform.calculatePosMatrix(p.tileID.toUnwrapped()),u_terrain_coords_id:(255-_.coordsIndex.length)/255,u_texture:0,u_ele_delta:_.getMeshFrameDelta(h.transform.zoom)};oe.draw(w,B.TRIANGLES,L,ki.disabled,M,Ci.backCCW,A,g,"terrain",F.vertexBuffer,F.indexBuffer,F.segments),_.coordsIndex.push(p.tileID.key)}w.bindFramebuffer.set(null),w.viewport.set([0,0,h.width,h.height])}(this,this.style.map.terrain))}renderLayer(e,n,a,o){if(!a.isHidden(this.transform.zoom)&&(a.type==="background"||a.type==="custom"||(o||[]).length))switch(this.id=a.id,a.type){case"symbol":(function(h,_,w,B,M){if(h.renderPass!=="translucent")return;const L=ki.disabled,F=h.colorModeForRenderPass();(w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function($,te,oe,p,g,A,v,x,Q){const T=te.transform,k=ks(),q=g==="map",G=A==="map";for(const O of $){const re=p.getTile(O),K=re.getBucket(oe);if(!K||!K.text||!K.text.segments.get().length)continue;const U=c.ag(K.textSizeData,T.zoom),ne=ai(re,1,te.transform.zoom),le=Nn(O.posMatrix,G,q,te.transform,ne),se=oe.layout.get("icon-text-fit")!=="none"&&K.hasIconData();if(U){const ue=Math.pow(2,T.zoom-re.tileID.overscaledZ),Ie=te.style.map.terrain?(Be,Y)=>te.style.map.terrain.getElevation(O,Be,Y):null,pe=k.translatePosition(T,re,v,x);gs(K,q,G,Q,T,le,O.posMatrix,ue,U,se,k,pe,O.toUnwrapped(),Ie)}}}(B,h,w,_,w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),M),w.paint.get("icon-opacity").constantOr(1)!==0&&mo(h,_,w,B,!1,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),w.layout.get("icon-rotation-alignment"),w.layout.get("icon-pitch-alignment"),w.layout.get("icon-keep-upright"),L,F),w.paint.get("text-opacity").constantOr(1)!==0&&mo(h,_,w,B,!0,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.layout.get("text-keep-upright"),L,F),_.map.showCollisionBoxes&&(Pn(h,_,w,B,!0),Pn(h,_,w,B,!1))})(e,n,a,o,this.style.placement.variableOffsets);break;case"circle":(function(h,_,w,B){if(h.renderPass!=="translucent")return;const M=w.paint.get("circle-opacity"),L=w.paint.get("circle-stroke-width"),F=w.paint.get("circle-stroke-opacity"),$=!w.layout.get("circle-sort-key").isConstant();if(M.constantOr(1)===0&&(L.constantOr(1)===0||F.constantOr(1)===0))return;const te=h.context,oe=te.gl,p=h.depthModeForSublayer(0,ti.ReadOnly),g=ki.disabled,A=h.colorModeForRenderPass(),v=[];for(let x=0;x<B.length;x++){const Q=B[x],T=_.getTile(Q),k=T.getBucket(w);if(!k)continue;const q=k.programConfigurations.get(w.id),G=h.useProgram("circle",q),O=k.layoutVertexBuffer,re=k.indexBuffer,K=h.style.map.terrain&&h.style.map.terrain.getTerrainData(Q),U={programConfiguration:q,program:G,layoutVertexBuffer:O,indexBuffer:re,uniformValues:Rl(h,Q,T,w),terrainData:K};if($){const ne=k.segments.get();for(const le of ne)v.push({segments:new c.a0([le]),sortKey:le.sortKey,state:U})}else v.push({segments:k.segments,sortKey:0,state:U})}$&&v.sort((x,Q)=>x.sortKey-Q.sortKey);for(const x of v){const{programConfiguration:Q,program:T,layoutVertexBuffer:k,indexBuffer:q,uniformValues:G,terrainData:O}=x.state;T.draw(te,oe.TRIANGLES,p,g,A,Ci.disabled,G,O,w.id,k,q,x.segments,w.paint,h.transform.zoom,Q)}})(e,n,a,o);break;case"heatmap":(function(h,_,w,B){if(w.paint.get("heatmap-opacity")===0)return;const M=h.context;if(h.style.map.terrain){for(const L of B){const F=_.getTile(L);_.hasRenderableParent(L)||(h.renderPass==="offscreen"?Na(h,F,w,L):h.renderPass==="translucent"&&ps(h,w,L))}M.viewport.set([0,0,h.width,h.height])}else h.renderPass==="offscreen"?function(L,F,$,te){const oe=L.context,p=oe.gl,g=ki.disabled,A=new Zi([p.ONE,p.ONE],c.aM.transparent,[!0,!0,!0,!0]);(function(v,x,Q){const T=v.gl;v.activeTexture.set(T.TEXTURE1),v.viewport.set([0,0,x.width/4,x.height/4]);let k=Q.heatmapFbos.get(c.aU);k?(T.bindTexture(T.TEXTURE_2D,k.colorAttachment.get()),v.bindFramebuffer.set(k.framebuffer)):(k=ma(v,x.width/4,x.height/4),Q.heatmapFbos.set(c.aU,k))})(oe,L,$),oe.clear({color:c.aM.transparent});for(let v=0;v<te.length;v++){const x=te[v];if(F.hasRenderableParent(x))continue;const Q=F.getTile(x),T=Q.getBucket($);if(!T)continue;const k=T.programConfigurations.get($.id),q=L.useProgram("heatmap",k),{zoom:G}=L.transform;q.draw(oe,p.TRIANGLES,ti.disabled,g,A,Ci.disabled,Rr(x.posMatrix,Q,G,$.paint.get("heatmap-intensity")),null,$.id,T.layoutVertexBuffer,T.indexBuffer,T.segments,$.paint,L.transform.zoom,k)}oe.viewport.set([0,0,L.width,L.height])}(h,_,w,B):h.renderPass==="translucent"&&function(L,F){const $=L.context,te=$.gl;$.setColorMode(L.colorModeForRenderPass());const oe=F.heatmapFbos.get(c.aU);oe&&($.activeTexture.set(te.TEXTURE0),te.bindTexture(te.TEXTURE_2D,oe.colorAttachment.get()),$.activeTexture.set(te.TEXTURE1),ya($,F).bind(te.LINEAR,te.CLAMP_TO_EDGE),L.useProgram("heatmapTexture").draw($,te.TRIANGLES,ti.disabled,ki.disabled,L.colorModeForRenderPass(),Ci.disabled,Ra(L,F,0,1),null,F.id,L.viewportBuffer,L.quadTriangleIndexBuffer,L.viewportSegments,F.paint,L.transform.zoom))}(h,w)})(e,n,a,o);break;case"line":(function(h,_,w,B){if(h.renderPass!=="translucent")return;const M=w.paint.get("line-opacity"),L=w.paint.get("line-width");if(M.constantOr(1)===0||L.constantOr(1)===0)return;const F=h.depthModeForSublayer(0,ti.ReadOnly),$=h.colorModeForRenderPass(),te=w.paint.get("line-dasharray"),oe=w.paint.get("line-pattern"),p=oe.constantOr(1),g=w.paint.get("line-gradient"),A=w.getCrossfadeParameters(),v=p?"linePattern":te?"lineSDF":g?"lineGradient":"line",x=h.context,Q=x.gl;let T=!0;for(const k of B){const q=_.getTile(k);if(p&&!q.patternsLoaded())continue;const G=q.getBucket(w);if(!G)continue;const O=G.programConfigurations.get(w.id),re=h.context.program.get(),K=h.useProgram(v,O),U=T||K.program!==re,ne=h.style.map.terrain&&h.style.map.terrain.getTerrainData(k),le=oe.constantOr(null);if(le&&q.imageAtlas){const Ie=q.imageAtlas,pe=Ie.patternPositions[le.to.toString()],Be=Ie.patternPositions[le.from.toString()];pe&&Be&&O.setConstantPatternPositions(pe,Be)}const se=ne?k:null,ue=p?ha(h,q,w,A,se):te?Ac(h,q,w,te,A,se):g?Ll(h,q,w,G.lineClipsArray.length,se):La(h,q,w,se);if(p)x.activeTexture.set(Q.TEXTURE0),q.imageAtlasTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),O.updatePaintBuffers(A);else if(te&&(U||h.lineAtlas.dirty))x.activeTexture.set(Q.TEXTURE0),h.lineAtlas.bind(x);else if(g){const Ie=G.gradients[w.id];let pe=Ie.texture;if(w.gradientVersion!==Ie.version){let Be=256;if(w.stepInterpolant){const Y=_.getSource().maxzoom,z=k.canonical.z===Y?Math.ceil(1<<h.transform.maxZoom-k.canonical.z):1;Be=c.ac(c.aV(G.maxLineLength/c.X*1024*z),256,x.maxTextureSize)}Ie.gradient=c.aW({expression:w.gradientExpression(),evaluationKey:"lineProgress",resolution:Be,image:Ie.gradient||void 0,clips:G.lineClipsArray}),Ie.texture?Ie.texture.update(Ie.gradient):Ie.texture=new St(x,Ie.gradient,Q.RGBA),Ie.version=w.gradientVersion,pe=Ie.texture}x.activeTexture.set(Q.TEXTURE0),pe.bind(w.stepInterpolant?Q.NEAREST:Q.LINEAR,Q.CLAMP_TO_EDGE)}K.draw(x,Q.TRIANGLES,F,h.stencilModeForClipping(k),$,Ci.disabled,ue,ne,w.id,G.layoutVertexBuffer,G.indexBuffer,G.segments,w.paint,h.transform.zoom,O,G.layoutVertexBuffer2),T=!1}})(e,n,a,o);break;case"fill":(function(h,_,w,B){const M=w.paint.get("fill-color"),L=w.paint.get("fill-opacity");if(L.constantOr(1)===0)return;const F=h.colorModeForRenderPass(),$=w.paint.get("fill-pattern"),te=h.opaquePassEnabledForLayer()&&!$.constantOr(1)&&M.constantOr(c.aM.transparent).a===1&&L.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===te){const oe=h.depthModeForSublayer(1,h.renderPass==="opaque"?ti.ReadWrite:ti.ReadOnly);Oa(h,_,w,B,oe,F,!1)}if(h.renderPass==="translucent"&&w.paint.get("fill-antialias")){const oe=h.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,ti.ReadOnly);Oa(h,_,w,B,oe,F,!0)}})(e,n,a,o);break;case"fill-extrusion":(function(h,_,w,B){const M=w.paint.get("fill-extrusion-opacity");if(M!==0&&h.renderPass==="translucent"){const L=new ti(h.context.gl.LEQUAL,ti.ReadWrite,h.depthRangeFor3D);if(M!==1||w.paint.get("fill-extrusion-pattern").constantOr(1))_o(h,_,w,B,L,ki.disabled,Zi.disabled),_o(h,_,w,B,L,h.stencilModeFor3D(),h.colorModeForRenderPass());else{const F=h.colorModeForRenderPass();_o(h,_,w,B,L,ki.disabled,F)}}})(e,n,a,o);break;case"hillshade":(function(h,_,w,B){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent")return;const M=h.context,L=h.depthModeForSublayer(0,ti.ReadOnly),F=h.colorModeForRenderPass(),[$,te]=h.renderPass==="translucent"?h.stencilConfigForOverlap(B):[{},B];for(const oe of te){const p=_.getTile(oe);p.needsHillshadePrepare!==void 0&&p.needsHillshadePrepare&&h.renderPass==="offscreen"?Us(h,p,w,L,ki.disabled,F):h.renderPass==="translucent"&&_a(h,oe,p,w,L,$[oe.overscaledZ],F)}M.viewport.set([0,0,h.width,h.height])})(e,n,a,o);break;case"raster":(function(h,_,w,B){if(h.renderPass!=="translucent"||w.paint.get("raster-opacity")===0||!B.length)return;const M=h.context,L=M.gl,F=_.getSource(),$=h.useProgram("raster"),te=h.colorModeForRenderPass(),[oe,p]=F instanceof qr?[{},B]:h.stencilConfigForOverlap(B),g=p[p.length-1].overscaledZ,A=!h.options.moving;for(const v of p){const x=h.depthModeForSublayer(v.overscaledZ-g,w.paint.get("raster-opacity")===1?ti.ReadWrite:ti.ReadOnly,L.LESS),Q=_.getTile(v);Q.registerFadeDuration(w.paint.get("raster-fade-duration"));const T=_.findLoadedParent(v,0),k=_.findLoadedSibling(v),q=gl(Q,T||k||null,_,w,h.transform,h.style.map.terrain);let G,O;const re=w.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;M.activeTexture.set(L.TEXTURE0),Q.texture.bind(re,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),M.activeTexture.set(L.TEXTURE1),T?(T.texture.bind(re,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),G=Math.pow(2,T.tileID.overscaledZ-Q.tileID.overscaledZ),O=[Q.tileID.canonical.x*G%1,Q.tileID.canonical.y*G%1]):Q.texture.bind(re,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),Q.texture.useMipmap&&M.extTextureFilterAnisotropic&&h.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax);const K=h.style.map.terrain&&h.style.map.terrain.getTerrainData(v),U=K?v:null,ne=U?U.posMatrix:h.transform.calculatePosMatrix(v.toUnwrapped(),A),le=Fl(ne,O||[0,0],G||1,q,w);F instanceof qr?$.draw(M,L.TRIANGLES,x,ki.disabled,te,Ci.disabled,le,K,w.id,F.boundsBuffer,h.quadTriangleIndexBuffer,F.boundsSegments):$.draw(M,L.TRIANGLES,x,oe[v.overscaledZ],te,Ci.disabled,le,K,w.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}})(e,n,a,o);break;case"background":(function(h,_,w,B){const M=w.paint.get("background-color"),L=w.paint.get("background-opacity");if(L===0)return;const F=h.context,$=F.gl,te=h.transform,oe=te.tileSize,p=w.paint.get("background-pattern");if(h.isPatternMissing(p))return;const g=!p&&M.a===1&&L===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==g)return;const A=ki.disabled,v=h.depthModeForSublayer(0,g==="opaque"?ti.ReadWrite:ti.ReadOnly),x=h.colorModeForRenderPass(),Q=h.useProgram(p?"backgroundPattern":"background"),T=B||te.coveringTiles({tileSize:oe,terrain:h.style.map.terrain});p&&(F.activeTexture.set($.TEXTURE0),h.imageManager.bind(h.context));const k=w.getCrossfadeParameters();for(const q of T){const G=B?q.posMatrix:h.transform.calculatePosMatrix(q.toUnwrapped()),O=p?As(G,L,h,p,{tileID:q,tileSize:oe},k):Ps(G,L,M),re=h.style.map.terrain&&h.style.map.terrain.getTerrainData(q);Q.draw(F,$.TRIANGLES,v,A,x,Ci.disabled,O,re,w.id,h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}})(e,0,a,o);break;case"custom":(function(h,_,w){const B=h.context,M=w.implementation;if(h.renderPass==="offscreen"){const L=M.prerender;L&&(h.setCustomLayerDefaults(),B.setColorMode(h.colorModeForRenderPass()),L.call(M,B.gl,h.transform.customLayerMatrix()),B.setDirty(),h.setBaseState())}else if(h.renderPass==="translucent"){h.setCustomLayerDefaults(),B.setColorMode(h.colorModeForRenderPass()),B.setStencilMode(ki.disabled);const L=M.renderingMode==="3d"?new ti(h.context.gl.LEQUAL,ti.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,ti.ReadOnly);B.setDepthMode(L),M.render(B.gl,h.transform.customLayerMatrix(),{farZ:h.transform.farZ,nearZ:h.transform.nearZ,fov:h.transform._fov,modelViewProjectionMatrix:h.transform.modelViewProjectionMatrix,projectionMatrix:h.transform.projectionMatrix}),B.setDirty(),h.setBaseState(),B.bindFramebuffer.set(null)}})(e,0,a)}}translatePosMatrix(e,n,a,o,h){if(!a[0]&&!a[1])return e;const _=h?o==="map"?this.transform.angle:0:o==="viewport"?-this.transform.angle:0;if(_){const M=Math.sin(_),L=Math.cos(_);a=[a[0]*L-a[1]*M,a[0]*M+a[1]*L]}const w=[h?a[0]:ai(n,a[0],this.transform.zoom),h?a[1]:ai(n,a[1],this.transform.zoom),0],B=new Float32Array(16);return c.J(B,e,w),B}saveTileTexture(e){const n=this._tileTextures[e.size[0]];n?n.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const n=this._tileTextures[e];return n&&n.length>0?n.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const n=this.imageManager.getPattern(e.from.toString()),a=this.imageManager.getPattern(e.to.toString());return!n||!a}useProgram(e,n){this.cache=this.cache||{};const a=e+(n?n.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[a]||(this.cache[a]=new so(this.context,Jr[e],n,Rs[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[a]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new St(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:n}=this.context.gl;return this.width!==e||this.height!==n}}class ba{constructor(e,n){this.points=e,this.planes=n}static fromInvProjectionMatrix(e,n,a){const o=Math.pow(2,a),h=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const B=1/(w=c.af([],w,e))[3]/n*o;return c.b1(w,w,[B,B,1/w[3],B])}),_=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const B=function($,te){var oe=te[0],p=te[1],g=te[2],A=oe*oe+p*p+g*g;return A>0&&(A=1/Math.sqrt(A)),$[0]=te[0]*A,$[1]=te[1]*A,$[2]=te[2]*A,$}([],function($,te,oe){var p=te[0],g=te[1],A=te[2],v=oe[0],x=oe[1],Q=oe[2];return $[0]=g*Q-A*x,$[1]=A*v-p*Q,$[2]=p*x-g*v,$}([],ut([],h[w[0]],h[w[1]]),ut([],h[w[2]],h[w[1]]))),M=-((L=B)[0]*(F=h[w[1]])[0]+L[1]*F[1]+L[2]*F[2]);var L,F;return B.concat(M)});return new ba(h,_)}}class Ln{constructor(e,n){this.min=e,this.max=n,this.center=function(a,o,h){return a[0]=.5*o[0],a[1]=.5*o[1],a[2]=.5*o[2],a}([],function(a,o,h){return a[0]=o[0]+h[0],a[1]=o[1]+h[1],a[2]=o[2]+h[2],a}([],this.min,this.max))}quadrant(e){const n=[e%2==0,e<2],a=dt(this.min),o=dt(this.max);for(let h=0;h<n.length;h++)a[h]=n[h]?this.min[h]:this.center[h],o[h]=n[h]?this.center[h]:this.max[h];return o[2]=this.max[2],new Ln(a,o)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let a=!0;for(let o=0;o<e.planes.length;o++){const h=e.planes[o];let _=0;for(let w=0;w<n.length;w++)c.b2(h,n[w])>=0&&_++;if(_===0)return 0;_!==n.length&&(a=!1)}if(a)return 2;for(let o=0;o<3;o++){let h=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let w=0;w<e.points.length;w++){const B=e.points[w][o]-this.min[o];h=Math.min(h,B),_=Math.max(_,B)}if(_<0||h>this.max[o]-this.min[o])return 0}return 1}}class Jn{constructor(e=0,n=0,a=0,o=0){if(isNaN(e)||e<0||isNaN(n)||n<0||isNaN(a)||a<0||isNaN(o)||o<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=n,this.left=a,this.right=o}interpolate(e,n,a){return n.top!=null&&e.top!=null&&(this.top=c.y.number(e.top,n.top,a)),n.bottom!=null&&e.bottom!=null&&(this.bottom=c.y.number(e.bottom,n.bottom,a)),n.left!=null&&e.left!=null&&(this.left=c.y.number(e.left,n.left,a)),n.right!=null&&e.right!=null&&(this.right=c.y.number(e.right,n.right,a)),this}getCenter(e,n){const a=c.ac((this.left+e-this.right)/2,0,e),o=c.ac((this.top+n-this.bottom)/2,0,n);return new c.P(a,o)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Jn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const wa=85.051129;class Yn{constructor(e,n,a,o,h){this.tileSize=512,this._renderWorldCopies=h===void 0||!!h,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=a??0,this._maxPitch=o??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new c.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Jn,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new Yn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const n=-c.b3(e,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=function(){var a=new c.A(4);return c.A!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a}(),function(a,o,h){var _=o[0],w=o[1],B=o[2],M=o[3],L=Math.sin(h),F=Math.cos(h);a[0]=_*F+B*L,a[1]=w*F+M*L,a[2]=_*-L+B*F,a[3]=w*-L+M*F}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const n=c.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const n=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this.tileZoom=Math.max(0,Math.floor(n)),this.scale=this.zoomScale(n),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,n,a){this._unmodified=!1,this._edgeInsets.interpolate(e,n,a),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const n=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(e){const n=[new c.b4(0,e)];if(this._renderWorldCopies){const a=this.pointCoordinate(new c.P(0,0)),o=this.pointCoordinate(new c.P(this.width,0)),h=this.pointCoordinate(new c.P(this.width,this.height)),_=this.pointCoordinate(new c.P(0,this.height)),w=Math.floor(Math.min(a.x,o.x,h.x,_.x)),B=Math.floor(Math.max(a.x,o.x,h.x,_.x)),M=1;for(let L=w-M;L<=B+M;L++)L!==0&&n.push(new c.b4(L,e))}return n}coveringTiles(e){var n,a;let o=this.coveringZoomLevel(e);const h=o;if(e.minzoom!==void 0&&o<e.minzoom)return[];e.maxzoom!==void 0&&o>e.maxzoom&&(o=e.maxzoom);const _=this.pointCoordinate(this.getCameraPoint()),w=c.Z.fromLngLat(this.center),B=Math.pow(2,o),M=[B*_.x,B*_.y,0],L=[B*w.x,B*w.y,0],F=ba.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,o);let $=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&($=o);const te=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,oe=x=>({aabb:new Ln([x*B,0,0],[(x+1)*B,B,0]),zoom:0,x:0,y:0,wrap:x,fullyVisible:!1}),p=[],g=[],A=o,v=e.reparseOverscaled?h:o;if(this._renderWorldCopies)for(let x=1;x<=3;x++)p.push(oe(-x)),p.push(oe(x));for(p.push(oe(0));p.length>0;){const x=p.pop(),Q=x.x,T=x.y;let k=x.fullyVisible;if(!k){const K=x.aabb.intersects(F);if(K===0)continue;k=K===2}const q=e.terrain?M:L,G=x.aabb.distanceX(q),O=x.aabb.distanceY(q),re=Math.max(Math.abs(G),Math.abs(O));if(x.zoom===A||re>te+(1<<A-x.zoom)-2&&x.zoom>=$){const K=A-x.zoom,U=M[0]-.5-(Q<<K),ne=M[1]-.5-(T<<K);g.push({tileID:new c.S(x.zoom===A?v:x.zoom,x.wrap,x.zoom,Q,T),distanceSq:ft([L[0]-.5-Q,L[1]-.5-T]),tileDistanceToCamera:Math.sqrt(U*U+ne*ne)})}else for(let K=0;K<4;K++){const U=(Q<<1)+K%2,ne=(T<<1)+(K>>1),le=x.zoom+1;let se=x.aabb.quadrant(K);if(e.terrain){const ue=new c.S(le,x.wrap,le,U,ne),Ie=e.terrain.getMinMaxElevation(ue),pe=(n=Ie.minElevation)!==null&&n!==void 0?n:this.elevation,Be=(a=Ie.maxElevation)!==null&&a!==void 0?a:this.elevation;se=new Ln([se.min[0],se.min[1],pe],[se.max[0],se.max[1],Be])}p.push({aabb:se,zoom:le,x:U,y:ne,wrap:x.wrap,fullyVisible:k})}}return g.sort((x,Q)=>x.distanceSq-Q.distanceSq).map(x=>x.tileID)}resize(e,n){this.width=e,this.height=n,this.pixelsToGLUnits=[2/e,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const n=c.ac(e.lat,-85.051129,wa);return new c.P(c.O(e.lng)*this.worldSize,c.Q(n)*this.worldSize)}unproject(e){return new c.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const n=this.elevation,a=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,o=this.pointLocation(this.centerPoint,e),h=e.getElevationForLngLatZoom(o,this.tileZoom);if(!(this.elevation-h))return;const _=a+n-h,w=Math.cos(this._pitch)*this.cameraToCenterDistance/_/c.b5(1,o.lat),B=this.scaleZoom(w/this.tileSize);this._elevation=h,this._center=o,this.zoom=B}setLocationAtPoint(e,n){const a=this.pointCoordinate(n),o=this.pointCoordinate(this.centerPoint),h=this.locationCoordinate(e),_=new c.Z(h.x-(a.x-o.x),h.y-(a.y-o.y));this.center=this.coordinateLocation(_),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,n){return n?this.coordinatePoint(this.locationCoordinate(e),n.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,n){return this.coordinateLocation(this.pointCoordinate(e,n))}locationCoordinate(e){return c.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,n){if(n){const $=n.pointCoordinate(e);if($!=null)return $}const a=[e.x,e.y,0,1],o=[e.x,e.y,1,1];c.af(a,a,this.pixelMatrixInverse),c.af(o,o,this.pixelMatrixInverse);const h=a[3],_=o[3],w=a[1]/h,B=o[1]/_,M=a[2]/h,L=o[2]/_,F=M===L?0:(0-M)/(L-M);return new c.Z(c.y.number(a[0]/h,o[0]/_,F)/this.worldSize,c.y.number(w,B,F)/this.worldSize)}coordinatePoint(e,n=0,a=this.pixelMatrix){const o=[e.x*this.worldSize,e.y*this.worldSize,n,1];return c.af(o,o,a),new c.P(o[0]/o[3],o[1]/o[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new Re().extend(this.pointLocation(new c.P(0,e))).extend(this.pointLocation(new c.P(this.width,e))).extend(this.pointLocation(new c.P(this.width,this.height))).extend(this.pointLocation(new c.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Re([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,wa])}calculateTileMatrix(e){const n=e.canonical,a=this.worldSize/this.zoomScale(n.z),o=n.x+Math.pow(2,n.z)*e.wrap,h=c.an(new Float64Array(16));return c.J(h,h,[o*a,n.y*a,0]),c.K(h,h,[a/c.X,a/c.X,1]),h}calculatePosMatrix(e,n=!1){const a=e.key,o=n?this._alignedPosMatrixCache:this._posMatrixCache;if(o[a])return o[a];const h=this.calculateTileMatrix(e);return c.L(h,n?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,h),o[a]=new Float32Array(h),o[a]}calculateFogMatrix(e){const n=e.key,a=this._fogMatrixCache;if(a[n])return a[n];const o=this.calculateTileMatrix(e);return c.L(o,this.fogMatrix,o),a[n]=new Float32Array(o),a[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,n){n=c.ac(+n,this.minZoom,this.maxZoom);const a={center:new c.N(e.lng,e.lat),zoom:n};let o=this.lngRange;if(!this._renderWorldCopies&&o===null){const x=179.9999999999;o=[-x,x]}const h=this.tileSize*this.zoomScale(a.zoom);let _=0,w=h,B=0,M=h,L=0,F=0;const{x:$,y:te}=this.size;if(this.latRange){const x=this.latRange;_=c.Q(x[1])*h,w=c.Q(x[0])*h,w-_<te&&(L=te/(w-_))}o&&(B=c.b3(c.O(o[0])*h,0,h),M=c.b3(c.O(o[1])*h,0,h),M<B&&(M+=h),M-B<$&&(F=$/(M-B)));const{x:oe,y:p}=this.project.call({worldSize:h},e);let g,A;const v=Math.max(F||0,L||0);if(v){const x=new c.P(F?(M+B)/2:oe,L?(w+_)/2:p);return a.center=this.unproject.call({worldSize:h},x).wrap(),a.zoom+=this.scaleZoom(v),a}if(this.latRange){const x=te/2;p-x<_&&(A=_+x),p+x>w&&(A=w-x)}if(o){const x=(B+M)/2;let Q=oe;this._renderWorldCopies&&(Q=c.b3(oe,x-h/2,x+h/2));const T=$/2;Q-T<B&&(g=B+T),Q+T>M&&(g=M-T)}if(g!==void 0||A!==void 0){const x=new c.P(g??oe,A??p);a.center=this.unproject.call({worldSize:h},x).wrap()}return a}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:n,zoom:a}=this.getConstrained(this.center,this.zoom);this.center=n,this.zoom=a,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,n=this.point.x,a=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=c.b5(1,this.center.lat)*this.worldSize;let o=c.an(new Float64Array(16));c.K(o,o,[this.width/2,-this.height/2,1]),c.J(o,o,[1,-1,0]),this.labelPlaneMatrix=o,o=c.an(new Float64Array(16)),c.K(o,o,[1,-1,1]),c.J(o,o,[-1,-1,0]),c.K(o,o,[2/this.width,2/this.height,1]),this.glCoordMatrix=o;const h=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),_=Math.min(this.elevation,this.minElevationForCurrentTile),w=h-_*this._pixelPerMeter/Math.cos(this._pitch),B=_<0?w:h,M=Math.PI/2+this._pitch,L=this._fov*(.5+e.y/this.height),F=Math.sin(L)*B/Math.sin(c.ac(Math.PI-M-L,.01,Math.PI-.01)),$=this.getHorizon(),te=2*Math.atan($/this.cameraToCenterDistance)*(.5+e.y/(2*$)),oe=Math.sin(te)*B/Math.sin(c.ac(Math.PI-M-te,.01,Math.PI-.01)),p=Math.min(F,oe);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*p+B),this.nearZ=this.height/50,o=new Float64Array(16),c.b6(o,this._fov,this.width/this.height,this.nearZ,this.farZ),o[8]=2*-e.x/this.width,o[9]=2*e.y/this.height,this.projectionMatrix=c.ae(o),c.K(o,o,[1,-1,1]),c.J(o,o,[0,0,-this.cameraToCenterDistance]),c.b7(o,o,this._pitch),c.ad(o,o,this.angle),c.J(o,o,[-n,-a,0]),this.mercatorMatrix=c.K([],o,[this.worldSize,this.worldSize,this.worldSize]),c.K(o,o,[1,1,this._pixelPerMeter]),this.pixelMatrix=c.L(new Float64Array(16),this.labelPlaneMatrix,o),c.J(o,o,[0,0,-this.elevation]),this.modelViewProjectionMatrix=o,this.invModelViewProjectionMatrix=c.as([],o),this.fogMatrix=new Float64Array(16),c.b6(this.fogMatrix,this._fov,this.width/this.height,h,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,c.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),c.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),c.b7(this.fogMatrix,this.fogMatrix,this._pitch),c.ad(this.fogMatrix,this.fogMatrix,this.angle),c.J(this.fogMatrix,this.fogMatrix,[-n,-a,0]),c.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),c.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=c.L(new Float64Array(16),this.labelPlaneMatrix,o);const g=this.width%2/2,A=this.height%2/2,v=Math.cos(this.angle),x=Math.sin(this.angle),Q=n-Math.round(n)+v*g+x*A,T=a-Math.round(a)+v*A+x*g,k=new Float64Array(o);if(c.J(k,k,[Q>.5?Q-1:Q,T>.5?T-1:T,0]),this.alignedModelViewProjectionMatrix=k,o=c.as(new Float64Array(16),this.pixelMatrix),!o)throw new Error("failed to invert matrix");this.pixelMatrixInverse=o,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new c.P(0,0)),n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return c.af(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(0,e))}getCameraQueryGeometry(e){const n=this.getCameraPoint();if(e.length===1)return[e[0],n];{let a=n.x,o=n.y,h=n.x,_=n.y;for(const w of e)a=Math.min(a,w.x),o=Math.min(o,w.y),h=Math.max(h,w.x),_=Math.max(_,w.y);return[new c.P(a,o),new c.P(h,o),new c.P(h,_),new c.P(a,_),new c.P(a,o)]}}lngLatToCameraDepth(e,n){const a=this.locationCoordinate(e),o=[a.x*this.worldSize,a.y*this.worldSize,n,1];return c.af(o,o,this.modelViewProjectionMatrix),o[2]/o[3]}}function ms(u,e){let n,a=!1,o=null,h=null;const _=()=>{o=null,a&&(u.apply(h,n),o=setTimeout(_,e),a=!1)};return(...w)=>(a=!0,h=this,n=w,o||_(),o)}class Ns{constructor(e){this._getCurrentHash=()=>{const n=window.location.hash.replace("#","");if(this._hashName){let a;return n.split("&").map(o=>o.split("=")).forEach(o=>{o[0]===this._hashName&&(a=o)}),(a&&a[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{const n=this._getCurrentHash();if(n.length>=3&&!n.some(a=>isNaN(a))){const a=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:a,pitch:+(n[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const n=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,n)},this._removeHash=()=>{const n=this._getCurrentHash();if(n.length===0)return;const a=n.join("/");let o=a;o.split("&").length>0&&(o=o.split("&")[0]),this._hashName&&(o=`${this._hashName}=${a}`);let h=window.location.hash.replace(o,"");h.startsWith("#&")?h=h.slice(0,1)+h.slice(2):h==="#"&&(h="");let _=window.location.href.replace(/(#.+)?$/,h);_=_.replace("&&","&"),window.history.replaceState(window.history.state,null,_)},this._updateHash=ms(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const n=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,o=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),h=Math.pow(10,o),_=Math.round(n.lng*h)/h,w=Math.round(n.lat*h)/h,B=this._map.getBearing(),M=this._map.getPitch();let L="";if(L+=e?`/${_}/${w}/${a}`:`${a}/${w}/${_}`,(B||M)&&(L+="/"+Math.round(10*B)/10),M&&(L+=`/${Math.round(M)}`),this._hashName){const F=this._hashName;let $=!1;const te=window.location.hash.slice(1).split("&").map(oe=>{const p=oe.split("=")[0];return p===F?($=!0,`${p}=${L}`):oe}).filter(oe=>oe);return $||te.push(`${F}=${L}`),`#${te.join("&")}`}return`#${L}`}}const Os={linearity:.3,easing:c.b8(0,0,.3,1)},ys=c.e({deceleration:2500,maxSpeed:1400},Os),Bo=c.e({deceleration:20,maxSpeed:1400},Os),ml=c.e({deceleration:1e3,maxSpeed:360},Os),Co=c.e({deceleration:1e3,maxSpeed:90},Os);class yl{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Qe.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,n=Qe.now();for(;e.length>0&&n-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:h}of this._inertiaBuffer)n.zoom+=h.zoomDelta||0,n.bearing+=h.bearingDelta||0,n.pitch+=h.pitchDelta||0,h.panDelta&&n.pan._add(h.panDelta),h.around&&(n.around=h.around),h.pinchAround&&(n.pinchAround=h.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,o={};if(n.pan.mag()){const h=Va(n.pan.mag(),a,c.e({},ys,e||{}));o.offset=n.pan.mult(h.amount/n.pan.mag()),o.center=this._map.transform.center,qa(o,h)}if(n.zoom){const h=Va(n.zoom,a,Bo);o.zoom=this._map.transform.zoom+h.amount,qa(o,h)}if(n.bearing){const h=Va(n.bearing,a,ml);o.bearing=this._map.transform.bearing+c.ac(h.amount,-179,179),qa(o,h)}if(n.pitch){const h=Va(n.pitch,a,Co);o.pitch=this._map.transform.pitch+h.amount,qa(o,h)}if(o.zoom||o.bearing){const h=n.pinchAround===void 0?n.around:n.pinchAround;o.around=h?this._map.unproject(h):this._map.getCenter()}return this.clear(),c.e(o,{noMoveStart:!0})}}function qa(u,e){(!u.duration||u.duration<e.duration)&&(u.duration=e.duration,u.easing=e.easing)}function Va(u,e,n){const{maxSpeed:a,linearity:o,deceleration:h}=n,_=c.ac(u*o/(e/1e3),-a,a),w=Math.abs(_)/(h*o);return{easing:n.easing,duration:1e3*w,amount:_*(w/2)}}class tr extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,a,o={}){const h=me.mousePos(n.getCanvas(),a),_=n.unproject(h);super(e,c.e({point:h,lngLat:_,originalEvent:a},o)),this._defaultPrevented=!1,this.target=n}}class qs extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,a){const o=e==="touchend"?a.changedTouches:a.touches,h=me.touchPos(n.getCanvasContainer(),o),_=h.map(B=>n.unproject(B)),w=h.reduce((B,M,L,F)=>B.add(M.div(F.length)),new c.P(0,0));super(e,{points:h,point:w,lngLats:_,lngLat:n.unproject(w),originalEvent:a}),this._defaultPrevented=!1}}class ql extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,a){super(e,{originalEvent:a}),this._defaultPrevented=!1}}class Vl{constructor(e,n){this._map=e,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new ql(e.type,this._map,e))}mousedown(e,n){return this._mousedownPos=n,this._firePreventable(new tr(e.type,this._map,e))}mouseup(e){this._map.fire(new tr(e.type,this._map,e))}click(e,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new tr(e.type,this._map,e))}dblclick(e){return this._firePreventable(new tr(e.type,this._map,e))}mouseover(e){this._map.fire(new tr(e.type,this._map,e))}mouseout(e){this._map.fire(new tr(e.type,this._map,e))}touchstart(e){return this._firePreventable(new qs(e.type,this._map,e))}touchmove(e){this._map.fire(new qs(e.type,this._map,e))}touchend(e){this._map.fire(new qs(e.type,this._map,e))}touchcancel(e){this._map.fire(new qs(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Xi{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new tr(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new tr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new tr(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class In{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(c.P.convert(e),this._map.terrain)}}class Kr{constructor(e,n){this._map=e,this._tr=new In(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,n){this.isEnabled()&&e.shiftKey&&e.button===0&&(me.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(e,n){if(!this._active)return;const a=n;if(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)return;const o=this._startPos;this._lastPos=a,this._box||(this._box=me.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const h=Math.min(o.x,a.x),_=Math.max(o.x,a.x),w=Math.min(o.y,a.y),B=Math.max(o.y,a.y);me.setTransform(this._box,`translate(${h}px,${w}px)`),this._box.style.width=_-h+"px",this._box.style.height=B-w+"px"}mouseupWindow(e,n){if(!this._active||e.button!==0)return;const a=this._startPos,o=n;if(this.reset(),me.suppressClick(),a.x!==o.x||a.y!==o.y)return this._map.fire(new c.k("boxzoomend",{originalEvent:e})),{cameraAnimation:h=>h.fitScreenCoordinates(a,o,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(me.remove(this._box),this._box=null),me.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,n){return this._map.fire(new c.k(e,{originalEvent:n}))}}function Ha(u,e){if(u.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${u.length}, points ${e.length}`);const n={};for(let a=0;a<u.length;a++)n[u[a].identifier]=e[a];return n}class ja{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,n,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),a.length===this.numTouches&&(this.centroid=function(o){const h=new c.P(0,0);for(const _ of o)h._add(_);return h.div(o.length)}(n),this.touches=Ha(a,n)))}touchmove(e,n,a){if(this.aborted||!this.centroid)return;const o=Ha(a,n);for(const h in this.touches){const _=o[h];(!_||_.dist(this.touches[h])>30)&&(this.aborted=!0)}}touchend(e,n,a){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){const o=!this.aborted&&this.centroid;if(this.reset(),o)return o}}}class Eo{constructor(e){this.singleTap=new ja(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,n,a){this.singleTap.touchstart(e,n,a)}touchmove(e,n,a){this.singleTap.touchmove(e,n,a)}touchend(e,n,a){const o=this.singleTap.touchend(e,n,a);if(o){const h=e.timeStamp-this.lastTime<500,_=!this.lastTap||this.lastTap.dist(o)<30;if(h&&_||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=o,this.count===this.numTaps)return this.reset(),o}}}class Qr{constructor(e){this._tr=new In(e),this._zoomIn=new Eo({numTouches:1,numTaps:2}),this._zoomOut=new Eo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,n,a){this._zoomIn.touchstart(e,n,a),this._zoomOut.touchstart(e,n,a)}touchmove(e,n,a){this._zoomIn.touchmove(e,n,a),this._zoomOut.touchmove(e,n,a)}touchend(e,n,a){const o=this._zoomIn.touchend(e,n,a),h=this._zoomOut.touchend(e,n,a),_=this._tr;return o?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:_.zoom+1,around:_.unproject(o)},{originalEvent:e})}):h?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:_.zoom-1,around:_.unproject(h)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bn{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const n=this._moveFunction(...e);if(n.bearingDelta||n.pitchDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(e,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=n.length?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,n){if(!this.isEnabled())return;const a=this._lastPoint;if(!a)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const o=n.length?n[0]:n;return!this._moved&&o.dist(a)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=o,this._move(a,o))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&me.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Qo={0:1,2:2};class So{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const n=me.mouseButton(e);this._eventButton=n}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(n,a){const o=Qo[a];return n.buttons===void 0||(n.buttons&o)!==o}(e,this._eventButton)}isValidEndEvent(e){return me.mouseButton(e)===this._eventButton}}class ko{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const Ja=u=>{u.mousedown=u.dragStart,u.mousemoveWindow=u.dragMove,u.mouseup=u.dragEnd,u.contextmenu=e=>{e.preventDefault()}},Vs=({enable:u,clickTolerance:e,bearingDegreesPerPixelMoved:n=.8})=>{const a=new So({checkCorrectEvent:o=>me.mouseButton(o)===0&&o.ctrlKey||me.mouseButton(o)===2});return new bn({clickTolerance:e,move:(o,h)=>({bearingDelta:(h.x-o.x)*n}),moveStateManager:a,enable:u,assignEvents:Ja})},Ya=({enable:u,clickTolerance:e,pitchDegreesPerPixelMoved:n=-.5})=>{const a=new So({checkCorrectEvent:o=>me.mouseButton(o)===0&&o.ctrlKey||me.mouseButton(o)===2});return new bn({clickTolerance:e,move:(o,h)=>({pitchDelta:(h.y-o.y)*n}),moveStateManager:a,enable:u,assignEvents:Ja})};class Hs{constructor(e,n){this._clickTolerance=e.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,n,a){return this._calculateTransform(e,n,a)}touchmove(e,n,a){if(this._active){if(!this._shouldBePrevented(a.length))return e.preventDefault(),this._calculateTransform(e,n,a);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,n,a){this._calculateTransform(e,n,a),this._active&&this._shouldBePrevented(a.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,n,a){a.length>0&&(this._active=!0);const o=Ha(a,n),h=new c.P(0,0),_=new c.P(0,0);let w=0;for(const M in o){const L=o[M],F=this._touches[M];F&&(h._add(L),_._add(L.sub(F)),w++,o[M]=L)}if(this._touches=o,this._shouldBePrevented(w)||!_.mag())return;const B=_.div(w);return this._sum._add(B),this._sum.mag()<this._clickTolerance?void 0:{around:h.div(w),panDelta:B}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class js{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,n,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([n[0],n[1]]))}touchmove(e,n,a){if(!this._firstTwoTouches)return;e.preventDefault();const[o,h]=this._firstTwoTouches,_=Ka(a,n,o),w=Ka(a,n,h);if(!_||!w)return;const B=this._aroundCenter?null:_.add(w).div(2);return this._move([_,w],B,e)}touchend(e,n,a){if(!this._firstTwoTouches)return;const[o,h]=this._firstTwoTouches,_=Ka(a,n,o),w=Ka(a,n,h);_&&w||(this._active&&me.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ka(u,e,n){for(let a=0;a<u.length;a++)if(u[a].identifier===n)return e[a]}function va(u,e){return Math.log(u/e)/Math.LN2}class _l extends js{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,n){const a=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(va(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:va(this._distance,a),pinchAround:n}}}function Il(u,e){return 180*u.angleWith(e)/Math.PI}class bl extends js{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,n,a){const o=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Il(this._vector,o),pinchAround:n}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const n=25/(Math.PI*this._minDiameter)*360,a=Il(e,this._startVector);return Math.abs(a)<n}}function Do(u){return Math.abs(u.y)>Math.abs(u.x)}class Kn extends js{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,n,a){super.touchstart(e,n,a),this._currentTouchCount=a.length}_start(e){this._lastPoints=e,Do(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,n,a){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const o=e[0].sub(this._lastPoints[0]),h=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(o,h,a.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(o.y+h.y)/2*-.5}):void 0}gestureBeginsVertically(e,n,a){if(this._valid!==void 0)return this._valid;const o=e.mag()>=2,h=n.mag()>=2;if(!o&&!h)return;if(!o||!h)return this._firstMove===void 0&&(this._firstMove=a),a-this._firstMove<100&&void 0;const _=e.y>0==n.y>0;return Do(e)&&Do(n)&&_}}const wl={panStep:100,bearingStep:15,pitchStep:10};class an{constructor(e){this._tr=new In(e);const n=wl;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let n=0,a=0,o=0,h=0,_=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?a=-1:(e.preventDefault(),h=-1);break;case 39:e.shiftKey?a=1:(e.preventDefault(),h=1);break;case 38:e.shiftKey?o=1:(e.preventDefault(),_=-1);break;case 40:e.shiftKey?o=-1:(e.preventDefault(),_=1);break;default:return}return this._rotationDisabled&&(a=0,o=0),{cameraAnimation:w=>{const B=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:Zr,zoom:n?Math.round(B.zoom)+n*(e.shiftKey?2:1):B.zoom,bearing:B.bearing+a*this._bearingStep,pitch:B.pitch+o*this._pitchStep,offset:[-h*this._panStep,-_*this._panStep],center:B.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Zr(u){return u*(2-u)}const Zn=4.000244140625;class wn{constructor(e,n){this._onTimeout=a=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)},this._map=e,this._tr=new In(e),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let n=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const a=Qe.now(),o=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,n!==0&&n%Zn==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":o>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(o*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=me.mousePos(this._map.getCanvas(),e),a=this._tr;this._around=n.y>a.transform.height/2-a.transform.getHorizon()?c.N.convert(this._aroundCenter?a.center:a.unproject(n)):c.N.convert(a.center),this._aroundPoint=a.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const B=this._type==="wheel"&&Math.abs(this._delta)>Zn?this._wheelZoomRate:this._defaultZoomRate;let M=2/(1+Math.exp(-Math.abs(this._delta*B)));this._delta<0&&M!==0&&(M=1/M);const L=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(L*M))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,a=this._startZoom,o=this._easing;let h,_=!1;const w=Qe.now()-this._lastWheelEventTime;if(this._type==="wheel"&&a&&o&&w){const B=Math.min(w/200,1),M=o(B);h=c.y.number(a,n,M),B<1?this._frameId||(this._frameId=!0):_=!0}else h=n,_=!0;return this._active=!0,_&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!_,zoomDelta:h-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let n=c.b9;if(this._prevEase){const a=this._prevEase,o=(Qe.now()-a.start)/a.duration,h=a.easing(o+.01)-a.easing(o),_=.27/Math.sqrt(h*h+1e-4)*.01,w=Math.sqrt(.0729-_*_);n=c.b8(_,w,.25,1)}return this._prevEase={start:Qe.now(),duration:e,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Js{constructor(e,n){this._clickZoom=e,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class on{constructor(e){this._tr=new In(e),this.reset()}reset(){this._active=!1}dblclick(e,n){return e.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(n)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hl{constructor(){this._tap=new Eo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,n,a){if(!this._swipePoint)if(this._tapTime){const o=n[0],h=e.timeStamp-this._tapTime<500,_=this._tapPoint.dist(o)<30;h&&_?a.length>0&&(this._swipePoint=o,this._swipeTouch=a[0].identifier):this.reset()}else this._tap.touchstart(e,n,a)}touchmove(e,n,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const o=n[0],h=o.y-this._swipePoint.y;return this._swipePoint=o,e.preventDefault(),this._active=!0,{zoomDelta:h/128}}}else this._tap.touchmove(e,n,a)}touchend(e,n,a){if(this._tapTime)this._swipePoint&&a.length===0&&this.reset();else{const o=this._tap.touchend(e,n,a);o&&(this._tapTime=e.timeStamp,this._tapPoint=o)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vl{constructor(e,n,a){this._el=e,this._mousePan=n,this._touchPan=a}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class jl{constructor(e,n,a){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=n,this._mousePitch=a}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Mo{constructor(e,n,a,o){this._el=e,this._touchZoom=n,this._touchRotate=a,this._tapDragZoom=o,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class $n{constructor(e,n){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=n,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=me.create("div","maplibregl-cooperative-gesture-screen",e);let n=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(n=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const a=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),o=document.createElement("div");o.className="maplibregl-desktop-message",o.textContent=n,this._container.appendChild(o);const h=document.createElement("div");h.className="maplibregl-mobile-message",h.textContent=a,this._container.appendChild(h),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(me.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,n){this._enabled&&(this._map.fire(new c.k("cooperativegestureprevented",{gestureType:e,originalEvent:n})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Sr=u=>u.zoom||u.drag||u.pitch||u.rotate;class mt extends c.k{}function xa(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class Za{constructor(e,n){this.handleWindowEvent=o=>{this.handleEvent(o,`${o.type}Window`)},this.handleEvent=(o,h)=>{if(o.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const _=o.type==="renderFrame"?void 0:o,w={needsRenderFrame:!1},B={},M={},L=o.touches,F=L?this._getMapTouches(L):void 0,$=F?me.touchPos(this._map.getCanvas(),F):me.mousePos(this._map.getCanvas(),o);for(const{handlerName:p,handler:g,allowed:A}of this._handlers){if(!g.isEnabled())continue;let v;this._blockedByActive(M,A,p)?g.reset():g[h||o.type]&&(v=g[h||o.type](o,$,F),this.mergeHandlerResult(w,B,v,p,_),v&&v.needsRenderFrame&&this._triggerRenderFrame()),(v||g.isActive())&&(M[p]=g)}const te={};for(const p in this._previousActiveHandlers)M[p]||(te[p]=_);this._previousActiveHandlers=M,(Object.keys(te).length||xa(w))&&(this._changes.push([w,B,te]),this._triggerRenderFrame()),(Object.keys(M).length||xa(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:oe}=w;oe&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],oe(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new yl(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[window,"blur",void 0]];for(const[o,h,_]of this._listeners)me.addEventListener(o,h,o===document?this.handleWindowEvent:this.handleEvent,_)}destroy(){for(const[e,n,a]of this._listeners)me.removeEventListener(e,n,e===document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(e){const n=this._map,a=n.getCanvasContainer();this._add("mapEvent",new Vl(n,e));const o=n.boxZoom=new Kr(n,e);this._add("boxZoom",o),e.interactive&&e.boxZoom&&o.enable();const h=n.cooperativeGestures=new $n(n,e.cooperativeGestures);this._add("cooperativeGestures",h),e.cooperativeGestures&&h.enable();const _=new Qr(n),w=new on(n);n.doubleClickZoom=new Js(w,_),this._add("tapZoom",_),this._add("clickZoom",w),e.interactive&&e.doubleClickZoom&&n.doubleClickZoom.enable();const B=new Hl;this._add("tapDragZoom",B);const M=n.touchPitch=new Kn(n);this._add("touchPitch",M),e.interactive&&e.touchPitch&&n.touchPitch.enable(e.touchPitch);const L=Vs(e),F=Ya(e);n.dragRotate=new jl(e,L,F),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]),e.interactive&&e.dragRotate&&n.dragRotate.enable();const $=(({enable:v,clickTolerance:x})=>{const Q=new So({checkCorrectEvent:T=>me.mouseButton(T)===0&&!T.ctrlKey});return new bn({clickTolerance:x,move:(T,k)=>({around:k,panDelta:k.sub(T)}),activateOnStart:!0,moveStateManager:Q,enable:v,assignEvents:Ja})})(e),te=new Hs(e,n);n.dragPan=new vl(a,$,te),this._add("mousePan",$),this._add("touchPan",te,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&n.dragPan.enable(e.dragPan);const oe=new bl,p=new _l;n.touchZoomRotate=new Mo(a,p,oe,B),this._add("touchRotate",oe,["touchPan","touchZoom"]),this._add("touchZoom",p,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&n.touchZoomRotate.enable(e.touchZoomRotate);const g=n.scrollZoom=new wn(n,()=>this._triggerRenderFrame());this._add("scrollZoom",g,["mousePan"]),e.interactive&&e.scrollZoom&&n.scrollZoom.enable(e.scrollZoom);const A=n.keyboard=new an(n);this._add("keyboard",A),e.interactive&&e.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new Xi(n))}_add(e,n,a){this._handlers.push({handlerName:e,handler:n,allowed:a}),this._handlersById[e]=n}stop(e){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Sr(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,n,a){for(const o in e)if(o!==a&&(!n||n.indexOf(o)<0))return!0;return!1}_getMapTouches(e){const n=[];for(const a of e)this._el.contains(a.target)&&n.push(a);return n}mergeHandlerResult(e,n,a,o,h){if(!a)return;c.e(e,a);const _={handlerName:o,originalEvent:a.originalEvent||h};a.zoomDelta!==void 0&&(n.zoom=_),a.panDelta!==void 0&&(n.drag=_),a.pitchDelta!==void 0&&(n.pitch=_),a.bearingDelta!==void 0&&(n.rotate=_)}_applyChanges(){const e={},n={},a={};for(const[o,h,_]of this._changes)o.panDelta&&(e.panDelta=(e.panDelta||new c.P(0,0))._add(o.panDelta)),o.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+o.zoomDelta),o.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+o.bearingDelta),o.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+o.pitchDelta),o.around!==void 0&&(e.around=o.around),o.pinchAround!==void 0&&(e.pinchAround=o.pinchAround),o.noInertia&&(e.noInertia=o.noInertia),c.e(n,h),c.e(a,_);this._updateMapTransform(e,n,a),this._changes=[]}_updateMapTransform(e,n,a){const o=this._map,h=o._getTransformForUpdate(),_=o.terrain;if(!(xa(e)||_&&this._terrainMovement))return this._fireEvents(n,a,!0);let{panDelta:w,zoomDelta:B,bearingDelta:M,pitchDelta:L,around:F,pinchAround:$}=e;$!==void 0&&(F=$),o._stop(!0),F=F||o.transform.centerPoint;const te=h.pointLocation(w?F.sub(w):F);M&&(h.bearing+=M),L&&(h.pitch+=L),B&&(h.zoom+=B),_?this._terrainMovement||!n.drag&&!n.zoom?n.drag&&this._terrainMovement?h.center=h.pointLocation(h.centerPoint.sub(w)):h.setLocationAtPoint(te,F):(this._terrainMovement=!0,this._map._elevationFreeze=!0,h.setLocationAtPoint(te,F)):h.setLocationAtPoint(te,F),o._applyUpdatedTransform(h),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(n,a,!0)}_fireEvents(e,n,a){const o=Sr(this._eventsInProgress),h=Sr(e),_={};for(const F in e){const{originalEvent:$}=e[F];this._eventsInProgress[F]||(_[`${F}start`]=$),this._eventsInProgress[F]=e[F]}!o&&h&&this._fireEvent("movestart",h.originalEvent);for(const F in _)this._fireEvent(F,_[F]);h&&this._fireEvent("move",h.originalEvent);for(const F in e){const{originalEvent:$}=e[F];this._fireEvent(F,$)}const w={};let B;for(const F in this._eventsInProgress){const{handlerName:$,originalEvent:te}=this._eventsInProgress[F];this._handlersById[$].isActive()||(delete this._eventsInProgress[F],B=n[$]||te,w[`${F}end`]=B)}for(const F in w)this._fireEvent(F,w[F]);const M=Sr(this._eventsInProgress),L=(o||h)&&!M;if(L&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const F=this._map._getTransformForUpdate();F.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(F)}if(a&&L){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),$=te=>te!==0&&-this._bearingSnap<te&&te<this._bearingSnap;!F||!F.essential&&Qe.prefersReducedMotion?(this._map.fire(new c.k("moveend",{originalEvent:B})),$(this._map.getBearing())&&this._map.resetNorth()):($(F.bearing||this._map.getBearing())&&(F.bearing=0),F.freezeElevation=!0,this._map.easeTo(F,{originalEvent:B})),this._updatingCamera=!1}}_fireEvent(e,n){this._map.fire(new c.k(e,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new mt("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class $a extends c.E{constructor(e,n){super(),this._renderFrameCallback=()=>{const a=Math.min((Qe.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(a)),a<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=n.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new c.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,n){return this.jumpTo({center:e},n)}panBy(e,n,a){return e=c.P.convert(e).mult(-1),this.panTo(this.transform.center,c.e({offset:e},n),a)}panTo(e,n,a){return this.easeTo(c.e({center:e},n),a)}getZoom(){return this.transform.zoom}setZoom(e,n){return this.jumpTo({zoom:e},n),this}zoomTo(e,n,a){return this.easeTo(c.e({zoom:e},n),a)}zoomIn(e,n){return this.zoomTo(this.getZoom()+1,e,n),this}zoomOut(e,n){return this.zoomTo(this.getZoom()-1,e,n),this}getBearing(){return this.transform.bearing}setBearing(e,n){return this.jumpTo({bearing:e},n),this}getPadding(){return this.transform.padding}setPadding(e,n){return this.jumpTo({padding:e},n),this}rotateTo(e,n,a){return this.easeTo(c.e({bearing:e},n),a)}resetNorth(e,n){return this.rotateTo(0,c.e({duration:1e3},e),n),this}resetNorthPitch(e,n){return this.easeTo(c.e({bearing:0,pitch:0,duration:1e3},e),n),this}snapToNorth(e,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,n):this}getPitch(){return this.transform.pitch}setPitch(e,n){return this.jumpTo({pitch:e},n),this}cameraForBounds(e,n){e=Re.convert(e).adjustAntiMeridian();const a=n&&n.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),a,n)}_cameraForBoxAndBearing(e,n,a,o){const h={top:0,bottom:0,right:0,left:0};if(typeof(o=c.e({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=="number"){const K=o.padding;o.padding={top:K,bottom:K,right:K,left:K}}o.padding=c.e(h,o.padding);const _=this.transform,w=_.padding,B=new Re(e,n),M=_.project(B.getNorthWest()),L=_.project(B.getNorthEast()),F=_.project(B.getSouthEast()),$=_.project(B.getSouthWest()),te=c.ba(-a),oe=M.rotate(te),p=L.rotate(te),g=F.rotate(te),A=$.rotate(te),v=new c.P(Math.max(oe.x,p.x,A.x,g.x),Math.max(oe.y,p.y,A.y,g.y)),x=new c.P(Math.min(oe.x,p.x,A.x,g.x),Math.min(oe.y,p.y,A.y,g.y)),Q=v.sub(x),T=(_.width-(w.left+w.right+o.padding.left+o.padding.right))/Q.x,k=(_.height-(w.top+w.bottom+o.padding.top+o.padding.bottom))/Q.y;if(k<0||T<0)return void c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const q=Math.min(_.scaleZoom(_.scale*Math.min(T,k)),o.maxZoom),G=c.P.convert(o.offset),O=new c.P((o.padding.left-o.padding.right)/2,(o.padding.top-o.padding.bottom)/2).rotate(c.ba(a)),re=G.add(O).mult(_.scale/_.zoomScale(q));return{center:_.unproject(M.add(F).div(2).sub(re)),zoom:q,bearing:a}}fitBounds(e,n,a){return this._fitInternal(this.cameraForBounds(e,n),n,a)}fitScreenCoordinates(e,n,a,o,h){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(c.P.convert(e)),this.transform.pointLocation(c.P.convert(n)),a,o),o,h)}_fitInternal(e,n,a){return e?(delete(n=c.e(e,n)).padding,n.linear?this.easeTo(n,a):this.flyTo(n,a)):this}jumpTo(e,n){this.stop();const a=this._getTransformForUpdate();let o=!1,h=!1,_=!1;return"zoom"in e&&a.zoom!==+e.zoom&&(o=!0,a.zoom=+e.zoom),e.center!==void 0&&(a.center=c.N.convert(e.center)),"bearing"in e&&a.bearing!==+e.bearing&&(h=!0,a.bearing=+e.bearing),"pitch"in e&&a.pitch!==+e.pitch&&(_=!0,a.pitch=+e.pitch),e.padding==null||a.isPaddingEqual(e.padding)||(a.padding=e.padding),this._applyUpdatedTransform(a),this.fire(new c.k("movestart",n)).fire(new c.k("move",n)),o&&this.fire(new c.k("zoomstart",n)).fire(new c.k("zoom",n)).fire(new c.k("zoomend",n)),h&&this.fire(new c.k("rotatestart",n)).fire(new c.k("rotate",n)).fire(new c.k("rotateend",n)),_&&this.fire(new c.k("pitchstart",n)).fire(new c.k("pitch",n)).fire(new c.k("pitchend",n)),this.fire(new c.k("moveend",n))}calculateCameraOptionsFromTo(e,n,a,o=0){const h=c.Z.fromLngLat(e,n),_=c.Z.fromLngLat(a,o),w=_.x-h.x,B=_.y-h.y,M=_.z-h.z,L=Math.hypot(w,B,M);if(L===0)throw new Error("Can't calculate camera options with same From and To");const F=Math.hypot(w,B),$=this.transform.scaleZoom(this.transform.cameraToCenterDistance/L/this.transform.tileSize),te=180*Math.atan2(w,-B)/Math.PI;let oe=180*Math.acos(F/L)/Math.PI;return oe=M<0?90-oe:90+oe,{center:_.toLngLat(),zoom:$,pitch:oe,bearing:te}}easeTo(e,n){var a;this._stop(!1,e.easeId),((e=c.e({offset:[0,0],duration:500,easing:c.b9},e)).animate===!1||!e.essential&&Qe.prefersReducedMotion)&&(e.duration=0);const o=this._getTransformForUpdate(),h=o.zoom,_=o.bearing,w=o.pitch,B=o.padding,M="bearing"in e?this._normalizeBearing(e.bearing,_):_,L="pitch"in e?+e.pitch:w,F="padding"in e?e.padding:o.padding,$=c.P.convert(e.offset);let te=o.centerPoint.add($);const oe=o.pointLocation(te),{center:p,zoom:g}=o.getConstrained(c.N.convert(e.center||oe),(a=e.zoom)!==null&&a!==void 0?a:h);this._normalizeCenter(p,o);const A=o.project(oe),v=o.project(p).sub(A),x=o.zoomScale(g-h);let Q,T;e.around&&(Q=c.N.convert(e.around),T=o.locationPoint(Q));const k={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||g!==h,this._rotating=this._rotating||_!==M,this._pitching=this._pitching||L!==w,this._padding=!o.isPaddingEqual(F),this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,k),this.terrain&&this._prepareElevation(p),this._ease(q=>{if(this._zooming&&(o.zoom=c.y.number(h,g,q)),this._rotating&&(o.bearing=c.y.number(_,M,q)),this._pitching&&(o.pitch=c.y.number(w,L,q)),this._padding&&(o.interpolatePadding(B,F,q),te=o.centerPoint.add($)),this.terrain&&!e.freezeElevation&&this._updateElevation(q),Q)o.setLocationAtPoint(Q,T);else{const G=o.zoomScale(o.zoom-h),O=g>h?Math.min(2,x):Math.max(.5,x),re=Math.pow(O,1-q),K=o.unproject(A.add(v.mult(q*re)).mult(G));o.setLocationAtPoint(o.renderWorldCopies?K.wrap():K,te)}this._applyUpdatedTransform(o),this._fireMoveEvents(n)},q=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n,q)},e),this}_prepareEase(e,n,a={}){this._moving=!0,n||a.moving||this.fire(new c.k("movestart",e)),this._zooming&&!a.zooming&&this.fire(new c.k("zoomstart",e)),this._rotating&&!a.rotating&&this.fire(new c.k("rotatestart",e)),this._pitching&&!a.pitching&&this.fire(new c.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&n!==this._elevationTarget){const a=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(a-(n-(a*e+this._elevationStart))/(1-e)),this._elevationTarget=n}this.transform.elevation=c.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const n=e.getCameraPosition(),a=this.terrain.getElevationForLngLatZoom(n.lngLat,e.zoom);if(n.altitude<a){const o=this.calculateCameraOptionsFromTo(n.lngLat,a,e.center,e.elevation);return{pitch:o.pitch,zoom:o.zoom}}return{}}_applyUpdatedTransform(e){const n=[];if(this.terrain&&n.push(o=>this._elevateCameraIfInsideTerrain(o)),this.transformCameraUpdate&&n.push(o=>this.transformCameraUpdate(o)),!n.length)return;const a=e.clone();for(const o of n){const h=a.clone(),{center:_,zoom:w,pitch:B,bearing:M,elevation:L}=o(h);_&&(h.center=_),w!==void 0&&(h.zoom=w),B!==void 0&&(h.pitch=B),M!==void 0&&(h.bearing=M),L!==void 0&&(h.elevation=L),a.apply(h)}this.transform.apply(a)}_fireMoveEvents(e){this.fire(new c.k("move",e)),this._zooming&&this.fire(new c.k("zoom",e)),this._rotating&&this.fire(new c.k("rotate",e)),this._pitching&&this.fire(new c.k("pitch",e))}_afterEase(e,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const a=this._zooming,o=this._rotating,h=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,a&&this.fire(new c.k("zoomend",e)),o&&this.fire(new c.k("rotateend",e)),h&&this.fire(new c.k("pitchend",e)),this.fire(new c.k("moveend",e))}flyTo(e,n){var a;if(!e.essential&&Qe.prefersReducedMotion){const ue=c.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ue,n)}this.stop(),e=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.b9},e);const o=this._getTransformForUpdate(),h=o.zoom,_=o.bearing,w=o.pitch,B=o.padding,M="bearing"in e?this._normalizeBearing(e.bearing,_):_,L="pitch"in e?+e.pitch:w,F="padding"in e?e.padding:o.padding,$=c.P.convert(e.offset);let te=o.centerPoint.add($);const oe=o.pointLocation(te),{center:p,zoom:g}=o.getConstrained(c.N.convert(e.center||oe),(a=e.zoom)!==null&&a!==void 0?a:h);this._normalizeCenter(p,o);const A=o.zoomScale(g-h),v=o.project(oe),x=o.project(p).sub(v);let Q=e.curve;const T=Math.max(o.width,o.height),k=T/A,q=x.mag();if("minZoom"in e){const ue=c.ac(Math.min(e.minZoom,h,g),o.minZoom,o.maxZoom),Ie=T/o.zoomScale(ue-h);Q=Math.sqrt(Ie/q*2)}const G=Q*Q;function O(ue){const Ie=(k*k-T*T+(ue?-1:1)*G*G*q*q)/(2*(ue?k:T)*G*q);return Math.log(Math.sqrt(Ie*Ie+1)-Ie)}function re(ue){return(Math.exp(ue)-Math.exp(-ue))/2}function K(ue){return(Math.exp(ue)+Math.exp(-ue))/2}const U=O(!1);let ne=function(ue){return K(U)/K(U+Q*ue)},le=function(ue){return T*((K(U)*(re(Ie=U+Q*ue)/K(Ie))-re(U))/G)/q;var Ie},se=(O(!0)-U)/Q;if(Math.abs(q)<1e-6||!isFinite(se)){if(Math.abs(T-k)<1e-6)return this.easeTo(e,n);const ue=k<T?-1:1;se=Math.abs(Math.log(k/T))/Q,le=()=>0,ne=Ie=>Math.exp(ue*Q*Ie)}return e.duration="duration"in e?+e.duration:1e3*se/("screenSpeed"in e?+e.screenSpeed/Q:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=_!==M,this._pitching=L!==w,this._padding=!o.isPaddingEqual(F),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(p),this._ease(ue=>{const Ie=ue*se,pe=1/ne(Ie);o.zoom=ue===1?g:h+o.scaleZoom(pe),this._rotating&&(o.bearing=c.y.number(_,M,ue)),this._pitching&&(o.pitch=c.y.number(w,L,ue)),this._padding&&(o.interpolatePadding(B,F,ue),te=o.centerPoint.add($)),this.terrain&&!e.freezeElevation&&this._updateElevation(ue);const Be=ue===1?p:o.unproject(v.add(x.mult(le(Ie))).mult(pe));o.setLocationAtPoint(o.renderWorldCopies?Be.wrap():Be,te),this._applyUpdatedTransform(o),this._fireMoveEvents(n)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,n){var a;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const o=this._onEaseEnd;delete this._onEaseEnd,o.call(this,n)}return e||(a=this.handlers)===null||a===void 0||a.stop(!1),this}_ease(e,n,a){a.animate===!1||a.duration===0?(e(1),n()):(this._easeStart=Qe.now(),this._easeOptions=a,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,n){e=c.b3(e,-180,180);const a=Math.abs(e-n);return Math.abs(e-360-n)<a&&(e-=360),Math.abs(e+360-n)<a&&(e+=360),e}_normalizeCenter(e,n){if(!n.renderWorldCopies||n.lngRange)return;const a=e.lng-n.center.lng;e.lng+=a>180?-360:a<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(c.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const Xn={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class _s{constructor(e=Xn){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=me.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=me.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=me.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){me.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,n){const a=this._map._getUIString(`AttributionControl.${n}`);e.title=a,e.setAttribute("aria-label",a)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(o=>typeof o!="string"?"":o)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const o=this._map.style.stylesheet;this.styleOwner=o.owner,this.styleId=o.id}const n=this._map.style.sourceCaches;for(const o in n){const h=n[o];if(h.used||h.usedForTerrain){const _=h.getSource();_.attribution&&e.indexOf(_.attribution)<0&&e.push(_.attribution)}}e=e.filter(o=>String(o).trim()),e.sort((o,h)=>o.length-h.length),e=e.filter((o,h)=>{for(let _=h+1;_<e.length;_++)if(e[_].indexOf(o)>=0)return!1;return!0});const a=e.join(" | ");a!==this._attribHTML&&(this._attribHTML=a,e.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Li{constructor(e={}){this._updateCompact=()=>{const n=this._container.children;if(n.length){const a=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&a.classList.add("maplibregl-compact"):a.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=me.create("div","maplibregl-ctrl");const n=me.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){me.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class oi{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const n=++this._id;return this._queue.push({callback:e,id:n,cancelled:!1}),n}remove(e){const n=this._currentlyRunning,a=n?this._queue.concat(n):this._queue;for(const o of a)if(o.id===e)return void(o.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const a of n)if(!a.cancelled&&(a.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var xl=c.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Ys extends c.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,n){this.sourceCache.update(e,n),this._renderableTilesKeys=[];const a={};for(const o of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n}))a[o.key]=!0,this._renderableTilesKeys.push(o.key),this._tiles[o.key]||(o.posMatrix=new Float64Array(16),c.aP(o.posMatrix,0,c.X,0,c.X,0,1),this._tiles[o.key]=new nn(o,this.tileSize));for(const o in this._tiles)a[o]||delete this._tiles[o]}freeRtt(e){for(const n in this._tiles){const a=this._tiles[n];(!e||a.tileID.equals(e)||a.tileID.isChildOf(e)||e.isChildOf(a.tileID))&&(a.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const n={};for(const a of this._renderableTilesKeys){const o=this._tiles[a].tileID;if(o.canonical.equals(e.canonical)){const h=e.clone();h.posMatrix=new Float64Array(16),c.aP(h.posMatrix,0,c.X,0,c.X,0,1),n[a]=h}else if(o.canonical.isChildOf(e.canonical)){const h=e.clone();h.posMatrix=new Float64Array(16);const _=o.canonical.z-e.canonical.z,w=o.canonical.x-(o.canonical.x>>_<<_),B=o.canonical.y-(o.canonical.y>>_<<_),M=c.X>>_;c.aP(h.posMatrix,0,M,0,M,0,1),c.J(h.posMatrix,h.posMatrix,[-w*M,-B*M,0]),n[a]=h}else if(e.canonical.isChildOf(o.canonical)){const h=e.clone();h.posMatrix=new Float64Array(16);const _=e.canonical.z-o.canonical.z,w=e.canonical.x-(e.canonical.x>>_<<_),B=e.canonical.y-(e.canonical.y>>_<<_),M=c.X>>_;c.aP(h.posMatrix,0,c.X,0,c.X,0,1),c.J(h.posMatrix,h.posMatrix,[w*M,B*M,0]),c.K(h.posMatrix,h.posMatrix,[1/2**_,1/2**_,0]),n[a]=h}}return n}getSourceTile(e,n){const a=this.sourceCache._source;let o=e.overscaledZ-this.deltaZoom;if(o>a.maxzoom&&(o=a.maxzoom),o<a.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(o).key);let h=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!h||!h.dem)&&n)for(;o>=a.minzoom&&(!h||!h.dem);)h=this.sourceCache.getTileByID(e.scaledTo(o--).key);return h}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(n=>n.timeAdded>=e)}}class To{constructor(e,n,a){this.painter=e,this.sourceCache=new Ys(n),this.options=a,this.exaggeration=typeof a.exaggeration=="number"?a.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,n,a,o=c.X){var h;if(!(n>=0&&n<o&&a>=0&&a<o))return 0;const _=this.getTerrainData(e),w=(h=_.tile)===null||h===void 0?void 0:h.dem;if(!w)return 0;const B=function(oe,p,g){var A=p[0],v=p[1];return oe[0]=g[0]*A+g[4]*v+g[12],oe[1]=g[1]*A+g[5]*v+g[13],oe}([],[n/o*c.X,a/o*c.X],_.u_terrain_matrix),M=[B[0]*w.dim,B[1]*w.dim],L=Math.floor(M[0]),F=Math.floor(M[1]),$=M[0]-L,te=M[1]-F;return w.get(L,F)*(1-$)*(1-te)+w.get(L+1,F)*$*(1-te)+w.get(L,F+1)*(1-$)*te+w.get(L+1,F+1)*$*te}getElevationForLngLatZoom(e,n){if(!c.bb(n,e.wrap()))return 0;const{tileID:a,mercatorX:o,mercatorY:h}=this._getOverscaledTileIDFromLngLatZoom(e,n);return this.getElevation(a,o%c.X,h%c.X,c.X)}getElevation(e,n,a,o=c.X){return this.getDEMElevation(e,n,a,o)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const o=this.painter.context,h=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new St(o,h,o.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new St(o,new c.R({width:1,height:1}),o.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.an([])}const n=this.sourceCache.getSourceTile(e,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const o=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new St(o,n.dem.getPixels(),o.gl.RGBA,{premultiply:!1}),n.demTexture.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const a=n&&n+n.tileID.key+e.key;if(a&&!this._demMatrixCache[a]){const o=this.sourceCache.sourceCache._source.maxzoom;let h=e.canonical.z-n.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=o?h=e.canonical.z-o:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const _=e.canonical.x-(e.canonical.x>>h<<h),w=e.canonical.y-(e.canonical.y>>h<<h),B=c.bc(new Float64Array(16),[1/(c.X<<h),1/(c.X<<h),0]);c.J(B,B,[_*c.X,w*c.X,0]),this._demMatrixCache[e.key]={matrix:B,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:a?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(e){const n=this.painter,a=n.width/devicePixelRatio,o=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===a&&this._fbo.height===o||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new St(n.context,{width:a,height:o,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new St(n.context,{width:a,height:o,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(a,o,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,a,o))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let h=0,_=0;h<this._coordsTextureSize;h++)for(let w=0;w<this._coordsTextureSize;w++,_+=4)n[_+0]=255&w,n[_+1]=255&h,n[_+2]=w>>8<<4|h>>8,n[_+3]=0;const a=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),o=new St(e,a,e.gl.RGBA,{premultiply:!1});return o.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=o,o}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const n=new Uint8Array(4),a=this.painter.context,o=a.gl,h=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),_=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),w=Math.round(this.painter.height/devicePixelRatio);a.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),o.readPixels(h,w-_-1,1,1,o.RGBA,o.UNSIGNED_BYTE,n),a.bindFramebuffer.set(null);const B=n[0]+(n[2]>>4<<8),M=n[1]+((15&n[2])<<8),L=this.coordsIndex[255-n[3]],F=L&&this.sourceCache.getTileByID(L);if(!F)return null;const $=this._coordsTextureSize,te=(1<<F.tileID.canonical.z)*$;return new c.Z((F.tileID.canonical.x*$+B)/te+F.tileID.wrap,(F.tileID.canonical.y*$+M)/te,this.getElevation(F.tileID,B,M,$))}depthAtPoint(e){const n=new Uint8Array(4),a=this.painter.context,o=a.gl;return a.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),o.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,o.RGBA,o.UNSIGNED_BYTE,n),a.bindFramebuffer.set(null),(n[0]/16777216+n[1]/65536+n[2]/256+n[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,n=new c.bd,a=new c.aY,o=this.meshSize,h=c.X/o,_=o*o;for(let F=0;F<=o;F++)for(let $=0;$<=o;$++)n.emplaceBack($*h,F*h,0);for(let F=0;F<_;F+=o+1)for(let $=0;$<o;$++)a.emplaceBack($+F,o+$+F+1,o+$+F+2),a.emplaceBack($+F,o+$+F+2,$+F+1);const w=n.length,B=w+2*(o+1);for(const F of[0,1])for(let $=0;$<=o;$++)for(const te of[0,1])n.emplaceBack($*h,F*c.X,te);for(let F=0;F<2*o;F+=2)a.emplaceBack(B+F,B+F+1,B+F+3),a.emplaceBack(B+F,B+F+3,B+F+2),a.emplaceBack(w+F,w+F+3,w+F+1),a.emplaceBack(w+F,w+F+2,w+F+3);const M=n.length,L=M+2*(o+1);for(const F of[0,1])for(let $=0;$<=o;$++)for(const te of[0,1])n.emplaceBack(F*c.X,$*h,te);for(let F=0;F<2*o;F+=2)a.emplaceBack(M+F,M+F+1,M+F+3),a.emplaceBack(M+F,M+F+3,M+F+2),a.emplaceBack(L+F,L+F+3,L+F+1),a.emplaceBack(L+F,L+F+2,L+F+3);return this._mesh=new Ia(e.createVertexBuffer(n,xl.members),e.createIndexBuffer(a),c.a0.simpleSegment(0,0,n.length,a.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*c.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,n){var a;const{tileID:o}=this._getOverscaledTileIDFromLngLatZoom(e,n);return(a=this.getMinMaxElevation(o).minElevation)!==null&&a!==void 0?a:0}getMinMaxElevation(e){const n=this.getTerrainData(e).tile,a={minElevation:null,maxElevation:null};return n&&n.dem&&(a.minElevation=n.dem.min*this.exaggeration,a.maxElevation=n.dem.max*this.exaggeration),a}_getOverscaledTileIDFromLngLatZoom(e,n){const a=c.Z.fromLngLat(e.wrap()),o=(1<<n)*c.X,h=a.x*o,_=a.y*o,w=Math.floor(h/c.X),B=Math.floor(_/c.X);return{tileID:new c.S(n,0,n,w,B),mercatorX:h,mercatorY:_}}}class Jl{constructor(e,n,a){this._context=e,this._size=n,this._tileSize=a,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),a=new St(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return a.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(a.texture),{id:e,fbo:n,texture:a,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(n=>e.id!==n),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const Ks={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Bl{constructor(e,n){this.painter=e,this.terrain=n,this.pool=new Jl(e.context,30,n.sourceCache.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(a=>!e._layers[a].isHidden(n)),this._coordsDescendingInv={};for(const a in e.sourceCaches){this._coordsDescendingInv[a]={};const o=e.sourceCaches[a].getVisibleCoordinates();for(const h of o){const _=this.terrain.sourceCache.getTerrainCoords(h);for(const w in _)this._coordsDescendingInv[a][w]||(this._coordsDescendingInv[a][w]=[]),this._coordsDescendingInv[a][w].push(_[w])}}this._coordsDescendingInvStr={};for(const a of e._order){const o=e._layers[a],h=o.source;if(Ks[o.type]&&!this._coordsDescendingInvStr[h]){this._coordsDescendingInvStr[h]={};for(const _ in this._coordsDescendingInv[h])this._coordsDescendingInvStr[h][_]=this._coordsDescendingInv[h][_].map(w=>w.key).sort().join()}}for(const a of this._renderableTiles)for(const o in this._coordsDescendingInvStr){const h=this._coordsDescendingInvStr[o][a.tileID.key];h&&h!==a.rttCoords[o]&&(a.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const n=e.type,a=this.painter,o=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Ks[n]&&(this._prevType&&Ks[this._prevType]||this._stacks.push([]),this._prevType=n,this._stacks[this._stacks.length-1].push(e.id),!o))return!0;if(Ks[this._prevType]||Ks[n]&&o){this._prevType=n;const h=this._stacks.length-1,_=this._stacks[h]||[];for(const w of this._renderableTiles){if(this.pool.isFull()&&(vo(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(w),w.rtt[h]){const M=this.pool.getObjectForId(w.rtt[h].id);if(M.stamp===w.rtt[h].stamp){this.pool.useObject(M);continue}}const B=this.pool.getOrCreateFreeObject();this.pool.useObject(B),this.pool.stampObject(B),w.rtt[h]={id:B.id,stamp:B.stamp},a.context.bindFramebuffer.set(B.fbo.framebuffer),a.context.clear({color:c.aM.transparent,stencil:0}),a.currentStencilSource=void 0;for(let M=0;M<_.length;M++){const L=a.style._layers[_[M]],F=L.source?this._coordsDescendingInv[L.source][w.tileID.key]:[w.tileID];a.context.viewport.set([0,0,B.fbo.width,B.fbo.height]),a._renderTileClippingMasks(L,F),a.renderLayer(a,a.style.sourceCaches[L.source],L,F),L.source&&(w.rttCoords[L.source]=this._coordsDescendingInvStr[L.source][w.tileID.key])}}return vo(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Ks[n]}return!1}}const Xa={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Po=he,Yl={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Xn,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Cl=u=>{u.touchstart=u.dragStart,u.touchmoveWindow=u.dragMove,u.touchend=u.dragEnd},Kl={showCompass:!0,showZoom:!0,visualizePitch:!1};class mc{constructor(e,n,a=!1){this.mousedown=_=>{this.startMouse(c.e({},_,{ctrlKey:!0,preventDefault:()=>_.preventDefault()}),me.mousePos(this.element,_)),me.addEventListener(window,"mousemove",this.mousemove),me.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=_=>{this.moveMouse(_,me.mousePos(this.element,_))},this.mouseup=_=>{this.mouseRotate.dragEnd(_),this.mousePitch&&this.mousePitch.dragEnd(_),this.offTemp()},this.touchstart=_=>{_.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=me.touchPos(this.element,_.targetTouches)[0],this.startTouch(_,this._startPos),me.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),me.addEventListener(window,"touchend",this.touchend))},this.touchmove=_=>{_.targetTouches.length!==1?this.reset():(this._lastPos=me.touchPos(this.element,_.targetTouches)[0],this.moveTouch(_,this._lastPos))},this.touchend=_=>{_.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const o=e.dragRotate._mouseRotate.getClickTolerance(),h=e.dragRotate._mousePitch.getClickTolerance();this.element=n,this.mouseRotate=Vs({clickTolerance:o,enable:!0}),this.touchRotate=(({enable:_,clickTolerance:w,bearingDegreesPerPixelMoved:B=.8})=>{const M=new ko;return new bn({clickTolerance:w,move:(L,F)=>({bearingDelta:(F.x-L.x)*B}),moveStateManager:M,enable:_,assignEvents:Cl})})({clickTolerance:o,enable:!0}),this.map=e,a&&(this.mousePitch=Ya({clickTolerance:h,enable:!0}),this.touchPitch=(({enable:_,clickTolerance:w,pitchDegreesPerPixelMoved:B=-.5})=>{const M=new ko;return new bn({clickTolerance:w,move:(L,F)=>({pitchDelta:(F.y-L.y)*B}),moveStateManager:M,enable:_,assignEvents:Cl})})({clickTolerance:h,enable:!0})),me.addEventListener(n,"mousedown",this.mousedown),me.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),me.addEventListener(n,"touchcancel",this.reset)}startMouse(e,n){this.mouseRotate.dragStart(e,n),this.mousePitch&&this.mousePitch.dragStart(e,n),me.disableDrag()}startTouch(e,n){this.touchRotate.dragStart(e,n),this.touchPitch&&this.touchPitch.dragStart(e,n),me.disableDrag()}moveMouse(e,n){const a=this.map,{bearingDelta:o}=this.mouseRotate.dragMove(e,n)||{};if(o&&a.setBearing(a.getBearing()+o),this.mousePitch){const{pitchDelta:h}=this.mousePitch.dragMove(e,n)||{};h&&a.setPitch(a.getPitch()+h)}}moveTouch(e,n){const a=this.map,{bearingDelta:o}=this.touchRotate.dragMove(e,n)||{};if(o&&a.setBearing(a.getBearing()+o),this.touchPitch){const{pitchDelta:h}=this.touchPitch.dragMove(e,n)||{};h&&a.setPitch(a.getPitch()+h)}}off(){const e=this.element;me.removeEventListener(e,"mousedown",this.mousedown),me.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),me.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),me.removeEventListener(window,"touchend",this.touchend),me.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){me.enableDrag(),me.removeEventListener(window,"mousemove",this.mousemove),me.removeEventListener(window,"mouseup",this.mouseup),me.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),me.removeEventListener(window,"touchend",this.touchend)}}let ir;function Fi(u,e,n){const a=new c.N(u.lng,u.lat);if(u=new c.N(u.lng,u.lat),e){const o=new c.N(u.lng-360,u.lat),h=new c.N(u.lng+360,u.lat),_=n.locationPoint(u).distSqr(e);n.locationPoint(o).distSqr(e)<_?u=o:n.locationPoint(h).distSqr(e)<_&&(u=h)}for(;Math.abs(u.lng-n.center.lng)>180;){const o=n.locationPoint(u);if(o.x>=0&&o.y>=0&&o.x<=n.width&&o.y<=n.height)break;u.lng>n.center.lng?u.lng-=360:u.lng+=360}return u.lng!==a.lng&&n.locationPoint(u).y>n.height/2-n.getHorizon()?u:a}const Zs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ro(u,e,n){const a=u.classList;for(const o in Zs)a.remove(`maplibregl-${n}-anchor-${o}`);a.add(`maplibregl-${n}-anchor-${e}`)}class Lo extends c.E{constructor(e){if(super(),this._onKeyPress=n=>{const a=n.code,o=n.charCode||n.keyCode;a!=="Space"&&a!=="Enter"&&o!==32&&o!==13||this.togglePopup()},this._onMapClick=n=>{const a=n.originalEvent.target,o=this._element;this._popup&&(a===o||o.contains(a))&&this.togglePopup()},this._update=n=>{var a;if(!this._map)return;const o=this._map.loaded()&&!this._map.isMoving();((n==null?void 0:n.type)==="terrain"||(n==null?void 0:n.type)==="render"&&!o)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Fi(this._lngLat,this._flatPos,this._map.transform):(a=this._lngLat)===null||a===void 0?void 0:a.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let _="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?_="rotateX(0deg)":this._pitchAlignment==="map"&&(_=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||n&&n.type!=="moveend"||(this._pos=this._pos.round()),me.setTransform(this._element,`${Zs[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${_} ${h}`),Qe.frameAsync(new AbortController).then(()=>{this._updateOpacity(n&&n.type==="moveend")}).catch(()=>{})},this._onMove=n=>{if(!this._isDragging){const a=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=a}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.k("dragstart"))),this.fire(new c.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.k("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=c.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=me.create("div");const n=me.createNS("http://www.w3.org/2000/svg","svg"),a=41,o=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${a}px`),n.setAttributeNS(null,"width",`${o}px`),n.setAttributeNS(null,"viewBox",`0 0 ${o} ${a}`);const h=me.createNS("http://www.w3.org/2000/svg","g");h.setAttributeNS(null,"stroke","none"),h.setAttributeNS(null,"stroke-width","1"),h.setAttributeNS(null,"fill","none"),h.setAttributeNS(null,"fill-rule","evenodd");const _=me.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"fill-rule","nonzero");const w=me.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const B=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const A of B){const v=me.createNS("http://www.w3.org/2000/svg","ellipse");v.setAttributeNS(null,"opacity","0.04"),v.setAttributeNS(null,"cx","10.5"),v.setAttributeNS(null,"cy","5.80029008"),v.setAttributeNS(null,"rx",A.rx),v.setAttributeNS(null,"ry",A.ry),w.appendChild(v)}const M=me.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill",this._color);const L=me.createNS("http://www.w3.org/2000/svg","path");L.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),M.appendChild(L);const F=me.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"opacity","0.25"),F.setAttributeNS(null,"fill","#000000");const $=me.createNS("http://www.w3.org/2000/svg","path");$.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),F.appendChild($);const te=me.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"transform","translate(6.0, 7.0)"),te.setAttributeNS(null,"fill","#FFFFFF");const oe=me.createNS("http://www.w3.org/2000/svg","g");oe.setAttributeNS(null,"transform","translate(8.0, 8.0)");const p=me.createNS("http://www.w3.org/2000/svg","circle");p.setAttributeNS(null,"fill","#000000"),p.setAttributeNS(null,"opacity","0.25"),p.setAttributeNS(null,"cx","5.5"),p.setAttributeNS(null,"cy","5.5"),p.setAttributeNS(null,"r","5.4999962");const g=me.createNS("http://www.w3.org/2000/svg","circle");g.setAttributeNS(null,"fill","#FFFFFF"),g.setAttributeNS(null,"cx","5.5"),g.setAttributeNS(null,"cy","5.5"),g.setAttributeNS(null,"r","5.4999962"),oe.appendChild(p),oe.appendChild(g),_.appendChild(w),_.appendChild(M),_.appendChild(F),_.appendChild(te),_.appendChild(oe),n.appendChild(_),n.setAttributeNS(null,"height",a*this._scale+"px"),n.setAttributeNS(null,"width",o*this._scale+"px"),this._element.appendChild(n),this._offset=c.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",n=>{n.preventDefault()}),this._element.addEventListener("mousedown",n=>{n.preventDefault()}),Ro(this._element,this._anchor,"marker"),e&&e.className)for(const n of e.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),me.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=c.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const o=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[o,-1*(38.1-13.5+o)],"bottom-right":[-o,-1*(38.1-13.5+o)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var n,a;if(!(!((n=this._map)===null||n===void 0)&&n.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const o=this._map,h=o.terrain.depthAtPoint(this._pos),_=o.terrain.getElevationForLngLatZoom(this._lngLat,o.transform.tileZoom);if(o.transform.lngLatToCameraDepth(this._lngLat,_)-h<.006)return void(this._element.style.opacity=this._opacity);const w=-this._offset.y/o.transform._pixelPerMeter,B=Math.sin(o.getPitch()*Math.PI/180)*w,M=o.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),L=o.transform.lngLatToCameraDepth(this._lngLat,_+B)-M>.006;!((a=this._popup)===null||a===void 0)&&a.isOpen()&&L&&this._popup.remove(),this._element.style.opacity=L?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=c.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,n){return e===void 0&&n===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),n!==void 0&&(this._opacityWhenCovered=n),this._map&&this._updateOpacity(!0),this}}const Ba={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let $s=0,Xs=!1;const Fn={maxWidth:100,unit:"metric"};function Ca(u,e,n){const a=n&&n.maxWidth||100,o=u._container.clientHeight/2,h=u.unproject([0,o]),_=u.unproject([a,o]),w=h.distanceTo(_);if(n&&n.unit==="imperial"){const B=3.2808*w;B>5280?Qt(e,a,B/5280,u._getUIString("ScaleControl.Miles")):Qt(e,a,B,u._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?Qt(e,a,w/1852,u._getUIString("ScaleControl.NauticalMiles")):w>=1e3?Qt(e,a,w/1e3,u._getUIString("ScaleControl.Kilometers")):Qt(e,a,w,u._getUIString("ScaleControl.Meters"))}function Qt(u,e,n,a){const o=function(h){const _=Math.pow(10,`${Math.floor(h)}`.length-1);let w=h/_;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(B){const M=Math.pow(10,Math.ceil(-Math.log(B)/Math.LN10));return Math.round(B*M)/M}(w),_*w}(n);u.style.width=e*(o/n)+"px",u.innerHTML=`${o}&nbsp;${a}`}const Ut={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Fo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function zo(u){if(u){if(typeof u=="number"){const e=Math.round(Math.abs(u)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,u),"top-left":new c.P(e,e),"top-right":new c.P(-e,e),bottom:new c.P(0,-u),"bottom-left":new c.P(e,-e),"bottom-right":new c.P(-e,-e),left:new c.P(u,0),right:new c.P(-u,0)}}if(u instanceof c.P||Array.isArray(u)){const e=c.P.convert(u);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:c.P.convert(u.center||[0,0]),top:c.P.convert(u.top||[0,0]),"top-left":c.P.convert(u["top-left"]||[0,0]),"top-right":c.P.convert(u["top-right"]||[0,0]),bottom:c.P.convert(u.bottom||[0,0]),"bottom-left":c.P.convert(u["bottom-left"]||[0,0]),"bottom-right":c.P.convert(u["bottom-right"]||[0,0]),left:c.P.convert(u.left||[0,0]),right:c.P.convert(u.right||[0,0])}}return zo(new c.P(0,0))}const El=he;S.AJAXError=c.bh,S.Evented=c.E,S.LngLat=c.N,S.MercatorCoordinate=c.Z,S.Point=c.P,S.addProtocol=c.bi,S.config=c.a,S.removeProtocol=c.bj,S.AttributionControl=_s,S.BoxZoomHandler=Kr,S.CanvasSource=rn,S.CooperativeGesturesHandler=$n,S.DoubleClickZoomHandler=Js,S.DragPanHandler=vl,S.DragRotateHandler=jl,S.EdgeInsets=Jn,S.FullscreenControl=class extends c.E{constructor(u={}){super(),this._onFullscreenChange=()=>{var e;let n=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=n==null?void 0:n.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)n=n.shadowRoot.fullscreenElement;n===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,u&&u.container&&(u.container instanceof HTMLElement?this._container=u.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=me.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){me.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const u=this._fullscreenButton=me.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);me.create("span","maplibregl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.title=u}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},S.GeoJSONSource=Un,S.GeolocateControl=class extends c.E{constructor(u){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new c.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const n=new c.N(e.coords.longitude,e.coords.latitude),a=e.coords.accuracy,o=this._map.getBearing(),h=c.e({bearing:o},this.options.fitBoundsOptions),_=Re.fromLngLat(n,a);this._map.fitBounds(_,h,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const n=new c.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Xs)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=me.create("button","maplibregl-ctrl-geolocate",this._container),me.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=me.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Lo({element:this._dotElement}),this._circleElement=me.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Lo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.k("trackuserlocationend")),this.fire(new c.k("userlocationlostfocus")))})}},this.options=c.e({},Ba,u)}onAdd(u){return this._map=u,this._container=me.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return c._(this,arguments,void 0,function*(e=!1){if(ir!==void 0&&!e)return ir;if(window.navigator.permissions===void 0)return ir=!!window.navigator.geolocation,ir;try{ir=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ir=!!window.navigator.geolocation}return ir})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),me.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,$s=0,Xs=!1}_isOutOfMapMaxBounds(u){const e=this._map.getMaxBounds(),n=u.coords;return e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const u=this._map.getBounds(),e=u.getSouthEast(),n=u.getNorthEast(),a=e.distanceTo(n),o=Math.ceil(this._accuracy/(a/this._map._container.clientHeight)*2);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":$s--,Xs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.k("trackuserlocationstart")),this.fire(new c.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),$s++,$s>1?(u={maximumAge:6e5,timeout:0},Xs=!0):(u=this.options.positionOptions,Xs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,u)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},S.Hash=Ns,S.ImageSource=qr,S.KeyboardHandler=an,S.LngLatBounds=Re,S.LogoControl=Li,S.Map=class extends $a{constructor(u){c.bf.mark(c.bg.create);const e=Object.assign(Object.assign({},Yl),u);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Yn(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new oi,this._controls=[],this._mapId=c.a4(),this._contextLost=n=>{n.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new c.k("webglcontextlost",{originalEvent:n}))},this._contextRestored=n=>{this._setupPainter(),this.resize(),this._update(),this.fire(new c.k("webglcontextrestored",{originalEvent:n}))},this._onMapScroll=n=>{if(n.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Xa),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Xe.addThrottleControl(()=>this.isMoving()),this._requestManager=new We(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let n=!1;const a=ms(o=>{this._trackResize&&!this._removed&&(this.resize(o),this.redraw())},50);this._resizeObserver=new ResizeObserver(o=>{n?a(o):n=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Za(this,e),this._hash=e.hash&&new Ns(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,c.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new _s(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new Li,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new c.k(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new c.k(`${n.dataType}dataloading`,n))}),this.on("dataabort",n=>{this.fire(new c.k("sourcedataabort",n))})}_getMapId(){return this._mapId}addControl(u,e){if(e===void 0&&(e=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new c.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=u.onAdd(this);this._controls.push(u);const a=this._controlPositions[e];return e.indexOf("bottom")!==-1?a.insertBefore(n,a.firstChild):a.appendChild(n),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new c.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(u);return e>-1&&this._controls.splice(e,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}calculateCameraOptionsFromTo(u,e,n,a){return a==null&&this.terrain&&(a=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(u,e,n,a)}resize(u){var e;const n=this._containerDimensions(),a=n[0],o=n[1],h=this._getClampedPixelRatio(a,o);if(this._resizeCanvas(a,o,h),this.painter.resize(a,o,h),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const B=this._getClampedPixelRatio(a,o);this._resizeCanvas(a,o,B),this.painter.resize(a,o,B)}this.transform.resize(a,o),(e=this._requestedCameraState)===null||e===void 0||e.resize(a,o);const _=!this._moving;return _&&(this.stop(),this.fire(new c.k("movestart",u)).fire(new c.k("move",u))),this.fire(new c.k("resize",u)),_&&this.fire(new c.k("moveend",u)),this}_getClampedPixelRatio(u,e){const{0:n,1:a}=this._maxCanvasSize,o=this.getPixelRatio(),h=u*o,_=e*o;return Math.min(h>n?n/h:1,_>a?a/_:1)*o}getPixelRatio(){var u;return(u=this._overridePixelRatio)!==null&&u!==void 0?u:devicePixelRatio}setPixelRatio(u){this._overridePixelRatio=u,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(u){return this.transform.setMaxBounds(Re.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u&&this.setZoom(u),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u&&this.setZoom(u),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u&&this.setPitch(u),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u&&this.setPitch(u),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this._update()}project(u){return this.transform.locationPoint(c.N.convert(u),this.style&&this.terrain)}unproject(u){return this.transform.pointLocation(c.P.convert(u),this.terrain)}isMoving(){var u;return this._moving||((u=this.handlers)===null||u===void 0?void 0:u.isMoving())}isZooming(){var u;return this._zooming||((u=this.handlers)===null||u===void 0?void 0:u.isZooming())}isRotating(){var u;return this._rotating||((u=this.handlers)===null||u===void 0?void 0:u.isRotating())}_createDelegatedListener(u,e,n){if(u==="mouseenter"||u==="mouseover"){let a=!1;return{layers:e,listener:n,delegates:{mousemove:h=>{const _=e.filter(B=>this.getLayer(B)),w=_.length!==0?this.queryRenderedFeatures(h.point,{layers:_}):[];w.length?a||(a=!0,n.call(this,new tr(u,this,h.originalEvent,{features:w}))):a=!1},mouseout:()=>{a=!1}}}}if(u==="mouseleave"||u==="mouseout"){let a=!1;return{layers:e,listener:n,delegates:{mousemove:_=>{const w=e.filter(B=>this.getLayer(B));(w.length!==0?this.queryRenderedFeatures(_.point,{layers:w}):[]).length?a=!0:a&&(a=!1,n.call(this,new tr(u,this,_.originalEvent)))},mouseout:_=>{a&&(a=!1,n.call(this,new tr(u,this,_.originalEvent)))}}}}{const a=o=>{const h=e.filter(w=>this.getLayer(w)),_=h.length!==0?this.queryRenderedFeatures(o.point,{layers:h}):[];_.length&&(o.features=_,n.call(this,o),delete o.features)};return{layers:e,listener:n,delegates:{[u]:a}}}}_saveDelegatedListener(u,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(e)}_removeDelegatedListener(u,e,n){if(!this._delegatedListeners||!this._delegatedListeners[u])return;const a=this._delegatedListeners[u];for(let o=0;o<a.length;o++){const h=a[o];if(h.listener===n&&h.layers.length===e.length&&h.layers.every(_=>e.includes(_))){for(const _ in h.delegates)this.off(_,h.delegates[_]);return void a.splice(o,1)}}}on(u,e,n){if(n===void 0)return super.on(u,e);const a=this._createDelegatedListener(u,typeof e=="string"?[e]:e,n);this._saveDelegatedListener(u,a);for(const o in a.delegates)this.on(o,a.delegates[o]);return this}once(u,e,n){if(n===void 0)return super.once(u,e);const a=typeof e=="string"?[e]:e,o=this._createDelegatedListener(u,a,n);for(const h in o.delegates){const _=o.delegates[h];o.delegates[h]=(...w)=>{this._removeDelegatedListener(u,a,n),_(...w)}}this._saveDelegatedListener(u,o);for(const h in o.delegates)this.once(h,o.delegates[h]);return this}off(u,e,n){return n===void 0?super.off(u,e):(this._removeDelegatedListener(u,typeof e=="string"?[e]:e,n),this)}queryRenderedFeatures(u,e){if(!this.style)return[];let n;const a=u instanceof c.P||Array.isArray(u),o=a?u:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(a?{}:u)||{},o instanceof c.P||typeof o[0]=="number")n=[c.P.convert(o)];else{const h=c.P.convert(o[0]),_=c.P.convert(o[1]);n=[h,new c.P(_.x,h.y),_,new c.P(h.x,_.y),h]}return this.style.queryRenderedFeatures(n,e,this.transform)}querySourceFeatures(u,e){return this.style.querySourceFeatures(u,e)}setStyle(u,e){return(e=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&u?(this._diffStyle(u,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(u,e))}setTransformRequest(u){return this._requestManager.setTransformRequest(u),this}_getUIString(u){const e=this._locale[u];if(e==null)throw new Error(`Missing UI string '${u}'`);return e}_updateStyle(u,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(u,e));const n=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!u)),u?(this.style=new Dn(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof u=="string"?this.style.loadURL(u,e,n):this.style.loadJSON(u,e,n),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Dn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(u,e){if(typeof u=="string"){const n=this._requestManager.transformRequest(u,"Style");c.h(n,new AbortController).then(a=>{this._updateDiff(a.data,e)}).catch(a=>{a&&this.fire(new c.j(a))})}else typeof u=="object"&&this._updateDiff(u,e)}_updateDiff(u,e){try{this.style.setState(u,e)&&this._update(!0)}catch(n){c.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(u,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(u,e){return this._lazyInitEmptyStyle(),this.style.addSource(u,e),this._update(!0)}isSourceLoaded(u){const e=this.style&&this.style.sourceCaches[u];if(e!==void 0)return e.loaded();this.fire(new c.j(new Error(`There is no source with ID '${u}'`)))}setTerrain(u){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),u){const e=this.style.sourceCaches[u.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${u.source}`);this.terrain===null&&e.reload();for(const n in this.style._layers){const a=this.style._layers[n];a.type==="hillshade"&&a.source===u.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new To(this.painter,e,u),this.painter.renderToTexture=new Bl(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=n=>{n.dataType==="style"?this.terrain.sourceCache.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==u.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new c.k("terrain",{terrain:u})),this}getTerrain(){var u,e;return(e=(u=this.terrain)===null||u===void 0?void 0:u.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const u=this.style&&this.style.sourceCaches;for(const e in u){const n=u[e]._tiles;for(const a in n){const o=n[a];if(o.state!=="loaded"&&o.state!=="errored")return!1}}return!0}removeSource(u){return this.style.removeSource(u),this._update(!0)}getSource(u){return this.style.getSource(u)}addImage(u,e,n={}){const{pixelRatio:a=1,sdf:o=!1,stretchX:h,stretchY:_,content:w,textFitWidth:B,textFitHeight:M}=n;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||c.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:L,height:F,data:$}=e,te=e;return this.style.addImage(u,{data:new c.R({width:L,height:F},new Uint8Array($)),pixelRatio:a,stretchX:h,stretchY:_,content:w,textFitWidth:B,textFitHeight:M,sdf:o,version:0,userImage:te}),te.onAdd&&te.onAdd(this,u),this}}{const{width:L,height:F,data:$}=Qe.getImageData(e);this.style.addImage(u,{data:new c.R({width:L,height:F},$),pixelRatio:a,stretchX:h,stretchY:_,content:w,textFitWidth:B,textFitHeight:M,sdf:o,version:0})}}updateImage(u,e){const n=this.style.getImage(u);if(!n)return this.fire(new c.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=e instanceof HTMLImageElement||c.b(e)?Qe.getImageData(e):e,{width:o,height:h,data:_}=a;if(o===void 0||h===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(o!==n.data.width||h!==n.data.height)return this.fire(new c.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(e instanceof HTMLImageElement||c.b(e));return n.data.replace(_,w),this.style.updateImage(u,n),this}getImage(u){return this.style.getImage(u)}hasImage(u){return u?!!this.style.getImage(u):(this.fire(new c.j(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(u)}loadImage(u){return Xe.getImage(this._requestManager.transformRequest(u,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(u,e){return this._lazyInitEmptyStyle(),this.style.addLayer(u,e),this._update(!0)}moveLayer(u,e){return this.style.moveLayer(u,e),this._update(!0)}removeLayer(u){return this.style.removeLayer(u),this._update(!0)}getLayer(u){return this.style.getLayer(u)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(u,e,n){return this.style.setLayerZoomRange(u,e,n),this._update(!0)}setFilter(u,e,n={}){return this.style.setFilter(u,e,n),this._update(!0)}getFilter(u){return this.style.getFilter(u)}setPaintProperty(u,e,n,a={}){return this.style.setPaintProperty(u,e,n,a),this._update(!0)}getPaintProperty(u,e){return this.style.getPaintProperty(u,e)}setLayoutProperty(u,e,n,a={}){return this.style.setLayoutProperty(u,e,n,a),this._update(!0)}getLayoutProperty(u,e){return this.style.getLayoutProperty(u,e)}setGlyphs(u,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(u,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(u,e,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(u,e,n,a=>{a||this._update(!0)}),this}removeSprite(u){return this._lazyInitEmptyStyle(),this.style.removeSprite(u),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(u,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(u,e,n=>{n||this._update(!0)}),this}setLight(u,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(u,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(u){return this._lazyInitEmptyStyle(),this.style.setSky(u),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(u,e){return this.style.setFeatureState(u,e),this._update()}removeFeatureState(u,e){return this.style.removeFeatureState(u,e),this._update()}getFeatureState(u){return this.style.getFeatureState(u)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let u=0,e=0;return this._container&&(u=this._container.clientWidth||400,e=this._container.clientHeight||300),[u,e]}_setupContainer(){const u=this._container;u.classList.add("maplibregl-map");const e=this._canvasContainer=me.create("div","maplibregl-canvas-container",u);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=me.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),a=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],a);const o=this._controlContainer=me.create("div","maplibregl-control-container",u),h=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{h[_]=me.create("div",`maplibregl-ctrl-${_} `,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,e,n){this._canvas.width=Math.floor(n*u),this._canvas.height=Math.floor(n*e),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const u={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",a=>{e={requestedAttributes:u},a&&(e.statusMessage=a.statusMessage,e.type=a.type)},{once:!0});const n=this._canvas.getContext("webgl2",u)||this._canvas.getContext("webgl",u);if(!n){const a="Failed to initialize WebGL";throw e?(e.message=a,new Error(JSON.stringify(e))):new Error(a)}this.painter=new xo(n,this.transform),$e.testSupport(n)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(u){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_render(u){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(u),this._removed)return;let n=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const o=this.transform.zoom,h=Qe.now();this.style.zoomHistory.update(o,h);const _=new c.z(o,{now:h,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),w=_.crossFadingFactor();w===1&&w===this._crossFadingFactor||(n=!0,this._crossFadingFactor=w),this.style.update(_)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new c.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.bf.mark(c.bg.load),this.fire(new c.k("load"))),this.style&&(this.style.hasTransitions()||n)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const a=this._sourcesDirty||this._styleDirty||this._placementDirty;return a||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.k("idle")),!this._loaded||this._fullyLoaded||a||(this._fullyLoaded=!0,c.bf.mark(c.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var u;this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Xe.removeThrottleControl(this._imageQueueHandle),(u=this._resizeObserver)===null||u===void 0||u.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),me.remove(this._canvasContainer),me.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),c.bf.clearMetrics(),this._removed=!0,this.fire(new c.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Qe.frameAsync(this._frameRequest).then(u=>{c.bf.frame(u),this._frameRequest=null,this._render(u)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get version(){return Po}getCameraTargetElevation(){return this.transform.elevation}},S.MapMouseEvent=tr,S.MapTouchEvent=qs,S.MapWheelEvent=ql,S.Marker=Lo,S.NavigationControl=class{constructor(u){this._updateZoomButtons=()=>{const e=this._map.getZoom(),n=e===this._map.getMaxZoom(),a=e===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,n)=>{const a=this._map._getUIString(`NavigationControl.${n}`);e.title=a,e.setAttribute("aria-label",a)},this.options=c.e({},Kl,u),this._container=me.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),me.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),me.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=me.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new mc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){me.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(u,e){const n=me.create("button",u,this._container);return n.type="button",n.addEventListener("click",e),n}},S.Popup=class extends c.E{constructor(u){super(),this.remove=()=>(this._content&&me.remove(this._content),this._container&&(me.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var n;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=me.create("div","maplibregl-popup",this._map.getContainer()),this._tip=me.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const w of this.options.className.split(" "))this._container.classList.add(w);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Fi(this._lngLat,this._flatPos,this._map.transform):(n=this._lngLat)===null||n===void 0?void 0:n.wrap(),this._trackPointer&&!e)return;const a=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let o=this.options.anchor;const h=zo(this.options.offset);if(!o){const w=this._container.offsetWidth,B=this._container.offsetHeight;let M;M=a.y+h.bottom.y<B?["top"]:a.y>this._map.transform.height-B?["bottom"]:[],a.x<w/2?M.push("left"):a.x>this._map.transform.width-w/2&&M.push("right"),o=M.length===0?"bottom":M.join("-")}let _=a.add(h[o]);this.options.subpixelPositioning||(_=_.round()),me.setTransform(this._container,`${Zs[o]} translate(${_.x}px,${_.y}px)`),Ro(this._container,o,"popup")},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(Ut),u)}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(u){return this._lngLat=c.N.convert(u),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(document.createTextNode(u))}setHTML(u){const e=document.createDocumentFragment(),n=document.createElement("body");let a;for(n.innerHTML=u;a=n.firstChild,a;)e.appendChild(a);return this.setDOMContent(e)}getMaxWidth(){var u;return(u=this._container)===null||u===void 0?void 0:u.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=me.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(u),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(u){return this._container&&this._container.classList.add(u),this}removeClassName(u){return this._container&&this._container.classList.remove(u),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){if(this._container)return this._container.classList.toggle(u)}setSubpixelPositioning(u){this.options.subpixelPositioning=u}_createCloseButton(){this.options.closeButton&&(this._closeButton=me.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(Fo);u&&u.focus()}},S.RasterDEMTileSource=Ii,S.RasterTileSource=Wt,S.ScaleControl=class{constructor(u){this._onMove=()=>{Ca(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Ca(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Fn),u)}getDefaultPosition(){return"bottom-left"}onAdd(u){return this._map=u,this._container=me.create("div","maplibregl-ctrl maplibregl-ctrl-scale",u.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){me.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},S.ScrollZoomHandler=wn,S.Style=Dn,S.TerrainControl=class{constructor(u){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=u}onAdd(u){return this._map=u,this._container=me.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=me.create("button","maplibregl-ctrl-terrain",this._container),me.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){me.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},S.TwoFingersTouchPitchHandler=Kn,S.TwoFingersTouchRotateHandler=bl,S.TwoFingersTouchZoomHandler=_l,S.TwoFingersTouchZoomRotateHandler=Mo,S.VectorTileSource=Mr,S.VideoSource=ra,S.addSourceType=(u,e)=>c._(void 0,void 0,void 0,function*(){if(na(u))throw new Error(`A source type called "${u}" already exists.`);((n,a)=>{Ss[n]=a})(u,e)}),S.clearPrewarmedResources=function(){const u=Vi;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(qi),Vi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},S.getMaxParallelImageRequests=function(){return c.a.MAX_PARALLEL_IMAGE_REQUESTS},S.getRTLTextPluginStatus=function(){return Qn().getRTLTextPluginStatus()},S.getVersion=function(){return El},S.getWorkerCount=function(){return vi.workerCount},S.getWorkerUrl=function(){return c.a.WORKER_URL},S.importScriptInWorkers=function(u){return _r().broadcast("IS",u)},S.prewarm=function(){pi().acquire(qi)},S.setMaxParallelImageRequests=function(u){c.a.MAX_PARALLEL_IMAGE_REQUESTS=u},S.setRTLTextPlugin=function(u,e){return Qn().setRTLTextPlugin(u,e)},S.setWorkerCount=function(u){vi.workerCount=u},S.setWorkerUrl=function(u){c.a.WORKER_URL=u}});var Z=I;return Z})})(Ld);var $g=Ld.exports;const Gc=Zg($g),Xg="0cdoIBjm8kHZGjEGavi9",Wg="https://pub-52f3a84d855d426f8854434b69877ae0.r2.dev/v1",ep="https://pub-52f3a84d855d426f8854434b69877ae0.r2.dev/lightning/v2",tp="https://db.incusgrid.com";var lu={exports:{}};(function(V,m){(function(I,E){E(m)})(Rd,function(I){function E(p){return(g,...A)=>Z(p,g,A)}function P(p,g){return E(S(p,g).get)}const{apply:Z,getOwnPropertyDescriptor:S,getPrototypeOf:c,ownKeys:he}=Reflect,{iterator:Ee,toStringTag:Fe}=Symbol,Qe=Object,{create:me,defineProperty:$e}=Qe,rt=Array.prototype[Ee],je=E(rt),bt=ArrayBuffer;P(bt.prototype,"byteLength");const Bt=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;Bt&&P(Bt.prototype,"byteLength");const ht=c(Uint8Array);ht.from;const Xe=ht.prototype;Xe[Ee],E(Xe.keys),E(Xe.values),E(Xe.entries),E(Xe.set),E(Xe.reverse),E(Xe.fill),E(Xe.copyWithin),E(Xe.sort),E(Xe.slice),E(Xe.subarray),P(Xe,"buffer"),P(Xe,"byteOffset"),P(Xe,"length"),P(Xe,Fe);const We=Uint8Array,dt=Uint16Array,zt=Uint32Array,ut=Float32Array,ft=c([][Ee]()),Nt=E(ft.next),Gt=E(function*(){}().next),St=c(ft),nr=E(DataView.prototype.getUint16),mi=WeakMap,ri=mi.prototype,Xt=E(ri.get),Ei=E(ri.set),ni=new mi,Oi=me(null,{next:{value:function(){const p=Xt(ni,this);return Nt(p)}},[Ee]:{value:function(){return this}}}),Yi=new mi,Si=me(St,{next:{value:function(){const p=Xt(Yi,this);return Gt(p)},writable:!0,configurable:!0}});for(const p of he(ft))p!=="next"&&$e(Si,p,S(ft,p));const Qi=new bt(4),$i=new ut(Qi),ur=new zt(Qi),qi=new dt(512),vi=new We(512);for(let p=0;p<256;++p){const g=p-127;g<-24?(qi[p]=0,qi[256|p]=32768,vi[p]=24,vi[256|p]=24):g<-14?(qi[p]=1024>>-g-14,qi[256|p]=1024>>-g-14|32768,vi[p]=-g-1,vi[256|p]=-g-1):g<=15?(qi[p]=g+15<<10,qi[256|p]=g+15<<10|32768,vi[p]=13,vi[256|p]=13):g<128?(qi[p]=31744,qi[256|p]=64512,vi[p]=24,vi[256|p]=24):(qi[p]=31744,qi[256|p]=64512,vi[p]=13,vi[256|p]=13)}const Wi=new zt(2048);for(let p=1;p<1024;++p){let g=p<<13,A=0;for(;!(8388608&g);)g<<=1,A-=8388608;g&=-8388609,A+=947912704,Wi[p]=g|A}for(let p=1024;p<2048;++p)Wi[p]=939524096+(p-1024<<13);const Vi=new zt(64);for(let p=1;p<31;++p)Vi[p]=p<<23;Vi[31]=1199570944,Vi[32]=2147483648;for(let p=33;p<63;++p)Vi[p]=2147483648+(p-32<<23);Vi[63]=3347054592;const yi=new dt(64);for(let p=1;p<64;++p)p!==32&&(yi[p]=1024);function pi(p,g,...A){return function(v){const x=v>>10;return ur[0]=Wi[yi[x]+(1023&v)]+Vi[x],$i[0]}(nr(p,g,...function(v){if(v[Ee]===rt&&ft.next===Nt)return v;const x=me(Oi);return Ei(ni,x,je(v)),x}(A)))}function yr(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}var _r={exports:{}};function Gi(p,g,A){const v=A&&A.debug||!1;v&&console.log("[xml-utils] getting "+g+" in "+p);const x=typeof p=="object"?p.outer:p,Q=x.slice(0,x.indexOf(">")+1),T=['"',"'"];for(let k=0;k<T.length;k++){const q=T[k],G=g+"\\="+q+"([^"+q+"]*)"+q;v&&console.log("[xml-utils] pattern:",G);const O=new RegExp(G).exec(Q);if(v&&console.log("[xml-utils] match:",O),O)return O[1]}}_r.exports=Gi,_r.exports.default=Gi;var Kt=yr(_r.exports),hi={exports:{}},si={exports:{}},Re={exports:{}};function Ri(p,g,A){const v=new RegExp(g).exec(p.slice(A));return v?A+v.index:-1}Re.exports=Ri,Re.exports.default=Ri;var Mr=Re.exports,Wt={exports:{}};function Ii(p,g,A){const v=new RegExp(g).exec(p.slice(A));return v?A+v.index+v[0].length-1:-1}Wt.exports=Ii,Wt.exports.default=Ii;var Un=Wt.exports,Ir={exports:{}};function qr(p,g){const A=new RegExp(g,"g"),v=p.match(A);return v?v.length:0}Ir.exports=qr,Ir.exports.default=qr;var ra=Ir.exports;const rn=Mr,Ss=Un,na=ra;function lt(p,g,A){const v=A&&A.debug||!1,x=!(A&&typeof A.nested===!1),Q=A&&A.startIndex||0;v&&console.log("[xml-utils] starting findTagByName with",g," and ",A);const T=rn(p,`<${g}[ 
>/]`,Q);if(v&&console.log("[xml-utils] start:",T),T===-1)return;const k=p.slice(T+g.length);let q=Ss(k,"^[^<]*[ /]>",0);const G=q!==-1&&k[q-1]==="/";if(v&&console.log("[xml-utils] selfClosing:",G),G===!1)if(x){let U=0,ne=1,le=0;for(;(q=Ss(k,"[ /]"+g+">",U))!==-1;){const se=k.substring(U,q+1);if(ne+=na(se,"<"+g+`[ 
	>]`),le+=na(se,"</"+g+">"),le>=ne)break;U=q}}else q=Ss(k,"[ /]"+g+">",0);const O=T+g.length+q+1;if(v&&console.log("[xml-utils] end:",O),O===-1)return;const re=p.slice(T,O);let K;return K=G?null:re.slice(re.indexOf(">")+1,re.lastIndexOf("<")),{inner:K,outer:re,start:T,end:O}}si.exports=lt,si.exports.default=lt;const En=si.exports;function br(p,g,A){const v=[],x=A&&A.debug||!1,Q=!A||typeof A.nested!="boolean"||A.nested;let T,k=A&&A.startIndex||0;for(;T=En(p,g,{debug:x,startIndex:k});)k=Q?T.start+1+g.length:T.end,v.push(T);return x&&console.log("findTagsByName found",v.length,"tags"),v}hi.exports=br,hi.exports.default=br;var Qn=yr(hi.exports);const nn={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},at={};for(const p in nn)nn.hasOwnProperty(p)&&(at[nn[p]]=parseInt(p,10));const ei=[at.BitsPerSample,at.ExtraSamples,at.SampleFormat,at.StripByteCounts,at.StripOffsets,at.StripRowCounts,at.TileByteCounts,at.TileOffsets,at.SubIFDs],Vt={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},Ht={};for(const p in Vt)Vt.hasOwnProperty(p)&&(Ht[Vt[p]]=parseInt(p,10));const sn=0,Yt=1,Sn=2,kn=3,Nn=5,fn=6,ge=8,j=0,H=1,ee=0,de=1,we=2,Se={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"},De=new Map;function _e(p,g){Array.isArray(p)||(p=[p]),p.forEach(A=>De.set(A,g))}async function Ne(p){const g=De.get(p.Compression);if(!g)throw new Error(`Unknown compression method identifier: ${p.Compression}`);return new(await g())(p)}function Ze(p,g,A,v=1){return new(Object.getPrototypeOf(p)).constructor(g*A*v)}function Le(p,g,A){return(1-A)*p+A*g}function At(p,g,A,v,x,Q="nearest"){switch(Q.toLowerCase()){case"nearest":return function(T,k,q,G,O){const re=k/G,K=q/O;return T.map(U=>{const ne=Ze(U,G,O);for(let le=0;le<O;++le){const se=Math.min(Math.round(K*le),q-1);for(let ue=0;ue<G;++ue){const Ie=Math.min(Math.round(re*ue),k-1),pe=U[se*k+Ie];ne[le*G+ue]=pe}}return ne})}(p,g,A,v,x);case"bilinear":case"linear":return function(T,k,q,G,O){const re=k/G,K=q/O;return T.map(U=>{const ne=Ze(U,G,O);for(let le=0;le<O;++le){const se=K*le,ue=Math.floor(se),Ie=Math.min(Math.ceil(se),q-1);for(let pe=0;pe<G;++pe){const Be=re*pe,Y=Be%1,z=Math.floor(Be),ce=Math.min(Math.ceil(Be),k-1),ie=U[ue*k+z],ae=U[ue*k+ce],Ae=U[Ie*k+z],Ce=U[Ie*k+ce],be=Le(Le(ie,ae,Y),Le(Ae,Ce,Y),se%1);ne[le*G+pe]=be}}return ne})}(p,g,A,v,x);default:throw new Error(`Unsupported resampling method: '${Q}'`)}}function Rt(p,g,A,v,x,Q,T="nearest"){switch(T.toLowerCase()){case"nearest":return function(k,q,G,O,re,K){const U=q/O,ne=G/re,le=Ze(k,O,re,K);for(let se=0;se<re;++se){const ue=Math.min(Math.round(ne*se),G-1);for(let Ie=0;Ie<O;++Ie){const pe=Math.min(Math.round(U*Ie),q-1);for(let Be=0;Be<K;++Be){const Y=k[ue*q*K+pe*K+Be];le[se*O*K+Ie*K+Be]=Y}}}return le}(p,g,A,v,x,Q);case"bilinear":case"linear":return function(k,q,G,O,re,K){const U=q/O,ne=G/re,le=Ze(k,O,re,K);for(let se=0;se<re;++se){const ue=ne*se,Ie=Math.floor(ue),pe=Math.min(Math.ceil(ue),G-1);for(let Be=0;Be<O;++Be){const Y=U*Be,z=Y%1,ce=Math.floor(Y),ie=Math.min(Math.ceil(Y),q-1);for(let ae=0;ae<K;++ae){const Ae=k[Ie*q*K+ce*K+ae],Ce=k[Ie*q*K+ie*K+ae],be=k[pe*q*K+ce*K+ae],xe=k[pe*q*K+ie*K+ae],ze=Le(Le(Ae,Ce,z),Le(be,xe,z),ue%1);le[se*O*K+Be*K+ae]=ze}}}return le}(p,g,A,v,x,Q);default:throw new Error(`Unsupported resampling method: '${T}'`)}}function Ot(p,g,A){let v=0;for(let x=g;x<A;++x)v+=p[x];return v}function ui(p,g,A){switch(p){case 1:if(g<=8)return new Uint8Array(A);if(g<=16)return new Uint16Array(A);if(g<=32)return new Uint32Array(A);break;case 2:if(g===8)return new Int8Array(A);if(g===16)return new Int16Array(A);if(g===32)return new Int32Array(A);break;case 3:switch(g){case 16:case 32:return new Float32Array(A);case 64:return new Float64Array(A)}}throw Error("Unsupported data format/bitsPerSample")}_e([void 0,1],()=>Promise.resolve().then(function(){return Ol}).then(p=>p.default)),_e(5,()=>Promise.resolve().then(function(){return ba}).then(p=>p.default)),_e(6,()=>{throw new Error("old style JPEG compression is not supported.")}),_e(7,()=>Promise.resolve().then(function(){return Va}).then(p=>p.default)),_e([8,32946],()=>Promise.resolve().then(function(){return e}).then(p=>p.default)),_e(32773,()=>Promise.resolve().then(function(){return n}).then(p=>p.default)),_e(34887,()=>Promise.resolve().then(function(){return F}).then(async p=>(await p.zstd.init(),p)).then(p=>p.default)),_e(50001,()=>Promise.resolve().then(function(){return $}).then(p=>p.default));class Zt{constructor(g,A,v,x,Q,T){this.fileDirectory=g,this.geoKeys=A,this.dataView=v,this.littleEndian=x,this.tiles=Q?{}:null,this.isTiled=!g.StripOffsets;const k=g.PlanarConfiguration;if(this.planarConfiguration=k===void 0?1:k,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=T}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return this.fileDirectory.SamplesPerPixel!==void 0?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:this.fileDirectory.RowsPerStrip!==void 0?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(g){return this.isTiled||(g+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-g*this.getTileHeight()}getBytesPerPixel(){let g=0;for(let A=0;A<this.fileDirectory.BitsPerSample.length;++A)g+=this.getSampleByteSize(A);return g}getSampleByteSize(g){if(g>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${g} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[g]/8)}getReaderForSample(g){const A=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[g]:1,v=this.fileDirectory.BitsPerSample[g];switch(A){case 1:if(v<=8)return DataView.prototype.getUint8;if(v<=16)return DataView.prototype.getUint16;if(v<=32)return DataView.prototype.getUint32;break;case 2:if(v<=8)return DataView.prototype.getInt8;if(v<=16)return DataView.prototype.getInt16;if(v<=32)return DataView.prototype.getInt32;break;case 3:switch(v){case 16:return function(x,Q){return pi(this,x,Q)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(g=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[g]:1}getBitsPerSample(g=0){return this.fileDirectory.BitsPerSample[g]}getArrayForSample(g,A){return ui(this.getSampleFormat(g),this.getBitsPerSample(g),A)}async getTileOrStrip(g,A,v,x,Q){const T=Math.ceil(this.getWidth()/this.getTileWidth()),k=Math.ceil(this.getHeight()/this.getTileHeight());let q;const{tiles:G}=this;let O,re;this.planarConfiguration===1?q=A*T+g:this.planarConfiguration===2&&(q=v*T*k+A*T+g),this.isTiled?(O=this.fileDirectory.TileOffsets[q],re=this.fileDirectory.TileByteCounts[q]):(O=this.fileDirectory.StripOffsets[q],re=this.fileDirectory.StripByteCounts[q]);const K=(await this.source.fetch([{offset:O,length:re}],Q))[0];let U;return G!==null&&G[q]?U=G[q]:(U=(async()=>{let ne=await x.decode(this.fileDirectory,K);const le=this.getSampleFormat(),se=this.getBitsPerSample();return function(ue,Ie){return(ue!==1&&ue!==2||!(Ie<=32)||Ie%8!=0)&&(ue!==3||Ie!==16&&Ie!==32&&Ie!==64)}(le,se)&&(ne=function(ue,Ie,pe,Be,Y,z,ce){const ie=new DataView(ue),ae=pe===2?1:Be,Ae=ui(Ie,Y,pe===2?ce*z:ce*z*Be),Ce=parseInt("1".repeat(Y),2);if(Ie===1){let be;be=pe===1?Be*Y:Y;let xe=z*be;7&xe&&(xe=xe+7&-8);for(let ze=0;ze<ce;++ze){const qe=ze*xe;for(let Ve=0;Ve<z;++Ve){const Ke=qe+Ve*ae*Y;for(let ct=0;ct<ae;++ct){const Ue=Ke+ct*Y,Pe=(ze*z+Ve)*ae+ct,Ye=Math.floor(Ue/8),vt=Ue%8;if(vt+Y<=8)Ae[Pe]=ie.getUint8(Ye)>>8-Y-vt&Ce;else if(vt+Y<=16)Ae[Pe]=ie.getUint16(Ye)>>16-Y-vt&Ce;else if(vt+Y<=24){const ot=ie.getUint16(Ye)<<8|ie.getUint8(Ye+2);Ae[Pe]=ot>>24-Y-vt&Ce}else Ae[Pe]=ie.getUint32(Ye)>>32-Y-vt&Ce}}}}return Ae.buffer}(ne,le,this.planarConfiguration,this.getSamplesPerPixel(),se,this.getTileWidth(),this.getBlockHeight(A))),ne})(),G!==null&&(G[q]=U)),{x:g,y:A,sample:v,data:await U}}async _readRaster(g,A,v,x,Q,T,k,q,G){const O=this.getTileWidth(),re=this.getTileHeight(),K=this.getWidth(),U=this.getHeight(),ne=Math.max(Math.floor(g[0]/O),0),le=Math.min(Math.ceil(g[2]/O),Math.ceil(K/O)),se=Math.max(Math.floor(g[1]/re),0),ue=Math.min(Math.ceil(g[3]/re),Math.ceil(U/re)),Ie=g[2]-g[0];let pe=this.getBytesPerPixel();const Be=[],Y=[];for(let ie=0;ie<A.length;++ie)this.planarConfiguration===1?Be.push(Ot(this.fileDirectory.BitsPerSample,0,A[ie])/8):Be.push(0),Y.push(this.getReaderForSample(A[ie]));const z=[],{littleEndian:ce}=this;for(let ie=se;ie<ue;++ie)for(let ae=ne;ae<le;++ae){let Ae;this.planarConfiguration===1&&(Ae=this.getTileOrStrip(ae,ie,0,Q,G));for(let Ce=0;Ce<A.length;++Ce){const be=Ce,xe=A[Ce];this.planarConfiguration===2&&(pe=this.getSampleByteSize(xe),Ae=this.getTileOrStrip(ae,ie,xe,Q,G));const ze=Ae.then(qe=>{const Ve=qe.data,Ke=new DataView(Ve),ct=this.getBlockHeight(qe.y),Ue=qe.y*re,Pe=qe.x*O,Ye=Ue+ct,vt=(qe.x+1)*O,ot=Y[be],Ct=Math.min(ct,ct-(Ye-g[3]),U-Ue),st=Math.min(O,O-(vt-g[2]),K-Pe);for(let yt=Math.max(0,g[1]-Ue);yt<Ct;++yt)for(let gt=Math.max(0,g[0]-Pe);gt<st;++gt){const nt=(yt*O+gt)*pe,_t=ot.call(Ke,nt+Be[be],ce);let ci;x?(ci=(yt+Ue-g[1])*Ie*A.length+(gt+Pe-g[0])*A.length+be,v[ci]=_t):(ci=(yt+Ue-g[1])*Ie+gt+Pe-g[0],v[be][ci]=_t)}});z.push(ze)}}if(await Promise.all(z),T&&g[2]-g[0]!==T||k&&g[3]-g[1]!==k){let ie;return ie=x?Rt(v,g[2]-g[0],g[3]-g[1],T,k,A.length,q):At(v,g[2]-g[0],g[3]-g[1],T,k,q),ie.width=T,ie.height=k,ie}return v.width=T||g[2]-g[0],v.height=k||g[3]-g[1],v}async readRasters({window:g,samples:A=[],interleave:v,pool:x=null,width:Q,height:T,resampleMethod:k,fillValue:q,signal:G}={}){const O=g||[0,0,this.getWidth(),this.getHeight()];if(O[0]>O[2]||O[1]>O[3])throw new Error("Invalid subsets");const re=(O[2]-O[0])*(O[3]-O[1]),K=this.getSamplesPerPixel();if(A&&A.length){for(let le=0;le<A.length;++le)if(A[le]>=K)return Promise.reject(new RangeError(`Invalid sample index '${A[le]}'.`))}else for(let le=0;le<K;++le)A.push(le);let U;if(v)U=ui(this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,Math.max.apply(null,this.fileDirectory.BitsPerSample),re*A.length),q&&U.fill(q);else{U=[];for(let le=0;le<A.length;++le){const se=this.getArrayForSample(A[le],re);Array.isArray(q)&&le<q.length?se.fill(q[le]):q&&!Array.isArray(q)&&se.fill(q),U.push(se)}}const ne=x||await Ne(this.fileDirectory);return await this._readRaster(O,A,U,v,ne,Q,T,k,G)}async readRGB({window:g,interleave:A=!0,pool:v=null,width:x,height:Q,resampleMethod:T,enableAlpha:k=!1,signal:q}={}){const G=g||[0,0,this.getWidth(),this.getHeight()];if(G[0]>G[2]||G[1]>G[3])throw new Error("Invalid subsets");const O=this.fileDirectory.PhotometricInterpretation;if(O===Sn){let ue=[0,1,2];if(this.fileDirectory.ExtraSamples!==j&&k){ue=[];for(let Ie=0;Ie<this.fileDirectory.BitsPerSample.length;Ie+=1)ue.push(Ie)}return this.readRasters({window:g,interleave:A,samples:ue,pool:v,width:x,height:Q,resampleMethod:T,signal:q})}let re;switch(O){case sn:case Yt:case kn:re=[0];break;case Nn:re=[0,1,2,3];break;case fn:case ge:re=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const K={window:G,interleave:!0,samples:re,pool:v,width:x,height:Q,resampleMethod:T,signal:q},{fileDirectory:U}=this,ne=await this.readRasters(K),le=2**this.fileDirectory.BitsPerSample[0];let se;switch(O){case sn:se=function(ue,Ie){const{width:pe,height:Be}=ue,Y=new Uint8Array(pe*Be*3);let z;for(let ce=0,ie=0;ce<ue.length;++ce,ie+=3)z=256-ue[ce]/Ie*256,Y[ie]=z,Y[ie+1]=z,Y[ie+2]=z;return Y}(ne,le);break;case Yt:se=function(ue,Ie){const{width:pe,height:Be}=ue,Y=new Uint8Array(pe*Be*3);let z;for(let ce=0,ie=0;ce<ue.length;++ce,ie+=3)z=ue[ce]/Ie*256,Y[ie]=z,Y[ie+1]=z,Y[ie+2]=z;return Y}(ne,le);break;case kn:se=function(ue,Ie){const{width:pe,height:Be}=ue,Y=new Uint8Array(pe*Be*3),z=Ie.length/3,ce=Ie.length/3*2;for(let ie=0,ae=0;ie<ue.length;++ie,ae+=3){const Ae=ue[ie];Y[ae]=Ie[Ae]/65536*256,Y[ae+1]=Ie[Ae+z]/65536*256,Y[ae+2]=Ie[Ae+ce]/65536*256}return Y}(ne,U.ColorMap);break;case Nn:se=function(ue){const{width:Ie,height:pe}=ue,Be=new Uint8Array(Ie*pe*3);for(let Y=0,z=0;Y<ue.length;Y+=4,z+=3){const ce=ue[Y],ie=ue[Y+1],ae=ue[Y+2],Ae=ue[Y+3];Be[z]=(255-ce)/256*255*((255-Ae)/256),Be[z+1]=(255-ie)/256*255*((255-Ae)/256),Be[z+2]=(255-ae)/256*255*((255-Ae)/256)}return Be}(ne);break;case fn:se=function(ue){const{width:Ie,height:pe}=ue,Be=new Uint8ClampedArray(Ie*pe*3);for(let Y=0,z=0;Y<ue.length;Y+=3,z+=3){const ce=ue[Y],ie=ue[Y+1],ae=ue[Y+2];Be[z]=ce+1.402*(ae-128),Be[z+1]=ce-.34414*(ie-128)-.71414*(ae-128),Be[z+2]=ce+1.772*(ie-128)}return Be}(ne);break;case ge:se=function(ue){const{width:Ie,height:pe}=ue,Be=new Uint8Array(Ie*pe*3);for(let Y=0,z=0;Y<ue.length;Y+=3,z+=3){let ce,ie,ae,Ae=(ue[Y+0]+16)/116,Ce=(ue[Y+1]<<24>>24)/500+Ae,be=Ae-(ue[Y+2]<<24>>24)/200;Ce=.95047*(Ce*Ce*Ce>.008856?Ce*Ce*Ce:(Ce-16/116)/7.787),Ae=1*(Ae*Ae*Ae>.008856?Ae*Ae*Ae:(Ae-16/116)/7.787),be=1.08883*(be*be*be>.008856?be*be*be:(be-16/116)/7.787),ce=3.2406*Ce+-1.5372*Ae+-.4986*be,ie=-.9689*Ce+1.8758*Ae+.0415*be,ae=.0557*Ce+-.204*Ae+1.057*be,ce=ce>.0031308?1.055*ce**(1/2.4)-.055:12.92*ce,ie=ie>.0031308?1.055*ie**(1/2.4)-.055:12.92*ie,ae=ae>.0031308?1.055*ae**(1/2.4)-.055:12.92*ae,Be[z]=255*Math.max(0,Math.min(1,ce)),Be[z+1]=255*Math.max(0,Math.min(1,ie)),Be[z+2]=255*Math.max(0,Math.min(1,ae))}return Be}(ne);break;default:throw new Error("Unsupported photometric interpretation.")}if(!A){const ue=new Uint8Array(se.length/3),Ie=new Uint8Array(se.length/3),pe=new Uint8Array(se.length/3);for(let Be=0,Y=0;Be<se.length;Be+=3,++Y)ue[Y]=se[Be],Ie[Y]=se[Be+1],pe[Y]=se[Be+2];se=[ue,Ie,pe]}return se.width=ne.width,se.height=ne.height,se}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const g=[];for(let A=0;A<this.fileDirectory.ModelTiepoint.length;A+=6)g.push({i:this.fileDirectory.ModelTiepoint[A],j:this.fileDirectory.ModelTiepoint[A+1],k:this.fileDirectory.ModelTiepoint[A+2],x:this.fileDirectory.ModelTiepoint[A+3],y:this.fileDirectory.ModelTiepoint[A+4],z:this.fileDirectory.ModelTiepoint[A+5]});return g}getGDALMetadata(g=null){const A={};if(!this.fileDirectory.GDAL_METADATA)return null;const v=this.fileDirectory.GDAL_METADATA;let x=Qn(v,"Item");x=g===null?x.filter(Q=>Kt(Q,"sample")===void 0):x.filter(Q=>Number(Kt(Q,"sample"))===g);for(let Q=0;Q<x.length;++Q){const T=x[Q];A[Kt(T,"name")]=T.inner}return A}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const g=this.fileDirectory.GDAL_NODATA;return Number(g.substring(0,g.length-1))}getOrigin(){const g=this.fileDirectory.ModelTiepoint,A=this.fileDirectory.ModelTransformation;if(g&&g.length===6)return[g[3],g[4],g[5]];if(A)return[A[3],A[7],A[11]];throw new Error("The image does not have an affine transformation.")}getResolution(g=null){const A=this.fileDirectory.ModelPixelScale,v=this.fileDirectory.ModelTransformation;if(A)return[A[0],-A[1],A[2]];if(v)return v[1]===0&&v[4]===0?[v[0],-v[5],v[10]]:[Math.sqrt(v[0]*v[0]+v[4]*v[4]),-Math.sqrt(v[1]*v[1]+v[5]*v[5]),v[10]];if(g){const[x,Q,T]=g.getResolution();return[x*g.getWidth()/this.getWidth(),Q*g.getHeight()/this.getHeight(),T*g.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(g=!1){const A=this.getHeight(),v=this.getWidth();if(this.fileDirectory.ModelTransformation&&!g){const[x,Q,T,k,q,G,O,re]=this.fileDirectory.ModelTransformation,K=[[0,0],[0,A],[v,0],[v,A]].map(([le,se])=>[k+x*le+Q*se,re+q*le+G*se]),U=K.map(le=>le[0]),ne=K.map(le=>le[1]);return[Math.min(...U),Math.min(...ne),Math.max(...U),Math.max(...ne)]}{const x=this.getOrigin(),Q=this.getResolution(),T=x[0],k=x[1],q=T+Q[0]*v,G=k+Q[1]*A;return[Math.min(T,q),Math.min(k,G),Math.max(T,q),Math.max(k,G)]}}}class fi{constructor(g){this._dataView=new DataView(g)}get buffer(){return this._dataView.buffer}getUint64(g,A){const v=this.getUint32(g,A),x=this.getUint32(g+4,A);let Q;if(A){if(Q=v+2**32*x,!Number.isSafeInteger(Q))throw new Error(`${Q} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return Q}if(Q=2**32*v+x,!Number.isSafeInteger(Q))throw new Error(`${Q} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return Q}getInt64(g,A){let v=0;const x=(128&this._dataView.getUint8(g+(A?7:0)))>0;let Q=!0;for(let T=0;T<8;T++){let k=this._dataView.getUint8(g+(A?T:7-T));x&&(Q?k!==0&&(k=255&~(k-1),Q=!1):k=255&~k),v+=k*256**T}return x&&(v=-v),v}getUint8(g,A){return this._dataView.getUint8(g,A)}getInt8(g,A){return this._dataView.getInt8(g,A)}getUint16(g,A){return this._dataView.getUint16(g,A)}getInt16(g,A){return this._dataView.getInt16(g,A)}getUint32(g,A){return this._dataView.getUint32(g,A)}getInt32(g,A){return this._dataView.getInt32(g,A)}getFloat16(g,A){return pi(this._dataView,g,A)}getFloat32(g,A){return this._dataView.getFloat32(g,A)}getFloat64(g,A){return this._dataView.getFloat64(g,A)}}class ai{constructor(g,A,v,x){this._dataView=new DataView(g),this._sliceOffset=A,this._littleEndian=v,this._bigTiff=x}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(g,A){return this.sliceOffset<=g&&this.sliceTop>=g+A}readUint8(g){return this._dataView.getUint8(g-this._sliceOffset,this._littleEndian)}readInt8(g){return this._dataView.getInt8(g-this._sliceOffset,this._littleEndian)}readUint16(g){return this._dataView.getUint16(g-this._sliceOffset,this._littleEndian)}readInt16(g){return this._dataView.getInt16(g-this._sliceOffset,this._littleEndian)}readUint32(g){return this._dataView.getUint32(g-this._sliceOffset,this._littleEndian)}readInt32(g){return this._dataView.getInt32(g-this._sliceOffset,this._littleEndian)}readFloat32(g){return this._dataView.getFloat32(g-this._sliceOffset,this._littleEndian)}readFloat64(g){return this._dataView.getFloat64(g-this._sliceOffset,this._littleEndian)}readUint64(g){const A=this.readUint32(g),v=this.readUint32(g+4);let x;if(this._littleEndian){if(x=A+2**32*v,!Number.isSafeInteger(x))throw new Error(`${x} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return x}if(x=2**32*A+v,!Number.isSafeInteger(x))throw new Error(`${x} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return x}readInt64(g){let A=0;const v=(128&this._dataView.getUint8(g+(this._littleEndian?7:0)))>0;let x=!0;for(let Q=0;Q<8;Q++){let T=this._dataView.getUint8(g+(this._littleEndian?Q:7-Q));v&&(x?T!==0&&(T=255&~(T-1),x=!1):T=255&~T),A+=T*256**Q}return v&&(A=-A),A}readOffset(g){return this._bigTiff?this.readUint64(g):this.readUint32(g)}}const sr=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class Ki{constructor(g=sr,A){this.workers=null,this._awaitingDecoder=null,this.size=g,this.messageId=0,g&&(this._awaitingDecoder=A?Promise.resolve(A):new Promise(v=>{Promise.resolve().then(function(){return oe}).then(x=>{v(x.create)})}),this._awaitingDecoder.then(v=>{this._awaitingDecoder=null,this.workers=[];for(let x=0;x<g;x++)this.workers.push({worker:v(),idle:!0})}))}async decode(g,A){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?Ne(g).then(v=>v.decode(g,A)):new Promise(v=>{const x=this.workers.find(k=>k.idle)||this.workers[Math.floor(Math.random()*this.size)];x.idle=!1;const Q=this.messageId++,T=k=>{k.data.id===Q&&(x.idle=!0,v(k.data.decoded),x.worker.removeEventListener("message",T))};x.worker.addEventListener("message",T),x.worker.postMessage({fileDirectory:g,buffer:A,id:Q},[A])})}destroy(){this.workers&&(this.workers.forEach(g=>{g.worker.terminate()}),this.workers=null)}}const ii=`\r
\r
`;function xi(p){if(Object.fromEntries!==void 0)return Object.fromEntries(p);const g={};for(const[A,v]of p)g[A.toLowerCase()]=v;return g}function Ui(p){return xi(p.split(`\r
`).map(g=>{const A=g.split(":").map(v=>v.trim());return A[0]=A[0].toLowerCase(),A}))}function ar(p){let g,A,v;return p&&([,g,A,v]=p.match(/bytes (\d+)-(\d+)\/(\d+)/),g=parseInt(g,10),A=parseInt(A,10),v=parseInt(v,10)),{start:g,end:A,total:v}}class Ar{async fetch(g,A=void 0){return Promise.all(g.map(v=>this.fetchSlice(v,A)))}async fetchSlice(g){throw new Error(`fetching of slice ${g} not possible, not implemented`)}get fileSize(){return null}async close(){}}class dr extends Map{constructor(g={}){if(super(),!(g.maxSize&&g.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof g.maxAge=="number"&&g.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=g.maxSize,this.maxAge=g.maxAge||Number.POSITIVE_INFINITY,this.onEviction=g.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(g){if(typeof this.onEviction=="function")for(const[A,v]of g)this.onEviction(A,v.value)}_deleteIfExpired(g,A){return typeof A.expiry=="number"&&A.expiry<=Date.now()&&(typeof this.onEviction=="function"&&this.onEviction(g,A.value),this.delete(g))}_getOrDeleteIfExpired(g,A){if(this._deleteIfExpired(g,A)===!1)return A.value}_getItemValue(g,A){return A.expiry?this._getOrDeleteIfExpired(g,A):A.value}_peek(g,A){const v=A.get(g);return this._getItemValue(g,v)}_set(g,A){this.cache.set(g,A),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(g,A){this.oldCache.delete(g),this._set(g,A)}*_entriesAscending(){for(const g of this.oldCache){const[A,v]=g;this.cache.has(A)||this._deleteIfExpired(A,v)===!1&&(yield g)}for(const g of this.cache){const[A,v]=g;this._deleteIfExpired(A,v)===!1&&(yield g)}}get(g){if(this.cache.has(g)){const A=this.cache.get(g);return this._getItemValue(g,A)}if(this.oldCache.has(g)){const A=this.oldCache.get(g);if(this._deleteIfExpired(g,A)===!1)return this._moveToRecent(g,A),A.value}}set(g,A,{maxAge:v=this.maxAge}={}){const x=typeof v=="number"&&v!==Number.POSITIVE_INFINITY?Date.now()+v:void 0;return this.cache.has(g)?this.cache.set(g,{value:A,expiry:x}):this._set(g,{value:A,expiry:x}),this}has(g){return this.cache.has(g)?!this._deleteIfExpired(g,this.cache.get(g)):!!this.oldCache.has(g)&&!this._deleteIfExpired(g,this.oldCache.get(g))}peek(g){return this.cache.has(g)?this._peek(g,this.cache):this.oldCache.has(g)?this._peek(g,this.oldCache):void 0}delete(g){const A=this.cache.delete(g);return A&&this._size--,this.oldCache.delete(g)||A}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(g){if(!(g&&g>0))throw new TypeError("`maxSize` must be a number greater than 0");const A=[...this._entriesAscending()],v=A.length-g;v<0?(this.cache=new Map(A),this.oldCache=new Map,this._size=A.length):(v>0&&this._emitEvictions(A.slice(0,v)),this.oldCache=new Map(A.slice(v)),this.cache=new Map,this._size=0),this.maxSize=g}*keys(){for(const[g]of this)yield g}*values(){for(const[,g]of this)yield g}*[Symbol.iterator](){for(const g of this.cache){const[A,v]=g;this._deleteIfExpired(A,v)===!1&&(yield[A,v.value])}for(const g of this.oldCache){const[A,v]=g;this.cache.has(A)||this._deleteIfExpired(A,v)===!1&&(yield[A,v.value])}}*entriesDescending(){let g=[...this.cache];for(let A=g.length-1;A>=0;--A){const v=g[A],[x,Q]=v;this._deleteIfExpired(x,Q)===!1&&(yield[x,Q.value])}g=[...this.oldCache];for(let A=g.length-1;A>=0;--A){const v=g[A],[x,Q]=v;this.cache.has(x)||this._deleteIfExpired(x,Q)===!1&&(yield[x,Q.value])}}*entriesAscending(){for(const[g,A]of this._entriesAscending())yield[g,A.value]}get size(){if(!this._size)return this.oldCache.size;let g=0;for(const A of this.oldCache.keys())this.cache.has(A)||g++;return Math.min(this._size+g,this.maxSize)}entries(){return this.entriesAscending()}forEach(g,A=this){for(const[v,x]of this.entriesAscending())g.call(A,x,v,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}class gn extends Error{constructor(g){super(g),Error.captureStackTrace&&Error.captureStackTrace(this,gn),this.name="AbortError"}}class Bi extends Error{constructor(g,A){super(A),this.errors=g,this.message=A,this.name="AggregateError"}}const Yo=Bi;class Ko{constructor(g,A,v=null){this.offset=g,this.length=A,this.data=v}get top(){return this.offset+this.length}}class Tr{constructor(g,A,v){this.offset=g,this.length=A,this.blockIds=v}}class Vr extends Ar{constructor(g,{blockSize:A=65536,cacheSize:v=100}={}){super(),this.source=g,this.blockSize=A,this.blockCache=new dr({maxSize:v,onEviction:(x,Q)=>{this.evictedBlocks.set(x,Q)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(g,A){const v=[],x=[],Q=[];this.evictedBlocks.clear();for(const{offset:K,length:U}of g){let ne=K+U;const{fileSize:le}=this;le!==null&&(ne=Math.min(ne,le));for(let se=Math.floor(K/this.blockSize)*this.blockSize;se<ne;se+=this.blockSize){const ue=Math.floor(se/this.blockSize);this.blockCache.has(ue)||this.blockRequests.has(ue)||(this.blockIdsToFetch.add(ue),x.push(ue)),this.blockRequests.has(ue)&&v.push(this.blockRequests.get(ue)),Q.push(ue)}}await async function(K){return new Promise(U=>setTimeout(U,K))}(),this.fetchBlocks(A);const T=[];for(const K of x)this.blockRequests.has(K)&&T.push(this.blockRequests.get(K));await Promise.allSettled(v),await Promise.allSettled(T);const k=[],q=Q.filter(K=>this.abortedBlockIds.has(K)||!this.blockCache.has(K));if(q.forEach(K=>this.blockIdsToFetch.add(K)),q.length>0&&A&&!A.aborted){this.fetchBlocks(null);for(const K of q){const U=this.blockRequests.get(K);if(!U)throw new Error(`Block ${K} is not in the block requests`);k.push(U)}await Promise.allSettled(k)}if(A&&A.aborted)throw new gn("Request was aborted");const G=Q.map(K=>this.blockCache.get(K)||this.evictedBlocks.get(K)),O=G.filter(K=>!K);if(O.length)throw new Yo(O,"Request failed");const re=new Map(function(K,U){const ne=Array.isArray(K)?K:Array.from(K),le=Array.isArray(U)?U:Array.from(U);return ne.map((se,ue)=>[se,le[ue]])}(Q,G));return this.readSliceData(g,re)}fetchBlocks(g){if(this.blockIdsToFetch.size>0){const A=this.groupBlocks(this.blockIdsToFetch),v=this.source.fetch(A,g);for(let x=0;x<A.length;++x){const Q=A[x];for(const T of Q.blockIds)this.blockRequests.set(T,(async()=>{try{const k=(await v)[x],q=T*this.blockSize,G=q-k.offset,O=Math.min(G+this.blockSize,k.data.byteLength),re=k.data.slice(G,O),K=new Ko(q,re.byteLength,re,T);this.blockCache.set(T,K),this.abortedBlockIds.delete(T)}catch(k){if(k.name!=="AbortError")throw k;k.signal=g,this.blockCache.delete(T),this.abortedBlockIds.add(T)}finally{this.blockRequests.delete(T)}})())}this.blockIdsToFetch.clear()}}groupBlocks(g){const A=Array.from(g).sort((T,k)=>T-k);if(A.length===0)return[];let v=[],x=null;const Q=[];for(const T of A)x===null||x+1===T?(v.push(T),x=T):(Q.push(new Tr(v[0]*this.blockSize,v.length*this.blockSize,v)),v=[T],x=T);return Q.push(new Tr(v[0]*this.blockSize,v.length*this.blockSize,v)),Q}readSliceData(g,A){return g.map(v=>{let x=v.offset+v.length;this.fileSize!==null&&(x=Math.min(this.fileSize,x));const Q=Math.floor(v.offset/this.blockSize),T=Math.floor(x/this.blockSize),k=new ArrayBuffer(v.length),q=new Uint8Array(k);for(let G=Q;G<=T;++G){const O=A.get(G),re=O.offset-v.offset;let K,U=0,ne=0;re<0?U=-re:re>0&&(ne=re),K=O.top-x<0?O.length-U:x-O.offset-U;const le=new Uint8Array(O.data,U,K);q.set(le,ne)}return k})}}class Zo{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(g){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class Pr{constructor(g){this.url=g}async request({headers:g,signal:A}={}){throw new Error("request is not implemented")}}class Hr extends Zo{constructor(g){super(),this.response=g}get status(){return this.response.status}getHeader(g){return this.response.headers.get(g)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class sa extends Pr{constructor(g,A){super(g),this.credentials=A}async request({headers:g,signal:A}={}){const v=await fetch(this.url,{headers:g,credentials:this.credentials,signal:A});return new Hr(v)}}class ks extends Zo{constructor(g,A){super(),this.xhr=g,this.data=A}get status(){return this.xhr.status}getHeader(g){return this.xhr.getResponseHeader(g)}async getData(){return this.data}}class or extends Pr{constructRequest(g,A){return new Promise((v,x)=>{const Q=new XMLHttpRequest;Q.open("GET",this.url),Q.responseType="arraybuffer";for(const[T,k]of Object.entries(g))Q.setRequestHeader(T,k);Q.onload=()=>{const T=Q.response;v(new ks(Q,T))},Q.onerror=x,Q.onabort=()=>x(new gn("Request aborted")),Q.send(),A&&(A.aborted&&Q.abort(),A.addEventListener("abort",()=>Q.abort()))})}async request({headers:g,signal:A}={}){return await this.constructRequest(g,A)}}var aa={};class pn extends Zo{constructor(g,A){super(),this.response=g,this.dataPromise=A}get status(){return this.response.statusCode}getHeader(g){return this.response.headers[g]}async getData(){return await this.dataPromise}}class er extends Pr{constructor(g){super(g),this.parsedUrl=aa.parse(this.url),this.httpApi=(this.parsedUrl.protocol,aa)}constructRequest(g,A){return new Promise((v,x)=>{const Q=this.httpApi.get({...this.parsedUrl,headers:g},T=>{const k=new Promise(q=>{const G=[];T.on("data",O=>{G.push(O)}),T.on("end",()=>{const O=Buffer.concat(G).buffer;q(O)}),T.on("error",x)});v(new pn(T,k))});Q.on("error",x),A&&(A.aborted&&Q.destroy(new gn("Request aborted")),A.addEventListener("abort",()=>Q.destroy(new gn("Request aborted"))))})}async request({headers:g,signal:A}={}){return await this.constructRequest(g,A)}}class oa extends Ar{constructor(g,A,v,x){super(),this.client=g,this.headers=A,this.maxRanges=v,this.allowFullFile=x,this._fileSize=null}async fetch(g,A){return this.maxRanges>=g.length?this.fetchSlices(g,A):(this.maxRanges>0&&g.length,Promise.all(g.map(v=>this.fetchSlice(v,A))))}async fetchSlices(g,A){const v=await this.client.request({headers:{...this.headers,Range:`bytes=${g.map(({offset:x,length:Q})=>`${x}-${x+Q}`).join(",")}`},signal:A});if(v.ok){if(v.status===206){const{type:x,params:Q}=function(re){const[K,...U]=re.split(";").map(ne=>ne.trim());return{type:K,params:xi(U.map(ne=>ne.split("=")))}}(v.getHeader("content-type"));if(x==="multipart/byteranges"){const re=function(K,U){let ne=null;const le=new TextDecoder("ascii"),se=[],ue=`--${U}`,Ie=`${ue}--`;for(let pe=0;pe<10;++pe)le.decode(new Uint8Array(K,pe,ue.length))===ue&&(ne=pe);if(ne===null)throw new Error("Could not find initial boundary");for(;ne<K.byteLength;){const pe=le.decode(new Uint8Array(K,ne,Math.min(ue.length+1024,K.byteLength-ne)));if(pe.length===0||pe.startsWith(Ie))break;if(!pe.startsWith(ue))throw new Error("Part does not start with boundary");const Be=pe.substr(ue.length+2);if(Be.length===0)break;const Y=Be.indexOf(ii),z=Ui(Be.substr(0,Y)),{start:ce,end:ie,total:ae}=ar(z["content-range"]),Ae=ne+ue.length+Y+4,Ce=parseInt(ie,10)+1-parseInt(ce,10);se.push({headers:z,data:K.slice(Ae,Ae+Ce),offset:ce,length:Ce,fileSize:ae}),ne=Ae+Ce+4}return se}(await v.getData(),Q.boundary);return this._fileSize=re[0].fileSize||null,re}const T=await v.getData(),{start:k,end:q,total:G}=ar(v.getHeader("content-range"));this._fileSize=G||null;const O=[{data:T,offset:k,length:q-k}];if(g.length>1){const re=await Promise.all(g.slice(1).map(K=>this.fetchSlice(K,A)));return O.concat(re)}return O}{if(!this.allowFullFile)throw new Error("Server responded with full file");const x=await v.getData();return this._fileSize=x.byteLength,[{data:x,offset:0,length:x.byteLength}]}}throw new Error("Error fetching data.")}async fetchSlice(g,A){const{offset:v,length:x}=g,Q=await this.client.request({headers:{...this.headers,Range:`bytes=${v}-${v+x}`},signal:A});if(Q.ok){if(Q.status===206){const T=await Q.getData(),{total:k}=ar(Q.getHeader("content-range"));return this._fileSize=k||null,{data:T,offset:v,length:x}}{if(!this.allowFullFile)throw new Error("Server responded with full file");const T=await Q.getData();return this._fileSize=T.byteLength,{data:T,offset:0,length:T.byteLength}}}throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function jr(p,{blockSize:g,cacheSize:A}){return g===null?p:new Vr(p,{blockSize:g,cacheSize:A})}function $o(p,{forceXHR:g=!1,...A}={}){return typeof fetch!="function"||g?typeof XMLHttpRequest<"u"?function(v,{headers:x={},maxRanges:Q=0,allowFullFile:T=!1,...k}={}){const q=new or(v);return jr(new oa(q,x,Q,T),k)}(p,A):function(v,{headers:x={},maxRanges:Q=0,allowFullFile:T=!1,...k}={}){const q=new er(v);return jr(new oa(q,x,Q,T),k)}(p,A):function(v,{headers:x={},credentials:Q,maxRanges:T=0,allowFullFile:k=!1,...q}={}){const G=new sa(v,Q);return jr(new oa(G,x,T,k),q)}(p,A)}function mn(p,g){let A=p.length-g,v=0;do{for(let x=g;x>0;x--)p[v+g]+=p[v],v++;A-=g}while(A>0)}function uc(p,g,A){let v=0,x=p.length;const Q=x/A;for(;x>g;){for(let k=g;k>0;--k)p[v+g]+=p[v],++v;x-=g}const T=p.slice();for(let k=0;k<Q;++k)for(let q=0;q<A;++q)p[A*k+q]=T[(A-q-1)*Q+k]}class Dn{async decode(g,A){const v=await this.decodeBlock(A),x=g.Predictor||1;if(x!==1){const Q=!g.StripOffsets;return function(T,k,q,G,O,re){if(k===1)return T;for(let ne=0;ne<O.length;++ne){if(O[ne]%8!=0)throw new Error("When decoding with predictor, only multiple of 8 bits are supported.");if(O[ne]!==O[0])throw new Error("When decoding with predictor, all samples must have the same size.")}const K=O[0]/8,U=re===2?1:O.length;for(let ne=0;ne<G&&!(ne*U*q*K>=T.byteLength);++ne){let le;if(k===2){switch(O[0]){case 8:le=new Uint8Array(T,ne*U*q*K,U*q*K);break;case 16:le=new Uint16Array(T,ne*U*q*K,U*q*K/2);break;case 32:le=new Uint32Array(T,ne*U*q*K,U*q*K/4);break;default:throw new Error(`Predictor 2 not allowed with ${O[0]} bits per sample.`)}mn(le,U)}else k===3&&(le=new Uint8Array(T,ne*U*q*K,U*q*K),uc(le,U,K))}return T}(v,x,Q?g.TileWidth:g.ImageWidth,Q?g.TileLength:g.RowsPerStrip||g.ImageLength,g.BitsPerSample,g.PlanarConfiguration)}return v}}function On(p){switch(p){case Ht.BYTE:case Ht.ASCII:case Ht.SBYTE:case Ht.UNDEFINED:return 1;case Ht.SHORT:case Ht.SSHORT:return 2;case Ht.LONG:case Ht.SLONG:case Ht.FLOAT:case Ht.IFD:return 4;case Ht.RATIONAL:case Ht.SRATIONAL:case Ht.DOUBLE:case Ht.LONG8:case Ht.SLONG8:case Ht.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${p}`)}}function Jr(p,g,A,v){let x=null,Q=null;const T=On(g);switch(g){case Ht.BYTE:case Ht.ASCII:case Ht.UNDEFINED:x=new Uint8Array(A),Q=p.readUint8;break;case Ht.SBYTE:x=new Int8Array(A),Q=p.readInt8;break;case Ht.SHORT:x=new Uint16Array(A),Q=p.readUint16;break;case Ht.SSHORT:x=new Int16Array(A),Q=p.readInt16;break;case Ht.LONG:case Ht.IFD:x=new Uint32Array(A),Q=p.readUint32;break;case Ht.SLONG:x=new Int32Array(A),Q=p.readInt32;break;case Ht.LONG8:case Ht.IFD8:x=new Array(A),Q=p.readUint64;break;case Ht.SLONG8:x=new Array(A),Q=p.readInt64;break;case Ht.RATIONAL:x=new Uint32Array(2*A),Q=p.readUint32;break;case Ht.SRATIONAL:x=new Int32Array(2*A),Q=p.readInt32;break;case Ht.FLOAT:x=new Float32Array(A),Q=p.readFloat32;break;case Ht.DOUBLE:x=new Float64Array(A),Q=p.readFloat64;break;default:throw new RangeError(`Invalid field type: ${g}`)}if(g!==Ht.RATIONAL&&g!==Ht.SRATIONAL)for(let k=0;k<A;++k)x[k]=Q.call(p,v+k*T);else for(let k=0;k<A;k+=2)x[k]=Q.call(p,v+k*T),x[k+1]=Q.call(p,v+(k*T+4));return g===Ht.ASCII?new TextDecoder("utf-8").decode(x):x}class _i{constructor(g,A,v){this.fileDirectory=g,this.geoKeyDirectory=A,this.nextIFDByteOffset=v}}class la extends Error{constructor(g){super(`No image at index ${g}`),this.index=g}}class Xo{async readRasters(g={}){const{window:A,width:v,height:x}=g;let{resX:Q,resY:T,bbox:k}=g;const q=await this.getImage();let G=q;const O=await this.getImageCount(),re=q.getBoundingBox();if(A&&k)throw new Error('Both "bbox" and "window" passed.');if(v||x){if(A){const[ne,le]=q.getOrigin(),[se,ue]=q.getResolution();k=[ne+A[0]*se,le+A[1]*ue,ne+A[2]*se,le+A[3]*ue]}const U=k||re;if(v){if(Q)throw new Error("Both width and resX passed");Q=(U[2]-U[0])/v}if(x){if(T)throw new Error("Both width and resY passed");T=(U[3]-U[1])/x}}if(Q||T){const U=[];for(let ne=0;ne<O;++ne){const le=await this.getImage(ne),{SubfileType:se,NewSubfileType:ue}=le.fileDirectory;(ne===0||se===2||1&ue)&&U.push(le)}U.sort((ne,le)=>ne.getWidth()-le.getWidth());for(let ne=0;ne<U.length;++ne){const le=U[ne],se=(re[2]-re[0])/le.getWidth(),ue=(re[3]-re[1])/le.getHeight();if(G=le,Q&&Q>se||T&&T>ue)break}}let K=A;if(k){const[U,ne]=q.getOrigin(),[le,se]=G.getResolution(q);K=[Math.round((k[0]-U)/le),Math.round((k[1]-ne)/se),Math.round((k[2]-U)/le),Math.round((k[3]-ne)/se)],K=[Math.min(K[0],K[2]),Math.min(K[1],K[3]),Math.max(K[0],K[2]),Math.max(K[1],K[3])]}return G.readRasters({...g,window:K})}}class hs extends Xo{constructor(g,A,v,x,Q={}){super(),this.source=g,this.littleEndian=A,this.bigTiff=v,this.firstIFDOffset=x,this.cache=Q.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(g,A){const v=this.bigTiff?4048:1024;return new ai((await this.source.fetch([{offset:g,length:A!==void 0?A:v}]))[0],g,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(g){const A=this.bigTiff?20:12,v=this.bigTiff?8:2;let x=await this.getSlice(g);const Q=this.bigTiff?x.readUint64(g):x.readUint16(g),T=Q*A+(this.bigTiff?16:6);x.covers(g,T)||(x=await this.getSlice(g,T));const k={};let q=g+(this.bigTiff?8:2);for(let re=0;re<Q;q+=A,++re){const K=x.readUint16(q),U=x.readUint16(q+2),ne=this.bigTiff?x.readUint64(q+4):x.readUint32(q+4);let le,se;const ue=On(U),Ie=q+(this.bigTiff?12:8);if(ue*ne<=(this.bigTiff?8:4))le=Jr(x,U,ne,Ie);else{const pe=x.readOffset(Ie),Be=On(U)*ne;x.covers(pe,Be)?le=Jr(x,U,ne,pe):le=Jr(await this.getSlice(pe,Be),U,ne,pe)}se=ne===1&&ei.indexOf(K)===-1&&U!==Ht.RATIONAL&&U!==Ht.SRATIONAL?le[0]:le,k[nn[K]]=se}const G=function(re){const K=re.GeoKeyDirectory;if(!K)return null;const U={};for(let ne=4;ne<=4*K[3];ne+=4){const le=Se[K[ne]],se=K[ne+1]?nn[K[ne+1]]:null,ue=K[ne+2],Ie=K[ne+3];let pe=null;if(se){if(pe=re[se],pe==null)throw new Error(`Could not get value of geoKey '${le}'.`);typeof pe=="string"?pe=pe.substring(Ie,Ie+ue-1):pe.subarray&&(pe=pe.subarray(Ie,Ie+ue),ue===1&&(pe=pe[0]))}else pe=Ie;U[le]=pe}return U}(k),O=x.readOffset(g+v+A*Q);return new _i(k,G,O)}async requestIFD(g){if(this.ifdRequests[g])return this.ifdRequests[g];if(g===0)return this.ifdRequests[g]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[g];if(!this.ifdRequests[g-1])try{this.ifdRequests[g-1]=this.requestIFD(g-1)}catch(A){throw A instanceof la?new la(g):A}return this.ifdRequests[g]=(async()=>{const A=await this.ifdRequests[g-1];if(A.nextIFDByteOffset===0)throw new la(g);return this.parseFileDirectoryAt(A.nextIFDByteOffset)})(),this.ifdRequests[g]}async getImage(g=0){const A=await this.requestIFD(g);return new Zt(A.fileDirectory,A.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let g=0,A=!0;for(;A;)try{await this.requestIFD(g),++g}catch(v){if(!(v instanceof la))throw v;A=!1}return g}async getGhostValues(){const g=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const A="GDAL_STRUCTURAL_METADATA_SIZE=";let v=await this.getSlice(g,130);if(A===Jr(v,Ht.ASCII,30,g)){const x=Jr(v,Ht.ASCII,130,g).split(`
`)[0],Q=Number(x.split("=")[1].split(" ")[0])+x.length;Q>130&&(v=await this.getSlice(g,Q));const T=Jr(v,Ht.ASCII,Q,g);this.ghostValues={},T.split(`
`).filter(k=>k.length>0).map(k=>k.split("=")).forEach(([k,q])=>{this.ghostValues[k]=q})}return this.ghostValues}static async fromSource(g,A,v){const x=(await g.fetch([{offset:0,length:1024}],v))[0],Q=new fi(x),T=Q.getUint16(0,0);let k;if(T===18761)k=!0;else{if(T!==19789)throw new TypeError("Invalid byte order value.");k=!1}const q=Q.getUint16(2,k);let G;if(q===42)G=!1;else{if(q!==43)throw new TypeError("Invalid magic number.");if(G=!0,Q.getUint16(4,k)!==8)throw new Error("Unsupported offset byte-size.")}const O=G?Q.getUint64(8,k):Q.getUint32(4,k);return new hs(g,k,G,O,A)}close(){return typeof this.source.close=="function"&&this.source.close()}}var so={exports:{}};(function(p,g){var A=function(){var v={},x=Math.PI/180,Q=180/Math.PI,T=6378137,k=20037508342789244e-9;function q(O){return Number(O)===O&&O%1!=0}function G(O){if(O=O||{},this.size=O.size||256,this.expansion=O.antimeridian===!0?2:1,!v[this.size]){var re=this.size,K=v[this.size]={};K.Bc=[],K.Cc=[],K.zc=[],K.Ac=[];for(var U=0;U<30;U++)K.Bc.push(re/360),K.Cc.push(re/(2*Math.PI)),K.zc.push(re/2),K.Ac.push(re),re*=2}this.Bc=v[this.size].Bc,this.Cc=v[this.size].Cc,this.zc=v[this.size].zc,this.Ac=v[this.size].Ac}return G.prototype.px=function(O,re){if(q(re)){var K=this.size*Math.pow(2,re),U=K/2,ne=K/360,le=K/(2*Math.PI),se=K,ue=Math.min(Math.max(Math.sin(x*O[1]),-.9999),.9999),Ie=U+O[0]*ne,pe=U+.5*Math.log((1+ue)/(1-ue))*-le;return Ie>se*this.expansion&&(Ie=se*this.expansion),pe>se&&(pe=se),[Ie,pe]}return U=this.zc[re],ue=Math.min(Math.max(Math.sin(x*O[1]),-.9999),.9999),Ie=Math.round(U+O[0]*this.Bc[re]),pe=Math.round(U+.5*Math.log((1+ue)/(1-ue))*-this.Cc[re]),Ie>this.Ac[re]*this.expansion&&(Ie=this.Ac[re]*this.expansion),pe>this.Ac[re]&&(pe=this.Ac[re]),[Ie,pe]},G.prototype.ll=function(O,re){if(q(re)){var K=this.size*Math.pow(2,re),U=K/360,ne=K/(2*Math.PI),le=K/2,se=(O[1]-le)/-ne;return[(O[0]-le)/U,Q*(2*Math.atan(Math.exp(se))-.5*Math.PI)]}return se=(O[1]-this.zc[re])/-this.Cc[re],[(O[0]-this.zc[re])/this.Bc[re],Q*(2*Math.atan(Math.exp(se))-.5*Math.PI)]},G.prototype.bbox=function(O,re,K,U,ne){U&&(re=Math.pow(2,K)-1-re);var le=[O*this.size,(+re+1)*this.size],se=[(+O+1)*this.size,re*this.size],ue=this.ll(le,K).concat(this.ll(se,K));return ne==="900913"?this.convert(ue,"900913"):ue},G.prototype.xyz=function(O,re,K,U){U==="900913"&&(O=this.convert(O,"WGS84"));var ne=[O[0],O[1]],le=[O[2],O[3]],se=this.px(ne,re),ue=this.px(le,re),Ie=[Math.floor(se[0]/this.size),Math.floor((ue[0]-1)/this.size)],pe=[Math.floor(ue[1]/this.size),Math.floor((se[1]-1)/this.size)],Be={minX:Math.min.apply(Math,Ie)<0?0:Math.min.apply(Math,Ie),minY:Math.min.apply(Math,pe)<0?0:Math.min.apply(Math,pe),maxX:Math.max.apply(Math,Ie),maxY:Math.max.apply(Math,pe)};if(K){var Y={minY:Math.pow(2,re)-1-Be.maxY,maxY:Math.pow(2,re)-1-Be.minY};Be.minY=Y.minY,Be.maxY=Y.maxY}return Be},G.prototype.convert=function(O,re){return re==="900913"?this.forward(O.slice(0,2)).concat(this.forward(O.slice(2,4))):this.inverse(O.slice(0,2)).concat(this.inverse(O.slice(2,4)))},G.prototype.forward=function(O){var re=[T*O[0]*x,T*Math.log(Math.tan(.25*Math.PI+.5*O[1]*x))];return re[0]>k&&(re[0]=k),re[0]<-k&&(re[0]=-k),re[1]>k&&(re[1]=k),re[1]<-k&&(re[1]=-k),re},G.prototype.inverse=function(O){return[O[0]*Q/T,(.5*Math.PI-2*Math.atan(Math.exp(-O[1]/T)))*Q]},G}();p.exports=A})(so);const yn=256,qn=4007501668557849e-8,Ds=new(yr(so.exports))({size:yn,antimeridian:!0}),ca=({x:p,y:g,z:A})=>Ds.bbox(p,g,A,!1,"900913"),ao=36e5;let Wo;const el=new dr({maxSize:16,maxAge:ao}),Rl=new dr({maxSize:16,maxAge:ao}),us=new dr({maxSize:1024,maxAge:ao}),Ms=p=>{Wo===void 0&&(Wo=new Ki);const g=v=>{const x=el.get(v);if(x)return x;{const Q=async function(T,k={},q){return hs.fromSource($o(T,k),q)}(v);return el.set(v,Q),Q}},A=async()=>{var Q;const v=Rl.get(p);if(v)return v;{const T=await g(p),k=await T.getImage(),q=k.getGDALMetadata(0),G=k.fileDirectory,O=(Q=k.fileDirectory)==null?void 0:Q.Artist,re=(([le,se,ue,Ie])=>[...Ds.inverse([le,se]),...Ds.inverse([ue,Ie])])(k.getBoundingBox()),K=[],U=await T.getImageCount();for(let le=0;le<U;le++){const se=await T.getImage(le),ue=(x=se.getResolution(k)[0],Math.log2(qn/(yn*x))),Ie=!!(1&se.fileDirectory.NewSubfileType),pe=!!(4&se.fileDirectory.NewSubfileType);K.push({zoom:ue,isOverview:Ie,isMask:pe})}const ne={offset:(q==null?void 0:q.OFFSET)!==void 0?parseFloat(q.OFFSET):0,scale:(q==null?void 0:q.SCALE)!==void 0?parseFloat(q.SCALE):1,noData:k.getGDALNoData()??void 0,photometricInterpretation:G==null?void 0:G.PhotometricInterpretation,bitsPerSample:G==null?void 0:G.BitsPerSample,colorMap:G==null?void 0:G.ColorMap,artist:O,bbox:re,images:K};return Rl.set(p,ne),ne}var x};return{getTilejson:async v=>{const{artist:x,images:Q,bbox:T}=await A(),k=Q.map(q=>q.zoom);return{tilejson:"2.2.0",tiles:[v+"/{z}/{x}/{y}"],attribution:x,minzoom:Math.round(Math.min(...k)),maxzoom:Math.round(Math.max(...k)),bounds:T}},getMetadata:A,getRawTile:async({z:v,x,y:Q},T=256)=>{const k=`${p}/${T}/${v}/${x}/${Q}`,q=us.get(k);if(q)return q;{const G=await g(p),{noData:O}=await A(),re=O===void 0||isNaN(O)?1/0:O,K=G.readRasters({bbox:ca({x,y:Q,z:v}),width:T,height:T,interleave:!1,resampleMethod:"nearest",pool:Wo,fillValue:re});return us.set(k,K),K}}}};function pr(p,g){return p==null||g==null?NaN:p<g?-1:p>g?1:p>=g?0:NaN}function Rr(p,g){return p==null||g==null?NaN:g<p?-1:g>p?1:g>=p?0:NaN}function Ra(p){let g,A,v;function x(Q,T,k=0,q=Q.length){if(k<q){if(g(T,T)!==0)return q;do{const G=k+q>>>1;A(Q[G],T)<0?k=G+1:q=G}while(k<q)}return k}return p.length!==2?(g=pr,A=(Q,T)=>pr(p(Q),T),v=(Q,T)=>p(Q)-T):(g=p===pr||p===Rr?p:oo,A=p,v=p),{left:x,center:function(Q,T,k=0,q=Q.length){const G=x(Q,T,k,q-1);return G>k&&v(Q[G-1],T)>-v(Q[G],T)?G-1:G},right:function(Q,T,k=0,q=Q.length){if(k<q){if(g(T,T)!==0)return q;do{const G=k+q>>>1;A(Q[G],T)<=0?k=G+1:q=G}while(k<q)}return k}}}function oo(){return 0}const La=Ra(pr).right;Ra(function(p){return p===null?NaN:+p}).center;const Ll=Math.sqrt(50),ha=Math.sqrt(10),Ac=Math.sqrt(2);function Fa(p,g,A){const v=(g-p)/Math.max(0,A),x=Math.floor(Math.log10(v)),Q=v/Math.pow(10,x),T=Q>=Ll?10:Q>=ha?5:Q>=Ac?2:1;let k,q,G;return x<0?(G=Math.pow(10,-x)/T,k=Math.round(p*G),q=Math.round(g*G),k/G<p&&++k,q/G>g&&--q,G=-G):(G=Math.pow(10,x)*T,k=Math.round(p/G),q=Math.round(g/G),k*G<p&&++k,q*G>g&&--q),q<k&&.5<=A&&A<2?Fa(p,g,2*A):[k,q,G]}function lo(p,g,A){return Fa(p=+p,g=+g,A=+A)[2]}function Fl(p,g){switch(arguments.length){case 0:break;case 1:this.range(p);break;default:this.range(g).domain(p)}return this}function tl(p,g,A){p.prototype=g.prototype=A,A.constructor=p}function il(p,g){var A=Object.create(p.prototype);for(var v in g)A[v]=g[v];return A}function Vn(){}var Ts=.7,Ps=1/Ts,As="\\s*([+-]?\\d+)\\s*",Rs="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",cr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",dc=/^#([0-9a-f]{3,8})$/,rl=new RegExp(`^rgb\\(${As},${As},${As}\\)$`),Ls=new RegExp(`^rgb\\(${cr},${cr},${cr}\\)$`),ds=new RegExp(`^rgba\\(${As},${As},${As},${Rs}\\)$`),bi=new RegExp(`^rgba\\(${cr},${cr},${cr},${Rs}\\)$`),co=new RegExp(`^hsl\\(${Rs},${cr},${cr}\\)$`),fc=new RegExp(`^hsla\\(${Rs},${cr},${cr},${Rs}\\)$`),Fs={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function zl(){return this.rgb().formatHex()}function nl(){return this.rgb().formatRgb()}function za(p){var g,A;return p=(p+"").trim().toLowerCase(),(g=dc.exec(p))?(A=g[1].length,g=parseInt(g[1],16),A===6?sl(g):A===3?new Er(g>>8&15|g>>4&240,g>>4&15|240&g,(15&g)<<4|15&g,1):A===8?ua(g>>24&255,g>>16&255,g>>8&255,(255&g)/255):A===4?ua(g>>12&15|g>>8&240,g>>8&15|g>>4&240,g>>4&15|240&g,((15&g)<<4|15&g)/255):null):(g=rl.exec(p))?new Er(g[1],g[2],g[3],1):(g=Ls.exec(p))?new Er(255*g[1]/100,255*g[2]/100,255*g[3]/100,1):(g=ds.exec(p))?ua(g[1],g[2],g[3],g[4]):(g=bi.exec(p))?ua(255*g[1]/100,255*g[2]/100,255*g[3]/100,g[4]):(g=co.exec(p))?ll(g[1],g[2]/100,g[3]/100,1):(g=fc.exec(p))?ll(g[1],g[2]/100,g[3]/100,g[4]):Fs.hasOwnProperty(p)?sl(Fs[p]):p==="transparent"?new Er(NaN,NaN,NaN,0):null}function sl(p){return new Er(p>>16&255,p>>8&255,255&p,1)}function ua(p,g,A,v){return v<=0&&(p=g=A=NaN),new Er(p,g,A,v)}function ho(p,g,A,v){return arguments.length===1?((x=p)instanceof Vn||(x=za(x)),x?new Er((x=x.rgb()).r,x.g,x.b,x.opacity):new Er):new Er(p,g,A,v??1);var x}function Er(p,g,A,v){this.r=+p,this.g=+g,this.b=+A,this.opacity=+v}function al(){return`#${zs(this.r)}${zs(this.g)}${zs(this.b)}`}function ol(){const p=Mn(this.opacity);return`${p===1?"rgb(":"rgba("}${fs(this.r)}, ${fs(this.g)}, ${fs(this.b)}${p===1?")":`, ${p})`}`}function Mn(p){return isNaN(p)?1:Math.max(0,Math.min(1,p))}function fs(p){return Math.max(0,Math.min(255,Math.round(p)||0))}function zs(p){return((p=fs(p))<16?"0":"")+p.toString(16)}function ll(p,g,A,v){return v<=0?p=g=A=NaN:A<=0||A>=1?p=g=NaN:g<=0&&(p=NaN),new _n(p,g,A,v)}function Aa(p){if(p instanceof _n)return new _n(p.h,p.s,p.l,p.opacity);if(p instanceof Vn||(p=za(p)),!p)return new _n;if(p instanceof _n)return p;var g=(p=p.rgb()).r/255,A=p.g/255,v=p.b/255,x=Math.min(g,A,v),Q=Math.max(g,A,v),T=NaN,k=Q-x,q=(Q+x)/2;return k?(T=g===Q?(A-v)/k+6*(A<v):A===Q?(v-g)/k+2:(g-A)/k+4,k/=q<.5?Q+x:2-Q-x,T*=60):k=q>0&&q<1?0:T,new _n(T,k,q,p.opacity)}function _n(p,g,A,v){this.h=+p,this.s=+g,this.l=+A,this.opacity=+v}function Ga(p){return(p=(p||0)%360)<0?p+360:p}function uo(p){return Math.max(0,Math.min(1,p||0))}function cl(p,g,A){return 255*(p<60?g+(A-g)*p/60:p<180?A:p<240?g+(A-g)*(240-p)/60:g)}tl(Vn,za,{copy(p){return Object.assign(new this.constructor,this,p)},displayable(){return this.rgb().displayable()},hex:zl,formatHex:zl,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return Aa(this).formatHsl()},formatRgb:nl,toString:nl}),tl(Er,ho,il(Vn,{brighter(p){return p=p==null?Ps:Math.pow(Ps,p),new Er(this.r*p,this.g*p,this.b*p,this.opacity)},darker(p){return p=p==null?Ts:Math.pow(Ts,p),new Er(this.r*p,this.g*p,this.b*p,this.opacity)},rgb(){return this},clamp(){return new Er(fs(this.r),fs(this.g),fs(this.b),Mn(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:al,formatHex:al,formatHex8:function(){return`#${zs(this.r)}${zs(this.g)}${zs(this.b)}${zs(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:ol,toString:ol})),tl(_n,function(p,g,A,v){return arguments.length===1?Aa(p):new _n(p,g,A,v??1)},il(Vn,{brighter(p){return p=p==null?Ps:Math.pow(Ps,p),new _n(this.h,this.s,this.l*p,this.opacity)},darker(p){return p=p==null?Ts:Math.pow(Ts,p),new _n(this.h,this.s,this.l*p,this.opacity)},rgb(){var p=this.h%360+360*(this.h<0),g=isNaN(p)||isNaN(this.s)?0:this.s,A=this.l,v=A+(A<.5?A:1-A)*g,x=2*A-v;return new Er(cl(p>=240?p-240:p+120,x,v),cl(p,x,v),cl(p<120?p+240:p-120,x,v),this.opacity)},clamp(){return new _n(Ga(this.h),uo(this.s),uo(this.l),Mn(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const p=Mn(this.opacity);return`${p===1?"hsl(":"hsla("}${Ga(this.h)}, ${100*uo(this.s)}%, ${100*uo(this.l)}%${p===1?")":`, ${p})`}`}}));var Ao=p=>()=>p;function Gl(p){return(p=+p)==1?hl:function(g,A){return A-g?function(v,x,Q){return v=Math.pow(v,Q),x=Math.pow(x,Q)-v,Q=1/Q,function(T){return Math.pow(v+T*x,Q)}}(g,A,p):Ao(isNaN(g)?A:g)}}function hl(p,g){var A=g-p;return A?function(v,x){return function(Q){return v+Q*x}}(p,A):Ao(isNaN(p)?g:p)}var fo=function p(g){var A=Gl(g);function v(x,Q){var T=A((x=ho(x)).r,(Q=ho(Q)).r),k=A(x.g,Q.g),q=A(x.b,Q.b),G=hl(x.opacity,Q.opacity);return function(O){return x.r=T(O),x.g=k(O),x.b=q(O),x.opacity=G(O),x+""}}return v.gamma=p,v}(1);function Ul(p,g){g||(g=[]);var A,v=p?Math.min(g.length,p.length):0,x=g.slice();return function(Q){for(A=0;A<v;++A)x[A]=p[A]*(1-Q)+g[A]*Q;return x}}function go(p,g){var A,v=g?g.length:0,x=p?Math.min(v,p.length):0,Q=new Array(x),T=new Array(v);for(A=0;A<x;++A)Q[A]=jn(p[A],g[A]);for(;A<v;++A)T[A]=g[A];return function(k){for(A=0;A<x;++A)T[A]=Q[A](k);return T}}function Hn(p,g){var A=new Date;return p=+p,g=+g,function(v){return A.setTime(p*(1-v)+g*v),A}}function da(p,g){return p=+p,g=+g,function(A){return p*(1-A)+g*A}}function ul(p,g){var A,v={},x={};for(A in p!==null&&typeof p=="object"||(p={}),g!==null&&typeof g=="object"||(g={}),g)A in p?v[A]=jn(p[A],g[A]):x[A]=g[A];return function(Q){for(A in v)x[A]=v[A](Q);return x}}var Ua=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,fa=new RegExp(Ua.source,"g");function Al(p,g){var A,v,x,Q=Ua.lastIndex=fa.lastIndex=0,T=-1,k=[],q=[];for(p+="",g+="";(A=Ua.exec(p))&&(v=fa.exec(g));)(x=v.index)>Q&&(x=g.slice(Q,x),k[T]?k[T]+=x:k[++T]=x),(A=A[0])===(v=v[0])?k[T]?k[T]+=v:k[++T]=v:(k[++T]=null,q.push({i:T,x:da(A,v)})),Q=fa.lastIndex;return Q<g.length&&(x=g.slice(Q),k[T]?k[T]+=x:k[++T]=x),k.length<2?q[0]?function(G){return function(O){return G(O)+""}}(q[0].x):function(G){return function(){return G}}(g):(g=q.length,function(G){for(var O,re=0;re<g;++re)k[(O=q[re]).i]=O.x(G);return k.join("")})}function jn(p,g){var A,v,x=typeof g;return g==null||x==="boolean"?Ao(g):(x==="number"?da:x==="string"?(A=za(g))?(g=A,fo):Al:g instanceof za?fo:g instanceof Date?Hn:(v=g,!ArrayBuffer.isView(v)||v instanceof DataView?Array.isArray(g)?go:typeof g.valueOf!="function"&&typeof g.toString!="function"||isNaN(g)?ul:da:Ul))(p,g)}function dl(p,g){return p=+p,g=+g,function(A){return Math.round(p*(1-A)+g*A)}}function gc(p){return+p}var Zi=[0,1];function ga(p){return p}function ti(p,g){return(g-=p=+p)?function(v){return(v-p)/g}:(A=isNaN(g)?NaN:.5,function(){return A});var A}function po(p,g,A){var v=p[0],x=p[1],Q=g[0],T=g[1];return x<v?(v=ti(x,v),Q=A(T,Q)):(v=ti(v,x),Q=A(Q,T)),function(k){return Q(v(k))}}function ki(p,g,A){var v=Math.min(p.length,g.length)-1,x=new Array(v),Q=new Array(v),T=-1;for(p[v]<p[0]&&(p=p.slice().reverse(),g=g.slice().reverse());++T<v;)x[T]=ti(p[T],p[T+1]),Q[T]=A(g[T],g[T+1]);return function(k){var q=La(p,k,1,v)-1;return Q[q](x[q](k))}}function Ci(){var p,g,A,v,x,Q,T=Zi,k=Zi,q=jn,G=ga;function O(){var K,U,ne,le=Math.min(T.length,k.length);return G!==ga&&(K=T[0],U=T[le-1],K>U&&(ne=K,K=U,U=ne),G=function(se){return Math.max(K,Math.min(U,se))}),v=le>2?ki:po,x=Q=null,re}function re(K){return K==null||isNaN(K=+K)?A:(x||(x=v(T.map(p),k,q)))(p(G(K)))}return re.invert=function(K){return G(g((Q||(Q=v(k,T.map(p),da)))(K)))},re.domain=function(K){return arguments.length?(T=Array.from(K,gc),O()):T.slice()},re.range=function(K){return arguments.length?(k=Array.from(K),O()):k.slice()},re.rangeRound=function(K){return k=Array.from(K),q=dl,O()},re.clamp=function(K){return arguments.length?(G=!!K||ga,O()):G!==ga},re.interpolate=function(K){return arguments.length?(q=K,O()):q},re.unknown=function(K){return arguments.length?(A=K,re):A},function(K,U){return p=K,g=U,O()}}function Tn(p,g){if((A=(p=g?p.toExponential(g-1):p.toExponential()).indexOf("e"))<0)return null;var A,v=p.slice(0,A);return[v.length>1?v[0]+v.slice(2):v,+p.slice(A+1)]}function Pn(p){return(p=Tn(Math.abs(p)))?p[1]:NaN}var pa,fl=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Rn(p){if(!(g=fl.exec(p)))throw new Error("invalid format: "+p);var g;return new gs({fill:g[1],align:g[2],sign:g[3],symbol:g[4],zero:g[5],width:g[6],comma:g[7],precision:g[8]&&g[8].slice(1),trim:g[9],type:g[10]})}function gs(p){this.fill=p.fill===void 0?" ":p.fill+"",this.align=p.align===void 0?">":p.align+"",this.sign=p.sign===void 0?"-":p.sign+"",this.symbol=p.symbol===void 0?"":p.symbol+"",this.zero=!!p.zero,this.width=p.width===void 0?void 0:+p.width,this.comma=!!p.comma,this.precision=p.precision===void 0?void 0:+p.precision,this.trim=!!p.trim,this.type=p.type===void 0?"":p.type+""}function Yr(p,g){var A=Tn(p,g);if(!A)return p+"";var v=A[0],x=A[1];return x<0?"0."+new Array(-x).join("0")+v:v.length>x+1?v.slice(0,x+1)+"."+v.slice(x+1):v+new Array(x-v.length+2).join("0")}Rn.prototype=gs.prototype,gs.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,0|this.width))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var mo={"%":(p,g)=>(100*p).toFixed(g),b:p=>Math.round(p).toString(2),c:p=>p+"",d:function(p){return Math.abs(p=Math.round(p))>=1e21?p.toLocaleString("en").replace(/,/g,""):p.toString(10)},e:(p,g)=>p.toExponential(g),f:(p,g)=>p.toFixed(g),g:(p,g)=>p.toPrecision(g),o:p=>Math.round(p).toString(8),p:(p,g)=>Yr(100*p,g),r:Yr,s:function(p,g){var A=Tn(p,g);if(!A)return p+"";var v=A[0],x=A[1],Q=x-(pa=3*Math.max(-8,Math.min(8,Math.floor(x/3))))+1,T=v.length;return Q===T?v:Q>T?v+new Array(Q-T+1).join("0"):Q>0?v.slice(0,Q)+"."+v.slice(Q):"0."+new Array(1-Q).join("0")+Tn(p,Math.max(0,g+Q-1))[0]},X:p=>Math.round(p).toString(16).toUpperCase(),x:p=>Math.round(p).toString(16)};function yo(p){return p}var Na,ps,ma,ya=Array.prototype.map,Gs=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function Oa(p){var g,A,v=p.grouping===void 0||p.thousands===void 0?yo:(g=ya.call(p.grouping,Number),A=p.thousands+"",function(K,U){for(var ne=K.length,le=[],se=0,ue=g[0],Ie=0;ne>0&&ue>0&&(Ie+ue+1>U&&(ue=Math.max(1,U-Ie)),le.push(K.substring(ne-=ue,ne+ue)),!((Ie+=ue+1)>U));)ue=g[se=(se+1)%g.length];return le.reverse().join(A)}),x=p.currency===void 0?"":p.currency[0]+"",Q=p.currency===void 0?"":p.currency[1]+"",T=p.decimal===void 0?".":p.decimal+"",k=p.numerals===void 0?yo:function(K){return function(U){return U.replace(/[0-9]/g,function(ne){return K[+ne]})}}(ya.call(p.numerals,String)),q=p.percent===void 0?"%":p.percent+"",G=p.minus===void 0?"":p.minus+"",O=p.nan===void 0?"NaN":p.nan+"";function re(K){var U=(K=Rn(K)).fill,ne=K.align,le=K.sign,se=K.symbol,ue=K.zero,Ie=K.width,pe=K.comma,Be=K.precision,Y=K.trim,z=K.type;z==="n"?(pe=!0,z="g"):mo[z]||(Be===void 0&&(Be=12),Y=!0,z="g"),(ue||U==="0"&&ne==="=")&&(ue=!0,U="0",ne="=");var ce=se==="$"?x:se==="#"&&/[boxX]/.test(z)?"0"+z.toLowerCase():"",ie=se==="$"?Q:/[%p]/.test(z)?q:"",ae=mo[z],Ae=/[defgprs%]/.test(z);function Ce(be){var xe,ze,qe,Ve=ce,Ke=ie;if(z==="c")Ke=ae(be)+Ke,be="";else{var ct=(be=+be)<0||1/be<0;if(be=isNaN(be)?O:ae(Math.abs(be),Be),Y&&(be=function(Ye){e:for(var vt,ot=Ye.length,Ct=1,st=-1;Ct<ot;++Ct)switch(Ye[Ct]){case".":st=vt=Ct;break;case"0":st===0&&(st=Ct),vt=Ct;break;default:if(!+Ye[Ct])break e;st>0&&(st=0)}return st>0?Ye.slice(0,st)+Ye.slice(vt+1):Ye}(be)),ct&&+be==0&&le!=="+"&&(ct=!1),Ve=(ct?le==="("?le:G:le==="-"||le==="("?"":le)+Ve,Ke=(z==="s"?Gs[8+pa/3]:"")+Ke+(ct&&le==="("?")":""),Ae){for(xe=-1,ze=be.length;++xe<ze;)if(48>(qe=be.charCodeAt(xe))||qe>57){Ke=(qe===46?T+be.slice(xe+1):be.slice(xe))+Ke,be=be.slice(0,xe);break}}}pe&&!ue&&(be=v(be,1/0));var Ue=Ve.length+be.length+Ke.length,Pe=Ue<Ie?new Array(Ie-Ue+1).join(U):"";switch(pe&&ue&&(be=v(Pe+be,Pe.length?Ie-Ke.length:1/0),Pe=""),ne){case"<":be=Ve+be+Ke+Pe;break;case"=":be=Ve+Pe+be+Ke;break;case"^":be=Pe.slice(0,Ue=Pe.length>>1)+Ve+be+Ke+Pe.slice(Ue);break;default:be=Pe+Ve+be+Ke}return k(be)}return Be=Be===void 0?6:/[gprs]/.test(z)?Math.max(1,Math.min(21,Be)):Math.max(0,Math.min(20,Be)),Ce.toString=function(){return K+""},Ce}return{format:re,formatPrefix:function(K,U){var ne=re(((K=Rn(K)).type="f",K)),le=3*Math.max(-8,Math.min(8,Math.floor(Pn(U)/3))),se=Math.pow(10,-le),ue=Gs[8+le/3];return function(Ie){return ne(se*Ie)+ue}}}}function _o(p,g,A,v){var x,Q=function(k,q,G){G=+G;const O=(q=+q)<(k=+k),re=O?lo(q,k,G):lo(k,q,G);return(O?-1:1)*(re<0?1/-re:re)}(p,g,A);switch((v=Rn(v??",f")).type){case"s":var T=Math.max(Math.abs(p),Math.abs(g));return v.precision!=null||isNaN(x=function(k,q){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Pn(q)/3)))-Pn(Math.abs(k)))}(Q,T))||(v.precision=x),ma(v,T);case"":case"e":case"g":case"p":case"r":v.precision!=null||isNaN(x=function(k,q){return k=Math.abs(k),q=Math.abs(q)-k,Math.max(0,Pn(q)-Pn(k))+1}(Q,Math.max(Math.abs(p),Math.abs(g))))||(v.precision=x-(v.type==="e"));break;case"f":case"%":v.precision!=null||isNaN(x=function(k){return Math.max(0,-Pn(Math.abs(k)))}(Q))||(v.precision=x-2*(v.type==="%"))}return ps(v)}function _a(p){var g=p.domain;return p.ticks=function(A){var v=g();return function(x,Q,T){if(!((T=+T)>0))return[];if((x=+x)==(Q=+Q))return[x];const k=Q<x,[q,G,O]=k?Fa(Q,x,T):Fa(x,Q,T);if(!(G>=q))return[];const re=G-q+1,K=new Array(re);if(k)if(O<0)for(let U=0;U<re;++U)K[U]=(G-U)/-O;else for(let U=0;U<re;++U)K[U]=(G-U)*O;else if(O<0)for(let U=0;U<re;++U)K[U]=(q+U)/-O;else for(let U=0;U<re;++U)K[U]=(q+U)*O;return K}(v[0],v[v.length-1],A??10)},p.tickFormat=function(A,v){var x=g();return _o(x[0],x[x.length-1],A??10,v)},p.nice=function(A){A==null&&(A=10);var v,x,Q=g(),T=0,k=Q.length-1,q=Q[T],G=Q[k],O=10;for(G<q&&(x=q,q=G,G=x,x=T,T=k,k=x);O-- >0;){if((x=lo(q,G,A))===v)return Q[T]=q,Q[k]=G,g(Q);if(x>0)q=Math.floor(q/x)*x,G=Math.ceil(G/x)*x;else{if(!(x<0))break;q=Math.ceil(q*x)/x,G=Math.floor(G*x)/x}v=x}return p},p}function Us(){var p=Ci()(ga,ga);return p.copy=function(){return g=p,Us().domain(g.domain()).range(g.range()).interpolate(g.interpolate()).clamp(g.clamp()).unknown(g.unknown());var g},Fl.apply(p,arguments),_a(p)}function gl(){var p,g=[.5],A=[0,1],v=1;function x(Q){return Q!=null&&Q<=Q?A[La(g,Q,0,v)]:p}return x.domain=function(Q){return arguments.length?(g=Array.from(Q),v=Math.min(g.length,A.length-1),x):g.slice()},x.range=function(Q){return arguments.length?(A=Array.from(Q),v=Math.min(g.length,A.length-1),x):A.slice()},x.invertExtent=function(Q){var T=A.indexOf(Q);return[g[T-1],g[T]]},x.unknown=function(Q){return arguments.length?(p=Q,x):p},x.copy=function(){return gl().domain(g).range(A).unknown(p)},Fl.apply(x,arguments)}Na=Oa({thousands:",",grouping:[3],currency:["$",""]}),ps=Na.format,ma=Na.formatPrefix;const Io={BrewerYlGn3:["#f7fcb9","#addd8e","#31a354"],BrewerYlGn4:["#ffffcc","#c2e699","#78c679","#238443"],BrewerYlGn5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],BrewerYlGn6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],BrewerYlGn7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],BrewerYlGn8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],BrewerYlGn9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],BrewerYlGnBu3:["#edf8b1","#7fcdbb","#2c7fb8"],BrewerYlGnBu4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],BrewerYlGnBu5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],BrewerYlGnBu6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],BrewerYlGnBu7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],BrewerYlGnBu8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],BrewerYlGnBu9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],BrewerGnBu3:["#e0f3db","#a8ddb5","#43a2ca"],BrewerGnBu4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],BrewerGnBu5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],BrewerGnBu6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],BrewerGnBu7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],BrewerGnBu8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],BrewerGnBu9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],BrewerBuGn3:["#e5f5f9","#99d8c9","#2ca25f"],BrewerBuGn4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],BrewerBuGn5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],BrewerBuGn6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],BrewerBuGn7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],BrewerBuGn8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],BrewerBuGn9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],BrewerPuBuGn3:["#ece2f0","#a6bddb","#1c9099"],BrewerPuBuGn4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],BrewerPuBuGn5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],BrewerPuBuGn6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],BrewerPuBuGn7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],BrewerPuBuGn8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],BrewerPuBuGn9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],BrewerPuBu3:["#ece7f2","#a6bddb","#2b8cbe"],BrewerPuBu4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],BrewerPuBu5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],BrewerPuBu6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],BrewerPuBu7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],BrewerPuBu8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],BrewerPuBu9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BrewerBuPu3:["#e0ecf4","#9ebcda","#8856a7"],BrewerBuPu4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],BrewerBuPu5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],BrewerBuPu6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],BrewerBuPu7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],BrewerBuPu8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],BrewerBuPu9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],BrewerRdPu3:["#fde0dd","#fa9fb5","#c51b8a"],BrewerRdPu4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],BrewerRdPu5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],BrewerRdPu6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],BrewerRdPu7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],BrewerRdPu8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],BrewerRdPu9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],BrewerPuRd3:["#e7e1ef","#c994c7","#dd1c77"],BrewerPuRd4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],BrewerPuRd5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],BrewerPuRd6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],BrewerPuRd7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],BrewerPuRd8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],BrewerPuRd9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],BrewerOrRd3:["#fee8c8","#fdbb84","#e34a33"],BrewerOrRd4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],BrewerOrRd5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],BrewerOrRd6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],BrewerOrRd7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],BrewerOrRd8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],BrewerOrRd9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],BrewerYlOrRd3:["#ffeda0","#feb24c","#f03b20"],BrewerYlOrRd4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],BrewerYlOrRd5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],BrewerYlOrRd6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],BrewerYlOrRd7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],BrewerYlOrRd8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],BrewerYlOrRd9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],BrewerYlOrBr3:["#fff7bc","#fec44f","#d95f0e"],BrewerYlOrBr4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],BrewerYlOrBr5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],BrewerYlOrBr6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],BrewerYlOrBr7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],BrewerYlOrBr8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],BrewerYlOrBr9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],BrewerPurples3:["#efedf5","#bcbddc","#756bb1"],BrewerPurples4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],BrewerPurples5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],BrewerPurples6:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],BrewerPurples7:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],BrewerPurples8:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],BrewerPurples9:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],BrewerBlues3:["#deebf7","#9ecae1","#3182bd"],BrewerBlues4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],BrewerBlues5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],BrewerBlues6:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],BrewerBlues7:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],BrewerBlues8:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],BrewerBlues9:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],BrewerGreens3:["#e5f5e0","#a1d99b","#31a354"],BrewerGreens4:["#edf8e9","#bae4b3","#74c476","#238b45"],BrewerGreens5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],BrewerGreens6:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],BrewerGreens7:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],BrewerGreens8:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],BrewerGreens9:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],BrewerOranges3:["#fee6ce","#fdae6b","#e6550d"],BrewerOranges4:["#feedde","#fdbe85","#fd8d3c","#d94701"],BrewerOranges5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],BrewerOranges6:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],BrewerOranges7:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],BrewerOranges8:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],BrewerOranges9:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BrewerReds3:["#fee0d2","#fc9272","#de2d26"],BrewerReds4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],BrewerReds5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],BrewerReds6:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],BrewerReds7:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],BrewerReds8:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],BrewerReds9:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],BrewerGreys3:["#f0f0f0","#bdbdbd","#636363"],BrewerGreys4:["#f7f7f7","#cccccc","#969696","#525252"],BrewerGreys5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],BrewerGreys6:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#636363","#252525"],BrewerGreys7:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],BrewerGreys8:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],BrewerGreys9:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],BrewerPuOr3:["#f1a340","#f7f7f7","#998ec3"],BrewerPuOr4:["#e66101","#fdb863","#b2abd2","#5e3c99"],BrewerPuOr5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],BrewerPuOr6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],BrewerPuOr7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],BrewerPuOr8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],BrewerPuOr9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],BrewerPuOr10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],BrewerPuOr11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],BrewerBrBG3:["#d8b365","#f5f5f5","#5ab4ac"],BrewerBrBG4:["#a6611a","#dfc27d","#80cdc1","#018571"],BrewerBrBG5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],BrewerBrBG6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],BrewerBrBG7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],BrewerBrBG8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],BrewerBrBG9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],BrewerBrBG10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],BrewerBrBG11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],BrewerPRGn3:["#af8dc3","#f7f7f7","#7fbf7b"],BrewerPRGn4:["#7b3294","#c2a5cf","#a6dba0","#008837"],BrewerPRGn5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],BrewerPRGn6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],BrewerPRGn7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],BrewerPRGn8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],BrewerPRGn9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],BrewerPRGn10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],BrewerPRGn11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],BrewerPiYG3:["#e9a3c9","#f7f7f7","#a1d76a"],BrewerPiYG4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],BrewerPiYG5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],BrewerPiYG6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],BrewerPiYG7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],BrewerPiYG8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],BrewerPiYG9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],BrewerPiYG10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],BrewerPiYG11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],BrewerRdBu3:["#ef8a62","#f7f7f7","#67a9cf"],BrewerRdBu4:["#ca0020","#f4a582","#92c5de","#0571b0"],BrewerRdBu5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],BrewerRdBu6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],BrewerRdBu7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],BrewerRdBu8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],BrewerRdBu9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],BrewerRdBu10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],BrewerRdBu11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],BrewerRdGy3:["#ef8a62","#ffffff","#999999"],BrewerRdGy4:["#ca0020","#f4a582","#bababa","#404040"],BrewerRdGy5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],BrewerRdGy6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],BrewerRdGy7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],BrewerRdGy8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],BrewerRdGy9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],BrewerRdGy10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],BrewerRdGy11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],BrewerRdYlBu3:["#fc8d59","#ffffbf","#91bfdb"],BrewerRdYlBu4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],BrewerRdYlBu5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],BrewerRdYlBu6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],BrewerRdYlBu7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],BrewerRdYlBu8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],BrewerRdYlBu9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],BrewerRdYlBu10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrewerRdYlBu11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrewerSpectral3:["#fc8d59","#ffffbf","#99d594"],BrewerSpectral4:["#d7191c","#fdae61","#abdda4","#2b83ba"],BrewerSpectral5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],BrewerSpectral6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],BrewerSpectral7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],BrewerSpectral8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],BrewerSpectral9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],BrewerSpectral10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],BrewerSpectral11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],BrewerRdYlGn3:["#fc8d59","#ffffbf","#91cf60"],BrewerRdYlGn4:["#d7191c","#fdae61","#a6d96a","#1a9641"],BrewerRdYlGn5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],BrewerRdYlGn6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],BrewerRdYlGn7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],BrewerRdYlGn8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],BrewerRdYlGn9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],BrewerRdYlGn10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],BrewerRdYlGn11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],BrewerAccent3:["#7fc97f","#beaed4","#fdc086"],BrewerAccent4:["#7fc97f","#beaed4","#fdc086","#ffff99"],BrewerAccent5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],BrewerAccent6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],BrewerAccent7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],BrewerAccent8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],BrewerDark23:["#1b9e77","#d95f02","#7570b3"],BrewerDark24:["#1b9e77","#d95f02","#7570b3","#e7298a"],BrewerDark25:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],BrewerDark26:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],BrewerDark27:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],BrewerDark28:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],BrewerPaired3:["#a6cee3","#1f78b4","#b2df8a"],BrewerPaired4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],BrewerPaired5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],BrewerPaired6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],BrewerPaired7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],BrewerPaired8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],BrewerPaired9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],BrewerPaired10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],BrewerPaired11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],BrewerPaired12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],BrewerPastel13:["#fbb4ae","#b3cde3","#ccebc5"],BrewerPastel14:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],BrewerPastel15:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],BrewerPastel16:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],BrewerPastel17:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],BrewerPastel18:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],BrewerPastel19:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"],BrewerPastel23:["#b3e2cd","#fdcdac","#cbd5e8"],BrewerPastel24:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],BrewerPastel25:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],BrewerPastel26:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],BrewerPastel27:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],BrewerPastel28:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],BrewerSet13:["#e41a1c","#377eb8","#4daf4a"],BrewerSet14:["#e41a1c","#377eb8","#4daf4a","#984ea3"],BrewerSet15:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],BrewerSet16:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],BrewerSet17:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],BrewerSet18:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],BrewerSet19:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],BrewerSet23:["#66c2a5","#fc8d62","#8da0cb"],BrewerSet24:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],BrewerSet25:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],BrewerSet26:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],BrewerSet27:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],BrewerSet28:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],BrewerSet33:["#8dd3c7","#ffffb3","#bebada"],BrewerSet34:["#8dd3c7","#ffffb3","#bebada","#fb8072"],BrewerSet35:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],BrewerSet36:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],BrewerSet37:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],BrewerSet38:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],BrewerSet39:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],BrewerSet310:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],BrewerSet311:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],BrewerSet312:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],CartoBurg:["#ffc6c4","#f4a3a8","#e38191","#cc607d","#ad466c","#8b3058","#672044"],CartoBurgYl:["#fbe6c5","#f5ba98","#ee8a82","#dc7176","#c8586c","#9c3f5d","#70284a"],CartoRedOr:["#f6d2a9","#f5b78e","#f19c7c","#ea8171","#dd686c","#ca5268","#b13f64"],CartoOrYel:["#ecda9a","#efc47e","#f3ad6a","#f7945d","#f97b57","#f66356","#ee4d5a"],CartoPeach:["#fde0c5","#facba6","#f8b58b","#f59e72","#f2855d","#ef6a4c","#eb4a40"],CartoPinkYl:["#fef6b5","#ffdd9a","#ffc285","#ffa679","#fa8a76","#f16d7a","#e15383"],CartoMint:["#e4f1e1","#b4d9cc","#89c0b6","#63a6a0","#448c8a","#287274","#0d585f"],CartoBluGrn:["#c4e6c3","#96d2a4","#6dbc90","#4da284","#36877a","#266b6e","#1d4f60"],CartoDarkMint:["#d2fbd4","#a5dbc2","#7bbcb0","#559c9e","#3a7c89","#235d72","#123f5a"],CartoEmrld:["#d3f2a3","#97e196","#6cc08b","#4c9b82","#217a79","#105965","#074050"],CartoBluYl:["#f7feae","#b7e6a5","#7ccba2","#46aea0","#089099","#00718b","#045275"],CartoTeal:["#d1eeea","#a8dbd9","#85c4c9","#68abb8","#4f90a6","#3b738f","#2a5674"],CartoTealGrn:["#b0f2bc","#89e8ac","#67dba5","#4cc8a3","#38b2a3","#2c98a0","#257d98"],CartoPurp:["#f3e0f7","#e4c7f1","#d1afe8","#b998dd","#9f82ce","#826dba","#63589f"],CartoPurpOr:["#f9ddda","#f2b9c4","#e597b9","#ce78b3","#ad5fad","#834ba0","#573b88"],CartoSunset:["#f3e79b","#fac484","#f8a07e","#eb7f86","#ce6693","#a059a0","#5c53a5"],CartoMagenta:["#f3cbd3","#eaa9bd","#dd88ac","#ca699d","#b14d8e","#91357d","#6c2167"],CartoSunsetDark:["#fcde9c","#faa476","#f0746e","#e34f6f","#dc3977","#b9257a","#7c1d6f"],CartoBrwnYl:["#ede5cf","#e0c2a2","#d39c83","#c1766f","#a65461","#813753","#541f3f"],CartoArmyRose:["#798234","#a3ad62","#d0d3a2","#fdfbe4","#f0c6c3","#df91a3","#d46780"],CartoFall:["#3d5941","#778868","#b5b991","#f6edbd","#edbb8a","#de8a5a","#ca562c"],CartoGeyser:["#008080","#70a494","#b4c8a8","#f6edbd","#edbb8a","#de8a5a","#ca562c"],CartoTemps:["#009392","#39b185","#9ccb86","#e9e29c","#eeb479","#e88471","#cf597e"],CartoTealRose:["#009392","#72aaa1","#b1c7b3","#f1eac8","#e5b9ad","#d98994","#d0587e"],CartoTropic:["#009B9E","#42B7B9","#A7D3D4","#F1F1F1","#E4C1D9","#D691C1","#C75DAB"],CartoEarth:["#A16928","#bd925a","#d6bd8d","#edeac2","#b5c8b8","#79a7ac","#2887a1"]},gi=Object.keys(Io),bo=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,pc=p=>{const g=bo.exec(p);if(g!==null)return[parseInt(g[1],16),parseInt(g[2],16),parseInt(g[3],16)];throw new Error(`Cannot parse hex color "${p}"`)},pl=({colorScheme:p,customColors:g,min:A,max:v,isReverse:x=!1,isContinuous:Q=!1})=>{let T;if(p){if(k=p,!gi.includes(k))throw new Error(`"${p}" is not a supported color scheme`);T=Io[p]}else{if(!(g.length>=2))throw new Error("You must provide at least 2 colors");T=g}var k;const q=T.map(pc),G=x?q.reverse():q;if(Q){const O=((re,K,U)=>Array.from({length:U},(ne,le)=>re+le*(K-re)/(U-1)))(A,v,G.length);return Us(O,G).clamp(!0)}{const O=((re,K,U)=>Array.from({length:U-1},(ne,le)=>re+(le+1)*(K-re)/U))(A,v,G.length);return gl(O,G)}};var Lr;(function(p){p[p.WhiteIsZero=0]="WhiteIsZero",p[p.BlackIsZero=1]="BlackIsZero",p[p.RGB=2]="RGB",p[p.Palette=3]="Palette",p[p.TransparencyMask=4]="TransparencyMask",p[p.CMYK=5]="CMYK",p[p.YCbCr=6]="YCbCr",p[p.CIELab=8]="CIELab",p[p.ICCLab=9]="ICCLab"})(Lr||(Lr={}));const Nl=(p,{noData:g,photometricInterpretation:A,bitsPerSample:v,colorMap:x})=>{const Q=v&&v[0]?2**v[0]:NaN,T=g??0;let k;switch(A){case Lr.WhiteIsZero:k=function(q,G,O){const re=new Uint8ClampedArray(4*q[0].length);let K;for(let U=0;U<q[0].length;U++)K=255-q[0][U]/G*255,re[4*U]=K,re[4*U+1]=K,re[4*U+2]=K,re[4*U+3]=q[0][U]===O?0:255;return re}(p,Q,T);break;case Lr.BlackIsZero:k=function(q,G,O){const re=new Uint8ClampedArray(4*q[0].length);let K;for(let U=0;U<q[0].length;U++)K=q[0][U]/G*255,re[4*U]=K,re[4*U+1]=K,re[4*U+2]=K,re[4*U+3]=q[0][U]===O?0:255;return re}(p,Q,T);break;case Lr.RGB:k=function(q,G){const[O,re,K]=q,U=new Uint8ClampedArray(4*q[0].length);for(let ne=0;ne<q[0].length;ne++)U[4*ne]=O[ne],U[4*ne+1]=re[ne],U[4*ne+2]=K[ne],U[4*ne+3]=O[ne]===G&&re[ne]==G&&K[ne]==G?0:255;return U}(p,T);break;case Lr.Palette:if(!x)throw new Error("colorMap for paletted image not found.");k=function(q,G,O){const re=new Uint8ClampedArray(4*q[0].length),K=G.length/3,U=G.length/3*2;for(let ne=0;ne<q[0].length;ne++){const le=q[0][ne];re[4*ne]=G[le]/65536*256,re[4*ne+1]=G[le+K]/65536*256,re[4*ne+2]=G[le+U]/65536*256,re[4*ne+3]=q[0][ne]===O?0:255}return re}(p,x,T);break;case Lr.CMYK:k=function(q,G){const O=new Uint8ClampedArray(4*q[0].length),[re,K,U,ne]=q;for(let le=0;le<q.length;le++){const se=re[le],ue=K[le],Ie=U[le],pe=ne[le];O[4*le]=(255-se)/256*255*((255-pe)/256),O[4*le+1]=(255-ue)/256*255*((255-pe)/256),O[4*le+2]=(255-Ie)/256*255*((255-pe)/256),O[4*le+3]=se===G&&ue===G&&Ie===G&&pe===G?0:255}return O}(p,T);break;case Lr.YCbCr:k=function(q,G){const[O,re,K]=q,U=new Uint8ClampedArray(4*q[0].length);for(let ne=0;ne<q[0].length;ne++){const le=O[ne],se=re[ne],ue=K[ne];U[4*ne]=le+1.402*(ue-128),U[4*ne+1]=le-.34414*(se-128)-.71414*(ue-128),U[4*ne+2]=le+1.772*(se-128),U[4*ne+3]=le===G&&se==G&&ue==G?0:255}return U}(p,T);break;case Lr.CIELab:k=function(q,G){const O=new Uint8ClampedArray(q[0].length);for(let re=0;re<q.length;re++){const K=q[0][re],U=q[1][re]<<24>>24,ne=q[2][re]<<24>>24;let le,se,ue,Ie=(K+16)/116,pe=U/500+Ie,Be=Ie-ne/200;pe=.95047*(pe*pe*pe>.008856?pe*pe*pe:(pe-16/116)/7.787),Ie=1*(Ie*Ie*Ie>.008856?Ie*Ie*Ie:(Ie-16/116)/7.787),Be=1.08883*(Be*Be*Be>.008856?Be*Be*Be:(Be-16/116)/7.787),le=3.2406*pe+-1.5372*Ie+-.4986*Be,se=-.9689*pe+1.8758*Ie+.0415*Be,ue=.0557*pe+-.204*Ie+1.057*Be,le=le>.0031308?1.055*le**(1/2.4)-.055:12.92*le,se=se>.0031308?1.055*se**(1/2.4)-.055:12.92*se,ue=ue>.0031308?1.055*ue**(1/2.4)-.055:12.92*ue,O[4*re]=255*Math.max(0,Math.min(1,le)),O[4*re+1]=255*Math.max(0,Math.min(1,se)),O[4*re+2]=255*Math.max(0,Math.min(1,ue)),O[4*re+3]=K===G&&U==G&&ne==G?0:255}return O}(p,T);break;default:throw new Error("Unsupported photometric interpretation.")}return k},wo=async p=>{var U,ne;const g=new RegExp(/cog:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),A=p.match(g);if(!A)throw new Error(`Invalid COG protocol URL '${p}'`);const v=A[1].split("#"),x=v[0];v.shift();const Q=v.join("#")??"",T=parseInt(A[2]),k=parseInt(A[3]),q=parseInt(A[4]),G=Ms(x),O=await G.getRawTile({z:T,x:k,y:q}),re=await G.getMetadata();let K;if(Q.startsWith("dem"))K=((le,{offset:se,scale:ue,noData:Ie})=>{const pe=le[0],Be=pe.length,Y=new Uint8ClampedArray(4*Be);for(let z=0;z<Be;z++){const ce=se+pe[z]*ue,ie=((ce==Ie?0:ce)- -1e4)/.1;Y[4*z]=Math.floor(ie/256/256)%256,Y[4*z+1]=Math.floor(ie/256)%256,Y[4*z+2]=ie%256,Y[4*z+3]=255}return Y})(O,re);else if(Q.startsWith("color")){const le=(U=Q.split("color").pop())==null?void 0:U.substring(1);if(!le)throw new Error("Color params are not defined");{const se=(ne=le.match(/\[("#([0-9a-fA-F]{3,6})"(,(\s)?)?)+\]/))==null?void 0:ne[0];let ue,Ie,pe,Be="",Y=[];se?(Y=JSON.parse(se),[ue,Ie,pe]=le.replace(`${se},`,"").split(",")):[Be,ue,Ie,pe]=le.split(",");const z=parseFloat(ue),ce=parseFloat(Ie),ie=(pe==null?void 0:pe.includes("-"))||!1,ae=(pe==null?void 0:pe.includes("c"))||!1;K=((Ae,{offset:Ce,scale:be,noData:xe,colorScale:ze})=>{const qe=Ae[0],Ve=qe.length,Ke=new Uint8ClampedArray(4*Ve),ct=pl(ze);for(let Ue=0;Ue<Ve;Ue++){const Pe=Ce+qe[Ue]*be;if(Pe===xe||isNaN(Pe)||Pe===1/0)Ke[4*Ue]=0,Ke[4*Ue+1]=0,Ke[4*Ue+2]=0,Ke[4*Ue+3]=0;else{const Ye=ct(Pe);Ke[4*Ue]=Ye[0],Ke[4*Ue+1]=Ye[1],Ke[4*Ue+2]=Ye[2],Ke[4*Ue+3]=255}}return Ke})(O,{...re,colorScale:{colorScheme:Be,customColors:Y,min:z,max:ce,isReverse:ie,isContinuous:ae}})}}else K=Nl(O,re);return await createImageBitmap(new ImageData(K,256,256))};var Ol=Object.freeze({__proto__:null,default:class extends Dn{decodeBlock(p){return p}}});const vo=257;function Ia(p,g){for(let A=g.length-1;A>=0;A--)p.push(g[A]);return p}function xo(p){const g=new Uint16Array(4093),A=new Uint8Array(4093);for(let ne=0;ne<=257;ne++)g[ne]=4096,A[ne]=ne;let v=258,x=9,Q=0;function T(){v=258,x=9}function k(ne){const le=function(se,ue,Ie){const pe=ue%8,Be=Math.floor(ue/8),Y=8-pe,z=ue+Ie-8*(Be+1);let ce=8*(Be+2)-(ue+Ie);const ie=8*(Be+2)-ue;if(ce=Math.max(0,ce),Be>=se.length)return console.warn("ran off the end of the buffer before finding EOI_CODE (end on input code)"),vo;let ae=se[Be]&2**(8-pe)-1;ae<<=Ie-Y;let Ae=ae;if(Be+1<se.length){let Ce=se[Be+1]>>>ce;Ce<<=Math.max(0,Ie-ie),Ae+=Ce}if(z>8&&Be+2<se.length){const Ce=8*(Be+3)-(ue+Ie);Ae+=se[Be+2]>>>Ce}return Ae}(ne,Q,x);return Q+=x,le}function q(ne,le){return A[v]=le,g[v]=ne,v++,v-1}function G(ne){const le=[];for(let se=ne;se!==4096;se=g[se])le.push(A[se]);return le}const O=[];T();const re=new Uint8Array(p);let K,U=k(re);for(;U!==vo;){if(U===256){for(T(),U=k(re);U===256;)U=k(re);if(U===vo)break;if(U>256)throw new Error(`corrupted code at scanline ${U}`);Ia(O,G(U)),K=U}else if(U<v){const ne=G(U);Ia(O,ne),q(K,ne[ne.length-1]),K=U}else{const ne=G(K);if(!ne)throw new Error(`Bogus entry. Not in dictionary, ${K} / ${v}, position: ${Q}`);Ia(O,ne),O.push(ne[ne.length-1]),q(K,ne[ne.length-1]),K=U}v+1>=2**x&&(x===12?K=void 0:x++),U=k(re)}return new Uint8Array(O)}var ba=Object.freeze({__proto__:null,default:class extends Dn{decodeBlock(p){return xo(p).buffer}}});const Ln=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),Jn=4017,wa=799,Yn=3406,ms=2276,Ns=1567,Os=3784,ys=5793,Bo=2896;function ml(p,g){let A=0;const v=[];let x=16;for(;x>0&&!p[x-1];)--x;v.push({children:[],index:0});let Q,T=v[0];for(let k=0;k<x;k++){for(let q=0;q<p[k];q++){for(T=v.pop(),T.children[T.index]=g[A];T.index>0;)T=v.pop();for(T.index++,v.push(T);v.length<=k;)v.push(Q={children:[],index:0}),T.children[T.index]=Q.children,T=Q;A++}k+1<x&&(v.push(Q={children:[],index:0}),T.children[T.index]=Q.children,T=Q)}return v[0].children}function Co(p,g,A,v,x,Q,T,k,q){const{mcusPerLine:G,progressive:O}=A,re=g;let K=g,U=0,ne=0;function le(){if(ne>0)return ne--,U>>ne&1;if(U=p[K++],U===255){const Ue=p[K++];if(Ue)throw new Error(`unexpected marker: ${(U<<8|Ue).toString(16)}`)}return ne=7,U>>>7}function se(Ue){let Pe,Ye=Ue;for(;(Pe=le())!==null;){if(Ye=Ye[Pe],typeof Ye=="number")return Ye;if(typeof Ye!="object")throw new Error("invalid huffman sequence")}return null}function ue(Ue){let Pe=Ue,Ye=0;for(;Pe>0;){const vt=le();if(vt===null)return;Ye=Ye<<1|vt,--Pe}return Ye}function Ie(Ue){const Pe=ue(Ue);return Pe>=1<<Ue-1?Pe:Pe+(-1<<Ue)+1}let pe=0,Be,Y=0;function z(Ue,Pe,Ye,vt,ot){const Ct=Ye%G,st=(Ye/G|0)*Ue.v+vt,yt=Ct*Ue.h+ot;Pe(Ue,Ue.blocks[st][yt])}function ce(Ue,Pe,Ye){const vt=Ye/Ue.blocksPerLine|0,ot=Ye%Ue.blocksPerLine;Pe(Ue,Ue.blocks[vt][ot])}const ie=v.length;let ae,Ae,Ce,be,xe,ze;ze=O?Q===0?k===0?function(Ue,Pe){const Ye=se(Ue.huffmanTableDC),vt=Ye===0?0:Ie(Ye)<<q;Ue.pred+=vt,Pe[0]=Ue.pred}:function(Ue,Pe){Pe[0]|=le()<<q}:k===0?function(Ue,Pe){if(pe>0)return void pe--;let Ye=Q;const vt=T;for(;Ye<=vt;){const ot=se(Ue.huffmanTableAC),Ct=15&ot,st=ot>>4;if(Ct===0){if(st<15){pe=ue(st)+(1<<st)-1;break}Ye+=16}else Ye+=st,Pe[Ln[Ye]]=Ie(Ct)*(1<<q),Ye++}}:function(Ue,Pe){let Ye=Q;const vt=T;let ot=0;for(;Ye<=vt;){const Ct=Ln[Ye],st=Pe[Ct]<0?-1:1;switch(Y){case 0:{const yt=se(Ue.huffmanTableAC),gt=15&yt;if(ot=yt>>4,gt===0)ot<15?(pe=ue(ot)+(1<<ot),Y=4):(ot=16,Y=1);else{if(gt!==1)throw new Error("invalid ACn encoding");Be=Ie(gt),Y=ot?2:3}continue}case 1:case 2:Pe[Ct]?Pe[Ct]+=(le()<<q)*st:(ot--,ot===0&&(Y=Y===2?3:0));break;case 3:Pe[Ct]?Pe[Ct]+=(le()<<q)*st:(Pe[Ct]=Be<<q,Y=0);break;case 4:Pe[Ct]&&(Pe[Ct]+=(le()<<q)*st)}Ye++}Y===4&&(pe--,pe===0&&(Y=0))}:function(Ue,Pe){const Ye=se(Ue.huffmanTableDC),vt=Ye===0?0:Ie(Ye);Ue.pred+=vt,Pe[0]=Ue.pred;let ot=1;for(;ot<64;){const Ct=se(Ue.huffmanTableAC),st=15&Ct,yt=Ct>>4;if(st===0){if(yt<15)break;ot+=16}else ot+=yt,Pe[Ln[ot]]=Ie(st),ot++}};let qe,Ve,Ke=0;Ve=ie===1?v[0].blocksPerLine*v[0].blocksPerColumn:G*A.mcusPerColumn;const ct=x||Ve;for(;Ke<Ve;){for(Ae=0;Ae<ie;Ae++)v[Ae].pred=0;if(pe=0,ie===1)for(ae=v[0],xe=0;xe<ct;xe++)ce(ae,ze,Ke),Ke++;else for(xe=0;xe<ct;xe++){for(Ae=0;Ae<ie;Ae++){ae=v[Ae];const{h:Ue,v:Pe}=ae;for(Ce=0;Ce<Pe;Ce++)for(be=0;be<Ue;be++)z(ae,ze,Ke,Ce,be)}if(Ke++,Ke===Ve)break}if(ne=0,qe=p[K]<<8|p[K+1],qe<65280)throw new Error("marker was not found");if(!(qe>=65488&&qe<=65495))break;K+=2}return K-re}function yl(p,g){const A=[],{blocksPerLine:v,blocksPerColumn:x}=g,Q=v<<3,T=new Int32Array(64),k=new Uint8Array(64);function q(G,O,re){const K=g.quantizationTable;let U,ne,le,se,ue,Ie,pe,Be,Y;const z=re;let ce;for(ce=0;ce<64;ce++)z[ce]=G[ce]*K[ce];for(ce=0;ce<8;++ce){const ie=8*ce;z[1+ie]!==0||z[2+ie]!==0||z[3+ie]!==0||z[4+ie]!==0||z[5+ie]!==0||z[6+ie]!==0||z[7+ie]!==0?(U=ys*z[0+ie]+128>>8,ne=ys*z[4+ie]+128>>8,le=z[2+ie],se=z[6+ie],ue=Bo*(z[1+ie]-z[7+ie])+128>>8,Be=Bo*(z[1+ie]+z[7+ie])+128>>8,Ie=z[3+ie]<<4,pe=z[5+ie]<<4,Y=U-ne+1>>1,U=U+ne+1>>1,ne=Y,Y=le*Os+se*Ns+128>>8,le=le*Ns-se*Os+128>>8,se=Y,Y=ue-pe+1>>1,ue=ue+pe+1>>1,pe=Y,Y=Be+Ie+1>>1,Ie=Be-Ie+1>>1,Be=Y,Y=U-se+1>>1,U=U+se+1>>1,se=Y,Y=ne-le+1>>1,ne=ne+le+1>>1,le=Y,Y=ue*ms+Be*Yn+2048>>12,ue=ue*Yn-Be*ms+2048>>12,Be=Y,Y=Ie*wa+pe*Jn+2048>>12,Ie=Ie*Jn-pe*wa+2048>>12,pe=Y,z[0+ie]=U+Be,z[7+ie]=U-Be,z[1+ie]=ne+pe,z[6+ie]=ne-pe,z[2+ie]=le+Ie,z[5+ie]=le-Ie,z[3+ie]=se+ue,z[4+ie]=se-ue):(Y=ys*z[0+ie]+512>>10,z[0+ie]=Y,z[1+ie]=Y,z[2+ie]=Y,z[3+ie]=Y,z[4+ie]=Y,z[5+ie]=Y,z[6+ie]=Y,z[7+ie]=Y)}for(ce=0;ce<8;++ce){const ie=ce;z[8+ie]!==0||z[16+ie]!==0||z[24+ie]!==0||z[32+ie]!==0||z[40+ie]!==0||z[48+ie]!==0||z[56+ie]!==0?(U=ys*z[0+ie]+2048>>12,ne=ys*z[32+ie]+2048>>12,le=z[16+ie],se=z[48+ie],ue=Bo*(z[8+ie]-z[56+ie])+2048>>12,Be=Bo*(z[8+ie]+z[56+ie])+2048>>12,Ie=z[24+ie],pe=z[40+ie],Y=U-ne+1>>1,U=U+ne+1>>1,ne=Y,Y=le*Os+se*Ns+2048>>12,le=le*Ns-se*Os+2048>>12,se=Y,Y=ue-pe+1>>1,ue=ue+pe+1>>1,pe=Y,Y=Be+Ie+1>>1,Ie=Be-Ie+1>>1,Be=Y,Y=U-se+1>>1,U=U+se+1>>1,se=Y,Y=ne-le+1>>1,ne=ne+le+1>>1,le=Y,Y=ue*ms+Be*Yn+2048>>12,ue=ue*Yn-Be*ms+2048>>12,Be=Y,Y=Ie*wa+pe*Jn+2048>>12,Ie=Ie*Jn-pe*wa+2048>>12,pe=Y,z[0+ie]=U+Be,z[56+ie]=U-Be,z[8+ie]=ne+pe,z[48+ie]=ne-pe,z[16+ie]=le+Ie,z[40+ie]=le-Ie,z[24+ie]=se+ue,z[32+ie]=se-ue):(Y=ys*re[ce+0]+8192>>14,z[0+ie]=Y,z[8+ie]=Y,z[16+ie]=Y,z[24+ie]=Y,z[32+ie]=Y,z[40+ie]=Y,z[48+ie]=Y,z[56+ie]=Y)}for(ce=0;ce<64;++ce){const ie=128+(z[ce]+8>>4);O[ce]=ie<0?0:ie>255?255:ie}}for(let G=0;G<x;G++){const O=G<<3;for(let re=0;re<8;re++)A.push(new Uint8Array(Q));for(let re=0;re<v;re++){q(g.blocks[G][re],k,T);let K=0;const U=re<<3;for(let ne=0;ne<8;ne++){const le=A[O+ne];for(let se=0;se<8;se++)le[U+se]=k[K++]}}}return A}class qa{constructor(){this.jfif=null,this.adobe=null,this.quantizationTables=[],this.huffmanTablesAC=[],this.huffmanTablesDC=[],this.resetFrames()}resetFrames(){this.frames=[]}parse(g){let A=0;function v(){const k=g[A]<<8|g[A+1];return A+=2,k}function x(){const k=v(),q=g.subarray(A,A+k-2);return A+=q.length,q}function Q(k){let q,G,O=0,re=0;for(G in k.components)k.components.hasOwnProperty(G)&&(q=k.components[G],O<q.h&&(O=q.h),re<q.v&&(re=q.v));const K=Math.ceil(k.samplesPerLine/8/O),U=Math.ceil(k.scanLines/8/re);for(G in k.components)if(k.components.hasOwnProperty(G)){q=k.components[G];const ne=Math.ceil(Math.ceil(k.samplesPerLine/8)*q.h/O),le=Math.ceil(Math.ceil(k.scanLines/8)*q.v/re),se=K*q.h,ue=U*q.v,Ie=[];for(let pe=0;pe<ue;pe++){const Be=[];for(let Y=0;Y<se;Y++)Be.push(new Int32Array(64));Ie.push(Be)}q.blocksPerLine=ne,q.blocksPerColumn=le,q.blocks=Ie}k.maxH=O,k.maxV=re,k.mcusPerLine=K,k.mcusPerColumn=U}let T=v();if(T!==65496)throw new Error("SOI not found");for(T=v();T!==65497;){switch(T){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:{const k=x();T===65504&&k[0]===74&&k[1]===70&&k[2]===73&&k[3]===70&&k[4]===0&&(this.jfif={version:{major:k[5],minor:k[6]},densityUnits:k[7],xDensity:k[8]<<8|k[9],yDensity:k[10]<<8|k[11],thumbWidth:k[12],thumbHeight:k[13],thumbData:k.subarray(14,14+3*k[12]*k[13])}),T===65518&&k[0]===65&&k[1]===100&&k[2]===111&&k[3]===98&&k[4]===101&&k[5]===0&&(this.adobe={version:k[6],flags0:k[7]<<8|k[8],flags1:k[9]<<8|k[10],transformCode:k[11]});break}case 65499:{const k=v()+A-2;for(;A<k;){const q=g[A++],G=new Int32Array(64);if(q>>4){if(q>>4!=1)throw new Error("DQT: invalid table spec");for(let O=0;O<64;O++)G[Ln[O]]=v()}else for(let O=0;O<64;O++)G[Ln[O]]=g[A++];this.quantizationTables[15&q]=G}break}case 65472:case 65473:case 65474:{v();const k={extended:T===65473,progressive:T===65474,precision:g[A++],scanLines:v(),samplesPerLine:v(),components:{},componentsOrder:[]},q=g[A++];let G;for(let O=0;O<q;O++){G=g[A];const re=g[A+1]>>4,K=15&g[A+1],U=g[A+2];k.componentsOrder.push(G),k.components[G]={h:re,v:K,quantizationIdx:U},A+=3}Q(k),this.frames.push(k);break}case 65476:{const k=v();for(let q=2;q<k;){const G=g[A++],O=new Uint8Array(16);let re=0;for(let U=0;U<16;U++,A++)O[U]=g[A],re+=O[U];const K=new Uint8Array(re);for(let U=0;U<re;U++,A++)K[U]=g[A];q+=17+re,G>>4?this.huffmanTablesAC[15&G]=ml(O,K):this.huffmanTablesDC[15&G]=ml(O,K)}break}case 65501:v(),this.resetInterval=v();break;case 65498:{v();const k=g[A++],q=[],G=this.frames[0];for(let ne=0;ne<k;ne++){const le=G.components[g[A++]],se=g[A++];le.huffmanTableDC=this.huffmanTablesDC[se>>4],le.huffmanTableAC=this.huffmanTablesAC[15&se],q.push(le)}const O=g[A++],re=g[A++],K=g[A++],U=Co(g,A,G,q,this.resetInterval,O,re,K>>4,15&K);A+=U;break}case 65535:g[A]!==255&&A--;break;default:if(g[A-3]===255&&g[A-2]>=192&&g[A-2]<=254){A-=3;break}throw new Error(`unknown JPEG marker ${T.toString(16)}`)}T=v()}}getResult(){const{frames:g}=this;if(this.frames.length===0)throw new Error("no frames were decoded");this.frames.length>1&&console.warn("more than one frame is not supported");for(let O=0;O<this.frames.length;O++){const re=this.frames[O].components;for(const K of Object.keys(re))re[K].quantizationTable=this.quantizationTables[re[K].quantizationIdx],delete re[K].quantizationIdx}const A=g[0],{components:v,componentsOrder:x}=A,Q=[],T=A.samplesPerLine,k=A.scanLines;for(let O=0;O<x.length;O++){const re=v[x[O]];Q.push({lines:yl(0,re),scaleX:re.h/A.maxH,scaleY:re.v/A.maxV})}const q=new Uint8Array(T*k*Q.length);let G=0;for(let O=0;O<k;++O)for(let re=0;re<T;++re)for(let K=0;K<Q.length;++K){const U=Q[K];q[G]=U.lines[0|O*U.scaleY][0|re*U.scaleX],++G}return q}}var Va=Object.freeze({__proto__:null,default:class extends Dn{constructor(p){super(),this.reader=new qa,p.JPEGTables&&this.reader.parse(p.JPEGTables)}decodeBlock(p){return this.reader.resetFrames(),this.reader.parse(new Uint8Array(p)),this.reader.getResult().buffer}}});/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */function tr(p){let g=p.length;for(;--g>=0;)p[g]=0}const qs=30,ql=new Array(576);tr(ql);const Vl=new Array(60);tr(Vl);const Xi=new Array(512);tr(Xi);const In=new Array(256);tr(In);const Kr=new Array(29);tr(Kr);const Ha=new Array(qs);tr(Ha);var ja=(p,g,A,v)=>{let x=65535&p,Q=p>>>16&65535,T=0;for(;A!==0;){T=A>2e3?2e3:A,A-=T;do x=x+g[v++]|0,Q=Q+x|0;while(--T);x%=65521,Q%=65521}return x|Q<<16};const Eo=new Uint32Array((()=>{let p,g=[];for(var A=0;A<256;A++){p=A;for(var v=0;v<8;v++)p=1&p?3988292384^p>>>1:p>>>1;g[A]=p}return g})());var Qr=(p,g,A,v)=>{const x=Eo,Q=v+A;p^=-1;for(let T=v;T<Q;T++)p=p>>>8^x[255&(p^g[T])];return~p},bn={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Qo={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const So=(p,g)=>Object.prototype.hasOwnProperty.call(p,g);var ko={assign:function(p){const g=Array.prototype.slice.call(arguments,1);for(;g.length;){const A=g.shift();if(A){if(typeof A!="object")throw new TypeError(A+"must be non-object");for(const v in A)So(A,v)&&(p[v]=A[v])}}return p},flattenChunks:p=>{let g=0;for(let v=0,x=p.length;v<x;v++)g+=p[v].length;const A=new Uint8Array(g);for(let v=0,x=0,Q=p.length;v<Q;v++){let T=p[v];A.set(T,x),x+=T.length}return A}};let Ja=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Ja=!1}const Vs=new Uint8Array(256);for(let p=0;p<256;p++)Vs[p]=p>=252?6:p>=248?5:p>=240?4:p>=224?3:p>=192?2:1;Vs[254]=Vs[254]=1;var Ya={string2buf:p=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(p);let g,A,v,x,Q,T=p.length,k=0;for(x=0;x<T;x++)A=p.charCodeAt(x),(64512&A)==55296&&x+1<T&&(v=p.charCodeAt(x+1),(64512&v)==56320&&(A=65536+(A-55296<<10)+(v-56320),x++)),k+=A<128?1:A<2048?2:A<65536?3:4;for(g=new Uint8Array(k),Q=0,x=0;Q<k;x++)A=p.charCodeAt(x),(64512&A)==55296&&x+1<T&&(v=p.charCodeAt(x+1),(64512&v)==56320&&(A=65536+(A-55296<<10)+(v-56320),x++)),A<128?g[Q++]=A:A<2048?(g[Q++]=192|A>>>6,g[Q++]=128|63&A):A<65536?(g[Q++]=224|A>>>12,g[Q++]=128|A>>>6&63,g[Q++]=128|63&A):(g[Q++]=240|A>>>18,g[Q++]=128|A>>>12&63,g[Q++]=128|A>>>6&63,g[Q++]=128|63&A);return g},buf2string:(p,g)=>{const A=g||p.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(p.subarray(0,g));let v,x;const Q=new Array(2*A);for(x=0,v=0;v<A;){let T=p[v++];if(T<128){Q[x++]=T;continue}let k=Vs[T];if(k>4)Q[x++]=65533,v+=k-1;else{for(T&=k===2?31:k===3?15:7;k>1&&v<A;)T=T<<6|63&p[v++],k--;k>1?Q[x++]=65533:T<65536?Q[x++]=T:(T-=65536,Q[x++]=55296|T>>10&1023,Q[x++]=56320|1023&T)}}return((T,k)=>{if(k<65534&&T.subarray&&Ja)return String.fromCharCode.apply(null,T.length===k?T:T.subarray(0,k));let q="";for(let G=0;G<k;G++)q+=String.fromCharCode(T[G]);return q})(Q,x)},utf8border:(p,g)=>{(g=g||p.length)>p.length&&(g=p.length);let A=g-1;for(;A>=0&&(192&p[A])==128;)A--;return A<0||A===0?g:A+Vs[p[A]]>g?A:g}},Hs=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const js=16209;var Ka=function(p,g){let A,v,x,Q,T,k,q,G,O,re,K,U,ne,le,se,ue,Ie,pe,Be,Y,z,ce,ie,ae;const Ae=p.state;A=p.next_in,ie=p.input,v=A+(p.avail_in-5),x=p.next_out,ae=p.output,Q=x-(g-p.avail_out),T=x+(p.avail_out-257),k=Ae.dmax,q=Ae.wsize,G=Ae.whave,O=Ae.wnext,re=Ae.window,K=Ae.hold,U=Ae.bits,ne=Ae.lencode,le=Ae.distcode,se=(1<<Ae.lenbits)-1,ue=(1<<Ae.distbits)-1;e:do{U<15&&(K+=ie[A++]<<U,U+=8,K+=ie[A++]<<U,U+=8),Ie=ne[K&se];t:for(;;){if(pe=Ie>>>24,K>>>=pe,U-=pe,pe=Ie>>>16&255,pe===0)ae[x++]=65535&Ie;else{if(!(16&pe)){if(64&pe){if(32&pe){Ae.mode=16191;break e}p.msg="invalid literal/length code",Ae.mode=js;break e}Ie=ne[(65535&Ie)+(K&(1<<pe)-1)];continue t}for(Be=65535&Ie,pe&=15,pe&&(U<pe&&(K+=ie[A++]<<U,U+=8),Be+=K&(1<<pe)-1,K>>>=pe,U-=pe),U<15&&(K+=ie[A++]<<U,U+=8,K+=ie[A++]<<U,U+=8),Ie=le[K&ue];;){if(pe=Ie>>>24,K>>>=pe,U-=pe,pe=Ie>>>16&255,16&pe){if(Y=65535&Ie,pe&=15,U<pe&&(K+=ie[A++]<<U,U+=8,U<pe&&(K+=ie[A++]<<U,U+=8)),Y+=K&(1<<pe)-1,Y>k){p.msg="invalid distance too far back",Ae.mode=js;break e}if(K>>>=pe,U-=pe,pe=x-Q,Y>pe){if(pe=Y-pe,pe>G&&Ae.sane){p.msg="invalid distance too far back",Ae.mode=js;break e}if(z=0,ce=re,O===0){if(z+=q-pe,pe<Be){Be-=pe;do ae[x++]=re[z++];while(--pe);z=x-Y,ce=ae}}else if(O<pe){if(z+=q+O-pe,pe-=O,pe<Be){Be-=pe;do ae[x++]=re[z++];while(--pe);if(z=0,O<Be){pe=O,Be-=pe;do ae[x++]=re[z++];while(--pe);z=x-Y,ce=ae}}}else if(z+=O-pe,pe<Be){Be-=pe;do ae[x++]=re[z++];while(--pe);z=x-Y,ce=ae}for(;Be>2;)ae[x++]=ce[z++],ae[x++]=ce[z++],ae[x++]=ce[z++],Be-=3;Be&&(ae[x++]=ce[z++],Be>1&&(ae[x++]=ce[z++]))}else{z=x-Y;do ae[x++]=ae[z++],ae[x++]=ae[z++],ae[x++]=ae[z++],Be-=3;while(Be>2);Be&&(ae[x++]=ae[z++],Be>1&&(ae[x++]=ae[z++]))}break}if(64&pe){p.msg="invalid distance code",Ae.mode=js;break e}Ie=le[(65535&Ie)+(K&(1<<pe)-1)]}}break}}while(A<v&&x<T);Be=U>>3,A-=Be,U-=Be<<3,K&=(1<<U)-1,p.next_in=A,p.next_out=x,p.avail_in=A<v?v-A+5:5-(A-v),p.avail_out=x<T?T-x+257:257-(x-T),Ae.hold=K,Ae.bits=U};const va=15,_l=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Il=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),bl=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Do=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Kn=(p,g,A,v,x,Q,T,k)=>{const q=k.bits;let G,O,re,K,U,ne,le=0,se=0,ue=0,Ie=0,pe=0,Be=0,Y=0,z=0,ce=0,ie=0,ae=null;const Ae=new Uint16Array(16),Ce=new Uint16Array(16);let be,xe,ze,qe=null;for(le=0;le<=va;le++)Ae[le]=0;for(se=0;se<v;se++)Ae[g[A+se]]++;for(pe=q,Ie=va;Ie>=1&&Ae[Ie]===0;Ie--);if(pe>Ie&&(pe=Ie),Ie===0)return x[Q++]=20971520,x[Q++]=20971520,k.bits=1,0;for(ue=1;ue<Ie&&Ae[ue]===0;ue++);for(pe<ue&&(pe=ue),z=1,le=1;le<=va;le++)if(z<<=1,z-=Ae[le],z<0)return-1;if(z>0&&(p===0||Ie!==1))return-1;for(Ce[1]=0,le=1;le<va;le++)Ce[le+1]=Ce[le]+Ae[le];for(se=0;se<v;se++)g[A+se]!==0&&(T[Ce[g[A+se]]++]=se);if(p===0?(ae=qe=T,ne=20):p===1?(ae=_l,qe=Il,ne=257):(ae=bl,qe=Do,ne=0),ie=0,se=0,le=ue,U=Q,Be=pe,Y=0,re=-1,ce=1<<pe,K=ce-1,p===1&&ce>852||p===2&&ce>592)return 1;for(;;){be=le-Y,T[se]+1<ne?(xe=0,ze=T[se]):T[se]>=ne?(xe=qe[T[se]-ne],ze=ae[T[se]-ne]):(xe=96,ze=0),G=1<<le-Y,O=1<<Be,ue=O;do O-=G,x[U+(ie>>Y)+O]=be<<24|xe<<16|ze;while(O!==0);for(G=1<<le-1;ie&G;)G>>=1;if(G!==0?(ie&=G-1,ie+=G):ie=0,se++,--Ae[le]==0){if(le===Ie)break;le=g[A+T[se]]}if(le>pe&&(ie&K)!==re){for(Y===0&&(Y=pe),U+=ue,Be=le-Y,z=1<<Be;Be+Y<Ie&&(z-=Ae[Be+Y],!(z<=0));)Be++,z<<=1;if(ce+=1<<Be,p===1&&ce>852||p===2&&ce>592)return 1;re=ie&K,x[re]=pe<<24|Be<<16|U-Q}}return ie!==0&&(x[U+ie]=le-Y<<24|64<<16),k.bits=pe,0};const{Z_FINISH:wl,Z_BLOCK:an,Z_TREES:Zr,Z_OK:Zn,Z_STREAM_END:wn,Z_NEED_DICT:Js,Z_STREAM_ERROR:on,Z_DATA_ERROR:Hl,Z_MEM_ERROR:vl,Z_BUF_ERROR:jl,Z_DEFLATED:Mo}=Qo,$n=16180,Sr=16190,mt=16191,xa=16192,Za=16194,$a=16199,Xn=16200,_s=16206,Li=16209,oi=p=>(p>>>24&255)+(p>>>8&65280)+((65280&p)<<8)+((255&p)<<24);function xl(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ys=p=>{if(!p)return 1;const g=p.state;return!g||g.strm!==p||g.mode<$n||g.mode>16211?1:0},To=p=>{if(Ys(p))return on;const g=p.state;return p.total_in=p.total_out=g.total=0,p.msg="",g.wrap&&(p.adler=1&g.wrap),g.mode=$n,g.last=0,g.havedict=0,g.flags=-1,g.dmax=32768,g.head=null,g.hold=0,g.bits=0,g.lencode=g.lendyn=new Int32Array(852),g.distcode=g.distdyn=new Int32Array(592),g.sane=1,g.back=-1,Zn},Jl=p=>{if(Ys(p))return on;const g=p.state;return g.wsize=0,g.whave=0,g.wnext=0,To(p)},Ks=(p,g)=>{let A;if(Ys(p))return on;const v=p.state;return g<0?(A=0,g=-g):(A=5+(g>>4),g<48&&(g&=15)),g&&(g<8||g>15)?on:(v.window!==null&&v.wbits!==g&&(v.window=null),v.wrap=A,v.wbits=g,Jl(p))},Bl=(p,g)=>{if(!p)return on;const A=new xl;p.state=A,A.strm=p,A.window=null,A.mode=$n;const v=Ks(p,g);return v!==Zn&&(p.state=null),v};let Xa,Po,Yl=!0;const Cl=p=>{if(Yl){Xa=new Int32Array(512),Po=new Int32Array(32);let g=0;for(;g<144;)p.lens[g++]=8;for(;g<256;)p.lens[g++]=9;for(;g<280;)p.lens[g++]=7;for(;g<288;)p.lens[g++]=8;for(Kn(1,p.lens,0,288,Xa,0,p.work,{bits:9}),g=0;g<32;)p.lens[g++]=5;Kn(2,p.lens,0,32,Po,0,p.work,{bits:5}),Yl=!1}p.lencode=Xa,p.lenbits=9,p.distcode=Po,p.distbits=5},Kl=(p,g,A,v)=>{let x;const Q=p.state;return Q.window===null&&(Q.wsize=1<<Q.wbits,Q.wnext=0,Q.whave=0,Q.window=new Uint8Array(Q.wsize)),v>=Q.wsize?(Q.window.set(g.subarray(A-Q.wsize,A),0),Q.wnext=0,Q.whave=Q.wsize):(x=Q.wsize-Q.wnext,x>v&&(x=v),Q.window.set(g.subarray(A-v,A-v+x),Q.wnext),(v-=x)?(Q.window.set(g.subarray(A-v,A),0),Q.wnext=v,Q.whave=Q.wsize):(Q.wnext+=x,Q.wnext===Q.wsize&&(Q.wnext=0),Q.whave<Q.wsize&&(Q.whave+=x))),0};var mc=(p,g)=>{let A,v,x,Q,T,k,q,G,O,re,K,U,ne,le,se,ue,Ie,pe,Be,Y,z,ce,ie=0;const ae=new Uint8Array(4);let Ae,Ce;const be=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ys(p)||!p.output||!p.input&&p.avail_in!==0)return on;A=p.state,A.mode===mt&&(A.mode=xa),T=p.next_out,x=p.output,q=p.avail_out,Q=p.next_in,v=p.input,k=p.avail_in,G=A.hold,O=A.bits,re=k,K=q,ce=Zn;e:for(;;)switch(A.mode){case $n:if(A.wrap===0){A.mode=xa;break}for(;O<16;){if(k===0)break e;k--,G+=v[Q++]<<O,O+=8}if(2&A.wrap&&G===35615){A.wbits===0&&(A.wbits=15),A.check=0,ae[0]=255&G,ae[1]=G>>>8&255,A.check=Qr(A.check,ae,2,0),G=0,O=0,A.mode=16181;break}if(A.head&&(A.head.done=!1),!(1&A.wrap)||(((255&G)<<8)+(G>>8))%31){p.msg="incorrect header check",A.mode=Li;break}if((15&G)!==Mo){p.msg="unknown compression method",A.mode=Li;break}if(G>>>=4,O-=4,z=8+(15&G),A.wbits===0&&(A.wbits=z),z>15||z>A.wbits){p.msg="invalid window size",A.mode=Li;break}A.dmax=1<<A.wbits,A.flags=0,p.adler=A.check=1,A.mode=512&G?16189:mt,G=0,O=0;break;case 16181:for(;O<16;){if(k===0)break e;k--,G+=v[Q++]<<O,O+=8}if(A.flags=G,(255&A.flags)!==Mo){p.msg="unknown compression method",A.mode=Li;break}if(57344&A.flags){p.msg="unknown header flags set",A.mode=Li;break}A.head&&(A.head.text=G>>8&1),512&A.flags&&4&A.wrap&&(ae[0]=255&G,ae[1]=G>>>8&255,A.check=Qr(A.check,ae,2,0)),G=0,O=0,A.mode=16182;case 16182:for(;O<32;){if(k===0)break e;k--,G+=v[Q++]<<O,O+=8}A.head&&(A.head.time=G),512&A.flags&&4&A.wrap&&(ae[0]=255&G,ae[1]=G>>>8&255,ae[2]=G>>>16&255,ae[3]=G>>>24&255,A.check=Qr(A.check,ae,4,0)),G=0,O=0,A.mode=16183;case 16183:for(;O<16;){if(k===0)break e;k--,G+=v[Q++]<<O,O+=8}A.head&&(A.head.xflags=255&G,A.head.os=G>>8),512&A.flags&&4&A.wrap&&(ae[0]=255&G,ae[1]=G>>>8&255,A.check=Qr(A.check,ae,2,0)),G=0,O=0,A.mode=16184;case 16184:if(1024&A.flags){for(;O<16;){if(k===0)break e;k--,G+=v[Q++]<<O,O+=8}A.length=G,A.head&&(A.head.extra_len=G),512&A.flags&&4&A.wrap&&(ae[0]=255&G,ae[1]=G>>>8&255,A.check=Qr(A.check,ae,2,0)),G=0,O=0}else A.head&&(A.head.extra=null);A.mode=16185;case 16185:if(1024&A.flags&&(U=A.length,U>k&&(U=k),U&&(A.head&&(z=A.head.extra_len-A.length,A.head.extra||(A.head.extra=new Uint8Array(A.head.extra_len)),A.head.extra.set(v.subarray(Q,Q+U),z)),512&A.flags&&4&A.wrap&&(A.check=Qr(A.check,v,U,Q)),k-=U,Q+=U,A.length-=U),A.length))break e;A.length=0,A.mode=16186;case 16186:if(2048&A.flags){if(k===0)break e;U=0;do z=v[Q+U++],A.head&&z&&A.length<65536&&(A.head.name+=String.fromCharCode(z));while(z&&U<k);if(512&A.flags&&4&A.wrap&&(A.check=Qr(A.check,v,U,Q)),k-=U,Q+=U,z)break e}else A.head&&(A.head.name=null);A.length=0,A.mode=16187;case 16187:if(4096&A.flags){if(k===0)break e;U=0;do z=v[Q+U++],A.head&&z&&A.length<65536&&(A.head.comment+=String.fromCharCode(z));while(z&&U<k);if(512&A.flags&&4&A.wrap&&(A.check=Qr(A.check,v,U,Q)),k-=U,Q+=U,z)break e}else A.head&&(A.head.comment=null);A.mode=16188;case 16188:if(512&A.flags){for(;O<16;){if(k===0)break e;k--,G+=v[Q++]<<O,O+=8}if(4&A.wrap&&G!==(65535&A.check)){p.msg="header crc mismatch",A.mode=Li;break}G=0,O=0}A.head&&(A.head.hcrc=A.flags>>9&1,A.head.done=!0),p.adler=A.check=0,A.mode=mt;break;case 16189:for(;O<32;){if(k===0)break e;k--,G+=v[Q++]<<O,O+=8}p.adler=A.check=oi(G),G=0,O=0,A.mode=Sr;case Sr:if(A.havedict===0)return p.next_out=T,p.avail_out=q,p.next_in=Q,p.avail_in=k,A.hold=G,A.bits=O,Js;p.adler=A.check=1,A.mode=mt;case mt:if(g===an||g===Zr)break e;case xa:if(A.last){G>>>=7&O,O-=7&O,A.mode=_s;break}for(;O<3;){if(k===0)break e;k--,G+=v[Q++]<<O,O+=8}switch(A.last=1&G,G>>>=1,O-=1,3&G){case 0:A.mode=16193;break;case 1:if(Cl(A),A.mode=$a,g===Zr){G>>>=2,O-=2;break e}break;case 2:A.mode=16196;break;case 3:p.msg="invalid block type",A.mode=Li}G>>>=2,O-=2;break;case 16193:for(G>>>=7&O,O-=7&O;O<32;){if(k===0)break e;k--,G+=v[Q++]<<O,O+=8}if((65535&G)!=(G>>>16^65535)){p.msg="invalid stored block lengths",A.mode=Li;break}if(A.length=65535&G,G=0,O=0,A.mode=Za,g===Zr)break e;case Za:A.mode=16195;case 16195:if(U=A.length,U){if(U>k&&(U=k),U>q&&(U=q),U===0)break e;x.set(v.subarray(Q,Q+U),T),k-=U,Q+=U,q-=U,T+=U,A.length-=U;break}A.mode=mt;break;case 16196:for(;O<14;){if(k===0)break e;k--,G+=v[Q++]<<O,O+=8}if(A.nlen=257+(31&G),G>>>=5,O-=5,A.ndist=1+(31&G),G>>>=5,O-=5,A.ncode=4+(15&G),G>>>=4,O-=4,A.nlen>286||A.ndist>30){p.msg="too many length or distance symbols",A.mode=Li;break}A.have=0,A.mode=16197;case 16197:for(;A.have<A.ncode;){for(;O<3;){if(k===0)break e;k--,G+=v[Q++]<<O,O+=8}A.lens[be[A.have++]]=7&G,G>>>=3,O-=3}for(;A.have<19;)A.lens[be[A.have++]]=0;if(A.lencode=A.lendyn,A.lenbits=7,Ae={bits:A.lenbits},ce=Kn(0,A.lens,0,19,A.lencode,0,A.work,Ae),A.lenbits=Ae.bits,ce){p.msg="invalid code lengths set",A.mode=Li;break}A.have=0,A.mode=16198;case 16198:for(;A.have<A.nlen+A.ndist;){for(;ie=A.lencode[G&(1<<A.lenbits)-1],se=ie>>>24,ue=ie>>>16&255,Ie=65535&ie,!(se<=O);){if(k===0)break e;k--,G+=v[Q++]<<O,O+=8}if(Ie<16)G>>>=se,O-=se,A.lens[A.have++]=Ie;else{if(Ie===16){for(Ce=se+2;O<Ce;){if(k===0)break e;k--,G+=v[Q++]<<O,O+=8}if(G>>>=se,O-=se,A.have===0){p.msg="invalid bit length repeat",A.mode=Li;break}z=A.lens[A.have-1],U=3+(3&G),G>>>=2,O-=2}else if(Ie===17){for(Ce=se+3;O<Ce;){if(k===0)break e;k--,G+=v[Q++]<<O,O+=8}G>>>=se,O-=se,z=0,U=3+(7&G),G>>>=3,O-=3}else{for(Ce=se+7;O<Ce;){if(k===0)break e;k--,G+=v[Q++]<<O,O+=8}G>>>=se,O-=se,z=0,U=11+(127&G),G>>>=7,O-=7}if(A.have+U>A.nlen+A.ndist){p.msg="invalid bit length repeat",A.mode=Li;break}for(;U--;)A.lens[A.have++]=z}}if(A.mode===Li)break;if(A.lens[256]===0){p.msg="invalid code -- missing end-of-block",A.mode=Li;break}if(A.lenbits=9,Ae={bits:A.lenbits},ce=Kn(1,A.lens,0,A.nlen,A.lencode,0,A.work,Ae),A.lenbits=Ae.bits,ce){p.msg="invalid literal/lengths set",A.mode=Li;break}if(A.distbits=6,A.distcode=A.distdyn,Ae={bits:A.distbits},ce=Kn(2,A.lens,A.nlen,A.ndist,A.distcode,0,A.work,Ae),A.distbits=Ae.bits,ce){p.msg="invalid distances set",A.mode=Li;break}if(A.mode=$a,g===Zr)break e;case $a:A.mode=Xn;case Xn:if(k>=6&&q>=258){p.next_out=T,p.avail_out=q,p.next_in=Q,p.avail_in=k,A.hold=G,A.bits=O,Ka(p,K),T=p.next_out,x=p.output,q=p.avail_out,Q=p.next_in,v=p.input,k=p.avail_in,G=A.hold,O=A.bits,A.mode===mt&&(A.back=-1);break}for(A.back=0;ie=A.lencode[G&(1<<A.lenbits)-1],se=ie>>>24,ue=ie>>>16&255,Ie=65535&ie,!(se<=O);){if(k===0)break e;k--,G+=v[Q++]<<O,O+=8}if(ue&&!(240&ue)){for(pe=se,Be=ue,Y=Ie;ie=A.lencode[Y+((G&(1<<pe+Be)-1)>>pe)],se=ie>>>24,ue=ie>>>16&255,Ie=65535&ie,!(pe+se<=O);){if(k===0)break e;k--,G+=v[Q++]<<O,O+=8}G>>>=pe,O-=pe,A.back+=pe}if(G>>>=se,O-=se,A.back+=se,A.length=Ie,ue===0){A.mode=16205;break}if(32&ue){A.back=-1,A.mode=mt;break}if(64&ue){p.msg="invalid literal/length code",A.mode=Li;break}A.extra=15&ue,A.mode=16201;case 16201:if(A.extra){for(Ce=A.extra;O<Ce;){if(k===0)break e;k--,G+=v[Q++]<<O,O+=8}A.length+=G&(1<<A.extra)-1,G>>>=A.extra,O-=A.extra,A.back+=A.extra}A.was=A.length,A.mode=16202;case 16202:for(;ie=A.distcode[G&(1<<A.distbits)-1],se=ie>>>24,ue=ie>>>16&255,Ie=65535&ie,!(se<=O);){if(k===0)break e;k--,G+=v[Q++]<<O,O+=8}if(!(240&ue)){for(pe=se,Be=ue,Y=Ie;ie=A.distcode[Y+((G&(1<<pe+Be)-1)>>pe)],se=ie>>>24,ue=ie>>>16&255,Ie=65535&ie,!(pe+se<=O);){if(k===0)break e;k--,G+=v[Q++]<<O,O+=8}G>>>=pe,O-=pe,A.back+=pe}if(G>>>=se,O-=se,A.back+=se,64&ue){p.msg="invalid distance code",A.mode=Li;break}A.offset=Ie,A.extra=15&ue,A.mode=16203;case 16203:if(A.extra){for(Ce=A.extra;O<Ce;){if(k===0)break e;k--,G+=v[Q++]<<O,O+=8}A.offset+=G&(1<<A.extra)-1,G>>>=A.extra,O-=A.extra,A.back+=A.extra}if(A.offset>A.dmax){p.msg="invalid distance too far back",A.mode=Li;break}A.mode=16204;case 16204:if(q===0)break e;if(U=K-q,A.offset>U){if(U=A.offset-U,U>A.whave&&A.sane){p.msg="invalid distance too far back",A.mode=Li;break}U>A.wnext?(U-=A.wnext,ne=A.wsize-U):ne=A.wnext-U,U>A.length&&(U=A.length),le=A.window}else le=x,ne=T-A.offset,U=A.length;U>q&&(U=q),q-=U,A.length-=U;do x[T++]=le[ne++];while(--U);A.length===0&&(A.mode=Xn);break;case 16205:if(q===0)break e;x[T++]=A.length,q--,A.mode=Xn;break;case _s:if(A.wrap){for(;O<32;){if(k===0)break e;k--,G|=v[Q++]<<O,O+=8}if(K-=q,p.total_out+=K,A.total+=K,4&A.wrap&&K&&(p.adler=A.check=A.flags?Qr(A.check,x,K,T-K):ja(A.check,x,K,T-K)),K=q,4&A.wrap&&(A.flags?G:oi(G))!==A.check){p.msg="incorrect data check",A.mode=Li;break}G=0,O=0}A.mode=16207;case 16207:if(A.wrap&&A.flags){for(;O<32;){if(k===0)break e;k--,G+=v[Q++]<<O,O+=8}if(4&A.wrap&&G!==(4294967295&A.total)){p.msg="incorrect length check",A.mode=Li;break}G=0,O=0}A.mode=16208;case 16208:ce=wn;break e;case Li:ce=Hl;break e;case 16210:return vl;default:return on}return p.next_out=T,p.avail_out=q,p.next_in=Q,p.avail_in=k,A.hold=G,A.bits=O,(A.wsize||K!==p.avail_out&&A.mode<Li&&(A.mode<_s||g!==wl))&&Kl(p,p.output,p.next_out,K-p.avail_out),re-=p.avail_in,K-=p.avail_out,p.total_in+=re,p.total_out+=K,A.total+=K,4&A.wrap&&K&&(p.adler=A.check=A.flags?Qr(A.check,x,K,p.next_out-K):ja(A.check,x,K,p.next_out-K)),p.data_type=A.bits+(A.last?64:0)+(A.mode===mt?128:0)+(A.mode===$a||A.mode===Za?256:0),(re===0&&K===0||g===wl)&&ce===Zn&&(ce=jl),ce},ir={inflateReset:Jl,inflateReset2:Ks,inflateResetKeep:To,inflateInit:p=>Bl(p,15),inflateInit2:Bl,inflate:mc,inflateEnd:p=>{if(Ys(p))return on;let g=p.state;return g.window&&(g.window=null),p.state=null,Zn},inflateGetHeader:(p,g)=>{if(Ys(p))return on;const A=p.state;return 2&A.wrap?(A.head=g,g.done=!1,Zn):on},inflateSetDictionary:(p,g)=>{const A=g.length;let v,x,Q;return Ys(p)?on:(v=p.state,v.wrap!==0&&v.mode!==Sr?on:v.mode===Sr&&(x=1,x=ja(x,g,A,0),x!==v.check)?Hl:(Q=Kl(p,g,A,A),Q?(v.mode=16210,vl):(v.havedict=1,Zn)))},inflateInfo:"pako inflate (from Nodeca project)"},Fi=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Zs=Object.prototype.toString,{Z_NO_FLUSH:Ro,Z_FINISH:Lo,Z_OK:Ba,Z_STREAM_END:$s,Z_NEED_DICT:Xs,Z_STREAM_ERROR:Fn,Z_DATA_ERROR:Ca,Z_MEM_ERROR:Qt}=Qo;function Ut(p){this.options=ko.assign({chunkSize:65536,windowBits:15,to:""},p||{});const g=this.options;g.raw&&g.windowBits>=0&&g.windowBits<16&&(g.windowBits=-g.windowBits,g.windowBits===0&&(g.windowBits=-15)),!(g.windowBits>=0&&g.windowBits<16)||p&&p.windowBits||(g.windowBits+=32),g.windowBits>15&&g.windowBits<48&&(15&g.windowBits||(g.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Hs,this.strm.avail_out=0;let A=ir.inflateInit2(this.strm,g.windowBits);if(A!==Ba)throw new Error(bn[A]);if(this.header=new Fi,ir.inflateGetHeader(this.strm,this.header),g.dictionary&&(typeof g.dictionary=="string"?g.dictionary=Ya.string2buf(g.dictionary):Zs.call(g.dictionary)==="[object ArrayBuffer]"&&(g.dictionary=new Uint8Array(g.dictionary)),g.raw&&(A=ir.inflateSetDictionary(this.strm,g.dictionary),A!==Ba)))throw new Error(bn[A])}function Fo(p,g){const A=new Ut(g);if(A.push(p),A.err)throw A.msg||bn[A.err];return A.result}Ut.prototype.push=function(p,g){const A=this.strm,v=this.options.chunkSize,x=this.options.dictionary;let Q,T,k;if(this.ended)return!1;for(T=g===~~g?g:g===!0?Lo:Ro,Zs.call(p)==="[object ArrayBuffer]"?A.input=new Uint8Array(p):A.input=p,A.next_in=0,A.avail_in=A.input.length;;){for(A.avail_out===0&&(A.output=new Uint8Array(v),A.next_out=0,A.avail_out=v),Q=ir.inflate(A,T),Q===Xs&&x&&(Q=ir.inflateSetDictionary(A,x),Q===Ba?Q=ir.inflate(A,T):Q===Ca&&(Q=Xs));A.avail_in>0&&Q===$s&&A.state.wrap>0&&p[A.next_in]!==0;)ir.inflateReset(A),Q=ir.inflate(A,T);switch(Q){case Fn:case Ca:case Xs:case Qt:return this.onEnd(Q),this.ended=!0,!1}if(k=A.avail_out,A.next_out&&(A.avail_out===0||Q===$s))if(this.options.to==="string"){let q=Ya.utf8border(A.output,A.next_out),G=A.next_out-q,O=Ya.buf2string(A.output,q);A.next_out=G,A.avail_out=v-G,G&&A.output.set(A.output.subarray(q,q+G),0),this.onData(O)}else this.onData(A.output.length===A.next_out?A.output:A.output.subarray(0,A.next_out));if(Q!==Ba||k!==0){if(Q===$s)return Q=ir.inflateEnd(this.strm),this.onEnd(Q),this.ended=!0,!0;if(A.avail_in===0)break}}return!0},Ut.prototype.onData=function(p){this.chunks.push(p)},Ut.prototype.onEnd=function(p){p===Ba&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=ko.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg};var zo={inflate:Fo};const{inflate:El}=zo;var u=El,e=Object.freeze({__proto__:null,default:class extends Dn{decodeBlock(p){return u(new Uint8Array(p)).buffer}}}),n=Object.freeze({__proto__:null,default:class extends Dn{decodeBlock(p){const g=new DataView(p),A=[];for(let v=0;v<p.byteLength;++v){let x=g.getInt8(v);if(x<0){const Q=g.getUint8(v+1);x=-x;for(let T=0;T<=x;++T)A.push(Q);v+=1}else{for(let Q=0;Q<=x;++Q)A.push(g.getUint8(v+Q+1));v+=x+1}}return new Uint8Array(A).buffer}}}),a={exports:{}};(function(p){/* Copyright 2015-2021 Esri. Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 @preserve */(function(){var g,A,v,x,Q,T,k,q,G,O,re,K,U,ne,le,se,ue=(g={defaultNoDataValue:-34027999387901484e22,decode:function(Y,z){var ce=(z=z||{}).encodedMaskData||z.encodedMaskData===null,ie=Q(Y,z.inputOffset||0,ce),ae=z.noDataValue!==null?z.noDataValue:g.defaultNoDataValue,Ae=A(ie,z.pixelType||Float32Array,z.encodedMaskData,ae,z.returnMask),Ce={width:ie.width,height:ie.height,pixelData:Ae.resultPixels,minValue:Ae.minValue,maxValue:ie.pixels.maxValue,noDataValue:ae};return Ae.resultMask&&(Ce.maskData=Ae.resultMask),z.returnEncodedMask&&ie.mask&&(Ce.encodedMaskData=ie.mask.bitset?ie.mask.bitset:null),z.returnFileInfo&&(Ce.fileInfo=v(ie),z.computeUsedBitDepths&&(Ce.fileInfo.bitDepths=x(ie))),Ce}},A=function(Y,z,ce,ie,ae){var Ae,Ce,be,xe=0,ze=Y.pixels.numBlocksX,qe=Y.pixels.numBlocksY,Ve=Math.floor(Y.width/ze),Ke=Math.floor(Y.height/qe),ct=2*Y.maxZError,Ue=Number.MAX_VALUE;ce=ce||(Y.mask?Y.mask.bitset:null),Ce=new z(Y.width*Y.height),ae&&ce&&(be=new Uint8Array(Y.width*Y.height));for(var Pe,Ye,vt=new Float32Array(Ve*Ke),ot=0;ot<=qe;ot++){var Ct=ot!==qe?Ke:Y.height%qe;if(Ct!==0)for(var st=0;st<=ze;st++){var yt=st!==ze?Ve:Y.width%ze;if(yt!==0){var gt,nt,_t,ci,$t=ot*Y.width*Ke+st*Ve,Ai=Y.width-yt,di=Y.pixels.blocks[xe];if(di.encoding<2?(di.encoding===0?gt=di.rawData:(T(di.stuffedData,di.bitsPerPixel,di.numValidPixels,di.offset,ct,vt,Y.pixels.maxValue),gt=vt),nt=0):_t=di.encoding===2?0:di.offset,ce)for(Ye=0;Ye<Ct;Ye++){for(7&$t&&(ci=ce[$t>>3],ci<<=7&$t),Pe=0;Pe<yt;Pe++)7&$t||(ci=ce[$t>>3]),128&ci?(be&&(be[$t]=1),Ue=Ue>(Ae=di.encoding<2?gt[nt++]:_t)?Ae:Ue,Ce[$t++]=Ae):(be&&(be[$t]=0),Ce[$t++]=ie),ci<<=1;$t+=Ai}else if(di.encoding<2)for(Ye=0;Ye<Ct;Ye++){for(Pe=0;Pe<yt;Pe++)Ue=Ue>(Ae=gt[nt++])?Ae:Ue,Ce[$t++]=Ae;$t+=Ai}else for(Ue=Ue>_t?_t:Ue,Ye=0;Ye<Ct;Ye++){for(Pe=0;Pe<yt;Pe++)Ce[$t++]=_t;$t+=Ai}if(di.encoding===1&&nt!==di.numValidPixels)throw"Block and Mask do not match";xe++}}}return{resultPixels:Ce,resultMask:be,minValue:Ue}},v=function(Y){return{fileIdentifierString:Y.fileIdentifierString,fileVersion:Y.fileVersion,imageType:Y.imageType,height:Y.height,width:Y.width,maxZError:Y.maxZError,eofOffset:Y.eofOffset,mask:Y.mask?{numBlocksX:Y.mask.numBlocksX,numBlocksY:Y.mask.numBlocksY,numBytes:Y.mask.numBytes,maxValue:Y.mask.maxValue}:null,pixels:{numBlocksX:Y.pixels.numBlocksX,numBlocksY:Y.pixels.numBlocksY,numBytes:Y.pixels.numBytes,maxValue:Y.pixels.maxValue,noDataValue:Y.noDataValue}}},x=function(Y){for(var z=Y.pixels.numBlocksX*Y.pixels.numBlocksY,ce={},ie=0;ie<z;ie++){var ae=Y.pixels.blocks[ie];ae.encoding===0?ce.float32=!0:ae.encoding===1?ce[ae.bitsPerPixel]=!0:ce[0]=!0}return Object.keys(ce)},Q=function(Y,z,ce){var ie={},ae=new Uint8Array(Y,z,10);if(ie.fileIdentifierString=String.fromCharCode.apply(null,ae),ie.fileIdentifierString.trim()!=="CntZImage")throw"Unexpected file identifier string: "+ie.fileIdentifierString;z+=10;var Ae=new DataView(Y,z,24);if(ie.fileVersion=Ae.getInt32(0,!0),ie.imageType=Ae.getInt32(4,!0),ie.height=Ae.getUint32(8,!0),ie.width=Ae.getUint32(12,!0),ie.maxZError=Ae.getFloat64(16,!0),z+=24,!ce)if(Ae=new DataView(Y,z,16),ie.mask={},ie.mask.numBlocksY=Ae.getUint32(0,!0),ie.mask.numBlocksX=Ae.getUint32(4,!0),ie.mask.numBytes=Ae.getUint32(8,!0),ie.mask.maxValue=Ae.getFloat32(12,!0),z+=16,ie.mask.numBytes>0){var Ce=new Uint8Array(Math.ceil(ie.width*ie.height/8)),be=(Ae=new DataView(Y,z,ie.mask.numBytes)).getInt16(0,!0),xe=2,ze=0;do{if(be>0)for(;be--;)Ce[ze++]=Ae.getUint8(xe++);else{var qe=Ae.getUint8(xe++);for(be=-be;be--;)Ce[ze++]=qe}be=Ae.getInt16(xe,!0),xe+=2}while(xe<ie.mask.numBytes);if(be!==-32768||ze<Ce.length)throw"Unexpected end of mask RLE encoding";ie.mask.bitset=Ce,z+=ie.mask.numBytes}else ie.mask.numBytes|ie.mask.numBlocksY|ie.mask.maxValue||(ie.mask.bitset=new Uint8Array(Math.ceil(ie.width*ie.height/8)));Ae=new DataView(Y,z,16),ie.pixels={},ie.pixels.numBlocksY=Ae.getUint32(0,!0),ie.pixels.numBlocksX=Ae.getUint32(4,!0),ie.pixels.numBytes=Ae.getUint32(8,!0),ie.pixels.maxValue=Ae.getFloat32(12,!0),z+=16;var Ve=ie.pixels.numBlocksX,Ke=ie.pixels.numBlocksY,ct=Ve+(ie.width%Ve>0?1:0),Ue=Ke+(ie.height%Ke>0?1:0);ie.pixels.blocks=new Array(ct*Ue);for(var Pe=0,Ye=0;Ye<Ue;Ye++)for(var vt=0;vt<ct;vt++){var ot=0,Ct=Y.byteLength-z;Ae=new DataView(Y,z,Math.min(10,Ct));var st={};ie.pixels.blocks[Pe++]=st;var yt=Ae.getUint8(0);if(ot++,st.encoding=63&yt,st.encoding>3)throw"Invalid block encoding ("+st.encoding+")";if(st.encoding!==2){if(yt!==0&&yt!==2){if(yt>>=6,st.offsetType=yt,yt===2)st.offset=Ae.getInt8(1),ot++;else if(yt===1)st.offset=Ae.getInt16(1,!0),ot+=2;else{if(yt!==0)throw"Invalid block offset type";st.offset=Ae.getFloat32(1,!0),ot+=4}if(st.encoding===1)if(yt=Ae.getUint8(ot),ot++,st.bitsPerPixel=63&yt,yt>>=6,st.numValidPixelsType=yt,yt===2)st.numValidPixels=Ae.getUint8(ot),ot++;else if(yt===1)st.numValidPixels=Ae.getUint16(ot,!0),ot+=2;else{if(yt!==0)throw"Invalid valid pixel count type";st.numValidPixels=Ae.getUint32(ot,!0),ot+=4}}var gt;if(z+=ot,st.encoding!==3){if(st.encoding===0){var nt=(ie.pixels.numBytes-1)/4;if(nt!==Math.floor(nt))throw"uncompressed block has invalid length";gt=new ArrayBuffer(4*nt),new Uint8Array(gt).set(new Uint8Array(Y,z,4*nt));var _t=new Float32Array(gt);st.rawData=_t,z+=4*nt}else if(st.encoding===1){var ci=Math.ceil(st.numValidPixels*st.bitsPerPixel/8),$t=Math.ceil(ci/4);gt=new ArrayBuffer(4*$t),new Uint8Array(gt).set(new Uint8Array(Y,z,ci)),st.stuffedData=new Uint32Array(gt),z+=ci}}}else z++}return ie.eofOffset=z,ie},T=function(Y,z,ce,ie,ae,Ae,Ce){var be,xe,ze,qe=(1<<z)-1,Ve=0,Ke=0,ct=Math.ceil((Ce-ie)/ae),Ue=4*Y.length-Math.ceil(z*ce/8);for(Y[Y.length-1]<<=8*Ue,be=0;be<ce;be++){if(Ke===0&&(ze=Y[Ve++],Ke=32),Ke>=z)xe=ze>>>Ke-z&qe,Ke-=z;else{var Pe=z-Ke;xe=(ze&qe)<<Pe&qe,xe+=(ze=Y[Ve++])>>>(Ke=32-Pe)}Ae[be]=xe<ct?ie+xe*ae:Ce}return Ae},g),Ie=(k=function(Y,z,ce,ie,ae,Ae,Ce,be){var xe,ze,qe,Ve,Ke,ct=(1<<ce)-1,Ue=0,Pe=0,Ye=4*Y.length-Math.ceil(ce*ie/8);if(Y[Y.length-1]<<=8*Ye,ae)for(xe=0;xe<ie;xe++)Pe===0&&(qe=Y[Ue++],Pe=32),Pe>=ce?(ze=qe>>>Pe-ce&ct,Pe-=ce):(ze=(qe&ct)<<(Ve=ce-Pe)&ct,ze+=(qe=Y[Ue++])>>>(Pe=32-Ve)),z[xe]=ae[ze];else for(Ke=Math.ceil((be-Ae)/Ce),xe=0;xe<ie;xe++)Pe===0&&(qe=Y[Ue++],Pe=32),Pe>=ce?(ze=qe>>>Pe-ce&ct,Pe-=ce):(ze=(qe&ct)<<(Ve=ce-Pe)&ct,ze+=(qe=Y[Ue++])>>>(Pe=32-Ve)),z[xe]=ze<Ke?Ae+ze*Ce:be},q=function(Y,z,ce,ie,ae,Ae){var Ce,be=(1<<z)-1,xe=0,ze=0,qe=0,Ve=0,Ke=0,ct=[],Ue=4*Y.length-Math.ceil(z*ce/8);Y[Y.length-1]<<=8*Ue;var Pe=Math.ceil((Ae-ie)/ae);for(ze=0;ze<ce;ze++)Ve===0&&(Ce=Y[xe++],Ve=32),Ve>=z?(Ke=Ce>>>Ve-z&be,Ve-=z):(Ke=(Ce&be)<<(qe=z-Ve)&be,Ke+=(Ce=Y[xe++])>>>(Ve=32-qe)),ct[ze]=Ke<Pe?ie+Ke*ae:Ae;return ct.unshift(ie),ct},G=function(Y,z,ce,ie,ae,Ae,Ce,be){var xe,ze,qe,Ve,Ke=(1<<ce)-1,ct=0,Ue=0,Pe=0;if(ae)for(xe=0;xe<ie;xe++)Ue===0&&(qe=Y[ct++],Ue=32,Pe=0),Ue>=ce?(ze=qe>>>Pe&Ke,Ue-=ce,Pe+=ce):(ze=qe>>>Pe&Ke,Ue=32-(Ve=ce-Ue),ze|=((qe=Y[ct++])&(1<<Ve)-1)<<ce-Ve,Pe=Ve),z[xe]=ae[ze];else{var Ye=Math.ceil((be-Ae)/Ce);for(xe=0;xe<ie;xe++)Ue===0&&(qe=Y[ct++],Ue=32,Pe=0),Ue>=ce?(ze=qe>>>Pe&Ke,Ue-=ce,Pe+=ce):(ze=qe>>>Pe&Ke,Ue=32-(Ve=ce-Ue),ze|=((qe=Y[ct++])&(1<<Ve)-1)<<ce-Ve,Pe=Ve),z[xe]=ze<Ye?Ae+ze*Ce:be}return z},O=function(Y,z,ce,ie,ae,Ae){var Ce,be=(1<<z)-1,xe=0,ze=0,qe=0,Ve=0,Ke=0,ct=0,Ue=[],Pe=Math.ceil((Ae-ie)/ae);for(ze=0;ze<ce;ze++)Ve===0&&(Ce=Y[xe++],Ve=32,ct=0),Ve>=z?(Ke=Ce>>>ct&be,Ve-=z,ct+=z):(Ke=Ce>>>ct&be,Ve=32-(qe=z-Ve),Ke|=((Ce=Y[xe++])&(1<<qe)-1)<<z-qe,ct=qe),Ue[ze]=Ke<Pe?ie+Ke*ae:Ae;return Ue.unshift(ie),Ue},re=function(Y,z,ce,ie){var ae,Ae,Ce,be,xe=(1<<ce)-1,ze=0,qe=0,Ve=4*Y.length-Math.ceil(ce*ie/8);for(Y[Y.length-1]<<=8*Ve,ae=0;ae<ie;ae++)qe===0&&(Ce=Y[ze++],qe=32),qe>=ce?(Ae=Ce>>>qe-ce&xe,qe-=ce):(Ae=(Ce&xe)<<(be=ce-qe)&xe,Ae+=(Ce=Y[ze++])>>>(qe=32-be)),z[ae]=Ae;return z},K=function(Y,z,ce,ie){var ae,Ae,Ce,be,xe=(1<<ce)-1,ze=0,qe=0,Ve=0;for(ae=0;ae<ie;ae++)qe===0&&(Ce=Y[ze++],qe=32,Ve=0),qe>=ce?(Ae=Ce>>>Ve&xe,qe-=ce,Ve+=ce):(Ae=Ce>>>Ve&xe,qe=32-(be=ce-qe),Ae|=((Ce=Y[ze++])&(1<<be)-1)<<ce-be,Ve=be),z[ae]=Ae;return z},U={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(Y){for(var z=65535,ce=65535,ie=Y.length,ae=Math.floor(ie/2),Ae=0;ae;){var Ce=ae>=359?359:ae;ae-=Ce;do z+=Y[Ae++]<<8,ce+=z+=Y[Ae++];while(--Ce);z=(65535&z)+(z>>>16),ce=(65535&ce)+(ce>>>16)}return 1&ie&&(ce+=z+=Y[Ae]<<8),((ce=(65535&ce)+(ce>>>16))<<16|(z=(65535&z)+(z>>>16)))>>>0},readHeaderInfo:function(Y,z){var ce=z.ptr,ie=new Uint8Array(Y,ce,6),ae={};if(ae.fileIdentifierString=String.fromCharCode.apply(null,ie),ae.fileIdentifierString.lastIndexOf("Lerc2",0)!==0)throw"Unexpected file identifier string (expect Lerc2 ): "+ae.fileIdentifierString;ce+=6;var Ae,Ce=new DataView(Y,ce,8),be=Ce.getInt32(0,!0);if(ae.fileVersion=be,ce+=4,be>=3&&(ae.checksum=Ce.getUint32(4,!0),ce+=4),Ce=new DataView(Y,ce,12),ae.height=Ce.getUint32(0,!0),ae.width=Ce.getUint32(4,!0),ce+=8,be>=4?(ae.numDims=Ce.getUint32(8,!0),ce+=4):ae.numDims=1,Ce=new DataView(Y,ce,40),ae.numValidPixel=Ce.getUint32(0,!0),ae.microBlockSize=Ce.getInt32(4,!0),ae.blobSize=Ce.getInt32(8,!0),ae.imageType=Ce.getInt32(12,!0),ae.maxZError=Ce.getFloat64(16,!0),ae.zMin=Ce.getFloat64(24,!0),ae.zMax=Ce.getFloat64(32,!0),ce+=40,z.headerInfo=ae,z.ptr=ce,be>=3&&(Ae=be>=4?52:48,this.computeChecksumFletcher32(new Uint8Array(Y,ce-Ae,ae.blobSize-14))!==ae.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(Y,z){var ce=z.headerInfo,ie=this.getDataTypeArray(ce.imageType),ae=ce.numDims*this.getDataTypeSize(ce.imageType),Ae=this.readSubArray(Y,z.ptr,ie,ae),Ce=this.readSubArray(Y,z.ptr+ae,ie,ae);z.ptr+=2*ae;var be,xe=!0;for(be=0;be<ce.numDims;be++)if(Ae[be]!==Ce[be]){xe=!1;break}return ce.minValues=Ae,ce.maxValues=Ce,xe},readSubArray:function(Y,z,ce,ie){var ae;if(ce===Uint8Array)ae=new Uint8Array(Y,z,ie);else{var Ae=new ArrayBuffer(ie);new Uint8Array(Ae).set(new Uint8Array(Y,z,ie)),ae=new ce(Ae)}return ae},readMask:function(Y,z){var ce,ie,ae=z.ptr,Ae=z.headerInfo,Ce=Ae.width*Ae.height,be=Ae.numValidPixel,xe=new DataView(Y,ae,4),ze={};if(ze.numBytes=xe.getUint32(0,!0),ae+=4,(be===0||Ce===be)&&ze.numBytes!==0)throw"invalid mask";if(be===0)ce=new Uint8Array(Math.ceil(Ce/8)),ze.bitset=ce,ie=new Uint8Array(Ce),z.pixels.resultMask=ie,ae+=ze.numBytes;else if(ze.numBytes>0){ce=new Uint8Array(Math.ceil(Ce/8));var qe=(xe=new DataView(Y,ae,ze.numBytes)).getInt16(0,!0),Ve=2,Ke=0,ct=0;do{if(qe>0)for(;qe--;)ce[Ke++]=xe.getUint8(Ve++);else for(ct=xe.getUint8(Ve++),qe=-qe;qe--;)ce[Ke++]=ct;qe=xe.getInt16(Ve,!0),Ve+=2}while(Ve<ze.numBytes);if(qe!==-32768||Ke<ce.length)throw"Unexpected end of mask RLE encoding";ie=new Uint8Array(Ce);var Ue=0,Pe=0;for(Pe=0;Pe<Ce;Pe++)7&Pe?(Ue=ce[Pe>>3],Ue<<=7&Pe):Ue=ce[Pe>>3],128&Ue&&(ie[Pe]=1);z.pixels.resultMask=ie,ze.bitset=ce,ae+=ze.numBytes}return z.ptr=ae,z.mask=ze,!0},readDataOneSweep:function(Y,z,ce,ie){var ae,Ae=z.ptr,Ce=z.headerInfo,be=Ce.numDims,xe=Ce.width*Ce.height,ze=Ce.imageType,qe=Ce.numValidPixel*U.getDataTypeSize(ze)*be,Ve=z.pixels.resultMask;if(ce===Uint8Array)ae=new Uint8Array(Y,Ae,qe);else{var Ke=new ArrayBuffer(qe);new Uint8Array(Ke).set(new Uint8Array(Y,Ae,qe)),ae=new ce(Ke)}if(ae.length===xe*be)z.pixels.resultPixels=ie?U.swapDimensionOrder(ae,xe,be,ce,!0):ae;else{z.pixels.resultPixels=new ce(xe*be);var ct=0,Ue=0,Pe=0,Ye=0;if(be>1){if(ie){for(Ue=0;Ue<xe;Ue++)if(Ve[Ue])for(Ye=Ue,Pe=0;Pe<be;Pe++,Ye+=xe)z.pixels.resultPixels[Ye]=ae[ct++]}else for(Ue=0;Ue<xe;Ue++)if(Ve[Ue])for(Ye=Ue*be,Pe=0;Pe<be;Pe++)z.pixels.resultPixels[Ye+Pe]=ae[ct++]}else for(Ue=0;Ue<xe;Ue++)Ve[Ue]&&(z.pixels.resultPixels[Ue]=ae[ct++])}return Ae+=qe,z.ptr=Ae,!0},readHuffmanTree:function(Y,z){var ce=this.HUFFMAN_LUT_BITS_MAX,ie=new DataView(Y,z.ptr,16);if(z.ptr+=16,ie.getInt32(0,!0)<2)throw"unsupported Huffman version";var ae=ie.getInt32(4,!0),Ae=ie.getInt32(8,!0),Ce=ie.getInt32(12,!0);if(Ae>=Ce)return!1;var be=new Uint32Array(Ce-Ae);U.decodeBits(Y,z,be);var xe,ze,qe,Ve,Ke=[];for(xe=Ae;xe<Ce;xe++)Ke[ze=xe-(xe<ae?0:ae)]={first:be[xe-Ae],second:null};var ct=Y.byteLength-z.ptr,Ue=Math.ceil(ct/4),Pe=new ArrayBuffer(4*Ue);new Uint8Array(Pe).set(new Uint8Array(Y,z.ptr,ct));var Ye,vt=new Uint32Array(Pe),ot=0,Ct=0;for(Ye=vt[0],xe=Ae;xe<Ce;xe++)(Ve=Ke[ze=xe-(xe<ae?0:ae)].first)>0&&(Ke[ze].second=Ye<<ot>>>32-Ve,32-ot>=Ve?(ot+=Ve)===32&&(ot=0,Ye=vt[++Ct]):(ot+=Ve-32,Ye=vt[++Ct],Ke[ze].second|=Ye>>>32-ot));var st=0,yt=0,gt=new ne;for(xe=0;xe<Ke.length;xe++)Ke[xe]!==void 0&&(st=Math.max(st,Ke[xe].first));yt=st>=ce?ce:st;var nt,_t,ci,$t,Ai,di=[];for(xe=Ae;xe<Ce;xe++)if((Ve=Ke[ze=xe-(xe<ae?0:ae)].first)>0)if(nt=[Ve,ze],Ve<=yt)for(_t=Ke[ze].second<<yt-Ve,ci=1<<yt-Ve,qe=0;qe<ci;qe++)di[_t|qe]=nt;else for(_t=Ke[ze].second,Ai=gt,$t=Ve-1;$t>=0;$t--)_t>>>$t&1?(Ai.right||(Ai.right=new ne),Ai=Ai.right):(Ai.left||(Ai.left=new ne),Ai=Ai.left),$t!==0||Ai.val||(Ai.val=nt[1]);return{decodeLut:di,numBitsLUTQick:yt,numBitsLUT:st,tree:gt,stuffedData:vt,srcPtr:Ct,bitPos:ot}},readHuffman:function(Y,z,ce,ie){var ae,Ae,Ce,be,xe,ze,qe,Ve,Ke,ct=z.headerInfo.numDims,Ue=z.headerInfo.height,Pe=z.headerInfo.width,Ye=Pe*Ue,vt=this.readHuffmanTree(Y,z),ot=vt.decodeLut,Ct=vt.tree,st=vt.stuffedData,yt=vt.srcPtr,gt=vt.bitPos,nt=vt.numBitsLUTQick,_t=vt.numBitsLUT,ci=z.headerInfo.imageType===0?128:0,$t=z.pixels.resultMask,Ai=0;gt>0&&(yt++,gt=0);var di,$r=st[yt],wr=z.encodeMode===1,Is=new ce(Ye*ct),jt=Is;if(ct<2||wr){for(di=0;di<ct;di++)if(ct>1&&(jt=new ce(Is.buffer,Ye*di,Ye),Ai=0),z.headerInfo.numValidPixel===Pe*Ue)for(Ve=0,ze=0;ze<Ue;ze++)for(qe=0;qe<Pe;qe++,Ve++){if(Ae=0,xe=be=$r<<gt>>>32-nt,32-gt<nt&&(xe=be|=st[yt+1]>>>64-gt-nt),ot[xe])Ae=ot[xe][1],gt+=ot[xe][0];else for(xe=be=$r<<gt>>>32-_t,32-gt<_t&&(xe=be|=st[yt+1]>>>64-gt-_t),ae=Ct,Ke=0;Ke<_t;Ke++)if(!(ae=be>>>_t-Ke-1&1?ae.right:ae.left).left&&!ae.right){Ae=ae.val,gt=gt+Ke+1;break}gt>=32&&(gt-=32,$r=st[++yt]),Ce=Ae-ci,wr?(Ce+=qe>0?Ai:ze>0?jt[Ve-Pe]:Ai,Ce&=255,jt[Ve]=Ce,Ai=Ce):jt[Ve]=Ce}else for(Ve=0,ze=0;ze<Ue;ze++)for(qe=0;qe<Pe;qe++,Ve++)if($t[Ve]){if(Ae=0,xe=be=$r<<gt>>>32-nt,32-gt<nt&&(xe=be|=st[yt+1]>>>64-gt-nt),ot[xe])Ae=ot[xe][1],gt+=ot[xe][0];else for(xe=be=$r<<gt>>>32-_t,32-gt<_t&&(xe=be|=st[yt+1]>>>64-gt-_t),ae=Ct,Ke=0;Ke<_t;Ke++)if(!(ae=be>>>_t-Ke-1&1?ae.right:ae.left).left&&!ae.right){Ae=ae.val,gt=gt+Ke+1;break}gt>=32&&(gt-=32,$r=st[++yt]),Ce=Ae-ci,wr?(qe>0&&$t[Ve-1]?Ce+=Ai:ze>0&&$t[Ve-Pe]?Ce+=jt[Ve-Pe]:Ce+=Ai,Ce&=255,jt[Ve]=Ce,Ai=Ce):jt[Ve]=Ce}}else for(Ve=0,ze=0;ze<Ue;ze++)for(qe=0;qe<Pe;qe++)if(Ve=ze*Pe+qe,!$t||$t[Ve])for(di=0;di<ct;di++,Ve+=Ye){if(Ae=0,xe=be=$r<<gt>>>32-nt,32-gt<nt&&(xe=be|=st[yt+1]>>>64-gt-nt),ot[xe])Ae=ot[xe][1],gt+=ot[xe][0];else for(xe=be=$r<<gt>>>32-_t,32-gt<_t&&(xe=be|=st[yt+1]>>>64-gt-_t),ae=Ct,Ke=0;Ke<_t;Ke++)if(!(ae=be>>>_t-Ke-1&1?ae.right:ae.left).left&&!ae.right){Ae=ae.val,gt=gt+Ke+1;break}gt>=32&&(gt-=32,$r=st[++yt]),Ce=Ae-ci,jt[Ve]=Ce}z.ptr=z.ptr+4*(yt+1)+(gt>0?4:0),z.pixels.resultPixels=Is,ct>1&&!ie&&(z.pixels.resultPixels=U.swapDimensionOrder(Is,Ye,ct,ce))},decodeBits:function(Y,z,ce,ie,ae){var Ae=z.headerInfo,Ce=Ae.fileVersion,be=0,xe=Y.byteLength-z.ptr>=5?5:Y.byteLength-z.ptr,ze=new DataView(Y,z.ptr,xe),qe=ze.getUint8(0);be++;var Ve=qe>>6,Ke=Ve===0?4:3-Ve,ct=(32&qe)>0,Ue=31&qe,Pe=0;if(Ke===1)Pe=ze.getUint8(be),be++;else if(Ke===2)Pe=ze.getUint16(be,!0),be+=2;else{if(Ke!==4)throw"Invalid valid pixel count type";Pe=ze.getUint32(be,!0),be+=4}var Ye,vt,ot,Ct,st,yt,gt,nt,_t,ci=2*Ae.maxZError,$t=Ae.numDims>1?Ae.maxValues[ae]:Ae.zMax;if(ct){for(z.counter.lut++,nt=ze.getUint8(be),be++,Ct=Math.ceil((nt-1)*Ue/8),st=Math.ceil(Ct/4),vt=new ArrayBuffer(4*st),ot=new Uint8Array(vt),z.ptr+=be,ot.set(new Uint8Array(Y,z.ptr,Ct)),gt=new Uint32Array(vt),z.ptr+=Ct,_t=0;nt-1>>>_t;)_t++;Ct=Math.ceil(Pe*_t/8),st=Math.ceil(Ct/4),vt=new ArrayBuffer(4*st),(ot=new Uint8Array(vt)).set(new Uint8Array(Y,z.ptr,Ct)),Ye=new Uint32Array(vt),z.ptr+=Ct,yt=Ce>=3?O(gt,Ue,nt-1,ie,ci,$t):q(gt,Ue,nt-1,ie,ci,$t),Ce>=3?G(Ye,ce,_t,Pe,yt):k(Ye,ce,_t,Pe,yt)}else z.counter.bitstuffer++,_t=Ue,z.ptr+=be,_t>0&&(Ct=Math.ceil(Pe*_t/8),st=Math.ceil(Ct/4),vt=new ArrayBuffer(4*st),(ot=new Uint8Array(vt)).set(new Uint8Array(Y,z.ptr,Ct)),Ye=new Uint32Array(vt),z.ptr+=Ct,Ce>=3?ie==null?K(Ye,ce,_t,Pe):G(Ye,ce,_t,Pe,!1,ie,ci,$t):ie==null?re(Ye,ce,_t,Pe):k(Ye,ce,_t,Pe,!1,ie,ci,$t))},readTiles:function(Y,z,ce,ie){var ae=z.headerInfo,Ae=ae.width,Ce=ae.height,be=Ae*Ce,xe=ae.microBlockSize,ze=ae.imageType,qe=U.getDataTypeSize(ze),Ve=Math.ceil(Ae/xe),Ke=Math.ceil(Ce/xe);z.pixels.numBlocksY=Ke,z.pixels.numBlocksX=Ve,z.pixels.ptr=0;var ct,Ue,Pe,Ye,vt,ot,Ct,st,yt,gt,nt=0,_t=0,ci=0,$t=0,Ai=0,di=0,$r=0,wr=0,Is=0,jt=0,Xr=0,vn=0,Wa=0,Wn=0,fr=0,Ea=new ce(xe*xe),qc=Ce%xe||xe,Vc=Ae%xe||xe,Zl=ae.numDims,zn=z.pixels.resultMask,Fr=z.pixels.resultPixels,eo=ae.fileVersion>=5?14:15,es=ae.zMax;for(ci=0;ci<Ke;ci++)for(Ai=ci!==Ke-1?xe:qc,$t=0;$t<Ve;$t++)for(jt=ci*Ae*xe+$t*xe,Xr=Ae-(di=$t!==Ve-1?xe:Vc),st=0;st<Zl;st++){if(Zl>1?(gt=Fr,jt=ci*Ae*xe+$t*xe,Fr=new ce(z.pixels.resultPixels.buffer,be*st*qe,be),es=ae.maxValues[st]):gt=null,$r=Y.byteLength-z.ptr,Ue={},fr=0,wr=(ct=new DataView(Y,z.ptr,Math.min(10,$r))).getUint8(0),fr++,yt=ae.fileVersion>=5?4&wr:0,Is=wr>>6&255,(wr>>2&eo)!=($t*xe>>3&eo)||yt&&st===0)throw"integrity issue";if((vt=3&wr)>3)throw z.ptr+=fr,"Invalid block encoding ("+vt+")";if(vt!==2)if(vt===0){if(yt)throw"integrity issue";if(z.counter.uncompressed++,z.ptr+=fr,vn=(vn=Ai*di*qe)<(Wa=Y.byteLength-z.ptr)?vn:Wa,Pe=new ArrayBuffer(vn%qe==0?vn:vn+qe-vn%qe),new Uint8Array(Pe).set(new Uint8Array(Y,z.ptr,vn)),Ye=new ce(Pe),Wn=0,zn)for(nt=0;nt<Ai;nt++){for(_t=0;_t<di;_t++)zn[jt]&&(Fr[jt]=Ye[Wn++]),jt++;jt+=Xr}else for(nt=0;nt<Ai;nt++){for(_t=0;_t<di;_t++)Fr[jt++]=Ye[Wn++];jt+=Xr}z.ptr+=Wn*qe}else if(ot=U.getDataTypeUsed(yt&&ze<6?4:ze,Is),Ct=U.getOnePixel(Ue,fr,ot,ct),fr+=U.getDataTypeSize(ot),vt===3)if(z.ptr+=fr,z.counter.constantoffset++,zn)for(nt=0;nt<Ai;nt++){for(_t=0;_t<di;_t++)zn[jt]&&(Fr[jt]=yt?Math.min(es,gt[jt]+Ct):Ct),jt++;jt+=Xr}else for(nt=0;nt<Ai;nt++){for(_t=0;_t<di;_t++)Fr[jt]=yt?Math.min(es,gt[jt]+Ct):Ct,jt++;jt+=Xr}else if(z.ptr+=fr,U.decodeBits(Y,z,Ea,Ct,st),fr=0,yt)if(zn)for(nt=0;nt<Ai;nt++){for(_t=0;_t<di;_t++)zn[jt]&&(Fr[jt]=Ea[fr++]+gt[jt]),jt++;jt+=Xr}else for(nt=0;nt<Ai;nt++){for(_t=0;_t<di;_t++)Fr[jt]=Ea[fr++]+gt[jt],jt++;jt+=Xr}else if(zn)for(nt=0;nt<Ai;nt++){for(_t=0;_t<di;_t++)zn[jt]&&(Fr[jt]=Ea[fr++]),jt++;jt+=Xr}else for(nt=0;nt<Ai;nt++){for(_t=0;_t<di;_t++)Fr[jt++]=Ea[fr++];jt+=Xr}else{if(yt)if(zn)for(nt=0;nt<Ai;nt++)for(_t=0;_t<di;_t++)zn[jt]&&(Fr[jt]=gt[jt]),jt++;else for(nt=0;nt<Ai;nt++)for(_t=0;_t<di;_t++)Fr[jt]=gt[jt],jt++;z.counter.constant++,z.ptr+=fr}}Zl>1&&!ie&&(z.pixels.resultPixels=U.swapDimensionOrder(z.pixels.resultPixels,be,Zl,ce))},formatFileInfo:function(Y){return{fileIdentifierString:Y.headerInfo.fileIdentifierString,fileVersion:Y.headerInfo.fileVersion,imageType:Y.headerInfo.imageType,height:Y.headerInfo.height,width:Y.headerInfo.width,numValidPixel:Y.headerInfo.numValidPixel,microBlockSize:Y.headerInfo.microBlockSize,blobSize:Y.headerInfo.blobSize,maxZError:Y.headerInfo.maxZError,pixelType:U.getPixelType(Y.headerInfo.imageType),eofOffset:Y.eofOffset,mask:Y.mask?{numBytes:Y.mask.numBytes}:null,pixels:{numBlocksX:Y.pixels.numBlocksX,numBlocksY:Y.pixels.numBlocksY,maxValue:Y.headerInfo.zMax,minValue:Y.headerInfo.zMin,noDataValue:Y.noDataValue}}},constructConstantSurface:function(Y,z){var ce=Y.headerInfo.zMax,ie=Y.headerInfo.zMin,ae=Y.headerInfo.maxValues,Ae=Y.headerInfo.numDims,Ce=Y.headerInfo.height*Y.headerInfo.width,be=0,xe=0,ze=0,qe=Y.pixels.resultMask,Ve=Y.pixels.resultPixels;if(qe)if(Ae>1){if(z)for(be=0;be<Ae;be++)for(ze=be*Ce,ce=ae[be],xe=0;xe<Ce;xe++)qe[xe]&&(Ve[ze+xe]=ce);else for(xe=0;xe<Ce;xe++)if(qe[xe])for(ze=xe*Ae,be=0;be<Ae;be++)Ve[ze+Ae]=ae[be]}else for(xe=0;xe<Ce;xe++)qe[xe]&&(Ve[xe]=ce);else if(Ae>1&&ie!==ce)if(z)for(be=0;be<Ae;be++)for(ze=be*Ce,ce=ae[be],xe=0;xe<Ce;xe++)Ve[ze+xe]=ce;else for(xe=0;xe<Ce;xe++)for(ze=xe*Ae,be=0;be<Ae;be++)Ve[ze+be]=ae[be];else for(xe=0;xe<Ce*Ae;xe++)Ve[xe]=ce},getDataTypeArray:function(Y){var z;switch(Y){case 0:z=Int8Array;break;case 1:z=Uint8Array;break;case 2:z=Int16Array;break;case 3:z=Uint16Array;break;case 4:z=Int32Array;break;case 5:z=Uint32Array;break;case 6:default:z=Float32Array;break;case 7:z=Float64Array}return z},getPixelType:function(Y){var z;switch(Y){case 0:z="S8";break;case 1:z="U8";break;case 2:z="S16";break;case 3:z="U16";break;case 4:z="S32";break;case 5:z="U32";break;case 6:default:z="F32";break;case 7:z="F64"}return z},isValidPixelValue:function(Y,z){if(z==null)return!1;var ce;switch(Y){case 0:ce=z>=-128&&z<=127;break;case 1:ce=z>=0&&z<=255;break;case 2:ce=z>=-32768&&z<=32767;break;case 3:ce=z>=0&&z<=65536;break;case 4:ce=z>=-2147483648&&z<=2147483647;break;case 5:ce=z>=0&&z<=4294967296;break;case 6:ce=z>=-34027999387901484e22&&z<=34027999387901484e22;break;case 7:ce=z>=-17976931348623157e292&&z<=17976931348623157e292;break;default:ce=!1}return ce},getDataTypeSize:function(Y){var z=0;switch(Y){case 0:case 1:z=1;break;case 2:case 3:z=2;break;case 4:case 5:case 6:z=4;break;case 7:z=8;break;default:z=Y}return z},getDataTypeUsed:function(Y,z){var ce=Y;switch(Y){case 2:case 4:ce=Y-z;break;case 3:case 5:ce=Y-2*z;break;case 6:ce=z===0?Y:z===1?2:1;break;case 7:ce=z===0?Y:Y-2*z+1;break;default:ce=Y}return ce},getOnePixel:function(Y,z,ce,ie){var ae=0;switch(ce){case 0:ae=ie.getInt8(z);break;case 1:ae=ie.getUint8(z);break;case 2:ae=ie.getInt16(z,!0);break;case 3:ae=ie.getUint16(z,!0);break;case 4:ae=ie.getInt32(z,!0);break;case 5:ae=ie.getUInt32(z,!0);break;case 6:ae=ie.getFloat32(z,!0);break;case 7:ae=ie.getFloat64(z,!0);break;default:throw"the decoder does not understand this pixel type"}return ae},swapDimensionOrder:function(Y,z,ce,ie,ae){var Ae=0,Ce=0,be=0,xe=0,ze=Y;if(ce>1)if(ze=new ie(z*ce),ae)for(Ae=0;Ae<z;Ae++)for(xe=Ae,be=0;be<ce;be++,xe+=z)ze[xe]=Y[Ce++];else for(Ae=0;Ae<z;Ae++)for(xe=Ae,be=0;be<ce;be++,xe+=z)ze[Ce++]=Y[xe];return ze}},ne=function(Y,z,ce){this.val=Y,this.left=z,this.right=ce},{decode:function(Y,z){var ce=(z=z||{}).noDataValue,ie=0,ae={};if(ae.ptr=z.inputOffset||0,ae.pixels={},U.readHeaderInfo(Y,ae)){var Ae=ae.headerInfo,Ce=Ae.fileVersion,be=U.getDataTypeArray(Ae.imageType);if(Ce>5)throw"unsupported lerc version 2."+Ce;U.readMask(Y,ae),Ae.numValidPixel===Ae.width*Ae.height||ae.pixels.resultMask||(ae.pixels.resultMask=z.maskData);var xe=Ae.width*Ae.height;ae.pixels.resultPixels=new be(xe*Ae.numDims),ae.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};var ze,qe=!z.returnPixelInterleavedDims;if(Ae.numValidPixel!==0)if(Ae.zMax===Ae.zMin)U.constructConstantSurface(ae,qe);else if(Ce>=4&&U.checkMinMaxRanges(Y,ae))U.constructConstantSurface(ae,qe);else{var Ve=new DataView(Y,ae.ptr,2),Ke=Ve.getUint8(0);if(ae.ptr++,Ke)U.readDataOneSweep(Y,ae,be,qe);else if(Ce>1&&Ae.imageType<=1&&Math.abs(Ae.maxZError-.5)<1e-5){var ct=Ve.getUint8(1);if(ae.ptr++,ae.encodeMode=ct,ct>2||Ce<4&&ct>1)throw"Invalid Huffman flag "+ct;ct?U.readHuffman(Y,ae,be,qe):U.readTiles(Y,ae,be,qe)}else U.readTiles(Y,ae,be,qe)}ae.eofOffset=ae.ptr,z.inputOffset?(ze=ae.headerInfo.blobSize+z.inputOffset-ae.ptr,Math.abs(ze)>=1&&(ae.eofOffset=z.inputOffset+ae.headerInfo.blobSize)):(ze=ae.headerInfo.blobSize-ae.ptr,Math.abs(ze)>=1&&(ae.eofOffset=ae.headerInfo.blobSize));var Ue={width:Ae.width,height:Ae.height,pixelData:ae.pixels.resultPixels,minValue:Ae.zMin,maxValue:Ae.zMax,validPixelCount:Ae.numValidPixel,dimCount:Ae.numDims,dimStats:{minValues:Ae.minValues,maxValues:Ae.maxValues},maskData:ae.pixels.resultMask};if(ae.pixels.resultMask&&U.isValidPixelValue(Ae.imageType,ce)){var Pe=ae.pixels.resultMask;for(ie=0;ie<xe;ie++)Pe[ie]||(Ue.pixelData[ie]=ce);Ue.noDataValue=ce}return ae.noDataValue=ce,z.returnFileInfo&&(Ue.fileInfo=U.formatFileInfo(ae)),Ue}},getBandCount:function(Y){for(var z=0,ce=0,ie={ptr:0,pixels:{}};ce<Y.byteLength-58;)U.readHeaderInfo(Y,ie),ce+=ie.headerInfo.blobSize,z++,ie.ptr=ce;return z}}),pe=(le=new ArrayBuffer(4),se=new Uint8Array(le),new Uint32Array(le)[0]=1,se[0]===1),Be={decode:function(Y,z){if(!pe)throw"Big endian system is not supported.";var ce,ie,ae=(z=z||{}).inputOffset||0,Ae=new Uint8Array(Y,ae,10),Ce=String.fromCharCode.apply(null,Ae);if(Ce.trim()==="CntZImage")ce=ue,ie=1;else{if(Ce.substring(0,5)!=="Lerc2")throw"Unexpected file identifier string: "+Ce;ce=Ie,ie=2}for(var be,xe,ze,qe,Ve,Ke,ct=0,Ue=Y.byteLength-10,Pe=[],Ye={width:0,height:0,pixels:[],pixelType:z.pixelType,mask:null,statistics:[]},vt=0;ae<Ue;){var ot=ce.decode(Y,{inputOffset:ae,encodedMaskData:be,maskData:ze,returnMask:ct===0,returnEncodedMask:ct===0,returnFileInfo:!0,returnPixelInterleavedDims:z.returnPixelInterleavedDims,pixelType:z.pixelType||null,noDataValue:z.noDataValue||null});ae=ot.fileInfo.eofOffset,ze=ot.maskData,ct===0&&(be=ot.encodedMaskData,Ye.width=ot.width,Ye.height=ot.height,Ye.dimCount=ot.dimCount||1,Ye.pixelType=ot.pixelType||ot.fileInfo.pixelType,Ye.mask=ze),ie>1&&(ze&&Pe.push(ze),ot.fileInfo.mask&&ot.fileInfo.mask.numBytes>0&&vt++),ct++,Ye.pixels.push(ot.pixelData),Ye.statistics.push({minValue:ot.minValue,maxValue:ot.maxValue,noDataValue:ot.noDataValue,dimStats:ot.dimStats})}if(ie>1&&vt>1){for(Ke=Ye.width*Ye.height,Ye.bandMasks=Pe,(ze=new Uint8Array(Ke)).set(Pe[0]),qe=1;qe<Pe.length;qe++)for(xe=Pe[qe],Ve=0;Ve<Ke;Ve++)ze[Ve]=ze[Ve]&xe[Ve];Ye.maskData=ze}return Ye}};p.exports?p.exports=Be:this.Lerc=Be})()})(a);var o=yr(a.exports);let h,_,w;const B={env:{emscripten_notify_memory_growth:function(p){w=new Uint8Array(_.exports.memory.buffer)}}},M="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",L=new class{init(){return h||(h=typeof fetch<"u"?fetch("data:application/wasm;base64,"+M).then(p=>p.arrayBuffer()).then(p=>WebAssembly.instantiate(p,B)).then(this._init):WebAssembly.instantiate(Buffer.from(M,"base64"),B).then(this._init),h)}_init(p){_=p.instance,B.env.emscripten_notify_memory_growth(0)}decode(p,g=0){if(!_)throw new Error("ZSTDDecoder: Await .init() before decoding.");const A=p.byteLength,v=_.exports.malloc(A);w.set(p,v),g=g||Number(_.exports.ZSTD_findDecompressedSize(v,A));const x=_.exports.malloc(g),Q=_.exports.ZSTD_decompress(x,g,v,A),T=w.slice(x,x+Q);return _.exports.free(v),_.exports.free(x),T}};var F=Object.freeze({__proto__:null,default:class extends Dn{constructor(p){super(),this.planarConfiguration=p.PlanarConfiguration!==void 0?p.PlanarConfiguration:1,this.samplesPerPixel=p.SamplesPerPixel!==void 0?p.SamplesPerPixel:1,this.addCompression=p.LercParameters[H]}decodeBlock(p){switch(this.addCompression){case ee:break;case de:p=u(new Uint8Array(p)).buffer;break;case we:p=L.decode(new Uint8Array(p)).buffer;break;default:throw new Error(`Unsupported LERC additional compression method identifier: ${this.addCompression}`)}return o.decode(p,{returnPixelInterleavedDims:this.planarConfiguration===1}).pixels[0].buffer}},zstd:L}),$=Object.freeze({__proto__:null,default:class extends Dn{constructor(){if(super(),typeof createImageBitmap>"u")throw new Error("Cannot decode WebImage as `createImageBitmap` is not available");if(typeof document>"u"&&typeof OffscreenCanvas>"u")throw new Error("Cannot decode WebImage as neither `document` nor `OffscreenCanvas` is not available")}async decode(p,g){const A=new Blob([g]),v=await createImageBitmap(A);let x;typeof document<"u"?(x=document.createElement("canvas"),x.width=v.width,x.height=v.height):x=new OffscreenCanvas(v.width,v.height);const Q=x.getContext("2d");return Q.drawImage(v,0,0),Q.getImageData(0,0,v.width,v.height).data.buffer}}}),te=Worker,oe=Object.freeze({__proto__:null,create:function(){const p='function A(A,e,t,i,r,I,g){try{var n=A[I](g),a=n.value}catch(A){return void t(A)}n.done?e(a):Promise.resolve(a).then(i,r)}function e(e){return function(){var t=this,i=arguments;return new Promise((function(r,I){var g=e.apply(t,i);function n(e){A(g,r,I,n,a,"next",e)}function a(e){A(g,r,I,n,a,"throw",e)}n(void 0)}))}}function t(A){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(A){return typeof A}:function(A){return A&&"function"==typeof Symbol&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},t(A)}var i={exports:{}};!function(A){var e=function(A){var e,i=Object.prototype,r=i.hasOwnProperty,I="function"==typeof Symbol?Symbol:{},g=I.iterator||"@@iterator",n=I.asyncIterator||"@@asyncIterator",a=I.toStringTag||"@@toStringTag";function o(A,e,t){return Object.defineProperty(A,e,{value:t,enumerable:!0,configurable:!0,writable:!0}),A[e]}try{o({},"")}catch(A){o=function(A,e,t){return A[e]=t}}function B(A,e,t,i){var r=e&&e.prototype instanceof h?e:h,I=Object.create(r.prototype),g=new S(i||[]);return I._invoke=function(A,e,t){var i=Q;return function(r,I){if(i===s)throw new Error("Generator is already running");if(i===f){if("throw"===r)throw I;return R()}for(t.method=r,t.arg=I;;){var g=t.delegate;if(g){var n=m(g,t);if(n){if(n===c)continue;return n}}if("next"===t.method)t.sent=t._sent=t.arg;else if("throw"===t.method){if(i===Q)throw i=f,t.arg;t.dispatchException(t.arg)}else"return"===t.method&&t.abrupt("return",t.arg);i=s;var a=C(A,e,t);if("normal"===a.type){if(i=t.done?f:E,a.arg===c)continue;return{value:a.arg,done:t.done}}"throw"===a.type&&(i=f,t.method="throw",t.arg=a.arg)}}}(A,t,g),I}function C(A,e,t){try{return{type:"normal",arg:A.call(e,t)}}catch(A){return{type:"throw",arg:A}}}A.wrap=B;var Q="suspendedStart",E="suspendedYield",s="executing",f="completed",c={};function h(){}function l(){}function u(){}var w={};o(w,g,(function(){return this}));var d=Object.getPrototypeOf,D=d&&d(d(v([])));D&&D!==i&&r.call(D,g)&&(w=D);var y=u.prototype=h.prototype=Object.create(w);function k(A){["next","throw","return"].forEach((function(e){o(A,e,(function(A){return this._invoke(e,A)}))}))}function p(A,e){function i(I,g,n,a){var o=C(A[I],A,g);if("throw"!==o.type){var B=o.arg,Q=B.value;return Q&&"object"===t(Q)&&r.call(Q,"__await")?e.resolve(Q.__await).then((function(A){i("next",A,n,a)}),(function(A){i("throw",A,n,a)})):e.resolve(Q).then((function(A){B.value=A,n(B)}),(function(A){return i("throw",A,n,a)}))}a(o.arg)}var I;this._invoke=function(A,t){function r(){return new e((function(e,r){i(A,t,e,r)}))}return I=I?I.then(r,r):r()}}function m(A,t){var i=A.iterator[t.method];if(i===e){if(t.delegate=null,"throw"===t.method){if(A.iterator.return&&(t.method="return",t.arg=e,m(A,t),"throw"===t.method))return c;t.method="throw",t.arg=new TypeError("The iterator does not provide a \'throw\' method")}return c}var r=C(i,A.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,c;var I=r.arg;return I?I.done?(t[A.resultName]=I.value,t.next=A.nextLoc,"return"!==t.method&&(t.method="next",t.arg=e),t.delegate=null,c):I:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,c)}function G(A){var e={tryLoc:A[0]};1 in A&&(e.catchLoc=A[1]),2 in A&&(e.finallyLoc=A[2],e.afterLoc=A[3]),this.tryEntries.push(e)}function F(A){var e=A.completion||{};e.type="normal",delete e.arg,A.completion=e}function S(A){this.tryEntries=[{tryLoc:"root"}],A.forEach(G,this),this.reset(!0)}function v(A){if(A){var t=A[g];if(t)return t.call(A);if("function"==typeof A.next)return A;if(!isNaN(A.length)){var i=-1,I=function t(){for(;++i<A.length;)if(r.call(A,i))return t.value=A[i],t.done=!1,t;return t.value=e,t.done=!0,t};return I.next=I}}return{next:R}}function R(){return{value:e,done:!0}}return l.prototype=u,o(y,"constructor",u),o(u,"constructor",l),l.displayName=o(u,a,"GeneratorFunction"),A.isGeneratorFunction=function(A){var e="function"==typeof A&&A.constructor;return!!e&&(e===l||"GeneratorFunction"===(e.displayName||e.name))},A.mark=function(A){return Object.setPrototypeOf?Object.setPrototypeOf(A,u):(A.__proto__=u,o(A,a,"GeneratorFunction")),A.prototype=Object.create(y),A},A.awrap=function(A){return{__await:A}},k(p.prototype),o(p.prototype,n,(function(){return this})),A.AsyncIterator=p,A.async=function(e,t,i,r,I){void 0===I&&(I=Promise);var g=new p(B(e,t,i,r),I);return A.isGeneratorFunction(t)?g:g.next().then((function(A){return A.done?A.value:g.next()}))},k(y),o(y,a,"Generator"),o(y,g,(function(){return this})),o(y,"toString",(function(){return"[object Generator]"})),A.keys=function(A){var e=[];for(var t in A)e.push(t);return e.reverse(),function t(){for(;e.length;){var i=e.pop();if(i in A)return t.value=i,t.done=!1,t}return t.done=!0,t}},A.values=v,S.prototype={constructor:S,reset:function(A){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(F),!A)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=e)},stop:function(){this.done=!0;var A=this.tryEntries[0].completion;if("throw"===A.type)throw A.arg;return this.rval},dispatchException:function(A){if(this.done)throw A;var t=this;function i(i,r){return n.type="throw",n.arg=A,t.next=i,r&&(t.method="next",t.arg=e),!!r}for(var I=this.tryEntries.length-1;I>=0;--I){var g=this.tryEntries[I],n=g.completion;if("root"===g.tryLoc)return i("end");if(g.tryLoc<=this.prev){var a=r.call(g,"catchLoc"),o=r.call(g,"finallyLoc");if(a&&o){if(this.prev<g.catchLoc)return i(g.catchLoc,!0);if(this.prev<g.finallyLoc)return i(g.finallyLoc)}else if(a){if(this.prev<g.catchLoc)return i(g.catchLoc,!0)}else{if(!o)throw new Error("try statement without catch or finally");if(this.prev<g.finallyLoc)return i(g.finallyLoc)}}}},abrupt:function(A,e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var I=i;break}}I&&("break"===A||"continue"===A)&&I.tryLoc<=e&&e<=I.finallyLoc&&(I=null);var g=I?I.completion:{};return g.type=A,g.arg=e,I?(this.method="next",this.next=I.finallyLoc,c):this.complete(g)},complete:function(A,e){if("throw"===A.type)throw A.arg;return"break"===A.type||"continue"===A.type?this.next=A.arg:"return"===A.type?(this.rval=this.arg=A.arg,this.method="return",this.next="end"):"normal"===A.type&&e&&(this.next=e),c},finish:function(A){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.finallyLoc===A)return this.complete(t.completion,t.afterLoc),F(t),c}},catch:function(A){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.tryLoc===A){var i=t.completion;if("throw"===i.type){var r=i.arg;F(t)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(A,t,i){return this.delegate={iterator:v(A),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=e),c}},A}(A.exports);try{regeneratorRuntime=e}catch(A){"object"===("undefined"==typeof globalThis?"undefined":t(globalThis))?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}(i);var r=i.exports,I=new Map;function g(A,e){Array.isArray(A)||(A=[A]),A.forEach((function(A){return I.set(A,e)}))}function n(A){return a.apply(this,arguments)}function a(){return(a=e(r.mark((function A(e){var t,i;return r.wrap((function(A){for(;;)switch(A.prev=A.next){case 0:if(t=I.get(e.Compression)){A.next=3;break}throw new Error("Unknown compression method identifier: ".concat(e.Compression));case 3:return A.next=5,t();case 5:return i=A.sent,A.abrupt("return",new i(e));case 7:case"end":return A.stop()}}),A)})))).apply(this,arguments)}g([void 0,1],(function(){return Promise.resolve().then((function(){return y})).then((function(A){return A.default}))})),g(5,(function(){return Promise.resolve().then((function(){return F})).then((function(A){return A.default}))})),g(6,(function(){throw new Error("old style JPEG compression is not supported.")})),g(7,(function(){return Promise.resolve().then((function(){return N})).then((function(A){return A.default}))})),g([8,32946],(function(){return Promise.resolve().then((function(){return OA})).then((function(A){return A.default}))})),g(32773,(function(){return Promise.resolve().then((function(){return _A})).then((function(A){return A.default}))})),g(34887,(function(){return Promise.resolve().then((function(){return le})).then(function(){var A=e(r.mark((function A(e){return r.wrap((function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,e.zstd.init();case 2:return A.abrupt("return",e);case 3:case"end":return A.stop()}}),A)})));return function(e){return A.apply(this,arguments)}}()).then((function(A){return A.default}))})),g(50001,(function(){return Promise.resolve().then((function(){return de})).then((function(A){return A.default}))}));var o=globalThis;function B(A,e){if(!(A instanceof e))throw new TypeError("Cannot call a class as a function")}function C(A,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(A,i.key,i)}}function Q(A,e,t){return e&&C(A.prototype,e),t&&C(A,t),A}function E(A,e){return E=Object.setPrototypeOf||function(A,e){return A.__proto__=e,A},E(A,e)}function s(A,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");A.prototype=Object.create(e&&e.prototype,{constructor:{value:A,writable:!0,configurable:!0}}),e&&E(A,e)}function f(A,e){if(e&&("object"===t(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(A){if(void 0===A)throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");return A}(A)}function c(A){return c=Object.setPrototypeOf?Object.getPrototypeOf:function(A){return A.__proto__||Object.getPrototypeOf(A)},c(A)}function h(A,e){var t=A.length-e,i=0;do{for(var r=e;r>0;r--)A[i+e]+=A[i],i++;t-=e}while(t>0)}function l(A,e,t){for(var i=0,r=A.length,I=r/t;r>e;){for(var g=e;g>0;--g)A[i+e]+=A[i],++i;r-=e}for(var n=A.slice(),a=0;a<I;++a)for(var o=0;o<t;++o)A[t*a+o]=n[(t-o-1)*I+a]}function u(A,e,t,i,r,I){if(!e||1===e)return A;for(var g=0;g<r.length;++g){if(r[g]%8!=0)throw new Error("When decoding with predictor, only multiple of 8 bits are supported.");if(r[g]!==r[0])throw new Error("When decoding with predictor, all samples must have the same size.")}for(var n=r[0]/8,a=2===I?1:r.length,o=0;o<i&&!(o*a*t*n>=A.byteLength);++o){var B=void 0;if(2===e){switch(r[0]){case 8:B=new Uint8Array(A,o*a*t*n,a*t*n);break;case 16:B=new Uint16Array(A,o*a*t*n,a*t*n/2);break;case 32:B=new Uint32Array(A,o*a*t*n,a*t*n/4);break;default:throw new Error("Predictor 2 not allowed with ".concat(r[0]," bits per sample."))}h(B,a)}else 3===e&&l(B=new Uint8Array(A,o*a*t*n,a*t*n),a,n)}return A}o.addEventListener("message",function(){var A=e(r.mark((function A(e){var t,i,I,g,a,B;return r.wrap((function(A){for(;;)switch(A.prev=A.next){case 0:return t=e.data,i=t.id,I=t.fileDirectory,g=t.buffer,A.next=3,n(I);case 3:return a=A.sent,A.next=6,a.decode(I,g);case 6:B=A.sent,o.postMessage({decoded:B,id:i},[B]);case 8:case"end":return A.stop()}}),A)})));return function(e){return A.apply(this,arguments)}}());var w=function(){function A(){B(this,A)}var t;return Q(A,[{key:"decode",value:(t=e(r.mark((function A(e,t){var i,I,g,n,a;return r.wrap((function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,this.decodeBlock(t);case 2:if(i=A.sent,1===(I=e.Predictor||1)){A.next=9;break}return g=!e.StripOffsets,n=g?e.TileWidth:e.ImageWidth,a=g?e.TileLength:e.RowsPerStrip||e.ImageLength,A.abrupt("return",u(i,I,n,a,e.BitsPerSample,e.PlanarConfiguration));case 9:return A.abrupt("return",i);case 10:case"end":return A.stop()}}),A,this)}))),function(A,e){return t.apply(this,arguments)})}]),A}();function d(A){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(A){return!1}}();return function(){var t,i=c(A);if(e){var r=c(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return f(this,t)}}var D=function(A){s(t,w);var e=d(t);function t(){return B(this,t),e.apply(this,arguments)}return Q(t,[{key:"decodeBlock",value:function(A){return A}}]),t}(),y=Object.freeze({__proto__:null,default:D});function k(A){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(A){return!1}}();return function(){var t,i=c(A);if(e){var r=c(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return f(this,t)}}function p(A,e){for(var t=e.length-1;t>=0;t--)A.push(e[t]);return A}function m(A){for(var e=new Uint16Array(4093),t=new Uint8Array(4093),i=0;i<=257;i++)e[i]=4096,t[i]=i;var r=258,I=9,g=0;function n(){r=258,I=9}function a(A){var e=function(A,e,t){var i=e%8,r=Math.floor(e/8),I=8-i,g=e+t-8*(r+1),n=8*(r+2)-(e+t),a=8*(r+2)-e;if(n=Math.max(0,n),r>=A.length)return console.warn("ran off the end of the buffer before finding EOI_CODE (end on input code)"),257;var o=A[r]&Math.pow(2,8-i)-1,B=o<<=t-I;if(r+1<A.length){var C=A[r+1]>>>n;B+=C<<=Math.max(0,t-a)}if(g>8&&r+2<A.length){var Q=8*(r+3)-(e+t);B+=A[r+2]>>>Q}return B}(A,g,I);return g+=I,e}function o(A,i){return t[r]=i,e[r]=A,++r-1}function B(A){for(var i=[],r=A;4096!==r;r=e[r])i.push(t[r]);return i}var C=[];n();for(var Q,E=new Uint8Array(A),s=a(E);257!==s;){if(256===s){for(n(),s=a(E);256===s;)s=a(E);if(257===s)break;if(s>256)throw new Error("corrupted code at scanline ".concat(s));p(C,B(s)),Q=s}else if(s<r){var f=B(s);p(C,f),o(Q,f[f.length-1]),Q=s}else{var c=B(Q);if(!c)throw new Error("Bogus entry. Not in dictionary, ".concat(Q," / ").concat(r,", position: ").concat(g));p(C,c),C.push(c[c.length-1]),o(Q,c[c.length-1]),Q=s}r+1>=Math.pow(2,I)&&(12===I?Q=void 0:I++),s=a(E)}return new Uint8Array(C)}var G=function(A){s(t,w);var e=k(t);function t(){return B(this,t),e.apply(this,arguments)}return Q(t,[{key:"decodeBlock",value:function(A){return m(A).buffer}}]),t}(),F=Object.freeze({__proto__:null,default:G});function S(A){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(A){return!1}}();return function(){var t,i=c(A);if(e){var r=c(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return f(this,t)}}var v=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);function R(A,e){for(var t=0,i=[],r=16;r>0&&!A[r-1];)--r;i.push({children:[],index:0});for(var I,g=i[0],n=0;n<r;n++){for(var a=0;a<A[n];a++){for((g=i.pop()).children[g.index]=e[t];g.index>0;)g=i.pop();for(g.index++,i.push(g);i.length<=n;)i.push(I={children:[],index:0}),g.children[g.index]=I.children,g=I;t++}n+1<r&&(i.push(I={children:[],index:0}),g.children[g.index]=I.children,g=I)}return i[0].children}function U(A,e,i,r,I,g,n,a,o){var B=i.mcusPerLine,C=i.progressive,Q=e,E=e,s=0,f=0;function c(){if(f>0)return f--,s>>f&1;if(255===(s=A[E++])){var e=A[E++];if(e)throw new Error("unexpected marker: ".concat((s<<8|e).toString(16)))}return f=7,s>>>7}function h(A){for(var e,i=A;null!==(e=c());){if("number"==typeof(i=i[e]))return i;if("object"!==t(i))throw new Error("invalid huffman sequence")}return null}function l(A){for(var e=A,t=0;e>0;){var i=c();if(null===i)return;t=t<<1|i,--e}return t}function u(A){var e=l(A);return e>=1<<A-1?e:e+(-1<<A)+1}var w=0;var d,D=0;function y(A,e,t,i,r){var I=t%B,g=(t/B|0)*A.v+i,n=I*A.h+r;e(A,A.blocks[g][n])}function k(A,e,t){var i=t/A.blocksPerLine|0,r=t%A.blocksPerLine;e(A,A.blocks[i][r])}var p,m,G,F,S,R,U=r.length;R=C?0===g?0===a?function(A,e){var t=h(A.huffmanTableDC),i=0===t?0:u(t)<<o;A.pred+=i,e[0]=A.pred}:function(A,e){e[0]|=c()<<o}:0===a?function(A,e){if(w>0)w--;else for(var t=g,i=n;t<=i;){var r=h(A.huffmanTableAC),I=15&r,a=r>>4;if(0===I){if(a<15){w=l(a)+(1<<a)-1;break}t+=16}else e[v[t+=a]]=u(I)*(1<<o),t++}}:function(A,e){for(var t=g,i=n,r=0;t<=i;){var I=v[t],a=e[I]<0?-1:1;switch(D){case 0:var B=h(A.huffmanTableAC),C=15&B;if(r=B>>4,0===C)r<15?(w=l(r)+(1<<r),D=4):(r=16,D=1);else{if(1!==C)throw new Error("invalid ACn encoding");d=u(C),D=r?2:3}continue;case 1:case 2:e[I]?e[I]+=(c()<<o)*a:0==--r&&(D=2===D?3:0);break;case 3:e[I]?e[I]+=(c()<<o)*a:(e[I]=d<<o,D=0);break;case 4:e[I]&&(e[I]+=(c()<<o)*a)}t++}4===D&&0==--w&&(D=0)}:function(A,e){var t=h(A.huffmanTableDC),i=0===t?0:u(t);A.pred+=i,e[0]=A.pred;for(var r=1;r<64;){var I=h(A.huffmanTableAC),g=15&I,n=I>>4;if(0===g){if(n<15)break;r+=16}else e[v[r+=n]]=u(g),r++}};var L,b,M=0;b=1===U?r[0].blocksPerLine*r[0].blocksPerColumn:B*i.mcusPerColumn;for(var N=I||b;M<b;){for(m=0;m<U;m++)r[m].pred=0;if(w=0,1===U)for(p=r[0],S=0;S<N;S++)k(p,R,M),M++;else for(S=0;S<N;S++){for(m=0;m<U;m++){var x=p=r[m],J=x.h,q=x.v;for(G=0;G<q;G++)for(F=0;F<J;F++)y(p,R,M,G,F)}if(++M===b)break}if(f=0,(L=A[E]<<8|A[E+1])<65280)throw new Error("marker was not found");if(!(L>=65488&&L<=65495))break;E+=2}return E-Q}function L(A,e){var t=[],i=e.blocksPerLine,r=e.blocksPerColumn,I=i<<3,g=new Int32Array(64),n=new Uint8Array(64);function a(A,t,i){var r,I,g,n,a,o,B,C,Q,E,s=e.quantizationTable,f=i;for(E=0;E<64;E++)f[E]=A[E]*s[E];for(E=0;E<8;++E){var c=8*E;0!==f[1+c]||0!==f[2+c]||0!==f[3+c]||0!==f[4+c]||0!==f[5+c]||0!==f[6+c]||0!==f[7+c]?(r=5793*f[0+c]+128>>8,I=5793*f[4+c]+128>>8,g=f[2+c],n=f[6+c],a=2896*(f[1+c]-f[7+c])+128>>8,C=2896*(f[1+c]+f[7+c])+128>>8,o=f[3+c]<<4,Q=r-I+1>>1,r=r+I+1>>1,I=Q,Q=3784*g+1567*n+128>>8,g=1567*g-3784*n+128>>8,n=Q,Q=a-(B=f[5+c]<<4)+1>>1,a=a+B+1>>1,B=Q,Q=C+o+1>>1,o=C-o+1>>1,C=Q,Q=r-n+1>>1,r=r+n+1>>1,n=Q,Q=I-g+1>>1,I=I+g+1>>1,g=Q,Q=2276*a+3406*C+2048>>12,a=3406*a-2276*C+2048>>12,C=Q,Q=799*o+4017*B+2048>>12,o=4017*o-799*B+2048>>12,B=Q,f[0+c]=r+C,f[7+c]=r-C,f[1+c]=I+B,f[6+c]=I-B,f[2+c]=g+o,f[5+c]=g-o,f[3+c]=n+a,f[4+c]=n-a):(Q=5793*f[0+c]+512>>10,f[0+c]=Q,f[1+c]=Q,f[2+c]=Q,f[3+c]=Q,f[4+c]=Q,f[5+c]=Q,f[6+c]=Q,f[7+c]=Q)}for(E=0;E<8;++E){var h=E;0!==f[8+h]||0!==f[16+h]||0!==f[24+h]||0!==f[32+h]||0!==f[40+h]||0!==f[48+h]||0!==f[56+h]?(r=5793*f[0+h]+2048>>12,I=5793*f[32+h]+2048>>12,g=f[16+h],n=f[48+h],a=2896*(f[8+h]-f[56+h])+2048>>12,C=2896*(f[8+h]+f[56+h])+2048>>12,o=f[24+h],Q=r-I+1>>1,r=r+I+1>>1,I=Q,Q=3784*g+1567*n+2048>>12,g=1567*g-3784*n+2048>>12,n=Q,Q=a-(B=f[40+h])+1>>1,a=a+B+1>>1,B=Q,Q=C+o+1>>1,o=C-o+1>>1,C=Q,Q=r-n+1>>1,r=r+n+1>>1,n=Q,Q=I-g+1>>1,I=I+g+1>>1,g=Q,Q=2276*a+3406*C+2048>>12,a=3406*a-2276*C+2048>>12,C=Q,Q=799*o+4017*B+2048>>12,o=4017*o-799*B+2048>>12,B=Q,f[0+h]=r+C,f[56+h]=r-C,f[8+h]=I+B,f[48+h]=I-B,f[16+h]=g+o,f[40+h]=g-o,f[24+h]=n+a,f[32+h]=n-a):(Q=5793*i[E+0]+8192>>14,f[0+h]=Q,f[8+h]=Q,f[16+h]=Q,f[24+h]=Q,f[32+h]=Q,f[40+h]=Q,f[48+h]=Q,f[56+h]=Q)}for(E=0;E<64;++E){var l=128+(f[E]+8>>4);t[E]=l<0?0:l>255?255:l}}for(var o=0;o<r;o++){for(var B=o<<3,C=0;C<8;C++)t.push(new Uint8Array(I));for(var Q=0;Q<i;Q++){a(e.blocks[o][Q],n,g);for(var E=0,s=Q<<3,f=0;f<8;f++)for(var c=t[B+f],h=0;h<8;h++)c[s+h]=n[E++]}}return t}var b=function(){function A(){B(this,A),this.jfif=null,this.adobe=null,this.quantizationTables=[],this.huffmanTablesAC=[],this.huffmanTablesDC=[],this.resetFrames()}return Q(A,[{key:"resetFrames",value:function(){this.frames=[]}},{key:"parse",value:function(A){var e=0;function t(){var t=A[e]<<8|A[e+1];return e+=2,t}function i(A){var e,t,i=0,r=0;for(t in A.components)A.components.hasOwnProperty(t)&&(i<(e=A.components[t]).h&&(i=e.h),r<e.v&&(r=e.v));var I=Math.ceil(A.samplesPerLine/8/i),g=Math.ceil(A.scanLines/8/r);for(t in A.components)if(A.components.hasOwnProperty(t)){e=A.components[t];for(var n=Math.ceil(Math.ceil(A.samplesPerLine/8)*e.h/i),a=Math.ceil(Math.ceil(A.scanLines/8)*e.v/r),o=I*e.h,B=g*e.v,C=[],Q=0;Q<B;Q++){for(var E=[],s=0;s<o;s++)E.push(new Int32Array(64));C.push(E)}e.blocksPerLine=n,e.blocksPerColumn=a,e.blocks=C}A.maxH=i,A.maxV=r,A.mcusPerLine=I,A.mcusPerColumn=g}var r,I,g=t();if(65496!==g)throw new Error("SOI not found");for(g=t();65497!==g;){switch(g){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var n=(r=void 0,I=void 0,r=t(),I=A.subarray(e,e+r-2),e+=I.length,I);65504===g&&74===n[0]&&70===n[1]&&73===n[2]&&70===n[3]&&0===n[4]&&(this.jfif={version:{major:n[5],minor:n[6]},densityUnits:n[7],xDensity:n[8]<<8|n[9],yDensity:n[10]<<8|n[11],thumbWidth:n[12],thumbHeight:n[13],thumbData:n.subarray(14,14+3*n[12]*n[13])}),65518===g&&65===n[0]&&100===n[1]&&111===n[2]&&98===n[3]&&101===n[4]&&0===n[5]&&(this.adobe={version:n[6],flags0:n[7]<<8|n[8],flags1:n[9]<<8|n[10],transformCode:n[11]});break;case 65499:for(var a=t()+e-2;e<a;){var o=A[e++],B=new Int32Array(64);if(o>>4==0)for(var C=0;C<64;C++){B[v[C]]=A[e++]}else{if(o>>4!=1)throw new Error("DQT: invalid table spec");for(var Q=0;Q<64;Q++){B[v[Q]]=t()}}this.quantizationTables[15&o]=B}break;case 65472:case 65473:case 65474:t();for(var E={extended:65473===g,progressive:65474===g,precision:A[e++],scanLines:t(),samplesPerLine:t(),components:{},componentsOrder:[]},s=A[e++],f=void 0,c=0;c<s;c++){f=A[e];var h=A[e+1]>>4,l=15&A[e+1],u=A[e+2];E.componentsOrder.push(f),E.components[f]={h:h,v:l,quantizationIdx:u},e+=3}i(E),this.frames.push(E);break;case 65476:for(var w=t(),d=2;d<w;){for(var D=A[e++],y=new Uint8Array(16),k=0,p=0;p<16;p++,e++)y[p]=A[e],k+=y[p];for(var m=new Uint8Array(k),G=0;G<k;G++,e++)m[G]=A[e];d+=17+k,D>>4==0?this.huffmanTablesDC[15&D]=R(y,m):this.huffmanTablesAC[15&D]=R(y,m)}break;case 65501:t(),this.resetInterval=t();break;case 65498:t();for(var F=A[e++],S=[],L=this.frames[0],b=0;b<F;b++){var M=L.components[A[e++]],N=A[e++];M.huffmanTableDC=this.huffmanTablesDC[N>>4],M.huffmanTableAC=this.huffmanTablesAC[15&N],S.push(M)}var x=A[e++],J=A[e++],q=A[e++],Y=U(A,e,L,S,this.resetInterval,x,J,q>>4,15&q);e+=Y;break;case 65535:255!==A[e]&&e--;break;default:if(255===A[e-3]&&A[e-2]>=192&&A[e-2]<=254){e-=3;break}throw new Error("unknown JPEG marker ".concat(g.toString(16)))}g=t()}}},{key:"getResult",value:function(){var A=this.frames;if(0===this.frames.length)throw new Error("no frames were decoded");this.frames.length>1&&console.warn("more than one frame is not supported");for(var e=0;e<this.frames.length;e++)for(var t=this.frames[e].components,i=0,r=Object.keys(t);i<r.length;i++){var I=r[i];t[I].quantizationTable=this.quantizationTables[t[I].quantizationIdx],delete t[I].quantizationIdx}for(var g=A[0],n=g.components,a=g.componentsOrder,o=[],B=g.samplesPerLine,C=g.scanLines,Q=0;Q<a.length;Q++){var E=n[a[Q]];o.push({lines:L(0,E),scaleX:E.h/g.maxH,scaleY:E.v/g.maxV})}for(var s=new Uint8Array(B*C*o.length),f=0,c=0;c<C;++c)for(var h=0;h<B;++h)for(var l=0;l<o.length;++l){var u=o[l];s[f]=u.lines[0|c*u.scaleY][0|h*u.scaleX],++f}return s}}]),A}(),M=function(A){s(t,w);var e=S(t);function t(A){var i;return B(this,t),(i=e.call(this)).reader=new b,A.JPEGTables&&i.reader.parse(A.JPEGTables),i}return Q(t,[{key:"decodeBlock",value:function(A){return this.reader.resetFrames(),this.reader.parse(new Uint8Array(A)),this.reader.getResult().buffer}}]),t}(),N=Object.freeze({__proto__:null,default:M});function x(A){for(var e=A.length;--e>=0;)A[e]=0}x(new Array(576)),x(new Array(60)),x(new Array(512)),x(new Array(256)),x(new Array(29)),x(new Array(30));var J=function(A,e,t,i){for(var r=65535&A|0,I=A>>>16&65535|0,g=0;0!==t;){t-=g=t>2e3?2e3:t;do{I=I+(r=r+e[i++]|0)|0}while(--g);r%=65521,I%=65521}return r|I<<16|0},q=new Uint32Array(function(){for(var A,e=[],t=0;t<256;t++){A=t;for(var i=0;i<8;i++)A=1&A?3988292384^A>>>1:A>>>1;e[t]=A}return e}()),Y=function(A,e,t,i){var r=q,I=i+t;A^=-1;for(var g=i;g<I;g++)A=A>>>8^r[255&(A^e[g])];return-1^A},K={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},H={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},O=function(A,e){return Object.prototype.hasOwnProperty.call(A,e)},P=function(A){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var i=e.shift();if(i){if("object"!==t(i))throw new TypeError(i+"must be non-object");for(var r in i)O(i,r)&&(A[r]=i[r])}}return A},T=function(A){for(var e=0,t=0,i=A.length;t<i;t++)e+=A[t].length;for(var r=new Uint8Array(e),I=0,g=0,n=A.length;I<n;I++){var a=A[I];r.set(a,g),g+=a.length}return r},V=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(A){V=!1}for(var _=new Uint8Array(256),X=0;X<256;X++)_[X]=X>=252?6:X>=248?5:X>=240?4:X>=224?3:X>=192?2:1;_[254]=_[254]=1;var Z=function(A){if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(A);var e,t,i,r,I,g=A.length,n=0;for(r=0;r<g;r++)55296==(64512&(t=A.charCodeAt(r)))&&r+1<g&&56320==(64512&(i=A.charCodeAt(r+1)))&&(t=65536+(t-55296<<10)+(i-56320),r++),n+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(n),I=0,r=0;I<n;r++)55296==(64512&(t=A.charCodeAt(r)))&&r+1<g&&56320==(64512&(i=A.charCodeAt(r+1)))&&(t=65536+(t-55296<<10)+(i-56320),r++),t<128?e[I++]=t:t<2048?(e[I++]=192|t>>>6,e[I++]=128|63&t):t<65536?(e[I++]=224|t>>>12,e[I++]=128|t>>>6&63,e[I++]=128|63&t):(e[I++]=240|t>>>18,e[I++]=128|t>>>12&63,e[I++]=128|t>>>6&63,e[I++]=128|63&t);return e},j=function(A,e){var t,i,r=e||A.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(A.subarray(0,e));var I=new Array(2*r);for(i=0,t=0;t<r;){var g=A[t++];if(g<128)I[i++]=g;else{var n=_[g];if(n>4)I[i++]=65533,t+=n-1;else{for(g&=2===n?31:3===n?15:7;n>1&&t<r;)g=g<<6|63&A[t++],n--;n>1?I[i++]=65533:g<65536?I[i++]=g:(g-=65536,I[i++]=55296|g>>10&1023,I[i++]=56320|1023&g)}}}return function(A,e){if(e<65534&&A.subarray&&V)return String.fromCharCode.apply(null,A.length===e?A:A.subarray(0,e));for(var t="",i=0;i<e;i++)t+=String.fromCharCode(A[i]);return t}(I,i)},W=function(A,e){(e=e||A.length)>A.length&&(e=A.length);for(var t=e-1;t>=0&&128==(192&A[t]);)t--;return t<0||0===t?e:t+_[A[t]]>e?t:e};var z=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},$=function(A,e){var t,i,r,I,g,n,a,o,B,C,Q,E,s,f,c,h,l,u,w,d,D,y,k,p,m=A.state;t=A.next_in,k=A.input,i=t+(A.avail_in-5),r=A.next_out,p=A.output,I=r-(e-A.avail_out),g=r+(A.avail_out-257),n=m.dmax,a=m.wsize,o=m.whave,B=m.wnext,C=m.window,Q=m.hold,E=m.bits,s=m.lencode,f=m.distcode,c=(1<<m.lenbits)-1,h=(1<<m.distbits)-1;A:do{E<15&&(Q+=k[t++]<<E,E+=8,Q+=k[t++]<<E,E+=8),l=s[Q&c];e:for(;;){if(Q>>>=u=l>>>24,E-=u,0===(u=l>>>16&255))p[r++]=65535&l;else{if(!(16&u)){if(0==(64&u)){l=s[(65535&l)+(Q&(1<<u)-1)];continue e}if(32&u){m.mode=12;break A}A.msg="invalid literal/length code",m.mode=30;break A}w=65535&l,(u&=15)&&(E<u&&(Q+=k[t++]<<E,E+=8),w+=Q&(1<<u)-1,Q>>>=u,E-=u),E<15&&(Q+=k[t++]<<E,E+=8,Q+=k[t++]<<E,E+=8),l=f[Q&h];t:for(;;){if(Q>>>=u=l>>>24,E-=u,!(16&(u=l>>>16&255))){if(0==(64&u)){l=f[(65535&l)+(Q&(1<<u)-1)];continue t}A.msg="invalid distance code",m.mode=30;break A}if(d=65535&l,E<(u&=15)&&(Q+=k[t++]<<E,(E+=8)<u&&(Q+=k[t++]<<E,E+=8)),(d+=Q&(1<<u)-1)>n){A.msg="invalid distance too far back",m.mode=30;break A}if(Q>>>=u,E-=u,d>(u=r-I)){if((u=d-u)>o&&m.sane){A.msg="invalid distance too far back",m.mode=30;break A}if(D=0,y=C,0===B){if(D+=a-u,u<w){w-=u;do{p[r++]=C[D++]}while(--u);D=r-d,y=p}}else if(B<u){if(D+=a+B-u,(u-=B)<w){w-=u;do{p[r++]=C[D++]}while(--u);if(D=0,B<w){w-=u=B;do{p[r++]=C[D++]}while(--u);D=r-d,y=p}}}else if(D+=B-u,u<w){w-=u;do{p[r++]=C[D++]}while(--u);D=r-d,y=p}for(;w>2;)p[r++]=y[D++],p[r++]=y[D++],p[r++]=y[D++],w-=3;w&&(p[r++]=y[D++],w>1&&(p[r++]=y[D++]))}else{D=r-d;do{p[r++]=p[D++],p[r++]=p[D++],p[r++]=p[D++],w-=3}while(w>2);w&&(p[r++]=p[D++],w>1&&(p[r++]=p[D++]))}break}}break}}while(t<i&&r<g);t-=w=E>>3,Q&=(1<<(E-=w<<3))-1,A.next_in=t,A.next_out=r,A.avail_in=t<i?i-t+5:5-(t-i),A.avail_out=r<g?g-r+257:257-(r-g),m.hold=Q,m.bits=E},AA=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),eA=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),tA=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),iA=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),rA=function(A,e,t,i,r,I,g,n){var a,o,B,C,Q,E,s,f,c,h=n.bits,l=0,u=0,w=0,d=0,D=0,y=0,k=0,p=0,m=0,G=0,F=null,S=0,v=new Uint16Array(16),R=new Uint16Array(16),U=null,L=0;for(l=0;l<=15;l++)v[l]=0;for(u=0;u<i;u++)v[e[t+u]]++;for(D=h,d=15;d>=1&&0===v[d];d--);if(D>d&&(D=d),0===d)return r[I++]=20971520,r[I++]=20971520,n.bits=1,0;for(w=1;w<d&&0===v[w];w++);for(D<w&&(D=w),p=1,l=1;l<=15;l++)if(p<<=1,(p-=v[l])<0)return-1;if(p>0&&(0===A||1!==d))return-1;for(R[1]=0,l=1;l<15;l++)R[l+1]=R[l]+v[l];for(u=0;u<i;u++)0!==e[t+u]&&(g[R[e[t+u]]++]=u);if(0===A?(F=U=g,E=19):1===A?(F=AA,S-=257,U=eA,L-=257,E=256):(F=tA,U=iA,E=-1),G=0,u=0,l=w,Q=I,y=D,k=0,B=-1,C=(m=1<<D)-1,1===A&&m>852||2===A&&m>592)return 1;for(;;){s=l-k,g[u]<E?(f=0,c=g[u]):g[u]>E?(f=U[L+g[u]],c=F[S+g[u]]):(f=96,c=0),a=1<<l-k,w=o=1<<y;do{r[Q+(G>>k)+(o-=a)]=s<<24|f<<16|c|0}while(0!==o);for(a=1<<l-1;G&a;)a>>=1;if(0!==a?(G&=a-1,G+=a):G=0,u++,0==--v[l]){if(l===d)break;l=e[t+g[u]]}if(l>D&&(G&C)!==B){for(0===k&&(k=D),Q+=w,p=1<<(y=l-k);y+k<d&&!((p-=v[y+k])<=0);)y++,p<<=1;if(m+=1<<y,1===A&&m>852||2===A&&m>592)return 1;r[B=G&C]=D<<24|y<<16|Q-I|0}}return 0!==G&&(r[Q+G]=l-k<<24|64<<16|0),n.bits=D,0},IA=H.Z_FINISH,gA=H.Z_BLOCK,nA=H.Z_TREES,aA=H.Z_OK,oA=H.Z_STREAM_END,BA=H.Z_NEED_DICT,CA=H.Z_STREAM_ERROR,QA=H.Z_DATA_ERROR,EA=H.Z_MEM_ERROR,sA=H.Z_BUF_ERROR,fA=H.Z_DEFLATED,cA=function(A){return(A>>>24&255)+(A>>>8&65280)+((65280&A)<<8)+((255&A)<<24)};function hA(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var lA,uA,wA=function(A){if(!A||!A.state)return CA;var e=A.state;return A.total_in=A.total_out=e.total=0,A.msg="",e.wrap&&(A.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,aA},dA=function(A){if(!A||!A.state)return CA;var e=A.state;return e.wsize=0,e.whave=0,e.wnext=0,wA(A)},DA=function(A,e){var t;if(!A||!A.state)return CA;var i=A.state;return e<0?(t=0,e=-e):(t=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?CA:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=t,i.wbits=e,dA(A))},yA=function(A,e){if(!A)return CA;var t=new hA;A.state=t,t.window=null;var i=DA(A,e);return i!==aA&&(A.state=null),i},kA=!0,pA=function(A){if(kA){lA=new Int32Array(512),uA=new Int32Array(32);for(var e=0;e<144;)A.lens[e++]=8;for(;e<256;)A.lens[e++]=9;for(;e<280;)A.lens[e++]=7;for(;e<288;)A.lens[e++]=8;for(rA(1,A.lens,0,288,lA,0,A.work,{bits:9}),e=0;e<32;)A.lens[e++]=5;rA(2,A.lens,0,32,uA,0,A.work,{bits:5}),kA=!1}A.lencode=lA,A.lenbits=9,A.distcode=uA,A.distbits=5},mA=function(A,e,t,i){var r,I=A.state;return null===I.window&&(I.wsize=1<<I.wbits,I.wnext=0,I.whave=0,I.window=new Uint8Array(I.wsize)),i>=I.wsize?(I.window.set(e.subarray(t-I.wsize,t),0),I.wnext=0,I.whave=I.wsize):((r=I.wsize-I.wnext)>i&&(r=i),I.window.set(e.subarray(t-i,t-i+r),I.wnext),(i-=r)?(I.window.set(e.subarray(t-i,t),0),I.wnext=i,I.whave=I.wsize):(I.wnext+=r,I.wnext===I.wsize&&(I.wnext=0),I.whave<I.wsize&&(I.whave+=r))),0},GA={inflateReset:dA,inflateReset2:DA,inflateResetKeep:wA,inflateInit:function(A){return yA(A,15)},inflateInit2:yA,inflate:function(A,e){var t,i,r,I,g,n,a,o,B,C,Q,E,s,f,c,h,l,u,w,d,D,y,k,p,m=0,G=new Uint8Array(4),F=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!A||!A.state||!A.output||!A.input&&0!==A.avail_in)return CA;12===(t=A.state).mode&&(t.mode=13),g=A.next_out,r=A.output,a=A.avail_out,I=A.next_in,i=A.input,n=A.avail_in,o=t.hold,B=t.bits,C=n,Q=a,y=aA;A:for(;;)switch(t.mode){case 1:if(0===t.wrap){t.mode=13;break}for(;B<16;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(2&t.wrap&&35615===o){t.check=0,G[0]=255&o,G[1]=o>>>8&255,t.check=Y(t.check,G,2,0),o=0,B=0,t.mode=2;break}if(t.flags=0,t.head&&(t.head.done=!1),!(1&t.wrap)||(((255&o)<<8)+(o>>8))%31){A.msg="incorrect header check",t.mode=30;break}if((15&o)!==fA){A.msg="unknown compression method",t.mode=30;break}if(B-=4,D=8+(15&(o>>>=4)),0===t.wbits)t.wbits=D;else if(D>t.wbits){A.msg="invalid window size",t.mode=30;break}t.dmax=1<<t.wbits,A.adler=t.check=1,t.mode=512&o?10:12,o=0,B=0;break;case 2:for(;B<16;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(t.flags=o,(255&t.flags)!==fA){A.msg="unknown compression method",t.mode=30;break}if(57344&t.flags){A.msg="unknown header flags set",t.mode=30;break}t.head&&(t.head.text=o>>8&1),512&t.flags&&(G[0]=255&o,G[1]=o>>>8&255,t.check=Y(t.check,G,2,0)),o=0,B=0,t.mode=3;case 3:for(;B<32;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}t.head&&(t.head.time=o),512&t.flags&&(G[0]=255&o,G[1]=o>>>8&255,G[2]=o>>>16&255,G[3]=o>>>24&255,t.check=Y(t.check,G,4,0)),o=0,B=0,t.mode=4;case 4:for(;B<16;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}t.head&&(t.head.xflags=255&o,t.head.os=o>>8),512&t.flags&&(G[0]=255&o,G[1]=o>>>8&255,t.check=Y(t.check,G,2,0)),o=0,B=0,t.mode=5;case 5:if(1024&t.flags){for(;B<16;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}t.length=o,t.head&&(t.head.extra_len=o),512&t.flags&&(G[0]=255&o,G[1]=o>>>8&255,t.check=Y(t.check,G,2,0)),o=0,B=0}else t.head&&(t.head.extra=null);t.mode=6;case 6:if(1024&t.flags&&((E=t.length)>n&&(E=n),E&&(t.head&&(D=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(i.subarray(I,I+E),D)),512&t.flags&&(t.check=Y(t.check,i,E,I)),n-=E,I+=E,t.length-=E),t.length))break A;t.length=0,t.mode=7;case 7:if(2048&t.flags){if(0===n)break A;E=0;do{D=i[I+E++],t.head&&D&&t.length<65536&&(t.head.name+=String.fromCharCode(D))}while(D&&E<n);if(512&t.flags&&(t.check=Y(t.check,i,E,I)),n-=E,I+=E,D)break A}else t.head&&(t.head.name=null);t.length=0,t.mode=8;case 8:if(4096&t.flags){if(0===n)break A;E=0;do{D=i[I+E++],t.head&&D&&t.length<65536&&(t.head.comment+=String.fromCharCode(D))}while(D&&E<n);if(512&t.flags&&(t.check=Y(t.check,i,E,I)),n-=E,I+=E,D)break A}else t.head&&(t.head.comment=null);t.mode=9;case 9:if(512&t.flags){for(;B<16;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(o!==(65535&t.check)){A.msg="header crc mismatch",t.mode=30;break}o=0,B=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),A.adler=t.check=0,t.mode=12;break;case 10:for(;B<32;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}A.adler=t.check=cA(o),o=0,B=0,t.mode=11;case 11:if(0===t.havedict)return A.next_out=g,A.avail_out=a,A.next_in=I,A.avail_in=n,t.hold=o,t.bits=B,BA;A.adler=t.check=1,t.mode=12;case 12:if(e===gA||e===nA)break A;case 13:if(t.last){o>>>=7&B,B-=7&B,t.mode=27;break}for(;B<3;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}switch(t.last=1&o,B-=1,3&(o>>>=1)){case 0:t.mode=14;break;case 1:if(pA(t),t.mode=20,e===nA){o>>>=2,B-=2;break A}break;case 2:t.mode=17;break;case 3:A.msg="invalid block type",t.mode=30}o>>>=2,B-=2;break;case 14:for(o>>>=7&B,B-=7&B;B<32;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if((65535&o)!=(o>>>16^65535)){A.msg="invalid stored block lengths",t.mode=30;break}if(t.length=65535&o,o=0,B=0,t.mode=15,e===nA)break A;case 15:t.mode=16;case 16:if(E=t.length){if(E>n&&(E=n),E>a&&(E=a),0===E)break A;r.set(i.subarray(I,I+E),g),n-=E,I+=E,a-=E,g+=E,t.length-=E;break}t.mode=12;break;case 17:for(;B<14;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(t.nlen=257+(31&o),o>>>=5,B-=5,t.ndist=1+(31&o),o>>>=5,B-=5,t.ncode=4+(15&o),o>>>=4,B-=4,t.nlen>286||t.ndist>30){A.msg="too many length or distance symbols",t.mode=30;break}t.have=0,t.mode=18;case 18:for(;t.have<t.ncode;){for(;B<3;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}t.lens[F[t.have++]]=7&o,o>>>=3,B-=3}for(;t.have<19;)t.lens[F[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,k={bits:t.lenbits},y=rA(0,t.lens,0,19,t.lencode,0,t.work,k),t.lenbits=k.bits,y){A.msg="invalid code lengths set",t.mode=30;break}t.have=0,t.mode=19;case 19:for(;t.have<t.nlen+t.ndist;){for(;h=(m=t.lencode[o&(1<<t.lenbits)-1])>>>16&255,l=65535&m,!((c=m>>>24)<=B);){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(l<16)o>>>=c,B-=c,t.lens[t.have++]=l;else{if(16===l){for(p=c+2;B<p;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(o>>>=c,B-=c,0===t.have){A.msg="invalid bit length repeat",t.mode=30;break}D=t.lens[t.have-1],E=3+(3&o),o>>>=2,B-=2}else if(17===l){for(p=c+3;B<p;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}B-=c,D=0,E=3+(7&(o>>>=c)),o>>>=3,B-=3}else{for(p=c+7;B<p;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}B-=c,D=0,E=11+(127&(o>>>=c)),o>>>=7,B-=7}if(t.have+E>t.nlen+t.ndist){A.msg="invalid bit length repeat",t.mode=30;break}for(;E--;)t.lens[t.have++]=D}}if(30===t.mode)break;if(0===t.lens[256]){A.msg="invalid code -- missing end-of-block",t.mode=30;break}if(t.lenbits=9,k={bits:t.lenbits},y=rA(1,t.lens,0,t.nlen,t.lencode,0,t.work,k),t.lenbits=k.bits,y){A.msg="invalid literal/lengths set",t.mode=30;break}if(t.distbits=6,t.distcode=t.distdyn,k={bits:t.distbits},y=rA(2,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,k),t.distbits=k.bits,y){A.msg="invalid distances set",t.mode=30;break}if(t.mode=20,e===nA)break A;case 20:t.mode=21;case 21:if(n>=6&&a>=258){A.next_out=g,A.avail_out=a,A.next_in=I,A.avail_in=n,t.hold=o,t.bits=B,$(A,Q),g=A.next_out,r=A.output,a=A.avail_out,I=A.next_in,i=A.input,n=A.avail_in,o=t.hold,B=t.bits,12===t.mode&&(t.back=-1);break}for(t.back=0;h=(m=t.lencode[o&(1<<t.lenbits)-1])>>>16&255,l=65535&m,!((c=m>>>24)<=B);){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(h&&0==(240&h)){for(u=c,w=h,d=l;h=(m=t.lencode[d+((o&(1<<u+w)-1)>>u)])>>>16&255,l=65535&m,!(u+(c=m>>>24)<=B);){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}o>>>=u,B-=u,t.back+=u}if(o>>>=c,B-=c,t.back+=c,t.length=l,0===h){t.mode=26;break}if(32&h){t.back=-1,t.mode=12;break}if(64&h){A.msg="invalid literal/length code",t.mode=30;break}t.extra=15&h,t.mode=22;case 22:if(t.extra){for(p=t.extra;B<p;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}t.length+=o&(1<<t.extra)-1,o>>>=t.extra,B-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=23;case 23:for(;h=(m=t.distcode[o&(1<<t.distbits)-1])>>>16&255,l=65535&m,!((c=m>>>24)<=B);){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(0==(240&h)){for(u=c,w=h,d=l;h=(m=t.distcode[d+((o&(1<<u+w)-1)>>u)])>>>16&255,l=65535&m,!(u+(c=m>>>24)<=B);){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}o>>>=u,B-=u,t.back+=u}if(o>>>=c,B-=c,t.back+=c,64&h){A.msg="invalid distance code",t.mode=30;break}t.offset=l,t.extra=15&h,t.mode=24;case 24:if(t.extra){for(p=t.extra;B<p;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}t.offset+=o&(1<<t.extra)-1,o>>>=t.extra,B-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){A.msg="invalid distance too far back",t.mode=30;break}t.mode=25;case 25:if(0===a)break A;if(E=Q-a,t.offset>E){if((E=t.offset-E)>t.whave&&t.sane){A.msg="invalid distance too far back",t.mode=30;break}E>t.wnext?(E-=t.wnext,s=t.wsize-E):s=t.wnext-E,E>t.length&&(E=t.length),f=t.window}else f=r,s=g-t.offset,E=t.length;E>a&&(E=a),a-=E,t.length-=E;do{r[g++]=f[s++]}while(--E);0===t.length&&(t.mode=21);break;case 26:if(0===a)break A;r[g++]=t.length,a--,t.mode=21;break;case 27:if(t.wrap){for(;B<32;){if(0===n)break A;n--,o|=i[I++]<<B,B+=8}if(Q-=a,A.total_out+=Q,t.total+=Q,Q&&(A.adler=t.check=t.flags?Y(t.check,r,Q,g-Q):J(t.check,r,Q,g-Q)),Q=a,(t.flags?o:cA(o))!==t.check){A.msg="incorrect data check",t.mode=30;break}o=0,B=0}t.mode=28;case 28:if(t.wrap&&t.flags){for(;B<32;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(o!==(4294967295&t.total)){A.msg="incorrect length check",t.mode=30;break}o=0,B=0}t.mode=29;case 29:y=oA;break A;case 30:y=QA;break A;case 31:return EA;default:return CA}return A.next_out=g,A.avail_out=a,A.next_in=I,A.avail_in=n,t.hold=o,t.bits=B,(t.wsize||Q!==A.avail_out&&t.mode<30&&(t.mode<27||e!==IA))&&mA(A,A.output,A.next_out,Q-A.avail_out),C-=A.avail_in,Q-=A.avail_out,A.total_in+=C,A.total_out+=Q,t.total+=Q,t.wrap&&Q&&(A.adler=t.check=t.flags?Y(t.check,r,Q,A.next_out-Q):J(t.check,r,Q,A.next_out-Q)),A.data_type=t.bits+(t.last?64:0)+(12===t.mode?128:0)+(20===t.mode||15===t.mode?256:0),(0===C&&0===Q||e===IA)&&y===aA&&(y=sA),y},inflateEnd:function(A){if(!A||!A.state)return CA;var e=A.state;return e.window&&(e.window=null),A.state=null,aA},inflateGetHeader:function(A,e){if(!A||!A.state)return CA;var t=A.state;return 0==(2&t.wrap)?CA:(t.head=e,e.done=!1,aA)},inflateSetDictionary:function(A,e){var t,i=e.length;return A&&A.state?0!==(t=A.state).wrap&&11!==t.mode?CA:11===t.mode&&J(1,e,i,0)!==t.check?QA:mA(A,e,i,i)?(t.mode=31,EA):(t.havedict=1,aA):CA},inflateInfo:"pako inflate (from Nodeca project)"};var FA=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},SA=Object.prototype.toString,vA=H.Z_NO_FLUSH,RA=H.Z_FINISH,UA=H.Z_OK,LA=H.Z_STREAM_END,bA=H.Z_NEED_DICT,MA=H.Z_STREAM_ERROR,NA=H.Z_DATA_ERROR,xA=H.Z_MEM_ERROR;function JA(A){this.options=P({chunkSize:65536,windowBits:15,to:""},A||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||A&&A.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new z,this.strm.avail_out=0;var t=GA.inflateInit2(this.strm,e.windowBits);if(t!==UA)throw new Error(K[t]);if(this.header=new FA,GA.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=Z(e.dictionary):"[object ArrayBuffer]"===SA.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=GA.inflateSetDictionary(this.strm,e.dictionary))!==UA))throw new Error(K[t])}function qA(A,e){var t=new JA(e);if(t.push(A),t.err)throw t.msg||K[t.err];return t.result}JA.prototype.push=function(A,e){var t,i,r,I=this.strm,g=this.options.chunkSize,n=this.options.dictionary;if(this.ended)return!1;for(i=e===~~e?e:!0===e?RA:vA,"[object ArrayBuffer]"===SA.call(A)?I.input=new Uint8Array(A):I.input=A,I.next_in=0,I.avail_in=I.input.length;;){for(0===I.avail_out&&(I.output=new Uint8Array(g),I.next_out=0,I.avail_out=g),(t=GA.inflate(I,i))===bA&&n&&((t=GA.inflateSetDictionary(I,n))===UA?t=GA.inflate(I,i):t===NA&&(t=bA));I.avail_in>0&&t===LA&&I.state.wrap>0&&0!==A[I.next_in];)GA.inflateReset(I),t=GA.inflate(I,i);switch(t){case MA:case NA:case bA:case xA:return this.onEnd(t),this.ended=!0,!1}if(r=I.avail_out,I.next_out&&(0===I.avail_out||t===LA))if("string"===this.options.to){var a=W(I.output,I.next_out),o=I.next_out-a,B=j(I.output,a);I.next_out=o,I.avail_out=g-o,o&&I.output.set(I.output.subarray(a,a+o),0),this.onData(B)}else this.onData(I.output.length===I.next_out?I.output:I.output.subarray(0,I.next_out));if(t!==UA||0!==r){if(t===LA)return t=GA.inflateEnd(this.strm),this.onEnd(t),this.ended=!0,!0;if(0===I.avail_in)break}}return!0},JA.prototype.onData=function(A){this.chunks.push(A)},JA.prototype.onEnd=function(A){A===UA&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=T(this.chunks)),this.chunks=[],this.err=A,this.msg=this.strm.msg};var YA={Inflate:JA,inflate:qA,inflateRaw:function(A,e){return(e=e||{}).raw=!0,qA(A,e)},ungzip:qA,constants:H}.inflate;function KA(A){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(A){return!1}}();return function(){var t,i=c(A);if(e){var r=c(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return f(this,t)}}var HA=function(A){s(t,w);var e=KA(t);function t(){return B(this,t),e.apply(this,arguments)}return Q(t,[{key:"decodeBlock",value:function(A){return YA(new Uint8Array(A)).buffer}}]),t}(),OA=Object.freeze({__proto__:null,default:HA});function PA(A){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(A){return!1}}();return function(){var t,i=c(A);if(e){var r=c(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return f(this,t)}}var TA,VA=function(A){s(t,w);var e=PA(t);function t(){return B(this,t),e.apply(this,arguments)}return Q(t,[{key:"decodeBlock",value:function(A){for(var e=new DataView(A),t=[],i=0;i<A.byteLength;++i){var r=e.getInt8(i);if(r<0){var I=e.getUint8(i+1);r=-r;for(var g=0;g<=r;++g)t.push(I);i+=1}else{for(var n=0;n<=r;++n)t.push(e.getUint8(i+n+1));i+=r+1}}return new Uint8Array(t).buffer}}]),t}(),_A=Object.freeze({__proto__:null,default:VA}),XA={exports:{}};TA=XA,\n/* Copyright 2015-2021 Esri. Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 @preserve */\nfunction(){var A,e,t,i,r,I,g,n,a,o,B,C,Q,E,s,f,c=(A={defaultNoDataValue:-34027999387901484e22,decode:function(I,g){var n=(g=g||{}).encodedMaskData||null===g.encodedMaskData,a=r(I,g.inputOffset||0,n),o=null!==g.noDataValue?g.noDataValue:A.defaultNoDataValue,B=e(a,g.pixelType||Float32Array,g.encodedMaskData,o,g.returnMask),C={width:a.width,height:a.height,pixelData:B.resultPixels,minValue:B.minValue,maxValue:a.pixels.maxValue,noDataValue:o};return B.resultMask&&(C.maskData=B.resultMask),g.returnEncodedMask&&a.mask&&(C.encodedMaskData=a.mask.bitset?a.mask.bitset:null),g.returnFileInfo&&(C.fileInfo=t(a),g.computeUsedBitDepths&&(C.fileInfo.bitDepths=i(a))),C}},e=function(A,e,t,i,r){var g,n,a,o=0,B=A.pixels.numBlocksX,C=A.pixels.numBlocksY,Q=Math.floor(A.width/B),E=Math.floor(A.height/C),s=2*A.maxZError,f=Number.MAX_VALUE;t=t||(A.mask?A.mask.bitset:null),n=new e(A.width*A.height),r&&t&&(a=new Uint8Array(A.width*A.height));for(var c,h,l=new Float32Array(Q*E),u=0;u<=C;u++){var w=u!==C?E:A.height%C;if(0!==w)for(var d=0;d<=B;d++){var D=d!==B?Q:A.width%B;if(0!==D){var y,k,p,m,G=u*A.width*E+d*Q,F=A.width-D,S=A.pixels.blocks[o];if(S.encoding<2?(0===S.encoding?y=S.rawData:(I(S.stuffedData,S.bitsPerPixel,S.numValidPixels,S.offset,s,l,A.pixels.maxValue),y=l),k=0):p=2===S.encoding?0:S.offset,t)for(h=0;h<w;h++){for(7&G&&(m=t[G>>3],m<<=7&G),c=0;c<D;c++)7&G||(m=t[G>>3]),128&m?(a&&(a[G]=1),f=f>(g=S.encoding<2?y[k++]:p)?g:f,n[G++]=g):(a&&(a[G]=0),n[G++]=i),m<<=1;G+=F}else if(S.encoding<2)for(h=0;h<w;h++){for(c=0;c<D;c++)f=f>(g=y[k++])?g:f,n[G++]=g;G+=F}else for(f=f>p?p:f,h=0;h<w;h++){for(c=0;c<D;c++)n[G++]=p;G+=F}if(1===S.encoding&&k!==S.numValidPixels)throw"Block and Mask do not match";o++}}}return{resultPixels:n,resultMask:a,minValue:f}},t=function(A){return{fileIdentifierString:A.fileIdentifierString,fileVersion:A.fileVersion,imageType:A.imageType,height:A.height,width:A.width,maxZError:A.maxZError,eofOffset:A.eofOffset,mask:A.mask?{numBlocksX:A.mask.numBlocksX,numBlocksY:A.mask.numBlocksY,numBytes:A.mask.numBytes,maxValue:A.mask.maxValue}:null,pixels:{numBlocksX:A.pixels.numBlocksX,numBlocksY:A.pixels.numBlocksY,numBytes:A.pixels.numBytes,maxValue:A.pixels.maxValue,noDataValue:A.noDataValue}}},i=function(A){for(var e=A.pixels.numBlocksX*A.pixels.numBlocksY,t={},i=0;i<e;i++){var r=A.pixels.blocks[i];0===r.encoding?t.float32=!0:1===r.encoding?t[r.bitsPerPixel]=!0:t[0]=!0}return Object.keys(t)},r=function(A,e,t){var i={},r=new Uint8Array(A,e,10);if(i.fileIdentifierString=String.fromCharCode.apply(null,r),"CntZImage"!==i.fileIdentifierString.trim())throw"Unexpected file identifier string: "+i.fileIdentifierString;e+=10;var I=new DataView(A,e,24);if(i.fileVersion=I.getInt32(0,!0),i.imageType=I.getInt32(4,!0),i.height=I.getUint32(8,!0),i.width=I.getUint32(12,!0),i.maxZError=I.getFloat64(16,!0),e+=24,!t)if(I=new DataView(A,e,16),i.mask={},i.mask.numBlocksY=I.getUint32(0,!0),i.mask.numBlocksX=I.getUint32(4,!0),i.mask.numBytes=I.getUint32(8,!0),i.mask.maxValue=I.getFloat32(12,!0),e+=16,i.mask.numBytes>0){var g=new Uint8Array(Math.ceil(i.width*i.height/8)),n=(I=new DataView(A,e,i.mask.numBytes)).getInt16(0,!0),a=2,o=0;do{if(n>0)for(;n--;)g[o++]=I.getUint8(a++);else{var B=I.getUint8(a++);for(n=-n;n--;)g[o++]=B}n=I.getInt16(a,!0),a+=2}while(a<i.mask.numBytes);if(-32768!==n||o<g.length)throw"Unexpected end of mask RLE encoding";i.mask.bitset=g,e+=i.mask.numBytes}else 0==(i.mask.numBytes|i.mask.numBlocksY|i.mask.maxValue)&&(i.mask.bitset=new Uint8Array(Math.ceil(i.width*i.height/8)));I=new DataView(A,e,16),i.pixels={},i.pixels.numBlocksY=I.getUint32(0,!0),i.pixels.numBlocksX=I.getUint32(4,!0),i.pixels.numBytes=I.getUint32(8,!0),i.pixels.maxValue=I.getFloat32(12,!0),e+=16;var C=i.pixels.numBlocksX,Q=i.pixels.numBlocksY,E=C+(i.width%C>0?1:0),s=Q+(i.height%Q>0?1:0);i.pixels.blocks=new Array(E*s);for(var f=0,c=0;c<s;c++)for(var h=0;h<E;h++){var l=0,u=A.byteLength-e;I=new DataView(A,e,Math.min(10,u));var w={};i.pixels.blocks[f++]=w;var d=I.getUint8(0);if(l++,w.encoding=63&d,w.encoding>3)throw"Invalid block encoding ("+w.encoding+")";if(2!==w.encoding){if(0!==d&&2!==d){if(d>>=6,w.offsetType=d,2===d)w.offset=I.getInt8(1),l++;else if(1===d)w.offset=I.getInt16(1,!0),l+=2;else{if(0!==d)throw"Invalid block offset type";w.offset=I.getFloat32(1,!0),l+=4}if(1===w.encoding)if(d=I.getUint8(l),l++,w.bitsPerPixel=63&d,d>>=6,w.numValidPixelsType=d,2===d)w.numValidPixels=I.getUint8(l),l++;else if(1===d)w.numValidPixels=I.getUint16(l,!0),l+=2;else{if(0!==d)throw"Invalid valid pixel count type";w.numValidPixels=I.getUint32(l,!0),l+=4}}var D;if(e+=l,3!==w.encoding)if(0===w.encoding){var y=(i.pixels.numBytes-1)/4;if(y!==Math.floor(y))throw"uncompressed block has invalid length";D=new ArrayBuffer(4*y),new Uint8Array(D).set(new Uint8Array(A,e,4*y));var k=new Float32Array(D);w.rawData=k,e+=4*y}else if(1===w.encoding){var p=Math.ceil(w.numValidPixels*w.bitsPerPixel/8),m=Math.ceil(p/4);D=new ArrayBuffer(4*m),new Uint8Array(D).set(new Uint8Array(A,e,p)),w.stuffedData=new Uint32Array(D),e+=p}}else e++}return i.eofOffset=e,i},I=function(A,e,t,i,r,I,g){var n,a,o,B=(1<<e)-1,C=0,Q=0,E=Math.ceil((g-i)/r),s=4*A.length-Math.ceil(e*t/8);for(A[A.length-1]<<=8*s,n=0;n<t;n++){if(0===Q&&(o=A[C++],Q=32),Q>=e)a=o>>>Q-e&B,Q-=e;else{var f=e-Q;a=(o&B)<<f&B,a+=(o=A[C++])>>>(Q=32-f)}I[n]=a<E?i+a*r:g}return I},A),h=(g=function(A,e,t,i,r,I,g,n){var a,o,B,C,Q,E=(1<<t)-1,s=0,f=0,c=4*A.length-Math.ceil(t*i/8);if(A[A.length-1]<<=8*c,r)for(a=0;a<i;a++)0===f&&(B=A[s++],f=32),f>=t?(o=B>>>f-t&E,f-=t):(o=(B&E)<<(C=t-f)&E,o+=(B=A[s++])>>>(f=32-C)),e[a]=r[o];else for(Q=Math.ceil((n-I)/g),a=0;a<i;a++)0===f&&(B=A[s++],f=32),f>=t?(o=B>>>f-t&E,f-=t):(o=(B&E)<<(C=t-f)&E,o+=(B=A[s++])>>>(f=32-C)),e[a]=o<Q?I+o*g:n},n=function(A,e,t,i,r,I){var g,n=(1<<e)-1,a=0,o=0,B=0,C=0,Q=0,E=[],s=4*A.length-Math.ceil(e*t/8);A[A.length-1]<<=8*s;var f=Math.ceil((I-i)/r);for(o=0;o<t;o++)0===C&&(g=A[a++],C=32),C>=e?(Q=g>>>C-e&n,C-=e):(Q=(g&n)<<(B=e-C)&n,Q+=(g=A[a++])>>>(C=32-B)),E[o]=Q<f?i+Q*r:I;return E.unshift(i),E},a=function(A,e,t,i,r,I,g,n){var a,o,B,C,Q=(1<<t)-1,E=0,s=0,f=0;if(r)for(a=0;a<i;a++)0===s&&(B=A[E++],s=32,f=0),s>=t?(o=B>>>f&Q,s-=t,f+=t):(o=B>>>f&Q,s=32-(C=t-s),o|=((B=A[E++])&(1<<C)-1)<<t-C,f=C),e[a]=r[o];else{var c=Math.ceil((n-I)/g);for(a=0;a<i;a++)0===s&&(B=A[E++],s=32,f=0),s>=t?(o=B>>>f&Q,s-=t,f+=t):(o=B>>>f&Q,s=32-(C=t-s),o|=((B=A[E++])&(1<<C)-1)<<t-C,f=C),e[a]=o<c?I+o*g:n}return e},o=function(A,e,t,i,r,I){var g,n=(1<<e)-1,a=0,o=0,B=0,C=0,Q=0,E=0,s=[],f=Math.ceil((I-i)/r);for(o=0;o<t;o++)0===C&&(g=A[a++],C=32,E=0),C>=e?(Q=g>>>E&n,C-=e,E+=e):(Q=g>>>E&n,C=32-(B=e-C),Q|=((g=A[a++])&(1<<B)-1)<<e-B,E=B),s[o]=Q<f?i+Q*r:I;return s.unshift(i),s},B=function(A,e,t,i){var r,I,g,n,a=(1<<t)-1,o=0,B=0,C=4*A.length-Math.ceil(t*i/8);for(A[A.length-1]<<=8*C,r=0;r<i;r++)0===B&&(g=A[o++],B=32),B>=t?(I=g>>>B-t&a,B-=t):(I=(g&a)<<(n=t-B)&a,I+=(g=A[o++])>>>(B=32-n)),e[r]=I;return e},C=function(A,e,t,i){var r,I,g,n,a=(1<<t)-1,o=0,B=0,C=0;for(r=0;r<i;r++)0===B&&(g=A[o++],B=32,C=0),B>=t?(I=g>>>C&a,B-=t,C+=t):(I=g>>>C&a,B=32-(n=t-B),I|=((g=A[o++])&(1<<n)-1)<<t-n,C=n),e[r]=I;return e},Q={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(A){for(var e=65535,t=65535,i=A.length,r=Math.floor(i/2),I=0;r;){var g=r>=359?359:r;r-=g;do{e+=A[I++]<<8,t+=e+=A[I++]}while(--g);e=(65535&e)+(e>>>16),t=(65535&t)+(t>>>16)}return 1&i&&(t+=e+=A[I]<<8),((t=(65535&t)+(t>>>16))<<16|(e=(65535&e)+(e>>>16)))>>>0},readHeaderInfo:function(A,e){var t=e.ptr,i=new Uint8Array(A,t,6),r={};if(r.fileIdentifierString=String.fromCharCode.apply(null,i),0!==r.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+r.fileIdentifierString;t+=6;var I,g=new DataView(A,t,8),n=g.getInt32(0,!0);if(r.fileVersion=n,t+=4,n>=3&&(r.checksum=g.getUint32(4,!0),t+=4),g=new DataView(A,t,12),r.height=g.getUint32(0,!0),r.width=g.getUint32(4,!0),t+=8,n>=4?(r.numDims=g.getUint32(8,!0),t+=4):r.numDims=1,g=new DataView(A,t,40),r.numValidPixel=g.getUint32(0,!0),r.microBlockSize=g.getInt32(4,!0),r.blobSize=g.getInt32(8,!0),r.imageType=g.getInt32(12,!0),r.maxZError=g.getFloat64(16,!0),r.zMin=g.getFloat64(24,!0),r.zMax=g.getFloat64(32,!0),t+=40,e.headerInfo=r,e.ptr=t,n>=3&&(I=n>=4?52:48,this.computeChecksumFletcher32(new Uint8Array(A,t-I,r.blobSize-14))!==r.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(A,e){var t=e.headerInfo,i=this.getDataTypeArray(t.imageType),r=t.numDims*this.getDataTypeSize(t.imageType),I=this.readSubArray(A,e.ptr,i,r),g=this.readSubArray(A,e.ptr+r,i,r);e.ptr+=2*r;var n,a=!0;for(n=0;n<t.numDims;n++)if(I[n]!==g[n]){a=!1;break}return t.minValues=I,t.maxValues=g,a},readSubArray:function(A,e,t,i){var r;if(t===Uint8Array)r=new Uint8Array(A,e,i);else{var I=new ArrayBuffer(i);new Uint8Array(I).set(new Uint8Array(A,e,i)),r=new t(I)}return r},readMask:function(A,e){var t,i,r=e.ptr,I=e.headerInfo,g=I.width*I.height,n=I.numValidPixel,a=new DataView(A,r,4),o={};if(o.numBytes=a.getUint32(0,!0),r+=4,(0===n||g===n)&&0!==o.numBytes)throw"invalid mask";if(0===n)t=new Uint8Array(Math.ceil(g/8)),o.bitset=t,i=new Uint8Array(g),e.pixels.resultMask=i,r+=o.numBytes;else if(o.numBytes>0){t=new Uint8Array(Math.ceil(g/8));var B=(a=new DataView(A,r,o.numBytes)).getInt16(0,!0),C=2,Q=0,E=0;do{if(B>0)for(;B--;)t[Q++]=a.getUint8(C++);else for(E=a.getUint8(C++),B=-B;B--;)t[Q++]=E;B=a.getInt16(C,!0),C+=2}while(C<o.numBytes);if(-32768!==B||Q<t.length)throw"Unexpected end of mask RLE encoding";i=new Uint8Array(g);var s=0,f=0;for(f=0;f<g;f++)7&f?(s=t[f>>3],s<<=7&f):s=t[f>>3],128&s&&(i[f]=1);e.pixels.resultMask=i,o.bitset=t,r+=o.numBytes}return e.ptr=r,e.mask=o,!0},readDataOneSweep:function(A,e,t,i){var r,I=e.ptr,g=e.headerInfo,n=g.numDims,a=g.width*g.height,o=g.imageType,B=g.numValidPixel*Q.getDataTypeSize(o)*n,C=e.pixels.resultMask;if(t===Uint8Array)r=new Uint8Array(A,I,B);else{var E=new ArrayBuffer(B);new Uint8Array(E).set(new Uint8Array(A,I,B)),r=new t(E)}if(r.length===a*n)e.pixels.resultPixels=i?Q.swapDimensionOrder(r,a,n,t,!0):r;else{e.pixels.resultPixels=new t(a*n);var s=0,f=0,c=0,h=0;if(n>1){if(i){for(f=0;f<a;f++)if(C[f])for(h=f,c=0;c<n;c++,h+=a)e.pixels.resultPixels[h]=r[s++]}else for(f=0;f<a;f++)if(C[f])for(h=f*n,c=0;c<n;c++)e.pixels.resultPixels[h+c]=r[s++]}else for(f=0;f<a;f++)C[f]&&(e.pixels.resultPixels[f]=r[s++])}return I+=B,e.ptr=I,!0},readHuffmanTree:function(A,e){var t=this.HUFFMAN_LUT_BITS_MAX,i=new DataView(A,e.ptr,16);if(e.ptr+=16,i.getInt32(0,!0)<2)throw"unsupported Huffman version";var r=i.getInt32(4,!0),I=i.getInt32(8,!0),g=i.getInt32(12,!0);if(I>=g)return!1;var n=new Uint32Array(g-I);Q.decodeBits(A,e,n);var a,o,B,C,s=[];for(a=I;a<g;a++)s[o=a-(a<r?0:r)]={first:n[a-I],second:null};var f=A.byteLength-e.ptr,c=Math.ceil(f/4),h=new ArrayBuffer(4*c);new Uint8Array(h).set(new Uint8Array(A,e.ptr,f));var l,u=new Uint32Array(h),w=0,d=0;for(l=u[0],a=I;a<g;a++)(C=s[o=a-(a<r?0:r)].first)>0&&(s[o].second=l<<w>>>32-C,32-w>=C?32===(w+=C)&&(w=0,l=u[++d]):(w+=C-32,l=u[++d],s[o].second|=l>>>32-w));var D=0,y=0,k=new E;for(a=0;a<s.length;a++)void 0!==s[a]&&(D=Math.max(D,s[a].first));y=D>=t?t:D;var p,m,G,F,S,v=[];for(a=I;a<g;a++)if((C=s[o=a-(a<r?0:r)].first)>0)if(p=[C,o],C<=y)for(m=s[o].second<<y-C,G=1<<y-C,B=0;B<G;B++)v[m|B]=p;else for(m=s[o].second,S=k,F=C-1;F>=0;F--)m>>>F&1?(S.right||(S.right=new E),S=S.right):(S.left||(S.left=new E),S=S.left),0!==F||S.val||(S.val=p[1]);return{decodeLut:v,numBitsLUTQick:y,numBitsLUT:D,tree:k,stuffedData:u,srcPtr:d,bitPos:w}},readHuffman:function(A,e,t,i){var r,I,g,n,a,o,B,C,E,s=e.headerInfo.numDims,f=e.headerInfo.height,c=e.headerInfo.width,h=c*f,l=this.readHuffmanTree(A,e),u=l.decodeLut,w=l.tree,d=l.stuffedData,D=l.srcPtr,y=l.bitPos,k=l.numBitsLUTQick,p=l.numBitsLUT,m=0===e.headerInfo.imageType?128:0,G=e.pixels.resultMask,F=0;y>0&&(D++,y=0);var S,v=d[D],R=1===e.encodeMode,U=new t(h*s),L=U;if(s<2||R){for(S=0;S<s;S++)if(s>1&&(L=new t(U.buffer,h*S,h),F=0),e.headerInfo.numValidPixel===c*f)for(C=0,o=0;o<f;o++)for(B=0;B<c;B++,C++){if(I=0,a=n=v<<y>>>32-k,32-y<k&&(a=n|=d[D+1]>>>64-y-k),u[a])I=u[a][1],y+=u[a][0];else for(a=n=v<<y>>>32-p,32-y<p&&(a=n|=d[D+1]>>>64-y-p),r=w,E=0;E<p;E++)if(!(r=n>>>p-E-1&1?r.right:r.left).left&&!r.right){I=r.val,y=y+E+1;break}y>=32&&(y-=32,v=d[++D]),g=I-m,R?(g+=B>0?F:o>0?L[C-c]:F,g&=255,L[C]=g,F=g):L[C]=g}else for(C=0,o=0;o<f;o++)for(B=0;B<c;B++,C++)if(G[C]){if(I=0,a=n=v<<y>>>32-k,32-y<k&&(a=n|=d[D+1]>>>64-y-k),u[a])I=u[a][1],y+=u[a][0];else for(a=n=v<<y>>>32-p,32-y<p&&(a=n|=d[D+1]>>>64-y-p),r=w,E=0;E<p;E++)if(!(r=n>>>p-E-1&1?r.right:r.left).left&&!r.right){I=r.val,y=y+E+1;break}y>=32&&(y-=32,v=d[++D]),g=I-m,R?(B>0&&G[C-1]?g+=F:o>0&&G[C-c]?g+=L[C-c]:g+=F,g&=255,L[C]=g,F=g):L[C]=g}}else for(C=0,o=0;o<f;o++)for(B=0;B<c;B++)if(C=o*c+B,!G||G[C])for(S=0;S<s;S++,C+=h){if(I=0,a=n=v<<y>>>32-k,32-y<k&&(a=n|=d[D+1]>>>64-y-k),u[a])I=u[a][1],y+=u[a][0];else for(a=n=v<<y>>>32-p,32-y<p&&(a=n|=d[D+1]>>>64-y-p),r=w,E=0;E<p;E++)if(!(r=n>>>p-E-1&1?r.right:r.left).left&&!r.right){I=r.val,y=y+E+1;break}y>=32&&(y-=32,v=d[++D]),g=I-m,L[C]=g}e.ptr=e.ptr+4*(D+1)+(y>0?4:0),e.pixels.resultPixels=U,s>1&&!i&&(e.pixels.resultPixels=Q.swapDimensionOrder(U,h,s,t))},decodeBits:function(A,e,t,i,r){var I=e.headerInfo,Q=I.fileVersion,E=0,s=A.byteLength-e.ptr>=5?5:A.byteLength-e.ptr,f=new DataView(A,e.ptr,s),c=f.getUint8(0);E++;var h=c>>6,l=0===h?4:3-h,u=(32&c)>0,w=31&c,d=0;if(1===l)d=f.getUint8(E),E++;else if(2===l)d=f.getUint16(E,!0),E+=2;else{if(4!==l)throw"Invalid valid pixel count type";d=f.getUint32(E,!0),E+=4}var D,y,k,p,m,G,F,S,v,R=2*I.maxZError,U=I.numDims>1?I.maxValues[r]:I.zMax;if(u){for(e.counter.lut++,S=f.getUint8(E),E++,p=Math.ceil((S-1)*w/8),m=Math.ceil(p/4),y=new ArrayBuffer(4*m),k=new Uint8Array(y),e.ptr+=E,k.set(new Uint8Array(A,e.ptr,p)),F=new Uint32Array(y),e.ptr+=p,v=0;S-1>>>v;)v++;p=Math.ceil(d*v/8),m=Math.ceil(p/4),y=new ArrayBuffer(4*m),(k=new Uint8Array(y)).set(new Uint8Array(A,e.ptr,p)),D=new Uint32Array(y),e.ptr+=p,G=Q>=3?o(F,w,S-1,i,R,U):n(F,w,S-1,i,R,U),Q>=3?a(D,t,v,d,G):g(D,t,v,d,G)}else e.counter.bitstuffer++,v=w,e.ptr+=E,v>0&&(p=Math.ceil(d*v/8),m=Math.ceil(p/4),y=new ArrayBuffer(4*m),(k=new Uint8Array(y)).set(new Uint8Array(A,e.ptr,p)),D=new Uint32Array(y),e.ptr+=p,Q>=3?null==i?C(D,t,v,d):a(D,t,v,d,!1,i,R,U):null==i?B(D,t,v,d):g(D,t,v,d,!1,i,R,U))},readTiles:function(A,e,t,i){var r=e.headerInfo,I=r.width,g=r.height,n=I*g,a=r.microBlockSize,o=r.imageType,B=Q.getDataTypeSize(o),C=Math.ceil(I/a),E=Math.ceil(g/a);e.pixels.numBlocksY=E,e.pixels.numBlocksX=C,e.pixels.ptr=0;var s,f,c,h,l,u,w,d,D,y,k=0,p=0,m=0,G=0,F=0,S=0,v=0,R=0,U=0,L=0,b=0,M=0,N=0,x=0,J=0,q=new t(a*a),Y=g%a||a,K=I%a||a,H=r.numDims,O=e.pixels.resultMask,P=e.pixels.resultPixels,T=r.fileVersion>=5?14:15,V=r.zMax;for(m=0;m<E;m++)for(F=m!==E-1?a:Y,G=0;G<C;G++)for(L=m*I*a+G*a,b=I-(S=G!==C-1?a:K),d=0;d<H;d++){if(H>1?(y=P,L=m*I*a+G*a,P=new t(e.pixels.resultPixels.buffer,n*d*B,n),V=r.maxValues[d]):y=null,v=A.byteLength-e.ptr,f={},J=0,R=(s=new DataView(A,e.ptr,Math.min(10,v))).getUint8(0),J++,D=r.fileVersion>=5?4&R:0,U=R>>6&255,(R>>2&T)!=(G*a>>3&T))throw"integrity issue";if(D&&0===d)throw"integrity issue";if((l=3&R)>3)throw e.ptr+=J,"Invalid block encoding ("+l+")";if(2!==l)if(0===l){if(D)throw"integrity issue";if(e.counter.uncompressed++,e.ptr+=J,M=(M=F*S*B)<(N=A.byteLength-e.ptr)?M:N,c=new ArrayBuffer(M%B==0?M:M+B-M%B),new Uint8Array(c).set(new Uint8Array(A,e.ptr,M)),h=new t(c),x=0,O)for(k=0;k<F;k++){for(p=0;p<S;p++)O[L]&&(P[L]=h[x++]),L++;L+=b}else for(k=0;k<F;k++){for(p=0;p<S;p++)P[L++]=h[x++];L+=b}e.ptr+=x*B}else if(u=Q.getDataTypeUsed(D&&o<6?4:o,U),w=Q.getOnePixel(f,J,u,s),J+=Q.getDataTypeSize(u),3===l)if(e.ptr+=J,e.counter.constantoffset++,O)for(k=0;k<F;k++){for(p=0;p<S;p++)O[L]&&(P[L]=D?Math.min(V,y[L]+w):w),L++;L+=b}else for(k=0;k<F;k++){for(p=0;p<S;p++)P[L]=D?Math.min(V,y[L]+w):w,L++;L+=b}else if(e.ptr+=J,Q.decodeBits(A,e,q,w,d),J=0,D)if(O)for(k=0;k<F;k++){for(p=0;p<S;p++)O[L]&&(P[L]=q[J++]+y[L]),L++;L+=b}else for(k=0;k<F;k++){for(p=0;p<S;p++)P[L]=q[J++]+y[L],L++;L+=b}else if(O)for(k=0;k<F;k++){for(p=0;p<S;p++)O[L]&&(P[L]=q[J++]),L++;L+=b}else for(k=0;k<F;k++){for(p=0;p<S;p++)P[L++]=q[J++];L+=b}else{if(D)if(O)for(k=0;k<F;k++)for(p=0;p<S;p++)O[L]&&(P[L]=y[L]),L++;else for(k=0;k<F;k++)for(p=0;p<S;p++)P[L]=y[L],L++;e.counter.constant++,e.ptr+=J}}H>1&&!i&&(e.pixels.resultPixels=Q.swapDimensionOrder(e.pixels.resultPixels,n,H,t))},formatFileInfo:function(A){return{fileIdentifierString:A.headerInfo.fileIdentifierString,fileVersion:A.headerInfo.fileVersion,imageType:A.headerInfo.imageType,height:A.headerInfo.height,width:A.headerInfo.width,numValidPixel:A.headerInfo.numValidPixel,microBlockSize:A.headerInfo.microBlockSize,blobSize:A.headerInfo.blobSize,maxZError:A.headerInfo.maxZError,pixelType:Q.getPixelType(A.headerInfo.imageType),eofOffset:A.eofOffset,mask:A.mask?{numBytes:A.mask.numBytes}:null,pixels:{numBlocksX:A.pixels.numBlocksX,numBlocksY:A.pixels.numBlocksY,maxValue:A.headerInfo.zMax,minValue:A.headerInfo.zMin,noDataValue:A.noDataValue}}},constructConstantSurface:function(A,e){var t=A.headerInfo.zMax,i=A.headerInfo.zMin,r=A.headerInfo.maxValues,I=A.headerInfo.numDims,g=A.headerInfo.height*A.headerInfo.width,n=0,a=0,o=0,B=A.pixels.resultMask,C=A.pixels.resultPixels;if(B)if(I>1){if(e)for(n=0;n<I;n++)for(o=n*g,t=r[n],a=0;a<g;a++)B[a]&&(C[o+a]=t);else for(a=0;a<g;a++)if(B[a])for(o=a*I,n=0;n<I;n++)C[o+I]=r[n]}else for(a=0;a<g;a++)B[a]&&(C[a]=t);else if(I>1&&i!==t)if(e)for(n=0;n<I;n++)for(o=n*g,t=r[n],a=0;a<g;a++)C[o+a]=t;else for(a=0;a<g;a++)for(o=a*I,n=0;n<I;n++)C[o+n]=r[n];else for(a=0;a<g*I;a++)C[a]=t},getDataTypeArray:function(A){var e;switch(A){case 0:e=Int8Array;break;case 1:e=Uint8Array;break;case 2:e=Int16Array;break;case 3:e=Uint16Array;break;case 4:e=Int32Array;break;case 5:e=Uint32Array;break;case 6:default:e=Float32Array;break;case 7:e=Float64Array}return e},getPixelType:function(A){var e;switch(A){case 0:e="S8";break;case 1:e="U8";break;case 2:e="S16";break;case 3:e="U16";break;case 4:e="S32";break;case 5:e="U32";break;case 6:default:e="F32";break;case 7:e="F64"}return e},isValidPixelValue:function(A,e){if(null==e)return!1;var t;switch(A){case 0:t=e>=-128&&e<=127;break;case 1:t=e>=0&&e<=255;break;case 2:t=e>=-32768&&e<=32767;break;case 3:t=e>=0&&e<=65536;break;case 4:t=e>=-2147483648&&e<=2147483647;break;case 5:t=e>=0&&e<=4294967296;break;case 6:t=e>=-34027999387901484e22&&e<=34027999387901484e22;break;case 7:t=e>=-17976931348623157e292&&e<=17976931348623157e292;break;default:t=!1}return t},getDataTypeSize:function(A){var e=0;switch(A){case 0:case 1:e=1;break;case 2:case 3:e=2;break;case 4:case 5:case 6:e=4;break;case 7:e=8;break;default:e=A}return e},getDataTypeUsed:function(A,e){var t=A;switch(A){case 2:case 4:t=A-e;break;case 3:case 5:t=A-2*e;break;case 6:t=0===e?A:1===e?2:1;break;case 7:t=0===e?A:A-2*e+1;break;default:t=A}return t},getOnePixel:function(A,e,t,i){var r=0;switch(t){case 0:r=i.getInt8(e);break;case 1:r=i.getUint8(e);break;case 2:r=i.getInt16(e,!0);break;case 3:r=i.getUint16(e,!0);break;case 4:r=i.getInt32(e,!0);break;case 5:r=i.getUInt32(e,!0);break;case 6:r=i.getFloat32(e,!0);break;case 7:r=i.getFloat64(e,!0);break;default:throw"the decoder does not understand this pixel type"}return r},swapDimensionOrder:function(A,e,t,i,r){var I=0,g=0,n=0,a=0,o=A;if(t>1)if(o=new i(e*t),r)for(I=0;I<e;I++)for(a=I,n=0;n<t;n++,a+=e)o[a]=A[g++];else for(I=0;I<e;I++)for(a=I,n=0;n<t;n++,a+=e)o[g++]=A[a];return o}},E=function(A,e,t){this.val=A,this.left=e,this.right=t},{decode:function(A,e){var t=(e=e||{}).noDataValue,i=0,r={};r.ptr=e.inputOffset||0,r.pixels={},Q.readHeaderInfo(A,r);var I=r.headerInfo,g=I.fileVersion,n=Q.getDataTypeArray(I.imageType);if(g>5)throw"unsupported lerc version 2."+g;Q.readMask(A,r),I.numValidPixel===I.width*I.height||r.pixels.resultMask||(r.pixels.resultMask=e.maskData);var a=I.width*I.height;r.pixels.resultPixels=new n(a*I.numDims),r.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};var o,B=!e.returnPixelInterleavedDims;if(0!==I.numValidPixel)if(I.zMax===I.zMin)Q.constructConstantSurface(r,B);else if(g>=4&&Q.checkMinMaxRanges(A,r))Q.constructConstantSurface(r,B);else{var C=new DataView(A,r.ptr,2),E=C.getUint8(0);if(r.ptr++,E)Q.readDataOneSweep(A,r,n,B);else if(g>1&&I.imageType<=1&&Math.abs(I.maxZError-.5)<1e-5){var s=C.getUint8(1);if(r.ptr++,r.encodeMode=s,s>2||g<4&&s>1)throw"Invalid Huffman flag "+s;s?Q.readHuffman(A,r,n,B):Q.readTiles(A,r,n,B)}else Q.readTiles(A,r,n,B)}r.eofOffset=r.ptr,e.inputOffset?(o=r.headerInfo.blobSize+e.inputOffset-r.ptr,Math.abs(o)>=1&&(r.eofOffset=e.inputOffset+r.headerInfo.blobSize)):(o=r.headerInfo.blobSize-r.ptr,Math.abs(o)>=1&&(r.eofOffset=r.headerInfo.blobSize));var f={width:I.width,height:I.height,pixelData:r.pixels.resultPixels,minValue:I.zMin,maxValue:I.zMax,validPixelCount:I.numValidPixel,dimCount:I.numDims,dimStats:{minValues:I.minValues,maxValues:I.maxValues},maskData:r.pixels.resultMask};if(r.pixels.resultMask&&Q.isValidPixelValue(I.imageType,t)){var c=r.pixels.resultMask;for(i=0;i<a;i++)c[i]||(f.pixelData[i]=t);f.noDataValue=t}return r.noDataValue=t,e.returnFileInfo&&(f.fileInfo=Q.formatFileInfo(r)),f},getBandCount:function(A){for(var e=0,t=0,i={ptr:0,pixels:{}};t<A.byteLength-58;)Q.readHeaderInfo(A,i),t+=i.headerInfo.blobSize,e++,i.ptr=t;return e}}),l=(s=new ArrayBuffer(4),f=new Uint8Array(s),new Uint32Array(s)[0]=1,1===f[0]),u={decode:function(A,e){if(!l)throw"Big endian system is not supported.";var t,i,r=(e=e||{}).inputOffset||0,I=new Uint8Array(A,r,10),g=String.fromCharCode.apply(null,I);if("CntZImage"===g.trim())t=c,i=1;else{if("Lerc2"!==g.substring(0,5))throw"Unexpected file identifier string: "+g;t=h,i=2}for(var n,a,o,B,C,Q,E=0,s=A.byteLength-10,f=[],u={width:0,height:0,pixels:[],pixelType:e.pixelType,mask:null,statistics:[]},w=0;r<s;){var d=t.decode(A,{inputOffset:r,encodedMaskData:n,maskData:o,returnMask:0===E,returnEncodedMask:0===E,returnFileInfo:!0,returnPixelInterleavedDims:e.returnPixelInterleavedDims,pixelType:e.pixelType||null,noDataValue:e.noDataValue||null});r=d.fileInfo.eofOffset,o=d.maskData,0===E&&(n=d.encodedMaskData,u.width=d.width,u.height=d.height,u.dimCount=d.dimCount||1,u.pixelType=d.pixelType||d.fileInfo.pixelType,u.mask=o),i>1&&(o&&f.push(o),d.fileInfo.mask&&d.fileInfo.mask.numBytes>0&&w++),E++,u.pixels.push(d.pixelData),u.statistics.push({minValue:d.minValue,maxValue:d.maxValue,noDataValue:d.noDataValue,dimStats:d.dimStats})}if(i>1&&w>1){for(Q=u.width*u.height,u.bandMasks=f,(o=new Uint8Array(Q)).set(f[0]),B=1;B<f.length;B++)for(a=f[B],C=0;C<Q;C++)o[C]=o[C]&a[C];u.maskData=o}return u}};TA.exports?TA.exports=u:this.Lerc=u}();var ZA,jA,WA,zA=XA.exports,$A={env:{emscripten_notify_memory_growth:function(A){WA=new Uint8Array(jA.exports.memory.buffer)}}},Ae=function(){function A(){B(this,A)}return Q(A,[{key:"init",value:function(){return ZA||(ZA="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+ee).then((function(A){return A.arrayBuffer()})).then((function(A){return WebAssembly.instantiate(A,$A)})).then(this._init):WebAssembly.instantiate(Buffer.from(ee,"base64"),$A).then(this._init))}},{key:"_init",value:function(A){jA=A.instance,$A.env.emscripten_notify_memory_growth(0)}},{key:"decode",value:function(A){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!jA)throw new Error("ZSTDDecoder: Await .init() before decoding.");var t=A.byteLength,i=jA.exports.malloc(t);WA.set(A,i),e=e||Number(jA.exports.ZSTD_findDecompressedSize(i,t));var r=jA.exports.malloc(e),I=jA.exports.ZSTD_decompress(r,e,i,t),g=WA.slice(r,r+I);return jA.exports.free(i),jA.exports.free(r),g}}]),A}(),ee="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",te={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},ie={};for(var re in te)te.hasOwnProperty(re)&&(ie[te[re]]=parseInt(re,10));ie.BitsPerSample,ie.ExtraSamples,ie.SampleFormat,ie.StripByteCounts,ie.StripOffsets,ie.StripRowCounts,ie.TileByteCounts,ie.TileOffsets,ie.SubIFDs;var Ie={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},ge={};for(var ne in Ie)Ie.hasOwnProperty(ne)&&(ge[Ie[ne]]=parseInt(ne,10));var ae=1,oe=0,Be=1,Ce=2,Qe={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"},Ee={};for(var se in Qe)Qe.hasOwnProperty(se)&&(Ee[Qe[se]]=parseInt(se,10));function fe(A){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(A){return!1}}();return function(){var t,i=c(A);if(e){var r=c(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return f(this,t)}}var ce=new Ae,he=function(A){s(t,w);var e=fe(t);function t(A){var i;return B(this,t),(i=e.call(this)).planarConfiguration=void 0!==A.PlanarConfiguration?A.PlanarConfiguration:1,i.samplesPerPixel=void 0!==A.SamplesPerPixel?A.SamplesPerPixel:1,i.addCompression=A.LercParameters[ae],i}return Q(t,[{key:"decodeBlock",value:function(A){switch(this.addCompression){case oe:break;case Be:A=YA(new Uint8Array(A)).buffer;break;case Ce:A=ce.decode(new Uint8Array(A)).buffer;break;default:throw new Error("Unsupported LERC additional compression method identifier: ".concat(this.addCompression))}return zA.decode(A,{returnPixelInterleavedDims:1===this.planarConfiguration}).pixels[0].buffer}}]),t}(),le=Object.freeze({__proto__:null,zstd:ce,default:he});function ue(A){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(A){return!1}}();return function(){var t,i=c(A);if(e){var r=c(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return f(this,t)}}var we=function(A){s(I,w);var t,i=ue(I);function I(){var A;if(B(this,I),A=i.call(this),"undefined"==typeof createImageBitmap)throw new Error("Cannot decode WebImage as `createImageBitmap` is not available");if("undefined"==typeof document&&"undefined"==typeof OffscreenCanvas)throw new Error("Cannot decode WebImage as neither `document` nor `OffscreenCanvas` is not available");return A}return Q(I,[{key:"decode",value:(t=e(r.mark((function A(e,t){var i,I,g,n;return r.wrap((function(A){for(;;)switch(A.prev=A.next){case 0:return i=new Blob([t]),A.next=3,createImageBitmap(i);case 3:return I=A.sent,"undefined"!=typeof document?((g=document.createElement("canvas")).width=I.width,g.height=I.height):g=new OffscreenCanvas(I.width,I.height),(n=g.getContext("2d")).drawImage(I,0,0),A.abrupt("return",n.getImageData(0,0,I.width,I.height).data.buffer);case 8:case"end":return A.stop()}}),A)}))),function(A,e){return t.apply(this,arguments)})}]),I}(),de=Object.freeze({__proto__:null,default:we});';return new te(typeof Buffer<"u"?"data:application/javascript;base64,"+Buffer.from(p,"binary").toString("base64"):URL.createObjectURL(new Blob([p],{type:"application/javascript"})))}});I.cogProtocol=async p=>{if(p.type=="json"){const g=p.url.replace("cog://","").split("#")[0];return{data:await Ms(g).getTilejson(p.url)}}if(p.type=="image")return{data:await wo(p.url)};throw new Error(`Unsupported request type '${p.type}'`)},I.colorScale=pl,I.colorSchemeNames=gi,I.locationValues=async(p,{latitude:g,longitude:A},v)=>{const x=Ms(p),{minzoom:Q,maxzoom:T}=await x.getTilejson(p),{noData:k,scale:q,offset:G}=await x.getMetadata(),O=v===void 0?T:Math.max(Q,Math.min(T,Math.round(v))),{tileIndex:re,column:K,row:U}=(({latitude:ne,longitude:le,zoom:se})=>{const[ue,Ie]=Ds.forward([le,ne]),pe=(ue+qn/2)/qn*yn*2**se,Be=-(Ie-qn/2)/qn*yn*2**se;return{tileIndex:{z:se,x:Math.floor(pe/yn),y:Math.floor(Be/yn)},row:Math.floor(Be%yn),column:Math.floor(pe%yn)}})({latitude:g,longitude:A,zoom:O});return(await x.getRawTile(re)).map(ne=>{const le=G+ne[256*U+K]*q;return le===k||isNaN(le)||le===1/0?NaN:le})}})})(lu,lu.exports);var zd=lu.exports;const hc=Pa(0),ip=Pd(hc,V=>V>0),rp={overlayOpacity:.4,activeLayer:"exposure",lightningPeriod:"year"},Qs=Pa(rp);function np(V){Qs.update(m=>({...m,overlayOpacity:V}))}function sp(V){Qs.update(m=>({...m,activeLayer:V}))}function ru(V){Qs.update(m=>({...m,lightningPeriod:V}))}const ap=Wg,op=7,lp=[{color:[255,0,0]},{color:[255,80,0]},{color:[255,140,0]},{color:[255,140,0]},{color:[255,140,0]},{color:[255,180,0]},{color:[255,180,0]},{color:[255,180,0]},{color:[255,180,0]},{color:[255,180,0]},{color:[255,220,0]},{color:[255,220,0]},{color:[255,220,0]},{color:[255,220,0]},{color:[255,220,0]},{color:[255,255,0]},{color:[255,255,0]},{color:[255,255,0]},{color:[255,255,0]},{color:[255,255,0]},{color:[200,255,0]},{color:[200,255,0]},{color:[200,255,0]},{color:[200,255,0]},{color:[200,255,0]},{color:[160,250,0]},{color:[160,250,0]},{color:[160,250,0]},{color:[160,250,0]},{color:[160,250,0]},{color:[120,235,0]},{color:[120,235,0]},{color:[120,235,0]},{color:[120,235,0]},{color:[120,235,0]},{color:[80,210,0]},{color:[80,210,0]},{color:[80,210,0]},{color:[80,210,0]},{color:[80,210,0]},{color:[50,185,0]},{color:[50,185,0]},{color:[50,185,0]},{color:[50,185,0]},{color:[50,185,0]},{color:[30,160,0]},{color:[30,160,0]},{color:[30,160,0]},{color:[30,160,0]},{color:[30,160,0]}];function cp(V,m){const I=V>=0?"N":"S",E=m>=0?"E":"W",P=Math.floor(Math.abs(V)/10)*10,Z=Math.floor(Math.abs(m)/10)*10;return`${I}${P.toString().padStart(2,"0")}_${E}${Z.toString().padStart(3,"0")}`}function hp(V,m){const I=V>=0?"N":"S",E=m>=0?"E":"W";return`${I}${Math.abs(V).toString().padStart(2,"0")}_${E}${Math.abs(m).toString().padStart(3,"0")}`}function up(V){const m=[],I=Math.floor(V.south),E=Math.floor(V.north),P=Math.floor(V.west),Z=Math.floor(V.east);for(let S=I;S<=E;S++)for(let c=P;c<=Z;c++){const he=cp(S,c),Ee=hp(S,c);m.push({region:he,tile:Ee,key:`${he}/${Ee}`})}return m}function Ap(){return`[${lp.map(m=>{const I=m.color[0].toString(16).padStart(2,"0"),E=m.color[1].toString(16).padStart(2,"0"),P=m.color[2].toString(16).padStart(2,"0");return`"#${I}${E}${P}"`}).join(",")}]`}function dp(V){const m=Ap();return`cog://${V}#color:${m},1,255`}class fp{constructor(m){Ma(this,"map");Ma(this,"loadedTiles",new Set);Ma(this,"loadingTiles",new Set);Ma(this,"protocolRegistered",!1);this.map=m}async init(){if(!this.protocolRegistered)try{Gc.addProtocol("cog",zd.cogProtocol),this.protocolRegistered=!0,console.log("COG protocol registered")}catch(m){console.log("COG protocol already registered or failed:",m)}return!0}boundsToMapBounds(m){return{west:m.getWest(),south:m.getSouth(),east:m.getEast(),north:m.getNorth()}}async loadTile(m){if(this.loadedTiles.has(m.key)||this.loadingTiles.has(m.key))return;this.loadingTiles.add(m.key),hc.update(Z=>Z+1);const I=`${ap}/${m.region}/${m.tile}.cog.tif`,E=`cog-${m.key.replace("/","-")}`,P=`cog-layer-${m.key.replace("/","-")}`;try{const Z=await fetch(I,{method:"HEAD"});if(Z.status===404){this.loadedTiles.add(m.key);return}if(!Z.ok)throw new Error(`HTTP ${Z.status}`);if(!this.map.getSource(E)){const S=dp(I);this.map.addSource(E,{type:"raster",url:S,tileSize:256});const c=Es(Qs);this.map.addLayer({id:P,type:"raster",source:E,paint:{"raster-opacity":c.overlayOpacity,"raster-resampling":"nearest"}}),console.log(`Loaded COG: ${m.key}`)}this.loadedTiles.add(m.key)}catch(Z){console.error(`Failed to load COG ${m.key}:`,Z)}finally{this.loadingTiles.delete(m.key),hc.update(Z=>Math.max(0,Z-1))}}loadVisibleRegions(){if(this.map.getZoom()<op){this.hideAllLayers();return}this.showAllLayers();const I=this.boundsToMapBounds(this.map.getBounds()),E=up(I);for(const P of E)this.loadTile(P)}hideAllLayers(){for(const m of this.loadedTiles){const I=`cog-layer-${m.replace("/","-")}`;this.map.getLayer(I)&&this.map.setLayoutProperty(I,"visibility","none")}}showAllLayers(){for(const m of this.loadedTiles){const I=`cog-layer-${m.replace("/","-")}`;this.map.getLayer(I)&&this.map.setLayoutProperty(I,"visibility","visible")}}onViewportChange(){this.loadVisibleRegions()}updateOpacity(m){for(const I of this.loadedTiles){const E=`cog-layer-${I.replace("/","-")}`;this.map.getLayer(E)&&this.map.setPaintProperty(E,"raster-opacity",m)}}isEnabled(){return!0}destroy(){for(const m of this.loadedTiles){const I=`cog-layer-${m.replace("/","-")}`,E=`cog-${m.replace("/","-")}`;this.map.getLayer(I)&&this.map.removeLayer(I),this.map.getSource(E)&&this.map.removeSource(E)}this.loadedTiles.clear(),this.loadingTiles.clear()}}const gp=[{id:1,min:0,max:0,level:"Exposed",color:"#FF0000"},{id:2,min:0,max:25,level:"Very Low",color:"#FF7800"},{id:3,min:25,max:50,level:"Low",color:"#FFA000"},{id:4,min:50,max:100,level:"Moderate",color:"#FFD200"},{id:5,min:100,max:150,level:"Good",color:"#FFFF00"},{id:6,min:150,max:200,level:"Very Good",color:"#C8FF00"},{id:7,min:200,max:1/0,level:"Protected",color:"#64DC00"}],Gd=["#004000","#005300","#006600","#007700","#008800","#009900","#00AA00","#00BB00","#00CC00","#00DD00","#00EE00","#22F600","#44FF00","#66FF00","#88FF00","#AAFF00","#CCFF00","#E5FF00","#FFFF00","#FFF000","#FFE000","#FFD000","#FFC000","#FFB000","#FFA000","#FF9000","#FF8000","#FF7000","#FF6000","#FF5000","#FF4000","#FF2000","#FF0000","#EE002A","#DD0055","#CC0080","#BB00AA","#A200D5","#8800FF","#7700FF"],cu={1:"Jan",2:"Feb",3:"Mar",4:"Apr",5:"May",6:"Jun",7:"Jul",8:"Aug",9:"Sep",10:"Oct",11:"Nov",12:"Dec",year:"Year"},pp={1:"jan.cog.tif",2:"feb.cog.tif",3:"mar.cog.tif",4:"apr.cog.tif",5:"may.cog.tif",6:"jun.cog.tif",7:"jul.cog.tif",8:"aug.cog.tif",9:"sep.cog.tif",10:"oct.cog.tif",11:"nov.cog.tif",12:"dec.cog.tif",year:"year.cog.tif"},mp=ep,Pl="lightning-source",ia="lightning-layer";function yp(){return`[${Gd.map(m=>`"${m}"`).join(",")}]`}function _p(V){const m=yp();return`cog://${V}#color:${m},1,200`}class Ip{constructor(m){Ma(this,"map");Ma(this,"loaded",!1);Ma(this,"visible",!1);Ma(this,"protocolRegistered",!1);Ma(this,"currentPeriod","year");this.map=m}async init(){if(!this.protocolRegistered)try{Gc.addProtocol("cog",zd.cogProtocol),this.protocolRegistered=!0}catch{}return!0}async show(){const m=Es(Qs);if(this.loaded&&this.currentPeriod!==m.lightningPeriod){await this.setPeriod(m.lightningPeriod);return}if(!this.loaded){await this.loadLayer(m.lightningPeriod);return}this.visible||this.map.getLayer(ia)&&(this.map.setLayoutProperty(ia,"visibility","visible"),this.visible=!0)}hide(){this.visible&&(this.map.getLayer(ia)&&this.map.setLayoutProperty(ia,"visibility","none"),this.visible=!1)}async setPeriod(m){m===this.currentPeriod&&this.loaded||(this.removeLayer(),await this.loadLayer(m))}removeLayer(){this.map.getLayer(ia)&&this.map.removeLayer(ia),this.map.getSource(Pl)&&this.map.removeSource(Pl),this.loaded=!1,this.visible=!1}async loadLayer(m){if(this.loaded)return;hc.update(P=>P+1);const I=pp[m],E=`${mp}/${I}`;try{if(!(await fetch(E,{method:"HEAD"})).ok){console.warn(`Lightning COG not found: ${I}`);return}if(!this.map.getSource(Pl)){const Z=_p(E);this.map.addSource(Pl,{type:"raster",url:Z,tileSize:256});const S=Es(Qs);this.map.addLayer({id:ia,type:"raster",source:Pl,paint:{"raster-opacity":S.overlayOpacity,"raster-resampling":"nearest"}}),this.loaded=!0,this.visible=!0,this.currentPeriod=m;const c=()=>{this.map.setLayoutProperty(ia,"visibility","none"),requestAnimationFrame(()=>{this.map.setLayoutProperty(ia,"visibility","visible")})};if(this.map.isSourceLoaded(Pl))c();else{const he=Ee=>{Ee.sourceId===Pl&&Ee.isSourceLoaded&&(this.map.off("sourcedata",he),c())};this.map.on("sourcedata",he)}}}catch(P){console.error("Failed to load lightning COG:",P)}finally{hc.update(P=>Math.max(0,P-1))}}updateOpacity(m){this.map.getLayer(ia)&&this.map.setPaintProperty(ia,"raster-opacity",m)}isEnabled(){return!0}isVisible(){return this.visible}getCurrentPeriod(){return this.currentPeriod}destroy(){this.removeLayer()}}class as extends Error{constructor(m){var I,E,P,Z;super("ClientResponseError"),this.url="",this.status=0,this.response={},this.isAbort=!1,this.originalError=null,Object.setPrototypeOf(this,as.prototype),m!==null&&typeof m=="object"&&(this.url=typeof m.url=="string"?m.url:"",this.status=typeof m.status=="number"?m.status:0,this.isAbort=!!m.isAbort,this.originalError=m.originalError,m.response!==null&&typeof m.response=="object"?this.response=m.response:m.data!==null&&typeof m.data=="object"?this.response=m.data:this.response={}),this.originalError||m instanceof as||(this.originalError=m),typeof DOMException<"u"&&m instanceof DOMException&&(m.name=="AbortError"||m.code==20)&&(this.isAbort=!0),this.name="ClientResponseError "+this.status,this.message=(I=this.response)==null?void 0:I.message,this.message||(this.isAbort?this.message="The request was autocancelled. You can find more info in https://github.com/pocketbase/js-sdk#auto-cancellation.":(Z=(P=(E=this.originalError)==null?void 0:E.cause)==null?void 0:P.message)!=null&&Z.includes("ECONNREFUSED ::1")?this.message="Failed to connect to the PocketBase server. Try changing the SDK URL from localhost to 127.0.0.1 (https://github.com/pocketbase/js-sdk/issues/21).":this.message="Something went wrong."),this.cause=this.originalError}get data(){return this.response}toJSON(){return{...this}}}const hh=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function bp(V,m){const I={};if(typeof V!="string")return I;const E=Object.assign({},{}).decode||wp;let P=0;for(;P<V.length;){const Z=V.indexOf("=",P);if(Z===-1)break;let S=V.indexOf(";",P);if(S===-1)S=V.length;else if(S<Z){P=V.lastIndexOf(";",Z-1)+1;continue}const c=V.slice(P,Z).trim();if(I[c]===void 0){let he=V.slice(Z+1,S).trim();he.charCodeAt(0)===34&&(he=he.slice(1,-1));try{I[c]=E(he)}catch{I[c]=he}}P=S+1}return I}function WA(V,m,I){const E=Object.assign({},I||{}),P=E.encode||vp;if(!hh.test(V))throw new TypeError("argument name is invalid");const Z=P(m);if(Z&&!hh.test(Z))throw new TypeError("argument val is invalid");let S=V+"="+Z;if(E.maxAge!=null){const c=E.maxAge-0;if(isNaN(c)||!isFinite(c))throw new TypeError("option maxAge is invalid");S+="; Max-Age="+Math.floor(c)}if(E.domain){if(!hh.test(E.domain))throw new TypeError("option domain is invalid");S+="; Domain="+E.domain}if(E.path){if(!hh.test(E.path))throw new TypeError("option path is invalid");S+="; Path="+E.path}if(E.expires){if(!function(he){return Object.prototype.toString.call(he)==="[object Date]"||he instanceof Date}(E.expires)||isNaN(E.expires.valueOf()))throw new TypeError("option expires is invalid");S+="; Expires="+E.expires.toUTCString()}if(E.httpOnly&&(S+="; HttpOnly"),E.secure&&(S+="; Secure"),E.priority)switch(typeof E.priority=="string"?E.priority.toLowerCase():E.priority){case"low":S+="; Priority=Low";break;case"medium":S+="; Priority=Medium";break;case"high":S+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}if(E.sameSite)switch(typeof E.sameSite=="string"?E.sameSite.toLowerCase():E.sameSite){case!0:S+="; SameSite=Strict";break;case"lax":S+="; SameSite=Lax";break;case"strict":S+="; SameSite=Strict";break;case"none":S+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return S}function wp(V){return V.indexOf("%")!==-1?decodeURIComponent(V):V}function vp(V){return encodeURIComponent(V)}const xp=typeof navigator<"u"&&navigator.product==="ReactNative"||typeof global<"u"&&global.HermesInternal;let Ud;function cc(V){if(V)try{const m=decodeURIComponent(Ud(V.split(".")[1]).split("").map(function(I){return"%"+("00"+I.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(m)||{}}catch{}return{}}function Nd(V,m=0){let I=cc(V);return!(Object.keys(I).length>0&&(!I.exp||I.exp-m>Date.now()/1e3))}Ud=typeof atob!="function"||xp?V=>{let m=String(V).replace(/=+$/,"");if(m.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var I,E,P=0,Z=0,S="";E=m.charAt(Z++);~E&&(I=P%4?64*I+E:E,P++%4)?S+=String.fromCharCode(255&I>>(-2*P&6)):0)E="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(E);return S}:atob;const ed="pb_auth";class du{constructor(){this.baseToken="",this.baseModel=null,this._onChangeCallbacks=[]}get token(){return this.baseToken}get record(){return this.baseModel}get model(){return this.baseModel}get isValid(){return!Nd(this.token)}get isSuperuser(){var I,E;let m=cc(this.token);return m.type=="auth"&&(((I=this.record)==null?void 0:I.collectionName)=="_superusers"||!((E=this.record)!=null&&E.collectionName)&&m.collectionId=="pbc_3142635823")}get isAdmin(){return console.warn("Please replace pb.authStore.isAdmin with pb.authStore.isSuperuser OR simply check the value of pb.authStore.record?.collectionName"),this.isSuperuser}get isAuthRecord(){return console.warn("Please replace pb.authStore.isAuthRecord with !pb.authStore.isSuperuser OR simply check the value of pb.authStore.record?.collectionName"),cc(this.token).type=="auth"&&!this.isSuperuser}save(m,I){this.baseToken=m||"",this.baseModel=I||null,this.triggerChange()}clear(){this.baseToken="",this.baseModel=null,this.triggerChange()}loadFromCookie(m,I=ed){const E=bp(m||"")[I]||"";let P={};try{P=JSON.parse(E),(typeof P===null||typeof P!="object"||Array.isArray(P))&&(P={})}catch{}this.save(P.token||"",P.record||P.model||null)}exportToCookie(m,I=ed){var he,Ee;const E={secure:!0,sameSite:!0,httpOnly:!0,path:"/"},P=cc(this.token);E.expires=P!=null&&P.exp?new Date(1e3*P.exp):new Date("1970-01-01"),m=Object.assign({},E,m);const Z={token:this.token,record:this.record?JSON.parse(JSON.stringify(this.record)):null};let S=WA(I,JSON.stringify(Z),m);const c=typeof Blob<"u"?new Blob([S]).size:S.length;if(Z.record&&c>4096){Z.record={id:(he=Z.record)==null?void 0:he.id,email:(Ee=Z.record)==null?void 0:Ee.email};const Fe=["collectionId","collectionName","verified"];for(const Qe in this.record)Fe.includes(Qe)&&(Z.record[Qe]=this.record[Qe]);S=WA(I,JSON.stringify(Z),m)}return S}onChange(m,I=!1){return this._onChangeCallbacks.push(m),I&&m(this.token,this.record),()=>{for(let E=this._onChangeCallbacks.length-1;E>=0;E--)if(this._onChangeCallbacks[E]==m)return delete this._onChangeCallbacks[E],void this._onChangeCallbacks.splice(E,1)}}triggerChange(){for(const m of this._onChangeCallbacks)m&&m(this.token,this.record)}}class Bp extends du{constructor(m="pocketbase_auth"){super(),this.storageFallback={},this.storageKey=m,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get record(){const m=this._storageGet(this.storageKey)||{};return m.record||m.model||null}get model(){return this.record}save(m,I){this._storageSet(this.storageKey,{token:m,record:I}),super.save(m,I)}clear(){this._storageRemove(this.storageKey),super.clear()}_storageGet(m){if(typeof window<"u"&&(window!=null&&window.localStorage)){const I=window.localStorage.getItem(m)||"";try{return JSON.parse(I)}catch{return I}}return this.storageFallback[m]}_storageSet(m,I){if(typeof window<"u"&&(window!=null&&window.localStorage)){let E=I;typeof I!="string"&&(E=JSON.stringify(I)),window.localStorage.setItem(m,E)}else this.storageFallback[m]=I}_storageRemove(m){var I;typeof window<"u"&&(window!=null&&window.localStorage)&&((I=window.localStorage)==null||I.removeItem(m)),delete this.storageFallback[m]}_bindStorageEvent(){typeof window<"u"&&(window!=null&&window.localStorage)&&window.addEventListener&&window.addEventListener("storage",m=>{if(m.key!=this.storageKey)return;const I=this._storageGet(this.storageKey)||{};super.save(I.token||"",I.record||I.model||null)})}}class no{constructor(m){this.client=m}}class Cp extends no{async getAll(m){return m=Object.assign({method:"GET"},m),this.client.send("/api/settings",m)}async update(m,I){return I=Object.assign({method:"PATCH",body:m},I),this.client.send("/api/settings",I)}async testS3(m="storage",I){return I=Object.assign({method:"POST",body:{filesystem:m}},I),this.client.send("/api/settings/test/s3",I).then(()=>!0)}async testEmail(m,I,E,P){return P=Object.assign({method:"POST",body:{email:I,template:E,collection:m}},P),this.client.send("/api/settings/test/email",P).then(()=>!0)}async generateAppleClientSecret(m,I,E,P,Z,S){return S=Object.assign({method:"POST",body:{clientId:m,teamId:I,keyId:E,privateKey:P,duration:Z}},S),this.client.send("/api/settings/apple/generate-client-secret",S)}}const Ep=["requestKey","$cancelKey","$autoCancel","fetch","headers","body","query","params","cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","signal","window"];function fu(V){if(V){V.query=V.query||{};for(let m in V)Ep.includes(m)||(V.query[m]=V[m],delete V[m])}}function Od(V){const m=[];for(const I in V){const E=encodeURIComponent(I),P=Array.isArray(V[I])?V[I]:[V[I]];for(let Z of P)Z=Qp(Z),Z!==null&&m.push(E+"="+Z)}return m.join("&")}function Qp(V){return V==null?null:V instanceof Date?encodeURIComponent(V.toISOString().replace("T"," ")):encodeURIComponent(typeof V=="object"?JSON.stringify(V):V)}class qd extends no{constructor(){super(...arguments),this.clientId="",this.eventSource=null,this.subscriptions={},this.lastSentSubscriptions=[],this.maxConnectTimeout=15e3,this.reconnectAttempts=0,this.maxReconnectAttempts=1/0,this.predefinedReconnectIntervals=[200,300,500,1e3,1200,1500,2e3],this.pendingConnects=[]}get isConnected(){return!!this.eventSource&&!!this.clientId&&!this.pendingConnects.length}async subscribe(m,I,E){var S;if(!m)throw new Error("topic must be set.");let P=m;if(E){fu(E=Object.assign({},E));const c="options="+encodeURIComponent(JSON.stringify({query:E.query,headers:E.headers}));P+=(P.includes("?")?"&":"?")+c}const Z=function(c){const he=c;let Ee;try{Ee=JSON.parse(he==null?void 0:he.data)}catch{}I(Ee||{})};return this.subscriptions[P]||(this.subscriptions[P]=[]),this.subscriptions[P].push(Z),this.isConnected?this.subscriptions[P].length===1?await this.submitSubscriptions():(S=this.eventSource)==null||S.addEventListener(P,Z):await this.connect(),async()=>this.unsubscribeByTopicAndListener(m,Z)}async unsubscribe(m){var E;let I=!1;if(m){const P=this.getSubscriptionsByTopic(m);for(let Z in P)if(this.hasSubscriptionListeners(Z)){for(let S of this.subscriptions[Z])(E=this.eventSource)==null||E.removeEventListener(Z,S);delete this.subscriptions[Z],I||(I=!0)}}else this.subscriptions={};this.hasSubscriptionListeners()?I&&await this.submitSubscriptions():this.disconnect()}async unsubscribeByPrefix(m){var E;let I=!1;for(let P in this.subscriptions)if((P+"?").startsWith(m)){I=!0;for(let Z of this.subscriptions[P])(E=this.eventSource)==null||E.removeEventListener(P,Z);delete this.subscriptions[P]}I&&(this.hasSubscriptionListeners()?await this.submitSubscriptions():this.disconnect())}async unsubscribeByTopicAndListener(m,I){var Z;let E=!1;const P=this.getSubscriptionsByTopic(m);for(let S in P){if(!Array.isArray(this.subscriptions[S])||!this.subscriptions[S].length)continue;let c=!1;for(let he=this.subscriptions[S].length-1;he>=0;he--)this.subscriptions[S][he]===I&&(c=!0,delete this.subscriptions[S][he],this.subscriptions[S].splice(he,1),(Z=this.eventSource)==null||Z.removeEventListener(S,I));c&&(this.subscriptions[S].length||delete this.subscriptions[S],E||this.hasSubscriptionListeners(S)||(E=!0))}this.hasSubscriptionListeners()?E&&await this.submitSubscriptions():this.disconnect()}hasSubscriptionListeners(m){var I,E;if(this.subscriptions=this.subscriptions||{},m)return!!((I=this.subscriptions[m])!=null&&I.length);for(let P in this.subscriptions)if((E=this.subscriptions[P])!=null&&E.length)return!0;return!1}async submitSubscriptions(){if(this.clientId)return this.addAllSubscriptionListeners(),this.lastSentSubscriptions=this.getNonEmptySubscriptionKeys(),this.client.send("/api/realtime",{method:"POST",body:{clientId:this.clientId,subscriptions:this.lastSentSubscriptions},requestKey:this.getSubscriptionsCancelKey()}).catch(m=>{if(!(m!=null&&m.isAbort))throw m})}getSubscriptionsCancelKey(){return"realtime_"+this.clientId}getSubscriptionsByTopic(m){const I={};m=m.includes("?")?m:m+"?";for(let E in this.subscriptions)(E+"?").startsWith(m)&&(I[E]=this.subscriptions[E]);return I}getNonEmptySubscriptionKeys(){const m=[];for(let I in this.subscriptions)this.subscriptions[I].length&&m.push(I);return m}addAllSubscriptionListeners(){if(this.eventSource){this.removeAllSubscriptionListeners();for(let m in this.subscriptions)for(let I of this.subscriptions[m])this.eventSource.addEventListener(m,I)}}removeAllSubscriptionListeners(){if(this.eventSource)for(let m in this.subscriptions)for(let I of this.subscriptions[m])this.eventSource.removeEventListener(m,I)}async connect(){if(!(this.reconnectAttempts>0))return new Promise((m,I)=>{this.pendingConnects.push({resolve:m,reject:I}),this.pendingConnects.length>1||this.initConnect()})}initConnect(){this.disconnect(!0),clearTimeout(this.connectTimeoutId),this.connectTimeoutId=setTimeout(()=>{this.connectErrorHandler(new Error("EventSource connect took too long."))},this.maxConnectTimeout),this.eventSource=new EventSource(this.client.buildURL("/api/realtime")),this.eventSource.onerror=m=>{this.connectErrorHandler(new Error("Failed to establish realtime connection."))},this.eventSource.addEventListener("PB_CONNECT",m=>{const I=m;this.clientId=I==null?void 0:I.lastEventId,this.submitSubscriptions().then(async()=>{let E=3;for(;this.hasUnsentSubscriptions()&&E>0;)E--,await this.submitSubscriptions()}).then(()=>{for(let P of this.pendingConnects)P.resolve();this.pendingConnects=[],this.reconnectAttempts=0,clearTimeout(this.reconnectTimeoutId),clearTimeout(this.connectTimeoutId);const E=this.getSubscriptionsByTopic("PB_CONNECT");for(let P in E)for(let Z of E[P])Z(m)}).catch(E=>{this.clientId="",this.connectErrorHandler(E)})})}hasUnsentSubscriptions(){const m=this.getNonEmptySubscriptionKeys();if(m.length!=this.lastSentSubscriptions.length)return!0;for(const I of m)if(!this.lastSentSubscriptions.includes(I))return!0;return!1}connectErrorHandler(m){if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),!this.clientId&&!this.reconnectAttempts||this.reconnectAttempts>this.maxReconnectAttempts){for(let E of this.pendingConnects)E.reject(new as(m));return this.pendingConnects=[],void this.disconnect()}this.disconnect(!0);const I=this.predefinedReconnectIntervals[this.reconnectAttempts]||this.predefinedReconnectIntervals[this.predefinedReconnectIntervals.length-1];this.reconnectAttempts++,this.reconnectTimeoutId=setTimeout(()=>{this.initConnect()},I)}disconnect(m=!1){var I;if(this.clientId&&this.onDisconnect&&this.onDisconnect(Object.keys(this.subscriptions)),clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),this.removeAllSubscriptionListeners(),this.client.cancelRequest(this.getSubscriptionsCancelKey()),(I=this.eventSource)==null||I.close(),this.eventSource=null,this.clientId="",!m){this.reconnectAttempts=0;for(let E of this.pendingConnects)E.resolve();this.pendingConnects=[]}}}class Vd extends no{decode(m){return m}async getFullList(m,I){if(typeof m=="number")return this._getFullList(m,I);let E=500;return(I=Object.assign({},m,I)).batch&&(E=I.batch,delete I.batch),this._getFullList(E,I)}async getList(m=1,I=30,E){return(E=Object.assign({method:"GET"},E)).query=Object.assign({page:m,perPage:I},E.query),this.client.send(this.baseCrudPath,E).then(P=>{var Z;return P.items=((Z=P.items)==null?void 0:Z.map(S=>this.decode(S)))||[],P})}async getFirstListItem(m,I){return(I=Object.assign({requestKey:"one_by_filter_"+this.baseCrudPath+"_"+m},I)).query=Object.assign({filter:m,skipTotal:1},I.query),this.getList(1,1,I).then(E=>{var P;if(!((P=E==null?void 0:E.items)!=null&&P.length))throw new as({status:404,response:{code:404,message:"The requested resource wasn't found.",data:{}}});return E.items[0]})}async getOne(m,I){if(!m)throw new as({url:this.client.buildURL(this.baseCrudPath+"/"),status:404,response:{code:404,message:"Missing required record id.",data:{}}});return I=Object.assign({method:"GET"},I),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(m),I).then(E=>this.decode(E))}async create(m,I){return I=Object.assign({method:"POST",body:m},I),this.client.send(this.baseCrudPath,I).then(E=>this.decode(E))}async update(m,I,E){return E=Object.assign({method:"PATCH",body:I},E),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(m),E).then(P=>this.decode(P))}async delete(m,I){return I=Object.assign({method:"DELETE"},I),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(m),I).then(()=>!0)}_getFullList(m=500,I){(I=I||{}).query=Object.assign({skipTotal:1},I.query);let E=[],P=async Z=>this.getList(Z,m||500,I).then(S=>{const c=S.items;return E=E.concat(c),c.length==S.perPage?P(Z+1):E});return P(1)}}function jo(V,m,I,E){const P=E!==void 0;return P||I!==void 0?P?(console.warn(V),m.body=Object.assign({},m.body,I),m.query=Object.assign({},m.query,E),m):Object.assign(m,I):m}function nu(V){var m;(m=V._resetAutoRefresh)==null||m.call(V)}class Sp extends Vd{constructor(m,I){super(m),this.collectionIdOrName=I}get baseCrudPath(){return this.baseCollectionPath+"/records"}get baseCollectionPath(){return"/api/collections/"+encodeURIComponent(this.collectionIdOrName)}get isSuperusers(){return this.collectionIdOrName=="_superusers"||this.collectionIdOrName=="_pbc_2773867675"}async subscribe(m,I,E){if(!m)throw new Error("Missing topic.");if(!I)throw new Error("Missing subscription callback.");return this.client.realtime.subscribe(this.collectionIdOrName+"/"+m,I,E)}async unsubscribe(m){return m?this.client.realtime.unsubscribe(this.collectionIdOrName+"/"+m):this.client.realtime.unsubscribeByPrefix(this.collectionIdOrName)}async getFullList(m,I){if(typeof m=="number")return super.getFullList(m,I);const E=Object.assign({},m,I);return super.getFullList(E)}async getList(m=1,I=30,E){return super.getList(m,I,E)}async getFirstListItem(m,I){return super.getFirstListItem(m,I)}async getOne(m,I){return super.getOne(m,I)}async create(m,I){return super.create(m,I)}async update(m,I,E){return super.update(m,I,E).then(P=>{var Z,S,c;if(((Z=this.client.authStore.record)==null?void 0:Z.id)===(P==null?void 0:P.id)&&(((S=this.client.authStore.record)==null?void 0:S.collectionId)===this.collectionIdOrName||((c=this.client.authStore.record)==null?void 0:c.collectionName)===this.collectionIdOrName)){let he=Object.assign({},this.client.authStore.record.expand),Ee=Object.assign({},this.client.authStore.record,P);he&&(Ee.expand=Object.assign(he,P.expand)),this.client.authStore.save(this.client.authStore.token,Ee)}return P})}async delete(m,I){return super.delete(m,I).then(E=>{var P,Z,S;return!E||((P=this.client.authStore.record)==null?void 0:P.id)!==m||((Z=this.client.authStore.record)==null?void 0:Z.collectionId)!==this.collectionIdOrName&&((S=this.client.authStore.record)==null?void 0:S.collectionName)!==this.collectionIdOrName||this.client.authStore.clear(),E})}authResponse(m){const I=this.decode((m==null?void 0:m.record)||{});return this.client.authStore.save(m==null?void 0:m.token,I),Object.assign({},m,{token:(m==null?void 0:m.token)||"",record:I})}async listAuthMethods(m){return m=Object.assign({method:"GET",fields:"mfa,otp,password,oauth2"},m),this.client.send(this.baseCollectionPath+"/auth-methods",m)}async authWithPassword(m,I,E){let P;E=Object.assign({method:"POST",body:{identity:m,password:I}},E),this.isSuperusers&&(P=E.autoRefreshThreshold,delete E.autoRefreshThreshold,E.autoRefresh||nu(this.client));let Z=await this.client.send(this.baseCollectionPath+"/auth-with-password",E);return Z=this.authResponse(Z),P&&this.isSuperusers&&function(c,he,Ee,Fe){nu(c);const Qe=c.beforeSend,me=c.authStore.record,$e=c.authStore.onChange((rt,je)=>{(!rt||(je==null?void 0:je.id)!=(me==null?void 0:me.id)||(je!=null&&je.collectionId||me!=null&&me.collectionId)&&(je==null?void 0:je.collectionId)!=(me==null?void 0:me.collectionId))&&nu(c)});c._resetAutoRefresh=function(){$e(),c.beforeSend=Qe,delete c._resetAutoRefresh},c.beforeSend=async(rt,je)=>{var Xe;const bt=c.authStore.token;if((Xe=je.query)!=null&&Xe.autoRefresh)return Qe?Qe(rt,je):{url:rt,sendOptions:je};let Bt=c.authStore.isValid;if(Bt&&Nd(c.authStore.token,he))try{await Ee()}catch{Bt=!1}Bt||await Fe();const ht=je.headers||{};for(let We in ht)if(We.toLowerCase()=="authorization"&&bt==ht[We]&&c.authStore.token){ht[We]=c.authStore.token;break}return je.headers=ht,Qe?Qe(rt,je):{url:rt,sendOptions:je}}}(this.client,P,()=>this.authRefresh({autoRefresh:!0}),()=>this.authWithPassword(m,I,Object.assign({autoRefresh:!0},E))),Z}async authWithOAuth2Code(m,I,E,P,Z,S,c){let he={method:"POST",body:{provider:m,code:I,codeVerifier:E,redirectURL:P,createData:Z}};return he=jo("This form of authWithOAuth2Code(provider, code, codeVerifier, redirectURL, createData?, body?, query?) is deprecated. Consider replacing it with authWithOAuth2Code(provider, code, codeVerifier, redirectURL, createData?, options?).",he,S,c),this.client.send(this.baseCollectionPath+"/auth-with-oauth2",he).then(Ee=>this.authResponse(Ee))}authWithOAuth2(...m){if(m.length>1||typeof(m==null?void 0:m[0])=="string")return console.warn("PocketBase: This form of authWithOAuth2() is deprecated and may get removed in the future. Please replace with authWithOAuth2Code() OR use the authWithOAuth2() realtime form as shown in https://pocketbase.io/docs/authentication/#oauth2-integration."),this.authWithOAuth2Code((m==null?void 0:m[0])||"",(m==null?void 0:m[1])||"",(m==null?void 0:m[2])||"",(m==null?void 0:m[3])||"",(m==null?void 0:m[4])||{},(m==null?void 0:m[5])||{},(m==null?void 0:m[6])||{});const I=(m==null?void 0:m[0])||{};let E=null;I.urlCallback||(E=td(void 0));const P=new qd(this.client);function Z(){E==null||E.close(),P.unsubscribe()}const S={},c=I.requestKey;return c&&(S.requestKey=c),this.listAuthMethods(S).then(he=>{var me;const Ee=he.oauth2.providers.find($e=>$e.name===I.provider);if(!Ee)throw new as(new Error(`Missing or invalid provider "${I.provider}".`));const Fe=this.client.buildURL("/api/oauth2-redirect"),Qe=c?(me=this.client.cancelControllers)==null?void 0:me[c]:void 0;return Qe&&(Qe.signal.onabort=()=>{Z()}),new Promise(async($e,rt)=>{var je;try{await P.subscribe("@oauth2",async Xe=>{var dt;const We=P.clientId;try{if(!Xe.state||We!==Xe.state)throw new Error("State parameters don't match.");if(Xe.error||!Xe.code)throw new Error("OAuth2 redirect error or missing code: "+Xe.error);const zt=Object.assign({},I);delete zt.provider,delete zt.scopes,delete zt.createData,delete zt.urlCallback,(dt=Qe==null?void 0:Qe.signal)!=null&&dt.onabort&&(Qe.signal.onabort=null);const ut=await this.authWithOAuth2Code(Ee.name,Xe.code,Ee.codeVerifier,Fe,I.createData,zt);$e(ut)}catch(zt){rt(new as(zt))}Z()});const bt={state:P.clientId};(je=I.scopes)!=null&&je.length&&(bt.scope=I.scopes.join(" "));const Bt=this._replaceQueryParams(Ee.authURL+Fe,bt);await(I.urlCallback||function(Xe){E?E.location.href=Xe:E=td(Xe)})(Bt)}catch(bt){Z(),rt(new as(bt))}})}).catch(he=>{throw Z(),he})}async authRefresh(m,I){let E={method:"POST"};return E=jo("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",E,m,I),this.client.send(this.baseCollectionPath+"/auth-refresh",E).then(P=>this.authResponse(P))}async requestPasswordReset(m,I,E){let P={method:"POST",body:{email:m}};return P=jo("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",P,I,E),this.client.send(this.baseCollectionPath+"/request-password-reset",P).then(()=>!0)}async confirmPasswordReset(m,I,E,P,Z){let S={method:"POST",body:{token:m,password:I,passwordConfirm:E}};return S=jo("This form of confirmPasswordReset(token, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(token, password, passwordConfirm, options?).",S,P,Z),this.client.send(this.baseCollectionPath+"/confirm-password-reset",S).then(()=>!0)}async requestVerification(m,I,E){let P={method:"POST",body:{email:m}};return P=jo("This form of requestVerification(email, body?, query?) is deprecated. Consider replacing it with requestVerification(email, options?).",P,I,E),this.client.send(this.baseCollectionPath+"/request-verification",P).then(()=>!0)}async confirmVerification(m,I,E){let P={method:"POST",body:{token:m}};return P=jo("This form of confirmVerification(token, body?, query?) is deprecated. Consider replacing it with confirmVerification(token, options?).",P,I,E),this.client.send(this.baseCollectionPath+"/confirm-verification",P).then(()=>{const Z=cc(m),S=this.client.authStore.record;return S&&!S.verified&&S.id===Z.id&&S.collectionId===Z.collectionId&&(S.verified=!0,this.client.authStore.save(this.client.authStore.token,S)),!0})}async requestEmailChange(m,I,E){let P={method:"POST",body:{newEmail:m}};return P=jo("This form of requestEmailChange(newEmail, body?, query?) is deprecated. Consider replacing it with requestEmailChange(newEmail, options?).",P,I,E),this.client.send(this.baseCollectionPath+"/request-email-change",P).then(()=>!0)}async confirmEmailChange(m,I,E,P){let Z={method:"POST",body:{token:m,password:I}};return Z=jo("This form of confirmEmailChange(token, password, body?, query?) is deprecated. Consider replacing it with confirmEmailChange(token, password, options?).",Z,E,P),this.client.send(this.baseCollectionPath+"/confirm-email-change",Z).then(()=>{const S=cc(m),c=this.client.authStore.record;return c&&c.id===S.id&&c.collectionId===S.collectionId&&this.client.authStore.clear(),!0})}async listExternalAuths(m,I){return this.client.collection("_externalAuths").getFullList(Object.assign({},I,{filter:this.client.filter("recordRef = {:id}",{id:m})}))}async unlinkExternalAuth(m,I,E){const P=await this.client.collection("_externalAuths").getFirstListItem(this.client.filter("recordRef = {:recordId} && provider = {:provider}",{recordId:m,provider:I}));return this.client.collection("_externalAuths").delete(P.id,E).then(()=>!0)}async requestOTP(m,I){return I=Object.assign({method:"POST",body:{email:m}},I),this.client.send(this.baseCollectionPath+"/request-otp",I)}async authWithOTP(m,I,E){return E=Object.assign({method:"POST",body:{otpId:m,password:I}},E),this.client.send(this.baseCollectionPath+"/auth-with-otp",E).then(P=>this.authResponse(P))}async impersonate(m,I,E){(E=Object.assign({method:"POST",body:{duration:I}},E)).headers=E.headers||{},E.headers.Authorization||(E.headers.Authorization=this.client.authStore.token);const P=new Hd(this.client.baseURL,new du,this.client.lang),Z=await P.send(this.baseCollectionPath+"/impersonate/"+encodeURIComponent(m),E);return P.authStore.save(Z==null?void 0:Z.token,this.decode((Z==null?void 0:Z.record)||{})),P}_replaceQueryParams(m,I={}){let E=m,P="";m.indexOf("?")>=0&&(E=m.substring(0,m.indexOf("?")),P=m.substring(m.indexOf("?")+1));const Z={},S=P.split("&");for(const c of S){if(c=="")continue;const he=c.split("=");Z[decodeURIComponent(he[0].replace(/\+/g," "))]=decodeURIComponent((he[1]||"").replace(/\+/g," "))}for(let c in I)I.hasOwnProperty(c)&&(I[c]==null?delete Z[c]:Z[c]=I[c]);P="";for(let c in Z)Z.hasOwnProperty(c)&&(P!=""&&(P+="&"),P+=encodeURIComponent(c.replace(/%20/g,"+"))+"="+encodeURIComponent(Z[c].replace(/%20/g,"+")));return P!=""?E+"?"+P:E}}function td(V){if(typeof window>"u"||!(window!=null&&window.open))throw new as(new Error("Not in a browser context - please pass a custom urlCallback function."));let m=1024,I=768,E=window.innerWidth,P=window.innerHeight;m=m>E?E:m,I=I>P?P:I;let Z=E/2-m/2,S=P/2-I/2;return window.open(V,"popup_window","width="+m+",height="+I+",top="+S+",left="+Z+",resizable,menubar=no")}class kp extends Vd{get baseCrudPath(){return"/api/collections"}async import(m,I=!1,E){return E=Object.assign({method:"PUT",body:{collections:m,deleteMissing:I}},E),this.client.send(this.baseCrudPath+"/import",E).then(()=>!0)}async getScaffolds(m){return m=Object.assign({method:"GET"},m),this.client.send(this.baseCrudPath+"/meta/scaffolds",m)}async truncate(m,I){return I=Object.assign({method:"DELETE"},I),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(m)+"/truncate",I).then(()=>!0)}}class Dp extends no{async getList(m=1,I=30,E){return(E=Object.assign({method:"GET"},E)).query=Object.assign({page:m,perPage:I},E.query),this.client.send("/api/logs",E)}async getOne(m,I){if(!m)throw new as({url:this.client.buildURL("/api/logs/"),status:404,response:{code:404,message:"Missing required log id.",data:{}}});return I=Object.assign({method:"GET"},I),this.client.send("/api/logs/"+encodeURIComponent(m),I)}async getStats(m){return m=Object.assign({method:"GET"},m),this.client.send("/api/logs/stats",m)}}class Mp extends no{async check(m){return m=Object.assign({method:"GET"},m),this.client.send("/api/health",m)}}class Tp extends no{getUrl(m,I,E={}){return console.warn("Please replace pb.files.getUrl() with pb.files.getURL()"),this.getURL(m,I,E)}getURL(m,I,E={}){if(!I||!(m!=null&&m.id)||!(m!=null&&m.collectionId)&&!(m!=null&&m.collectionName))return"";const P=[];P.push("api"),P.push("files"),P.push(encodeURIComponent(m.collectionId||m.collectionName)),P.push(encodeURIComponent(m.id)),P.push(encodeURIComponent(I));let Z=this.client.buildURL(P.join("/"));if(Object.keys(E).length){E.download===!1&&delete E.download;const S=new URLSearchParams(E);Z+=(Z.includes("?")?"&":"?")+S}return Z}async getToken(m){return m=Object.assign({method:"POST"},m),this.client.send("/api/files/token",m).then(I=>(I==null?void 0:I.token)||"")}}class Pp extends no{async getFullList(m){return m=Object.assign({method:"GET"},m),this.client.send("/api/backups",m)}async create(m,I){return I=Object.assign({method:"POST",body:{name:m}},I),this.client.send("/api/backups",I).then(()=>!0)}async upload(m,I){return I=Object.assign({method:"POST",body:m},I),this.client.send("/api/backups/upload",I).then(()=>!0)}async delete(m,I){return I=Object.assign({method:"DELETE"},I),this.client.send(`/api/backups/${encodeURIComponent(m)}`,I).then(()=>!0)}async restore(m,I){return I=Object.assign({method:"POST"},I),this.client.send(`/api/backups/${encodeURIComponent(m)}/restore`,I).then(()=>!0)}getDownloadUrl(m,I){return console.warn("Please replace pb.backups.getDownloadUrl() with pb.backups.getDownloadURL()"),this.getDownloadURL(m,I)}getDownloadURL(m,I){return this.client.buildURL(`/api/backups/${encodeURIComponent(I)}?token=${encodeURIComponent(m)}`)}}class Rp extends no{async getFullList(m){return m=Object.assign({method:"GET"},m),this.client.send("/api/crons",m)}async run(m,I){return I=Object.assign({method:"POST"},I),this.client.send(`/api/crons/${encodeURIComponent(m)}`,I).then(()=>!0)}}function hu(V){return typeof Blob<"u"&&V instanceof Blob||typeof File<"u"&&V instanceof File||V!==null&&typeof V=="object"&&V.uri&&(typeof navigator<"u"&&navigator.product==="ReactNative"||typeof global<"u"&&global.HermesInternal)}function uu(V){var m;return V&&(((m=V.constructor)==null?void 0:m.name)==="FormData"||typeof FormData<"u"&&V instanceof FormData)}function id(V){for(const m in V){const I=Array.isArray(V[m])?V[m]:[V[m]];for(const E of I)if(hu(E))return!0}return!1}const Lp=/^[\-\.\d]+$/;function rd(V){if(typeof V!="string")return V;if(V=="true")return!0;if(V=="false")return!1;if((V[0]==="-"||V[0]>="0"&&V[0]<="9")&&Lp.test(V)){let m=+V;if(""+m===V)return m}return V}class Fp extends no{constructor(){super(...arguments),this.requests=[],this.subs={}}collection(m){return this.subs[m]||(this.subs[m]=new zp(this.requests,m)),this.subs[m]}async send(m){const I=new FormData,E=[];for(let P=0;P<this.requests.length;P++){const Z=this.requests[P];if(E.push({method:Z.method,url:Z.url,headers:Z.headers,body:Z.json}),Z.files)for(let S in Z.files){const c=Z.files[S]||[];for(let he of c)I.append("requests."+P+"."+S,he)}}return I.append("@jsonPayload",JSON.stringify({requests:E})),m=Object.assign({method:"POST",body:I},m),this.client.send("/api/batch",m)}}class zp{constructor(m,I){this.requests=[],this.requests=m,this.collectionIdOrName=I}upsert(m,I){I=Object.assign({body:m||{}},I);const E={method:"PUT",url:"/api/collections/"+encodeURIComponent(this.collectionIdOrName)+"/records"};this.prepareRequest(E,I),this.requests.push(E)}create(m,I){I=Object.assign({body:m||{}},I);const E={method:"POST",url:"/api/collections/"+encodeURIComponent(this.collectionIdOrName)+"/records"};this.prepareRequest(E,I),this.requests.push(E)}update(m,I,E){E=Object.assign({body:I||{}},E);const P={method:"PATCH",url:"/api/collections/"+encodeURIComponent(this.collectionIdOrName)+"/records/"+encodeURIComponent(m)};this.prepareRequest(P,E),this.requests.push(P)}delete(m,I){I=Object.assign({},I);const E={method:"DELETE",url:"/api/collections/"+encodeURIComponent(this.collectionIdOrName)+"/records/"+encodeURIComponent(m)};this.prepareRequest(E,I),this.requests.push(E)}prepareRequest(m,I){if(fu(I),m.headers=I.headers,m.json={},m.files={},I.query!==void 0){const P=Od(I.query);P&&(m.url+=(m.url.includes("?")?"&":"?")+P)}let E=I.body;uu(E)&&(E=function(Z){let S={};return Z.forEach((c,he)=>{if(he==="@jsonPayload"&&typeof c=="string")try{let Ee=JSON.parse(c);Object.assign(S,Ee)}catch(Ee){console.warn("@jsonPayload error:",Ee)}else S[he]!==void 0?(Array.isArray(S[he])||(S[he]=[S[he]]),S[he].push(rd(c))):S[he]=rd(c)}),S}(E));for(const P in E){const Z=E[P];if(hu(Z))m.files[P]=m.files[P]||[],m.files[P].push(Z);else if(Array.isArray(Z)){const S=[],c=[];for(const he of Z)hu(he)?S.push(he):c.push(he);if(S.length>0&&S.length==Z.length){m.files[P]=m.files[P]||[];for(let he of S)m.files[P].push(he)}else if(m.json[P]=c,S.length>0){let he=P;P.startsWith("+")||P.endsWith("+")||(he+="+"),m.files[he]=m.files[he]||[];for(let Ee of S)m.files[he].push(Ee)}}else m.json[P]=Z}}}class Hd{get baseUrl(){return this.baseURL}set baseUrl(m){this.baseURL=m}constructor(m="/",I,E="en-US"){this.cancelControllers={},this.recordServices={},this.enableAutoCancellation=!0,this.baseURL=m,this.lang=E,I?this.authStore=I:typeof window<"u"&&window.Deno?this.authStore=new du:this.authStore=new Bp,this.collections=new kp(this),this.files=new Tp(this),this.logs=new Dp(this),this.settings=new Cp(this),this.realtime=new qd(this),this.health=new Mp(this),this.backups=new Pp(this),this.crons=new Rp(this)}get admins(){return this.collection("_superusers")}createBatch(){return new Fp(this)}collection(m){return this.recordServices[m]||(this.recordServices[m]=new Sp(this,m)),this.recordServices[m]}autoCancellation(m){return this.enableAutoCancellation=!!m,this}cancelRequest(m){return this.cancelControllers[m]&&(this.cancelControllers[m].abort(),delete this.cancelControllers[m]),this}cancelAllRequests(){for(let m in this.cancelControllers)this.cancelControllers[m].abort();return this.cancelControllers={},this}filter(m,I){if(!I)return m;for(let E in I){let P=I[E];switch(typeof P){case"boolean":case"number":P=""+P;break;case"string":P="'"+P.replace(/'/g,"\\'")+"'";break;default:P=P===null?"null":P instanceof Date?"'"+P.toISOString().replace("T"," ")+"'":"'"+JSON.stringify(P).replace(/'/g,"\\'")+"'"}m=m.replaceAll("{:"+E+"}",P)}return m}getFileUrl(m,I,E={}){return console.warn("Please replace pb.getFileUrl() with pb.files.getURL()"),this.files.getURL(m,I,E)}buildUrl(m){return console.warn("Please replace pb.buildUrl() with pb.buildURL()"),this.buildURL(m)}buildURL(m){var E;let I=this.baseURL;return typeof window>"u"||!window.location||I.startsWith("https://")||I.startsWith("http://")||(I=(E=window.location.origin)!=null&&E.endsWith("/")?window.location.origin.substring(0,window.location.origin.length-1):window.location.origin||"",this.baseURL.startsWith("/")||(I+=window.location.pathname||"/",I+=I.endsWith("/")?"":"/"),I+=this.baseURL),m&&(I+=I.endsWith("/")?"":"/",I+=m.startsWith("/")?m.substring(1):m),I}async send(m,I){I=this.initSendOptions(m,I);let E=this.buildURL(m);if(this.beforeSend){const P=Object.assign({},await this.beforeSend(E,I));P.url!==void 0||P.options!==void 0?(E=P.url||E,I=P.options||I):Object.keys(P).length&&(I=P,console!=null&&console.warn&&console.warn("Deprecated format of beforeSend return: please use `return { url, options }`, instead of `return options`."))}if(I.query!==void 0){const P=Od(I.query);P&&(E+=(E.includes("?")?"&":"?")+P),delete I.query}return this.getHeader(I.headers,"Content-Type")=="application/json"&&I.body&&typeof I.body!="string"&&(I.body=JSON.stringify(I.body)),(I.fetch||fetch)(E,I).then(async P=>{var S;let Z={};try{Z=await P.json()}catch(c){if((S=I.signal)!=null&&S.aborted||typeof DOMException<"u"&&c instanceof DOMException&&(c.name=="AbortError"||c.code==20))throw c}if(this.afterSend&&(Z=await this.afterSend(P,Z,I)),P.status>=400)throw new as({url:P.url,status:P.status,data:Z});return Z}).catch(P=>{throw new as(P)})}initSendOptions(m,I){if((I=Object.assign({method:"GET"},I)).body=function(P){if(typeof FormData>"u"||P===void 0||typeof P!="object"||P===null||uu(P)||!id(P))return P;const Z=new FormData;for(const S in P){const c=P[S];if(c!==void 0)if(typeof c!="object"||id({data:c})){const he=Array.isArray(c)?c:[c];for(let Ee of he)Z.append(S,Ee)}else{let he={};he[S]=c,Z.append("@jsonPayload",JSON.stringify(he))}}return Z}(I.body),fu(I),I.query=Object.assign({},I.params,I.query),I.requestKey===void 0&&(I.$autoCancel===!1||I.query.$autoCancel===!1?I.requestKey=null:(I.$cancelKey||I.query.$cancelKey)&&(I.requestKey=I.$cancelKey||I.query.$cancelKey)),delete I.$autoCancel,delete I.query.$autoCancel,delete I.$cancelKey,delete I.query.$cancelKey,this.getHeader(I.headers,"Content-Type")!==null||uu(I.body)||(I.headers=Object.assign({},I.headers,{"Content-Type":"application/json"})),this.getHeader(I.headers,"Accept-Language")===null&&(I.headers=Object.assign({},I.headers,{"Accept-Language":this.lang})),this.authStore.token&&this.getHeader(I.headers,"Authorization")===null&&(I.headers=Object.assign({},I.headers,{Authorization:this.authStore.token})),this.enableAutoCancellation&&I.requestKey!==null){const E=I.requestKey||(I.method||"GET")+m;delete I.requestKey,this.cancelRequest(E);const P=new AbortController;this.cancelControllers[E]=P,I.signal=P.signal}return I}getHeader(m,I){m=m||{},I=I.toLowerCase();for(let E in m)if(E.toLowerCase()==I)return m[E];return null}}const Or=new Hd(tp),Nc=Pa(Or.authStore.record),Gp=Pa(!0);async function Up(){if(Or.authStore.onChange((V,m)=>{Nc.set(m)}),Or.authStore.token)if(!Or.authStore.isValid)Or.authStore.clear();else try{await Or.collection("users").authRefresh()}catch{Or.authStore.clear()}Nc.set(Or.authStore.record),Gp.set(!1)}async function jd(V,m){return(await Or.collection("users").authWithPassword(V,m)).record}async function Np(V,m,I){const E=await Or.collection("users").create({email:V,password:m,passwordConfirm:I});return await jd(V,m),E}function Op(){Or.authStore.clear()}async function qp(V){return(await Or.collection("users").authWithOAuth2({provider:V})).record}const uh=[{id:"corfu",name:"Corfu, Greece",center:{lng:19.92,lat:39.62},radiusKm:100},{id:"tortola",name:"Tortola, BVI",center:{lng:-64.62,lat:18.43},radiusKm:100},{id:"whitsundays",name:"Whitsunday Islands, Australia",center:{lng:148.95,lat:-20.08},radiusKm:100}],nd={Europe:"corfu",Africa:"corfu",America:"tortola",Australia:"whitsundays",Pacific:"whitsundays"},sd={"Asia/Auckland":"whitsundays"},Vp="corfu",Fc=7,Hp=6e4;function jp(){try{const V=Intl.DateTimeFormat().resolvedOptions().timeZone||"";if(sd[V]){const I=uh.find(E=>E.id===sd[V]);if(I)return I}const m=V.split("/")[0];if(m&&nd[m]){const I=uh.find(E=>E.id===nd[m]);if(I)return I}}catch{}return uh.find(V=>V.id===Vp)||uh[0]}function Jd(V,m,I,E){const Z=(E-m)*Math.PI/180,S=(I-V)*Math.PI/180,c=Math.sin(Z/2)*Math.sin(Z/2)+Math.cos(m*Math.PI/180)*Math.cos(E*Math.PI/180)*Math.sin(S/2)*Math.sin(S/2);return 6371*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))}const Oc=Pa(jp()),Uc=Pa(!1),dh=Pa(10),ad=Pa(0),zc=Pa(!1),Au=Pa(!1);Pd([dh,Uc],([V,m])=>V>=Fc&&!m);function su(V,m){const I=Es(Oc);return Jd(I.center.lng,I.center.lat,V,m)<=I.radiusKm}function Jp(V,m){const I=Es(Oc),E=Jd(I.center.lng,I.center.lat,V,m);if(E===0)return{lng:I.center.lng,lat:I.center.lat};const P=I.radiusKm/E,Z=I.center.lng+(V-I.center.lng)*P,S=I.center.lat+(m-I.center.lat)*P;return{lng:Z,lat:S}}function au(){const V=Date.now(),m=Es(ad);V-m>=Hp?(zc.set(!0),ad.set(V)):(Au.set(!0),setTimeout(()=>{Au.set(!1)},3e3))}function Ah(V){const m=V==="active"||V==="lifetime";Uc.set(m)}function od(V){let m,I="<span>Log in to interact with the map</span>";return{c(){m=tt("div"),m.innerHTML=I,this.h()},l(E){m=et(E,"DIV",{class:!0,"data-svelte-h":!0}),li(m)!=="svelte-sdlnke"&&(m.innerHTML=I),this.h()},h(){Te(m,"class","login-hint svelte-1yxm7uw")},m(E,P){Ft(E,m,P)},d(E){E&&He(m)}}}function Yp(V){let m,I,E,P=!V[0]&&od();return{c(){m=tt("div"),I=Mt(),P&&P.c(),E=Cr(),this.h()},l(Z){m=et(Z,"DIV",{class:!0}),Pt(m).forEach(He),I=Dt(Z),P&&P.l(Z),E=Cr(),this.h()},h(){Te(m,"class","map-container svelte-1yxm7uw")},m(Z,S){Ft(Z,m,S),V[7](m),Ft(Z,I,S),P&&P.m(Z,S),Ft(Z,E,S)},p(Z,[S]){Z[0]?P&&(P.d(1),P=null):P||(P=od(),P.c(),P.m(E.parentNode,E))},i:Pi,o:Pi,d(Z){Z&&(He(m),He(I),He(E)),V[7](null),P&&P.d(Z)}}}function Kp(V,m,I){let E,P;Cn(V,Qs,je=>I(6,E=je)),Cn(V,Nc,je=>I(0,P=je));let{mapTilerKey:Z}=m,S,c=null,he=null,Ee=null,Fe=!1;async function Qe(){if(!P){Ah(null);return}try{const je=await Or.collection("users").getOne(P.id);Ah(je.plan_status)}catch{Ah(null)}}function me(){if(!c||Fe||Es(Uc))return;const je=c.getZoom();if(dh.set(je),je<Fc)return;const bt=c.getCenter();if(!su(bt.lng,bt.lat)){Fe=!0;const Bt=Jp(bt.lng,bt.lat);c.setCenter([Bt.lng,Bt.lat]),au(),setTimeout(()=>{Fe=!1},100)}}function $e(){if(!c||Fe||Es(Uc))return;const je=c.getZoom(),bt=Es(dh);if(dh.set(je),bt<Fc&&je>=Fc){const Bt=c.getCenter();if(!su(Bt.lng,Bt.lat)){Fe=!0;const ht=Es(Oc);c.flyTo({center:[ht.center.lng,ht.center.lat],zoom:je}),au(),setTimeout(()=>{Fe=!1},500)}}}gh(async()=>{const je=Es(Oc);I(3,c=new Gc.Map({container:S,style:`https://api.maptiler.com/maps/outdoor-v2/style.json?key=${Z}`,center:[je.center.lng,je.center.lat],zoom:10})),c.addControl(new Gc.NavigationControl,"top-right"),c.addControl(new Gc.ScaleControl,"bottom-left"),c.on("move",me),c.on("zoom",$e),c.on("click",bt=>{if(Es(Uc))return;((c==null?void 0:c.getZoom())??0)>=Fc&&!su(bt.lngLat.lng,bt.lngLat.lat)&&au()}),c.on("load",async()=>{if(!c)return;I(4,he=new fp(c));const bt=await he.init();I(5,Ee=new Ip(c)),await Ee.init(),bt?(console.log("COG overlay enabled"),E.activeLayer==="exposure"&&he.loadVisibleRegions(),c.on("moveend",()=>{E.activeLayer==="exposure"&&(he==null||he.onViewportChange())})):console.log("Shielding overlay disabled (PUBLIC_SHIELDING_COG_BASE_URL not set)")})}),Sd(()=>{he==null||he.destroy(),Ee==null||Ee.destroy(),c==null||c.remove()});function rt(je){ou[je?"unshift":"push"](()=>{S=je,I(1,S)})}return V.$$set=je=>{"mapTilerKey"in je&&I(2,Z=je.mapTilerKey)},V.$$.update=()=>{V.$$.dirty&112&&E.overlayOpacity!==void 0&&(he==null||he.updateOpacity(E.overlayOpacity),Ee==null||Ee.updateOpacity(E.overlayOpacity)),V.$$.dirty&112&&he&&Ee&&(E.activeLayer==="exposure"?(Ee.hide(),he.loadVisibleRegions()):(he.hideAllLayers(),Ee.show())),V.$$.dirty&96&&Ee&&E.activeLayer==="activity"&&Ee.setPeriod(E.lightningPeriod),V.$$.dirty&1&&(P?Qe():Ah(null)),V.$$.dirty&9&&c&&(P?(c.scrollZoom.enable(),c.boxZoom.enable(),c.dragRotate.enable(),c.dragPan.enable(),c.keyboard.enable(),c.doubleClickZoom.enable(),c.touchZoomRotate.enable()):(c.scrollZoom.disable(),c.boxZoom.disable(),c.dragRotate.disable(),c.dragPan.disable(),c.keyboard.disable(),c.doubleClickZoom.disable(),c.touchZoomRotate.disable()))},[P,S,Z,c,he,Ee,E,rt]}let Zp=class extends ls{constructor(m){super(),cs(this,m,Kp,Yp,os,{mapTilerKey:2})}};function $p(V){let m,I,E,P="<span>Protected</span> <span>Exposed</span>";return{c(){m=tt("div"),I=Mt(),E=tt("div"),E.innerHTML=P,this.h()},l(Z){m=et(Z,"DIV",{class:!0,style:!0}),Pt(m).forEach(He),I=Dt(Z),E=et(Z,"DIV",{class:!0,"data-svelte-h":!0}),li(E)!=="svelte-1x1do4p"&&(E.innerHTML=P),this.h()},h(){Te(m,"class","gradient-bar svelte-1imlov9"),kd(m,"background",V[3]),Te(E,"class","gradient-labels svelte-1imlov9")},m(Z,S){Ft(Z,m,S),Ft(Z,I,S),Ft(Z,E,S)},p:Pi,d(Z){Z&&(He(m),He(I),He(E))}}}function Xp(V){let m,I,E,P="<span>Low</span> <span>High</span>";return{c(){m=tt("div"),I=Mt(),E=tt("div"),E.innerHTML=P,this.h()},l(Z){m=et(Z,"DIV",{class:!0,style:!0}),Pt(m).forEach(He),I=Dt(Z),E=et(Z,"DIV",{class:!0,"data-svelte-h":!0}),li(E)!=="svelte-3tvt5t"&&(E.innerHTML=P),this.h()},h(){Te(m,"class","gradient-bar svelte-1imlov9"),kd(m,"background",V[2]),Te(E,"class","gradient-labels svelte-1imlov9")},m(Z,S){Ft(Z,m,S),Ft(Z,I,S),Ft(Z,E,S)},p:Pi,d(Z){Z&&(He(m),He(I),He(E))}}}function Wp(V){let m,I,E=(V[0].activeLayer==="activity"?V[1]:"Exposure")+"",P,Z,S;function c(Fe,Qe){return Fe[0].activeLayer==="activity"?Xp:$p}let he=c(V),Ee=he(V);return{c(){m=tt("div"),I=tt("h3"),P=Ji(E),Z=Mt(),S=tt("div"),Ee.c(),this.h()},l(Fe){m=et(Fe,"DIV",{class:!0});var Qe=Pt(m);I=et(Qe,"H3",{class:!0});var me=Pt(I);P=ji(me,E),me.forEach(He),Z=Dt(Qe),S=et(Qe,"DIV",{class:!0});var $e=Pt(S);Ee.l($e),$e.forEach(He),Qe.forEach(He),this.h()},h(){Te(I,"class","svelte-1imlov9"),Te(S,"class","legend-items svelte-1imlov9"),Te(m,"class","legend svelte-1imlov9")},m(Fe,Qe){Ft(Fe,m,Qe),Ge(m,I),Ge(I,P),Ge(m,Z),Ge(m,S),Ee.m(S,null)},p(Fe,[Qe]){Qe&3&&E!==(E=(Fe[0].activeLayer==="activity"?Fe[1]:"Exposure")+"")&&tn(P,E),he===(he=c(Fe))&&Ee?Ee.p(Fe,Qe):(Ee.d(1),Ee=he(Fe),Ee&&(Ee.c(),Ee.m(S,null)))},i:Pi,o:Pi,d(Fe){Fe&&He(m),Ee.d()}}}function em(V,m,I){let E,P;Cn(V,Qs,he=>I(0,P=he));const Z=`linear-gradient(90deg, ${Gd.join(", ")})`,c=`linear-gradient(90deg, ${[...gp.map(he=>he.color)].reverse().join(", ")})`;return V.$$.update=()=>{V.$$.dirty&1&&I(1,E=P.lightningPeriod==="year"?"Activity (Annual)":`Activity (${cu[P.lightningPeriod]})`)},[P,E,Z,c]}class tm extends ls{constructor(m){super(),cs(this,m,em,Wp,os,{})}}function ld(V){let m,I,E,P,Z,S,c;return{c(){m=tt("div"),I=tt("div"),E=Mt(),P=tt("span"),Z=Ji("Loading... ("),S=Ji(V[1]),c=Ji(" pending)"),this.h()},l(he){m=et(he,"DIV",{class:!0});var Ee=Pt(m);I=et(Ee,"DIV",{class:!0}),Pt(I).forEach(He),E=Dt(Ee),P=et(Ee,"SPAN",{});var Fe=Pt(P);Z=ji(Fe,"Loading... ("),S=ji(Fe,V[1]),c=ji(Fe," pending)"),Fe.forEach(He),Ee.forEach(He),this.h()},h(){Te(I,"class","spinner svelte-hal6h8"),Te(m,"class","loading-indicator svelte-hal6h8")},m(he,Ee){Ft(he,m,Ee),Ge(m,I),Ge(m,E),Ge(m,P),Ge(P,Z),Ge(P,S),Ge(P,c)},p(he,Ee){Ee&2&&tn(S,he[1])},d(he){he&&He(m)}}}function im(V){let m,I=V[0]&&ld(V);return{c(){I&&I.c(),m=Cr()},l(E){I&&I.l(E),m=Cr()},m(E,P){I&&I.m(E,P),Ft(E,m,P)},p(E,[P]){E[0]?I?I.p(E,P):(I=ld(E),I.c(),I.m(m.parentNode,m)):I&&(I.d(1),I=null)},i:Pi,o:Pi,d(E){E&&He(m),I&&I.d(E)}}}function rm(V,m,I){let E,P;return Cn(V,ip,Z=>I(0,E=Z)),Cn(V,hc,Z=>I(1,P=Z)),[E,P]}class nm extends ls{constructor(m){super(),cs(this,m,rm,im,os,{})}}function cd(V){let m,I='<p class="svelte-1k0q185">Adjusts the transparency of the overlay layer, making it easier to see the underlying map details.</p>';return{c(){m=tt("div"),m.innerHTML=I,this.h()},l(E){m=et(E,"DIV",{class:!0,"data-svelte-h":!0}),li(m)!=="svelte-kvhtey"&&(m.innerHTML=I),this.h()},h(){Te(m,"class","help-popover svelte-1k0q185")},m(E,P){Ft(E,m,P)},d(E){E&&He(m)}}}function sm(V){let m,I,E="Overlay Opacity",P,Z,S,c,he,Ee=Math.round(V[1].overlayOpacity*100)+"",Fe,Qe,me,$e,rt="?",je,bt,Bt,ht=V[0]&&cd();return{c(){m=tt("div"),I=tt("label"),I.textContent=E,P=Mt(),Z=tt("input"),c=Mt(),he=tt("span"),Fe=Ji(Ee),Qe=Ji("%"),me=Mt(),$e=tt("button"),$e.textContent=rt,je=Mt(),ht&&ht.c(),this.h()},l(Xe){m=et(Xe,"DIV",{class:!0});var We=Pt(m);I=et(We,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),li(I)!=="svelte-2ehpdk"&&(I.textContent=E),P=Dt(We),Z=et(We,"INPUT",{id:!0,type:!0,min:!0,max:!0,step:!0,class:!0}),c=Dt(We),he=et(We,"SPAN",{class:!0});var dt=Pt(he);Fe=ji(dt,Ee),Qe=ji(dt,"%"),dt.forEach(He),me=Dt(We),$e=et(We,"BUTTON",{class:!0,title:!0,"aria-label":!0,"data-svelte-h":!0}),li($e)!=="svelte-1lgoic7"&&($e.textContent=rt),je=Dt(We),ht&&ht.l(We),We.forEach(He),this.h()},h(){Te(I,"for","opacity-slider"),Te(I,"class","svelte-1k0q185"),Te(Z,"id","opacity-slider"),Te(Z,"type","range"),Te(Z,"min","0"),Te(Z,"max","1"),Te(Z,"step","0.1"),Z.value=S=V[1].overlayOpacity,Te(Z,"class","svelte-1k0q185"),Te(he,"class","opacity-value svelte-1k0q185"),Te($e,"class","help-btn svelte-1k0q185"),Te($e,"title","What is this?"),Te($e,"aria-label","Help"),Te(m,"class","opacity-control svelte-1k0q185")},m(Xe,We){Ft(Xe,m,We),Ge(m,I),Ge(m,P),Ge(m,Z),Ge(m,c),Ge(m,he),Ge(he,Fe),Ge(he,Qe),Ge(m,me),Ge(m,$e),Ge(m,je),ht&&ht.m(m,null),bt||(Bt=[Ti(window,"click",V[4]),Ti(Z,"input",V[2]),Ti($e,"click",Dd(V[3]))],bt=!0)},p(Xe,[We]){We&2&&S!==(S=Xe[1].overlayOpacity)&&(Z.value=S),We&2&&Ee!==(Ee=Math.round(Xe[1].overlayOpacity*100)+"")&&tn(Fe,Ee),Xe[0]?ht||(ht=cd(),ht.c(),ht.m(m,null)):ht&&(ht.d(1),ht=null)},i:Pi,o:Pi,d(Xe){Xe&&He(m),ht&&ht.d(),bt=!1,Jo(Bt)}}}function am(V,m,I){let E;Cn(V,Qs,he=>I(1,E=he));let P=!1;function Z(he){const Ee=he.target;np(parseFloat(Ee.value))}function S(){I(0,P=!P)}function c(he){he.target.closest(".opacity-control")||I(0,P=!1)}return[P,E,Z,S,c]}class om extends ls{constructor(m){super(),cs(this,m,am,sm,os,{})}}function hd(V){let m,I,E,P="",Z,S,c=V[1]==="login"?"Login":"Create Account",he,Ee,Fe,Qe,me,$e="Email",rt,je,bt,Bt,ht,Xe="Password",We,dt,zt,ut,ft,Nt,Gt,St=V[6]?"Please wait...":V[1]==="login"?"Login":"Create Account",nr,mi,ri,Xt='<span class="svelte-16siter">or</span>',Ei,ni,Oi,Yi,Si,Qi,$i,ur,qi,vi,Wi,Vi,yi=V[1]==="register"&&ud(V),pi=V[5]&&Ad(V);function yr(Kt,hi){return Kt[1]==="login"?cm:lm}let _r=yr(V),Gi=_r(V);return{c(){m=tt("div"),I=tt("div"),E=tt("button"),E.textContent=P,Z=Mt(),S=tt("h2"),he=Ji(c),Ee=Mt(),Fe=tt("form"),Qe=tt("div"),me=tt("label"),me.textContent=$e,rt=Mt(),je=tt("input"),bt=Mt(),Bt=tt("div"),ht=tt("label"),ht.textContent=Xe,We=Mt(),dt=tt("input"),ut=Mt(),yi&&yi.c(),ft=Mt(),pi&&pi.c(),Nt=Mt(),Gt=tt("button"),nr=Ji(St),mi=Mt(),ri=tt("div"),ri.innerHTML=Xt,Ei=Mt(),ni=tt("button"),Oi=Lc("svg"),Yi=Lc("path"),Si=Lc("path"),Qi=Lc("path"),$i=Lc("path"),ur=Ji(`
        Continue with Google`),qi=Mt(),vi=tt("div"),Gi.c(),this.h()},l(Kt){m=et(Kt,"DIV",{class:!0,role:!0,"aria-modal":!0});var hi=Pt(m);I=et(hi,"DIV",{class:!0});var si=Pt(I);E=et(si,"BUTTON",{class:!0,"data-svelte-h":!0}),li(E)!=="svelte-1ngpojv"&&(E.textContent=P),Z=Dt(si),S=et(si,"H2",{class:!0});var Re=Pt(S);he=ji(Re,c),Re.forEach(He),Ee=Dt(si),Fe=et(si,"FORM",{});var Ri=Pt(Fe);Qe=et(Ri,"DIV",{class:!0});var Mr=Pt(Qe);me=et(Mr,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),li(me)!=="svelte-1p9d3fm"&&(me.textContent=$e),rt=Dt(Mr),je=et(Mr,"INPUT",{id:!0,type:!0,autocomplete:!0,class:!0}),Mr.forEach(He),bt=Dt(Ri),Bt=et(Ri,"DIV",{class:!0});var Wt=Pt(Bt);ht=et(Wt,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),li(ht)!=="svelte-pepa0a"&&(ht.textContent=Xe),We=Dt(Wt),dt=et(Wt,"INPUT",{id:!0,type:!0,autocomplete:!0,class:!0}),Wt.forEach(He),ut=Dt(Ri),yi&&yi.l(Ri),ft=Dt(Ri),pi&&pi.l(Ri),Nt=Dt(Ri),Gt=et(Ri,"BUTTON",{type:!0,class:!0});var Ii=Pt(Gt);nr=ji(Ii,St),Ii.forEach(He),Ri.forEach(He),mi=Dt(si),ri=et(si,"DIV",{class:!0,"data-svelte-h":!0}),li(ri)!=="svelte-aitez0"&&(ri.innerHTML=Xt),Ei=Dt(si),ni=et(si,"BUTTON",{class:!0});var Un=Pt(ni);Oi=Rc(Un,"svg",{viewBox:!0,width:!0,height:!0});var Ir=Pt(Oi);Yi=Rc(Ir,"path",{fill:!0,d:!0}),Pt(Yi).forEach(He),Si=Rc(Ir,"path",{fill:!0,d:!0}),Pt(Si).forEach(He),Qi=Rc(Ir,"path",{fill:!0,d:!0}),Pt(Qi).forEach(He),$i=Rc(Ir,"path",{fill:!0,d:!0}),Pt($i).forEach(He),Ir.forEach(He),ur=ji(Un,`
        Continue with Google`),Un.forEach(He),qi=Dt(si),vi=et(si,"DIV",{class:!0});var qr=Pt(vi);Gi.l(qr),qr.forEach(He),si.forEach(He),hi.forEach(He),this.h()},h(){Te(E,"class","close-btn svelte-16siter"),Te(S,"class","svelte-16siter"),Te(me,"for","email"),Te(me,"class","svelte-16siter"),Te(je,"id","email"),Te(je,"type","email"),je.required=!0,Te(je,"autocomplete","email"),Te(je,"class","svelte-16siter"),Te(Qe,"class","field svelte-16siter"),Te(ht,"for","password"),Te(ht,"class","svelte-16siter"),Te(dt,"id","password"),Te(dt,"type","password"),dt.required=!0,Te(dt,"autocomplete",zt=V[1]==="login"?"current-password":"new-password"),Te(dt,"class","svelte-16siter"),Te(Bt,"class","field svelte-16siter"),Te(Gt,"type","submit"),Te(Gt,"class","submit-btn svelte-16siter"),Gt.disabled=V[6],Te(ri,"class","divider svelte-16siter"),Te(Yi,"fill","#4285F4"),Te(Yi,"d","M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"),Te(Si,"fill","#34A853"),Te(Si,"d","M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"),Te(Qi,"fill","#FBBC05"),Te(Qi,"d","M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"),Te($i,"fill","#EA4335"),Te($i,"d","M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"),Te(Oi,"viewBox","0 0 24 24"),Te(Oi,"width","18"),Te(Oi,"height","18"),Te(ni,"class","google-btn svelte-16siter"),ni.disabled=V[6],Te(vi,"class","toggle svelte-16siter"),Te(I,"class","modal svelte-16siter"),Te(m,"class","backdrop svelte-16siter"),Te(m,"role","dialog"),Te(m,"aria-modal","true")},m(Kt,hi){Ft(Kt,m,hi),Ge(m,I),Ge(I,E),Ge(I,Z),Ge(I,S),Ge(S,he),Ge(I,Ee),Ge(I,Fe),Ge(Fe,Qe),Ge(Qe,me),Ge(Qe,rt),Ge(Qe,je),lc(je,V[2]),Ge(Fe,bt),Ge(Fe,Bt),Ge(Bt,ht),Ge(Bt,We),Ge(Bt,dt),lc(dt,V[3]),Ge(Fe,ut),yi&&yi.m(Fe,null),Ge(Fe,ft),pi&&pi.m(Fe,null),Ge(Fe,Nt),Ge(Fe,Gt),Ge(Gt,nr),Ge(I,mi),Ge(I,ri),Ge(I,Ei),Ge(I,ni),Ge(ni,Oi),Ge(Oi,Yi),Ge(Oi,Si),Ge(Oi,Qi),Ge(Oi,$i),Ge(ni,ur),Ge(I,qi),Ge(I,vi),Gi.m(vi,null),Wi||(Vi=[Ti(E,"click",V[11]),Ti(je,"input",V[12]),Ti(dt,"input",V[13]),Ti(Fe,"submit",Vg(V[7])),Ti(ni,"click",V[8]),Ti(m,"click",V[10])],Wi=!0)},p(Kt,hi){hi&2&&c!==(c=Kt[1]==="login"?"Login":"Create Account")&&tn(he,c),hi&4&&je.value!==Kt[2]&&lc(je,Kt[2]),hi&2&&zt!==(zt=Kt[1]==="login"?"current-password":"new-password")&&Te(dt,"autocomplete",zt),hi&8&&dt.value!==Kt[3]&&lc(dt,Kt[3]),Kt[1]==="register"?yi?yi.p(Kt,hi):(yi=ud(Kt),yi.c(),yi.m(Fe,ft)):yi&&(yi.d(1),yi=null),Kt[5]?pi?pi.p(Kt,hi):(pi=Ad(Kt),pi.c(),pi.m(Fe,Nt)):pi&&(pi.d(1),pi=null),hi&66&&St!==(St=Kt[6]?"Please wait...":Kt[1]==="login"?"Login":"Create Account")&&tn(nr,St),hi&64&&(Gt.disabled=Kt[6]),hi&64&&(ni.disabled=Kt[6]),_r===(_r=yr(Kt))&&Gi?Gi.p(Kt,hi):(Gi.d(1),Gi=_r(Kt),Gi&&(Gi.c(),Gi.m(vi,null)))},d(Kt){Kt&&He(m),yi&&yi.d(),pi&&pi.d(),Gi.d(),Wi=!1,Jo(Vi)}}}function ud(V){let m,I,E="Confirm Password",P,Z,S,c;return{c(){m=tt("div"),I=tt("label"),I.textContent=E,P=Mt(),Z=tt("input"),this.h()},l(he){m=et(he,"DIV",{class:!0});var Ee=Pt(m);I=et(Ee,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),li(I)!=="svelte-1o1itl8"&&(I.textContent=E),P=Dt(Ee),Z=et(Ee,"INPUT",{id:!0,type:!0,autocomplete:!0,class:!0}),Ee.forEach(He),this.h()},h(){Te(I,"for","passwordConfirm"),Te(I,"class","svelte-16siter"),Te(Z,"id","passwordConfirm"),Te(Z,"type","password"),Z.required=!0,Te(Z,"autocomplete","new-password"),Te(Z,"class","svelte-16siter"),Te(m,"class","field svelte-16siter")},m(he,Ee){Ft(he,m,Ee),Ge(m,I),Ge(m,P),Ge(m,Z),lc(Z,V[4]),S||(c=Ti(Z,"input",V[14]),S=!0)},p(he,Ee){Ee&16&&Z.value!==he[4]&&lc(Z,he[4])},d(he){he&&He(m),S=!1,c()}}}function Ad(V){let m,I;return{c(){m=tt("div"),I=Ji(V[5]),this.h()},l(E){m=et(E,"DIV",{class:!0});var P=Pt(m);I=ji(P,V[5]),P.forEach(He),this.h()},h(){Te(m,"class","error svelte-16siter")},m(E,P){Ft(E,m,P),Ge(m,I)},p(E,P){P&32&&tn(I,E[5])},d(E){E&&He(m)}}}function lm(V){let m,I,E="Login",P,Z;return{c(){m=Ji("Already have an account? "),I=tt("button"),I.textContent=E,this.h()},l(S){m=ji(S,"Already have an account? "),I=et(S,"BUTTON",{class:!0,"data-svelte-h":!0}),li(I)!=="svelte-1qozt9s"&&(I.textContent=E),this.h()},h(){Te(I,"class","svelte-16siter")},m(S,c){Ft(S,m,c),Ft(S,I,c),P||(Z=Ti(I,"click",V[9]),P=!0)},p:Pi,d(S){S&&(He(m),He(I)),P=!1,Z()}}}function cm(V){let m,I,E="Sign up",P,Z;return{c(){m=Ji("Don't have an account? "),I=tt("button"),I.textContent=E,this.h()},l(S){m=ji(S,"Don't have an account? "),I=et(S,"BUTTON",{class:!0,"data-svelte-h":!0}),li(I)!=="svelte-1uqo441"&&(I.textContent=E),this.h()},h(){Te(I,"class","svelte-16siter")},m(S,c){Ft(S,m,c),Ft(S,I,c),P||(Z=Ti(I,"click",V[9]),P=!0)},p:Pi,d(S){S&&(He(m),He(I)),P=!1,Z()}}}function hm(V){let m,I=V[0]&&hd(V);return{c(){I&&I.c(),m=Cr()},l(E){I&&I.l(E),m=Cr()},m(E,P){I&&I.m(E,P),Ft(E,m,P)},p(E,[P]){E[0]?I?I.p(E,P):(I=hd(E),I.c(),I.m(m.parentNode,m)):I&&(I.d(1),I=null)},i:Pi,o:Pi,d(E){E&&He(m),I&&I.d(E)}}}function um(V,m,I){let{show:E=!1}=m,P="login",Z="",S="",c="",he="",Ee=!1;async function Fe(){I(5,he=""),I(6,Ee=!0);try{P==="login"?await jd(Z,S):await Np(Z,S,c),I(0,E=!1),me()}catch(Xe){I(5,he=Xe.message||"Authentication failed")}finally{I(6,Ee=!1)}}async function Qe(){I(5,he=""),I(6,Ee=!0);try{await qp("google"),I(0,E=!1),me()}catch(Xe){I(5,he=Xe.message||"Google login failed")}finally{I(6,Ee=!1)}}function me(){I(2,Z=""),I(3,S=""),I(4,c=""),I(5,he="")}function $e(){I(1,P=P==="login"?"register":"login"),I(5,he="")}function rt(Xe){Xe.target===Xe.currentTarget&&I(0,E=!1)}const je=()=>I(0,E=!1);function bt(){Z=this.value,I(2,Z)}function Bt(){S=this.value,I(3,S)}function ht(){c=this.value,I(4,c)}return V.$$set=Xe=>{"show"in Xe&&I(0,E=Xe.show)},[E,P,Z,S,c,he,Ee,Fe,Qe,$e,rt,je,bt,Bt,ht]}class Am extends ls{constructor(m){super(),cs(this,m,um,hm,os,{show:0})}}function dd(V,m,I){var S;const E=V.slice();E[15]=m[I];const P=((S=E[1].currentPlan)==null?void 0:S.id)===E[15].id;E[16]=P;const Z=!E[16]||E[1].cancelAtPeriodEnd;return E[17]=Z,E}function fd(V){let m,I,E,P,Z,S="",c,he,Ee="Billing",Fe,Qe,me,$e,rt="Current plan",je,bt,Bt,ht,Xe,We,dt,zt;function ut(Xt,Ei){return Xt[1].currentPlan?fm:dm}let ft=ut(V),Nt=ft(V),Gt=V[1].currentPlan&&V[1].planStatus!=="lifetime"&&!V[1].cancelAtPeriodEnd&&md(V),St=V[4]&&yd(V);function nr(Xt,Ei){return Xt[3]?mm:Xt[5].length===0?pm:gm}let mi=nr(V),ri=mi(V);return{c(){m=tt("div"),I=tt("button"),E=Mt(),P=tt("div"),Z=tt("button"),Z.textContent=S,c=Mt(),he=tt("h2"),he.textContent=Ee,Fe=Mt(),Qe=tt("div"),me=tt("div"),$e=tt("div"),$e.textContent=rt,je=Mt(),bt=tt("div"),Nt.c(),Bt=Mt(),Gt&&Gt.c(),ht=Mt(),St&&St.c(),Xe=Mt(),We=tt("div"),ri.c(),this.h()},l(Xt){m=et(Xt,"DIV",{class:!0,role:!0,"aria-modal":!0});var Ei=Pt(m);I=et(Ei,"BUTTON",{class:!0,type:!0,"aria-label":!0}),Pt(I).forEach(He),E=Dt(Ei),P=et(Ei,"DIV",{class:!0});var ni=Pt(P);Z=et(ni,"BUTTON",{class:!0,"data-svelte-h":!0}),li(Z)!=="svelte-1ngpojv"&&(Z.textContent=S),c=Dt(ni),he=et(ni,"H2",{class:!0,"data-svelte-h":!0}),li(he)!=="svelte-5a0ibn"&&(he.textContent=Ee),Fe=Dt(ni),Qe=et(ni,"DIV",{class:!0});var Oi=Pt(Qe);me=et(Oi,"DIV",{class:!0});var Yi=Pt(me);$e=et(Yi,"DIV",{class:!0,"data-svelte-h":!0}),li($e)!=="svelte-ehgmhv"&&($e.textContent=rt),je=Dt(Yi),bt=et(Yi,"DIV",{class:!0});var Si=Pt(bt);Nt.l(Si),Si.forEach(He),Yi.forEach(He),Bt=Dt(Oi),Gt&&Gt.l(Oi),Oi.forEach(He),ht=Dt(ni),St&&St.l(ni),Xe=Dt(ni),We=et(ni,"DIV",{class:!0});var Qi=Pt(We);ri.l(Qi),Qi.forEach(He),ni.forEach(He),Ei.forEach(He),this.h()},h(){Te(I,"class","backdrop-dismiss svelte-1ul00ht"),Te(I,"type","button"),Te(I,"aria-label","Close billing"),Te(Z,"class","close-btn svelte-1ul00ht"),Te(he,"class","svelte-1ul00ht"),Te($e,"class","label svelte-1ul00ht"),Te(bt,"class","value svelte-1ul00ht"),Te(me,"class","current-info svelte-1ul00ht"),Te(Qe,"class","current svelte-1ul00ht"),Te(We,"class","plans svelte-1ul00ht"),Te(P,"class","modal svelte-1ul00ht"),Te(m,"class","backdrop svelte-1ul00ht"),Te(m,"role","dialog"),Te(m,"aria-modal","true")},m(Xt,Ei){Ft(Xt,m,Ei),Ge(m,I),Ge(m,E),Ge(m,P),Ge(P,Z),Ge(P,c),Ge(P,he),Ge(P,Fe),Ge(P,Qe),Ge(Qe,me),Ge(me,$e),Ge(me,je),Ge(me,bt),Nt.m(bt,null),Ge(Qe,Bt),Gt&&Gt.m(Qe,null),Ge(P,ht),St&&St.m(P,null),Ge(P,Xe),Ge(P,We),ri.m(We,null),dt||(zt=[Ti(I,"click",V[8]),Ti(Z,"click",V[10])],dt=!0)},p(Xt,Ei){ft===(ft=ut(Xt))&&Nt?Nt.p(Xt,Ei):(Nt.d(1),Nt=ft(Xt),Nt&&(Nt.c(),Nt.m(bt,null))),Xt[1].currentPlan&&Xt[1].planStatus!=="lifetime"&&!Xt[1].cancelAtPeriodEnd?Gt?Gt.p(Xt,Ei):(Gt=md(Xt),Gt.c(),Gt.m(Qe,null)):Gt&&(Gt.d(1),Gt=null),Xt[4]?St?St.p(Xt,Ei):(St=yd(Xt),St.c(),St.m(P,Xe)):St&&(St.d(1),St=null),mi===(mi=nr(Xt))&&ri?ri.p(Xt,Ei):(ri.d(1),ri=mi(Xt),ri&&(ri.c(),ri.m(We,null)))},d(Xt){Xt&&He(m),Nt.d(),Gt&&Gt.d(),St&&St.d(),ri.d(),dt=!1,Jo(zt)}}}function dm(V){let m,I="None";return{c(){m=tt("span"),m.textContent=I,this.h()},l(E){m=et(E,"SPAN",{class:!0,"data-svelte-h":!0}),li(m)!=="svelte-1l9bfjs"&&(m.textContent=I),this.h()},h(){Te(m,"class","muted svelte-1ul00ht")},m(E,P){Ft(E,m,P)},p:Pi,d(E){E&&He(m)}}}function fm(V){let m,I=V[1].currentPlan.name+"",E,P,Z,S,c=V[1].planStatus&&gd(V),he=V[1].cancelAtPeriodEnd&&pd();return{c(){m=tt("span"),E=Ji(I),P=Mt(),c&&c.c(),Z=Mt(),he&&he.c(),S=Cr(),this.h()},l(Ee){m=et(Ee,"SPAN",{class:!0});var Fe=Pt(m);E=ji(Fe,I),Fe.forEach(He),P=Dt(Ee),c&&c.l(Ee),Z=Dt(Ee),he&&he.l(Ee),S=Cr(),this.h()},h(){Te(m,"class","plan-name svelte-1ul00ht")},m(Ee,Fe){Ft(Ee,m,Fe),Ge(m,E),Ft(Ee,P,Fe),c&&c.m(Ee,Fe),Ft(Ee,Z,Fe),he&&he.m(Ee,Fe),Ft(Ee,S,Fe)},p(Ee,Fe){Fe&2&&I!==(I=Ee[1].currentPlan.name+"")&&tn(E,I),Ee[1].planStatus?c?c.p(Ee,Fe):(c=gd(Ee),c.c(),c.m(Z.parentNode,Z)):c&&(c.d(1),c=null),Ee[1].cancelAtPeriodEnd?he||(he=pd(),he.c(),he.m(S.parentNode,S)):he&&(he.d(1),he=null)},d(Ee){Ee&&(He(m),He(P),He(Z),He(S)),c&&c.d(Ee),he&&he.d(Ee)}}}function gd(V){let m,I=V[1].planStatus+"",E;return{c(){m=tt("span"),E=Ji(I),this.h()},l(P){m=et(P,"SPAN",{class:!0});var Z=Pt(m);E=ji(Z,I),Z.forEach(He),this.h()},h(){Te(m,"class","status svelte-1ul00ht")},m(P,Z){Ft(P,m,Z),Ge(m,E)},p(P,Z){Z&2&&I!==(I=P[1].planStatus+"")&&tn(E,I)},d(P){P&&He(m)}}}function pd(V){let m,I="Cancels at period end";return{c(){m=tt("span"),m.textContent=I,this.h()},l(E){m=et(E,"SPAN",{class:!0,"data-svelte-h":!0}),li(m)!=="svelte-10njltp"&&(m.textContent=I),this.h()},h(){Te(m,"class","status canceling svelte-1ul00ht")},m(E,P){Ft(E,m,P)},d(E){E&&He(m)}}}function md(V){let m,I=V[2]?"Canceling...":"Cancel",E,P,Z,S;return{c(){m=tt("button"),E=Ji(I),this.h()},l(c){m=et(c,"BUTTON",{class:!0});var he=Pt(m);E=ji(he,I),he.forEach(He),this.h()},h(){Te(m,"class","cancel-btn svelte-1ul00ht"),m.disabled=P=V[2]||V[3]},m(c,he){Ft(c,m,he),Ge(m,E),Z||(S=Ti(m,"click",V[6]),Z=!0)},p(c,he){he&4&&I!==(I=c[2]?"Canceling...":"Cancel")&&tn(E,I),he&12&&P!==(P=c[2]||c[3])&&(m.disabled=P)},d(c){c&&He(m),Z=!1,S()}}}function yd(V){let m,I;return{c(){m=tt("div"),I=Ji(V[4]),this.h()},l(E){m=et(E,"DIV",{class:!0});var P=Pt(m);I=ji(P,V[4]),P.forEach(He),this.h()},h(){Te(m,"class","error svelte-1ul00ht")},m(E,P){Ft(E,m,P),Ge(m,I)},p(E,P){P&16&&tn(I,E[4])},d(E){E&&He(m)}}}function gm(V){let m=[],I=new Map,E,P=fh(V[5]);const Z=S=>S[15].id;for(let S=0;S<P.length;S+=1){let c=dd(V,P,S),he=Z(c);I.set(he,m[S]=_d(he,c))}return{c(){for(let S=0;S<m.length;S+=1)m[S].c();E=Cr()},l(S){for(let c=0;c<m.length;c+=1)m[c].l(S);E=Cr()},m(S,c){for(let he=0;he<m.length;he+=1)m[he]&&m[he].m(S,c);Ft(S,E,c)},p(S,c){c&170&&(P=fh(S[5]),m=Kg(m,c,Z,1,S,P,I,E.parentNode,Yg,_d,E,dd))},d(S){S&&He(E);for(let c=0;c<m.length;c+=1)m[c].d(S)}}}function pm(V){let m,I="No active plans";return{c(){m=tt("div"),m.textContent=I,this.h()},l(E){m=et(E,"DIV",{class:!0,"data-svelte-h":!0}),li(m)!=="svelte-1i9sp8t"&&(m.textContent=I),this.h()},h(){Te(m,"class","muted svelte-1ul00ht")},m(E,P){Ft(E,m,P)},p:Pi,d(E){E&&He(m)}}}function mm(V){let m,I="Loading...";return{c(){m=tt("div"),m.textContent=I,this.h()},l(E){m=et(E,"DIV",{class:!0,"data-svelte-h":!0}),li(m)!=="svelte-mlj0q2"&&(m.textContent=I),this.h()},h(){Te(m,"class","muted svelte-1ul00ht")},m(E,P){Ft(E,m,P)},p:Pi,d(E){E&&He(m)}}}function ym(V){let m,I=V[16]&&V[1].cancelAtPeriodEnd?"Resubscribe":V[15].interval==="lifetime"?"Buy":"Subscribe",E,P,Z;function S(){return V[11](V[15])}return{c(){m=tt("button"),E=Ji(I),this.h()},l(c){m=et(c,"BUTTON",{class:!0});var he=Pt(m);E=ji(he,I),he.forEach(He),this.h()},h(){Te(m,"class","checkout-btn svelte-1ul00ht"),m.disabled=V[3]},m(c,he){Ft(c,m,he),Ge(m,E),P||(Z=Ti(m,"click",S),P=!0)},p(c,he){V=c,he&34&&I!==(I=V[16]&&V[1].cancelAtPeriodEnd?"Resubscribe":V[15].interval==="lifetime"?"Buy":"Subscribe")&&tn(E,I),he&8&&(m.disabled=V[3])},d(c){c&&He(m),P=!1,Z()}}}function _m(V){let m,I="Current";return{c(){m=tt("span"),m.textContent=I,this.h()},l(E){m=et(E,"SPAN",{class:!0,"data-svelte-h":!0}),li(m)!=="svelte-1h9p5id"&&(m.textContent=I),this.h()},h(){Te(m,"class","current-badge svelte-1ul00ht")},m(E,P){Ft(E,m,P)},p:Pi,d(E){E&&He(m)}}}function _d(V,m){let I,E,P,Z=m[15].name+"",S,c,he,Ee,Fe=Id(m[15].price,m[15].currency)+"",Qe,me,$e,rt,je=(m[15].interval==="lifetime"?"once":m[15].interval)+"",bt,Bt,ht;function Xe(zt,ut){return zt[16]&&!zt[1].cancelAtPeriodEnd?_m:ym}let We=Xe(m),dt=We(m);return{key:V,first:null,c(){I=tt("div"),E=tt("div"),P=tt("div"),S=Ji(Z),c=Mt(),he=tt("div"),Ee=tt("span"),Qe=Ji(Fe),me=Mt(),$e=tt("span"),rt=Ji("/ "),bt=Ji(je),Bt=Mt(),dt.c(),ht=Mt(),this.h()},l(zt){I=et(zt,"DIV",{class:!0});var ut=Pt(I);E=et(ut,"DIV",{class:!0});var ft=Pt(E);P=et(ft,"DIV",{class:!0});var Nt=Pt(P);S=ji(Nt,Z),Nt.forEach(He),c=Dt(ft),he=et(ft,"DIV",{class:!0});var Gt=Pt(he);Ee=et(Gt,"SPAN",{class:!0});var St=Pt(Ee);Qe=ji(St,Fe),St.forEach(He),me=Dt(Gt),$e=et(Gt,"SPAN",{class:!0});var nr=Pt($e);rt=ji(nr,"/ "),bt=ji(nr,je),nr.forEach(He),Gt.forEach(He),ft.forEach(He),Bt=Dt(ut),dt.l(ut),ht=Dt(ut),ut.forEach(He),this.h()},h(){Te(P,"class","plan-title svelte-1ul00ht"),Te(Ee,"class","plan-price svelte-1ul00ht"),Te($e,"class","plan-interval svelte-1ul00ht"),Te(he,"class","plan-subtitle svelte-1ul00ht"),Te(E,"class","plan-meta"),Te(I,"class","plan svelte-1ul00ht"),Ta(I,"current-plan",m[16]&&!m[1].cancelAtPeriodEnd),this.first=I},m(zt,ut){Ft(zt,I,ut),Ge(I,E),Ge(E,P),Ge(P,S),Ge(E,c),Ge(E,he),Ge(he,Ee),Ge(Ee,Qe),Ge(he,me),Ge(he,$e),Ge($e,rt),Ge($e,bt),Ge(I,Bt),dt.m(I,null),Ge(I,ht)},p(zt,ut){m=zt,ut&32&&Z!==(Z=m[15].name+"")&&tn(S,Z),ut&32&&Fe!==(Fe=Id(m[15].price,m[15].currency)+"")&&tn(Qe,Fe),ut&32&&je!==(je=(m[15].interval==="lifetime"?"once":m[15].interval)+"")&&tn(bt,je),We===(We=Xe(m))&&dt?dt.p(m,ut):(dt.d(1),dt=We(m),dt&&(dt.c(),dt.m(I,ht))),ut&34&&Ta(I,"current-plan",m[16]&&!m[1].cancelAtPeriodEnd)},d(zt){zt&&He(I),dt.d()}}}function Im(V){let m,I=V[0]&&fd(V);return{c(){I&&I.c(),m=Cr()},l(E){I&&I.l(E),m=Cr()},m(E,P){I&&I.m(E,P),Ft(E,m,P)},p(E,[P]){E[0]?I?I.p(E,P):(I=fd(E),I.c(),I.m(m.parentNode,m)):I&&(I.d(1),I=null)},i:Pi,o:Pi,d(E){E&&He(m),I&&I.d(E)}}}function Id(V,m){return new Intl.NumberFormat("de-DE",{style:"currency",currency:m}).format(V)}function bm(){try{const V=Intl.DateTimeFormat().resolvedOptions().timeZone||"";if(V.startsWith("Europe/")||V==="Atlantic/Canary"||V==="Atlantic/Madeira"||V==="Atlantic/Azores")return"EUR"}catch{}return"USD"}function wm(V,m,I){let E,P;Cn(V,Nc,ht=>I(12,P=ht));let{show:Z=!1}=m,S=bm(),c=[],he={currentPlan:null,planStatus:"",cancelAtPeriodEnd:!1},Ee=!1,Fe=!1,Qe="";async function me(){var ht;if(P){I(3,Fe=!0),I(4,Qe="");try{const Xe=await Or.collection("users").getOne(P.id,{expand:"current_plan"}),We=(ht=Xe==null?void 0:Xe.expand)==null?void 0:ht.current_plan;let dt=!1;try{const ut=await Or.collection("subscriptions").getList(1,1,{filter:`user = '${P.id}'`});ut.items.length>0&&(dt=ut.items[0].cancel_at_period_end===!0)}catch{}I(1,he={currentPlan:We??null,planStatus:Xe.plan_status??"",cancelAtPeriodEnd:dt});const zt={lifetime:0,yearly:1,monthly:2};I(9,c=(await Or.collection("plans").getFullList({filter:`active = true && currency = '${S}'`})).sort((ut,ft)=>(zt[ut.interval]??99)-(zt[ft.interval]??99)))}catch(Xe){I(4,Qe=(Xe==null?void 0:Xe.message)||"Failed to load billing info")}finally{I(3,Fe=!1)}}}async function $e(){I(2,Ee=!0),I(4,Qe="");try{await Or.send("/api/stripe-cancel",{method:"POST"}),await me()}catch(ht){I(4,Qe=(ht==null?void 0:ht.message)||"Failed to cancel subscription")}finally{I(2,Ee=!1)}}async function rt(ht){I(3,Fe=!0),I(4,Qe="");try{const Xe=await Or.send("/api/stripe-checkout",{method:"POST",body:{planId:ht}});if(!(Xe!=null&&Xe.url))throw new Error("Checkout did not return a redirect URL");window.location.href=Xe.url}catch(Xe){I(4,Qe=(Xe==null?void 0:Xe.message)||"Checkout failed"),I(3,Fe=!1)}}function je(ht){I(0,Z=!1)}const bt=()=>I(0,Z=!1),Bt=ht=>rt(ht.id);return V.$$set=ht=>{"show"in ht&&I(0,Z=ht.show)},V.$$.update=()=>{V.$$.dirty&1&&Z&&me(),V.$$.dirty&514&&I(5,E=he.planStatus==="lifetime"?c.filter(ht=>ht.interval==="lifetime"):c)},[Z,he,Ee,Fe,Qe,E,$e,rt,je,c,bt,Bt]}class vm extends ls{constructor(m){super(),cs(this,m,wm,Im,os,{show:0})}}function xm(V){let m,I="Login",E,P;return{c(){m=tt("button"),m.textContent=I,this.h()},l(Z){m=et(Z,"BUTTON",{class:!0,"data-svelte-h":!0}),li(m)!=="svelte-5a9e8v"&&(m.textContent=I),this.h()},h(){Te(m,"class","login-btn svelte-t6wi3p")},m(Z,S){Ft(Z,m,S),E||(P=Ti(m,"click",V[4]),E=!0)},p:Pi,d(Z){Z&&He(m),E=!1,P()}}}function Bm(V){let m,I=V[2].email+"",E,P,Z,S="Billing",c,he,Ee="Logout",Fe,Qe;return{c(){m=tt("span"),E=Ji(I),P=Mt(),Z=tt("button"),Z.textContent=S,c=Mt(),he=tt("button"),he.textContent=Ee,this.h()},l(me){m=et(me,"SPAN",{class:!0});var $e=Pt(m);E=ji($e,I),$e.forEach(He),P=Dt(me),Z=et(me,"BUTTON",{class:!0,"data-svelte-h":!0}),li(Z)!=="svelte-sy610t"&&(Z.textContent=S),c=Dt(me),he=et(me,"BUTTON",{class:!0,"data-svelte-h":!0}),li(he)!=="svelte-nurb2"&&(he.textContent=Ee),this.h()},h(){Te(m,"class","user-email svelte-t6wi3p"),Te(Z,"class","billing-btn svelte-t6wi3p"),Te(he,"class","logout-btn svelte-t6wi3p")},m(me,$e){Ft(me,m,$e),Ge(m,E),Ft(me,P,$e),Ft(me,Z,$e),Ft(me,c,$e),Ft(me,he,$e),Fe||(Qe=[Ti(Z,"click",V[3]),Ti(he,"click",Op)],Fe=!0)},p(me,$e){$e&4&&I!==(I=me[2].email+"")&&tn(E,I)},d(me){me&&(He(m),He(P),He(Z),He(c),He(he)),Fe=!1,Jo(Qe)}}}function Cm(V){let m,I,E='<img src="/logo/incusgrid_logo_transparent.svg" alt="IncusGrid" class="logo svelte-t6wi3p"/> <span class="brand-name svelte-t6wi3p">IncusGrid</span>',P,Z,S,c,he,Ee,Fe,Qe,me;function $e(We,dt){return We[2]?Bm:xm}let rt=$e(V),je=rt(V);function bt(We){V[5](We)}let Bt={};V[0]!==void 0&&(Bt.show=V[0]),c=new Am({props:Bt}),ou.push(()=>$A(c,"show",bt));function ht(We){V[6](We)}let Xe={};return V[1]!==void 0&&(Xe.show=V[1]),Fe=new vm({props:Xe}),ou.push(()=>$A(Fe,"show",ht)),{c(){m=tt("header"),I=tt("div"),I.innerHTML=E,P=Mt(),Z=tt("div"),je.c(),S=Mt(),Cs(c.$$.fragment),Ee=Mt(),Cs(Fe.$$.fragment),this.h()},l(We){m=et(We,"HEADER",{class:!0});var dt=Pt(m);I=et(dt,"DIV",{class:!0,"data-svelte-h":!0}),li(I)!=="svelte-1c2sdme"&&(I.innerHTML=E),P=Dt(dt),Z=et(dt,"DIV",{class:!0});var zt=Pt(Z);je.l(zt),zt.forEach(He),dt.forEach(He),S=Dt(We),Bs(c.$$.fragment,We),Ee=Dt(We),Bs(Fe.$$.fragment,We),this.h()},h(){Te(I,"class","brand svelte-t6wi3p"),Te(Z,"class","auth svelte-t6wi3p"),Te(m,"class","svelte-t6wi3p")},m(We,dt){Ft(We,m,dt),Ge(m,I),Ge(m,P),Ge(m,Z),je.m(Z,null),Ft(We,S,dt),xs(c,We,dt),Ft(We,Ee,dt),xs(Fe,We,dt),me=!0},p(We,[dt]){rt===(rt=$e(We))&&je?je.p(We,dt):(je.d(1),je=rt(We),je&&(je.c(),je.m(Z,null)));const zt={};!he&&dt&1&&(he=!0,zt.show=We[0],ZA(()=>he=!1)),c.$set(zt);const ut={};!Qe&&dt&2&&(Qe=!0,ut.show=We[1],ZA(()=>Qe=!1)),Fe.$set(ut)},i(We){me||(Dr(c.$$.fragment,We),Dr(Fe.$$.fragment,We),me=!0)},o(We){dn(c.$$.fragment,We),dn(Fe.$$.fragment,We),me=!1},d(We){We&&(He(m),He(S),He(Ee)),je.d(),vs(c,We),vs(Fe,We)}}}function Em(V,m,I){let E;Cn(V,Nc,Qe=>I(2,E=Qe));let P=!1,Z=!1;function S(){I(1,Z=!0)}gh(()=>{window.addEventListener("open-billing-modal",S)}),Sd(()=>{window.removeEventListener("open-billing-modal",S)});const c=()=>I(1,Z=!0),he=()=>I(0,P=!0);function Ee(Qe){P=Qe,I(0,P)}function Fe(Qe){Z=Qe,I(1,Z)}return[P,Z,E,c,he,Ee,Fe]}class Qm extends ls{constructor(m){super(),cs(this,m,Em,Cm,os,{})}}function bd(V){let m,I='<div class="help-item svelte-1t43nla"><div class="help-icon exposure svelte-1t43nla"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M12 2L4 5v6.09c0 5.05 3.41 9.76 8 10.91 4.59-1.15 8-5.86 8-10.91V5l-8-3z"></path></svg></div> <div class="help-text svelte-1t43nla"><strong class="svelte-1t43nla">Exposure</strong> <p class="svelte-1t43nla">Shows how well terrain shields each location from lightning. Green areas have nearby hills or high buildings that act as natural lightning rods. Red areas are statistically more exposed to lightning strikes than green areas.</p></div></div> <div class="help-item svelte-1t43nla"><div class="help-icon activity svelte-1t43nla"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M7 2v11h3v9l7-12h-4l4-8z"></path></svg></div> <div class="help-text svelte-1t43nla"><strong class="svelte-1t43nla">Activity</strong> <p class="svelte-1t43nla">Shows the average lightning strikes per square kilometer for any given month or over the entire year. Red areas have significantly more lightning strikes than green areas.</p></div></div>';return{c(){m=tt("div"),m.innerHTML=I,this.h()},l(E){m=et(E,"DIV",{class:!0,"data-svelte-h":!0}),li(m)!=="svelte-p7aqei"&&(m.innerHTML=I),this.h()},h(){Te(m,"class","help-popover svelte-1t43nla")},m(E,P){Ft(E,m,P)},d(E){E&&He(m)}}}function Sm(V){let m,I,E=`<svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="svelte-1t43nla"><path d="M12 2L4 5v6.09c0 5.05 3.41 9.76 8 10.91 4.59-1.15 8-5.86 8-10.91V5l-8-3z"></path></svg>
    Exposure`,P,Z,S=`<svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="svelte-1t43nla"><path d="M7 2v11h3v9l7-12h-4l4-8z"></path></svg>
    Activity`,c,he,Ee="?",Fe,Qe,me,$e=V[0]&&bd();return{c(){m=tt("div"),I=tt("button"),I.innerHTML=E,P=Mt(),Z=tt("button"),Z.innerHTML=S,c=Mt(),he=tt("button"),he.textContent=Ee,Fe=Mt(),$e&&$e.c(),this.h()},l(rt){m=et(rt,"DIV",{class:!0});var je=Pt(m);I=et(je,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),li(I)!=="svelte-1h76bnd"&&(I.innerHTML=E),P=Dt(je),Z=et(je,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),li(Z)!=="svelte-hl1je4"&&(Z.innerHTML=S),c=Dt(je),he=et(je,"BUTTON",{class:!0,title:!0,"aria-label":!0,"data-svelte-h":!0}),li(he)!=="svelte-s18xjb"&&(he.textContent=Ee),Fe=Dt(je),$e&&$e.l(je),je.forEach(He),this.h()},h(){Te(I,"class","layer-btn svelte-1t43nla"),Te(I,"title","Show exposure level based on nearby protection"),Ta(I,"active",V[1].activeLayer==="exposure"),Te(Z,"class","layer-btn svelte-1t43nla"),Te(Z,"title","Show historical lightning activity"),Ta(Z,"active",V[1].activeLayer==="activity"),Te(he,"class","help-btn svelte-1t43nla"),Te(he,"title","Learn about layers"),Te(he,"aria-label","Help"),Te(m,"class","layer-toggle svelte-1t43nla")},m(rt,je){Ft(rt,m,je),Ge(m,I),Ge(m,P),Ge(m,Z),Ge(m,c),Ge(m,he),Ge(m,Fe),$e&&$e.m(m,null),Qe||(me=[Ti(window,"click",V[4]),Ti(I,"click",V[5]),Ti(Z,"click",V[6]),Ti(he,"click",Dd(V[3]))],Qe=!0)},p(rt,[je]){je&2&&Ta(I,"active",rt[1].activeLayer==="exposure"),je&2&&Ta(Z,"active",rt[1].activeLayer==="activity"),rt[0]?$e||($e=bd(),$e.c(),$e.m(m,null)):$e&&($e.d(1),$e=null)},i:Pi,o:Pi,d(rt){rt&&He(m),$e&&$e.d(),Qe=!1,Jo(me)}}}function km(V,m,I){let E;Cn(V,Qs,Fe=>I(1,E=Fe));let P=!1;function Z(Fe){sp(Fe)}function S(){I(0,P=!P)}function c(Fe){Fe.target.closest(".layer-toggle")||I(0,P=!1)}return[P,E,Z,S,c,()=>Z("exposure"),()=>Z("activity")]}class Dm extends ls{constructor(m){super(),cs(this,m,km,Sm,os,{})}}function wd(V,m,I){const E=V.slice();return E[5]=m[I],E[7]=I,E}function Mm(V){let m;return{c(){m=tt("div"),this.h()},l(I){m=et(I,"DIV",{class:!0}),Pt(m).forEach(He),this.h()},h(){Te(m,"class","timeline-line svelte-ude4px"),Ta(m,"before-year",V[1][V[7]+1]==="year")},m(I,E){Ft(I,m,E)},p:Pi,d(I){I&&He(m)}}}function vd(V){let m,I,E,P,Z=cu[V[5]]+"",S,c,he,Ee,Fe;function Qe(){return V[4](V[5])}let me=V[7]<V[1].length-1&&Mm(V);return{c(){m=tt("button"),I=tt("span"),E=Mt(),P=tt("span"),S=Ji(Z),c=Mt(),me&&me.c(),he=Cr(),this.h()},l($e){m=et($e,"BUTTON",{class:!0,"aria-label":!0});var rt=Pt(m);I=et(rt,"SPAN",{class:!0}),Pt(I).forEach(He),E=Dt(rt),P=et(rt,"SPAN",{class:!0});var je=Pt(P);S=ji(je,Z),je.forEach(He),rt.forEach(He),c=Dt($e),me&&me.l($e),he=Cr(),this.h()},h(){Te(I,"class","point-dot svelte-ude4px"),Te(P,"class","point-label svelte-ude4px"),Te(m,"class","timeline-point svelte-ude4px"),Te(m,"aria-label",cu[V[5]]),Ta(m,"active",V[0].lightningPeriod===V[5]),Ta(m,"is-year",V[5]==="year")},m($e,rt){Ft($e,m,rt),Ge(m,I),Ge(m,E),Ge(m,P),Ge(P,S),Ft($e,c,rt),me&&me.m($e,rt),Ft($e,he,rt),Ee||(Fe=Ti(m,"click",Qe),Ee=!0)},p($e,rt){V=$e,rt&3&&Ta(m,"active",V[0].lightningPeriod===V[5]),V[7]<V[1].length-1&&me.p(V,rt)},d($e){$e&&(He(m),He(c),He(he)),me&&me.d($e),Ee=!1,Fe()}}}function Tm(V){let m,I,E,P,Z=fh(V[1]),S=[];for(let c=0;c<Z.length;c+=1)S[c]=vd(wd(V,Z,c));return{c(){m=tt("div"),I=tt("div");for(let c=0;c<S.length;c+=1)S[c].c();this.h()},l(c){m=et(c,"DIV",{class:!0,role:!0,"aria-label":!0,tabindex:!0});var he=Pt(m);I=et(he,"DIV",{class:!0});var Ee=Pt(I);for(let Fe=0;Fe<S.length;Fe+=1)S[Fe].l(Ee);Ee.forEach(He),he.forEach(He),this.h()},h(){Te(I,"class","timeline-track svelte-ude4px"),Te(m,"class","timeline-container svelte-ude4px"),Te(m,"role","group"),Te(m,"aria-label","Activity period selector"),Te(m,"tabindex","0")},m(c,he){Ft(c,m,he),Ge(m,I);for(let Ee=0;Ee<S.length;Ee+=1)S[Ee]&&S[Ee].m(I,null);E||(P=Ti(m,"keydown",V[3]),E=!0)},p(c,[he]){if(he&7){Z=fh(c[1]);let Ee;for(Ee=0;Ee<Z.length;Ee+=1){const Fe=wd(c,Z,Ee);S[Ee]?S[Ee].p(Fe,he):(S[Ee]=vd(Fe),S[Ee].c(),S[Ee].m(I,null))}for(;Ee<S.length;Ee+=1)S[Ee].d(1);S.length=Z.length}},i:Pi,o:Pi,d(c){c&&He(m),Hg(S,c),E=!1,P()}}}function Pm(V,m,I){let E;Cn(V,Qs,he=>I(0,E=he));const P=[1,2,3,4,5,6,7,8,9,10,11,12,"year"];function Z(he){ru(he)}function S(he){const Ee=P.indexOf(E.lightningPeriod);he.key==="ArrowLeft"&&Ee>0?ru(P[Ee-1]):he.key==="ArrowRight"&&Ee<P.length-1&&ru(P[Ee+1])}return[E,P,Z,S,he=>Z(he)]}class Rm extends ls{constructor(m){super(),cs(this,m,Pm,Tm,os,{})}}function xd(V){let m,I,E,P,Z,S="",c,he,Ee="Payment Successful!",Fe,Qe,me="Thank you for your purchase. Your plan is now active.",$e,rt,je="Continue",bt,Bt;return{c(){m=tt("div"),I=tt("button"),E=Mt(),P=tt("div"),Z=tt("div"),Z.textContent=S,c=Mt(),he=tt("h2"),he.textContent=Ee,Fe=Mt(),Qe=tt("p"),Qe.textContent=me,$e=Mt(),rt=tt("button"),rt.textContent=je,this.h()},l(ht){m=et(ht,"DIV",{class:!0,role:!0,"aria-modal":!0});var Xe=Pt(m);I=et(Xe,"BUTTON",{class:!0,type:!0,"aria-label":!0}),Pt(I).forEach(He),E=Dt(Xe),P=et(Xe,"DIV",{class:!0});var We=Pt(P);Z=et(We,"DIV",{class:!0,"data-svelte-h":!0}),li(Z)!=="svelte-ngli57"&&(Z.textContent=S),c=Dt(We),he=et(We,"H2",{class:!0,"data-svelte-h":!0}),li(he)!=="svelte-15d9u2n"&&(he.textContent=Ee),Fe=Dt(We),Qe=et(We,"P",{class:!0,"data-svelte-h":!0}),li(Qe)!=="svelte-10hsw22"&&(Qe.textContent=me),$e=Dt(We),rt=et(We,"BUTTON",{class:!0,"data-svelte-h":!0}),li(rt)!=="svelte-ac5k3r"&&(rt.textContent=je),We.forEach(He),Xe.forEach(He),this.h()},h(){Te(I,"class","backdrop-dismiss svelte-177sfa8"),Te(I,"type","button"),Te(I,"aria-label","Close"),Te(Z,"class","icon svelte-177sfa8"),Te(he,"class","svelte-177sfa8"),Te(Qe,"class","svelte-177sfa8"),Te(rt,"class","close-btn svelte-177sfa8"),Te(P,"class","modal svelte-177sfa8"),Te(m,"class","backdrop svelte-177sfa8"),Te(m,"role","dialog"),Te(m,"aria-modal","true")},m(ht,Xe){Ft(ht,m,Xe),Ge(m,I),Ge(m,E),Ge(m,P),Ge(P,Z),Ge(P,c),Ge(P,he),Ge(P,Fe),Ge(P,Qe),Ge(P,$e),Ge(P,rt),bt||(Bt=[Ti(I,"click",V[1]),Ti(rt,"click",V[1])],bt=!0)},p:Pi,d(ht){ht&&He(m),bt=!1,Jo(Bt)}}}function Lm(V){let m,I=V[0]&&xd(V);return{c(){I&&I.c(),m=Cr()},l(E){I&&I.l(E),m=Cr()},m(E,P){I&&I.m(E,P),Ft(E,m,P)},p(E,[P]){E[0]?I?I.p(E,P):(I=xd(E),I.c(),I.m(m.parentNode,m)):I&&(I.d(1),I=null)},i:Pi,o:Pi,d(E){E&&He(m),I&&I.d(E)}}}function Fm(V,m,I){let E;Cn(V,Jg,S=>I(3,E=S));let P=!1;gh(()=>{const S=E.url.searchParams.get("billing");if(E.url.searchParams.get("session_id"),S==="success"){I(0,P=!0);const c=new URL(window.location.href);c.searchParams.delete("billing"),c.searchParams.delete("session_id"),window.history.replaceState({},"",c.pathname)}});function Z(){I(0,P=!1)}return[P,Z]}class zm extends ls{constructor(m){super(),cs(this,m,Fm,Lm,os,{})}}function Bd(V){let m,I,E,P,Z,S="",c,he,Ee="",Fe,Qe,me="You've left your free zone",$e,rt,je,bt,Bt,ht="Your current access:",Xe,We,dt,zt,ut,ft=V[1].name+"",Nt,Gt,St,nr,mi=V[1].radiusKm+"",ri,Xt,Ei,ni,Oi="Worldwide overview map",Yi,Si,Qi='<div class="section-title svelte-1snuf20">With a subscription you get:</div> <ul class="svelte-1snuf20"><li class="svelte-1snuf20">Worldwide access without restrictions</li> <li class="svelte-1snuf20">Exposure layer (topographic shielding)</li> <li class="svelte-1snuf20">Activity layer (lightning frequency)</li></ul>',$i,ur,qi="Find sheltered anchorages, campsites & more.",vi,Wi,Vi="View Plans",yi,pi,yr="Maybe later",_r,Gi;return{c(){m=tt("div"),I=tt("button"),E=Mt(),P=tt("div"),Z=tt("button"),Z.textContent=S,c=Mt(),he=tt("div"),he.textContent=Ee,Fe=Mt(),Qe=tt("h2"),Qe.textContent=me,$e=Mt(),rt=tt("div"),je=Mt(),bt=tt("div"),Bt=tt("div"),Bt.textContent=ht,Xe=Mt(),We=tt("ul"),dt=tt("li"),zt=Ji("Detail view around "),ut=tt("strong"),Nt=Ji(ft),Gt=Mt(),St=tt("li"),nr=Ji("~"),ri=Ji(mi),Xt=Ji(" km radius at full resolution"),Ei=Mt(),ni=tt("li"),ni.textContent=Oi,Yi=Mt(),Si=tt("div"),Si.innerHTML=Qi,$i=Mt(),ur=tt("div"),ur.textContent=qi,vi=Mt(),Wi=tt("button"),Wi.textContent=Vi,yi=Mt(),pi=tt("button"),pi.textContent=yr,this.h()},l(Kt){m=et(Kt,"DIV",{class:!0,role:!0,"aria-modal":!0});var hi=Pt(m);I=et(hi,"BUTTON",{class:!0,type:!0,"aria-label":!0}),Pt(I).forEach(He),E=Dt(hi),P=et(hi,"DIV",{class:!0});var si=Pt(P);Z=et(si,"BUTTON",{class:!0,"data-svelte-h":!0}),li(Z)!=="svelte-moq3tb"&&(Z.textContent=S),c=Dt(si),he=et(si,"DIV",{class:!0,"data-svelte-h":!0}),li(he)!=="svelte-a17grk"&&(he.textContent=Ee),Fe=Dt(si),Qe=et(si,"H2",{class:!0,"data-svelte-h":!0}),li(Qe)!=="svelte-9m3c6v"&&(Qe.textContent=me),$e=Dt(si),rt=et(si,"DIV",{class:!0}),Pt(rt).forEach(He),je=Dt(si),bt=et(si,"DIV",{class:!0});var Re=Pt(bt);Bt=et(Re,"DIV",{class:!0,"data-svelte-h":!0}),li(Bt)!=="svelte-1nxo6uz"&&(Bt.textContent=ht),Xe=Dt(Re),We=et(Re,"UL",{class:!0});var Ri=Pt(We);dt=et(Ri,"LI",{class:!0});var Mr=Pt(dt);zt=ji(Mr,"Detail view around "),ut=et(Mr,"STRONG",{class:!0});var Wt=Pt(ut);Nt=ji(Wt,ft),Wt.forEach(He),Mr.forEach(He),Gt=Dt(Ri),St=et(Ri,"LI",{class:!0});var Ii=Pt(St);nr=ji(Ii,"~"),ri=ji(Ii,mi),Xt=ji(Ii," km radius at full resolution"),Ii.forEach(He),Ei=Dt(Ri),ni=et(Ri,"LI",{class:!0,"data-svelte-h":!0}),li(ni)!=="svelte-1cyig4w"&&(ni.textContent=Oi),Ri.forEach(He),Re.forEach(He),Yi=Dt(si),Si=et(si,"DIV",{class:!0,"data-svelte-h":!0}),li(Si)!=="svelte-vvw4te"&&(Si.innerHTML=Qi),$i=Dt(si),ur=et(si,"DIV",{class:!0,"data-svelte-h":!0}),li(ur)!=="svelte-4kftou"&&(ur.textContent=qi),vi=Dt(si),Wi=et(si,"BUTTON",{class:!0,"data-svelte-h":!0}),li(Wi)!=="svelte-1vcyi68"&&(Wi.textContent=Vi),yi=Dt(si),pi=et(si,"BUTTON",{class:!0,"data-svelte-h":!0}),li(pi)!=="svelte-1jxvlxi"&&(pi.textContent=yr),si.forEach(He),hi.forEach(He),this.h()},h(){Te(I,"class","backdrop-dismiss svelte-1snuf20"),Te(I,"type","button"),Te(I,"aria-label","Close"),Te(Z,"class","close-btn svelte-1snuf20"),Te(he,"class","icon svelte-1snuf20"),Te(Qe,"class","svelte-1snuf20"),Te(rt,"class","divider svelte-1snuf20"),Te(Bt,"class","section-title svelte-1snuf20"),Te(ut,"class","svelte-1snuf20"),Te(dt,"class","svelte-1snuf20"),Te(St,"class","svelte-1snuf20"),Te(ni,"class","svelte-1snuf20"),Te(We,"class","svelte-1snuf20"),Te(bt,"class","section svelte-1snuf20"),Te(Si,"class","section svelte-1snuf20"),Te(ur,"class","hint svelte-1snuf20"),Te(Wi,"class","primary-btn svelte-1snuf20"),Te(pi,"class","secondary-btn svelte-1snuf20"),Te(P,"class","modal svelte-1snuf20"),Te(m,"class","backdrop svelte-1snuf20"),Te(m,"role","dialog"),Te(m,"aria-modal","true")},m(Kt,hi){Ft(Kt,m,hi),Ge(m,I),Ge(m,E),Ge(m,P),Ge(P,Z),Ge(P,c),Ge(P,he),Ge(P,Fe),Ge(P,Qe),Ge(P,$e),Ge(P,rt),Ge(P,je),Ge(P,bt),Ge(bt,Bt),Ge(bt,Xe),Ge(bt,We),Ge(We,dt),Ge(dt,zt),Ge(dt,ut),Ge(ut,Nt),Ge(We,Gt),Ge(We,St),Ge(St,nr),Ge(St,ri),Ge(St,Xt),Ge(We,Ei),Ge(We,ni),Ge(P,Yi),Ge(P,Si),Ge(P,$i),Ge(P,ur),Ge(P,vi),Ge(P,Wi),Ge(P,yi),Ge(P,pi),_r||(Gi=[Ti(I,"click",V[4]),Ti(Z,"click",V[3]),Ti(Wi,"click",V[2]),Ti(pi,"click",V[3])],_r=!0)},p(Kt,hi){hi&2&&ft!==(ft=Kt[1].name+"")&&tn(Nt,ft),hi&2&&mi!==(mi=Kt[1].radiusKm+"")&&tn(ri,mi)},d(Kt){Kt&&He(m),_r=!1,Jo(Gi)}}}function Gm(V){let m,I=V[0]&&Bd(V);return{c(){I&&I.c(),m=Cr()},l(E){I&&I.l(E),m=Cr()},m(E,P){I&&I.m(E,P),Ft(E,m,P)},p(E,[P]){E[0]?I?I.p(E,P):(I=Bd(E),I.c(),I.m(m.parentNode,m)):I&&(I.d(1),I=null)},i:Pi,o:Pi,d(E){E&&He(m),I&&I.d(E)}}}function Um(V,m,I){let E,P;Cn(V,zc,he=>I(0,E=he)),Cn(V,Oc,he=>I(1,P=he));function Z(){zc.set(!1),window.dispatchEvent(new CustomEvent("open-billing-modal"))}function S(){zc.set(!1)}function c(){zc.set(!1)}return[E,P,Z,S,c]}class Nm extends ls{constructor(m){super(),cs(this,m,Um,Gm,os,{})}}function Cd(V,{delay:m=0,duration:I=400,easing:E=Og}={}){const P=+getComputedStyle(V).opacity;return{delay:m,duration:I,easing:E,css:Z=>`opacity: ${Z*P}`}}function Ed(V){let m,I='<span class="icon svelte-d8da0u"></span> <span class="message svelte-d8da0u">This area requires a subscription</span>',E,P;return{c(){m=tt("div"),m.innerHTML=I,this.h()},l(Z){m=et(Z,"DIV",{class:!0,"data-svelte-h":!0}),li(m)!=="svelte-1wewva"&&(m.innerHTML=I),this.h()},h(){Te(m,"class","toast svelte-d8da0u")},m(Z,S){Ft(Z,m,S),P=!0},i(Z){P||(Z&&qg(()=>{P&&(E||(E=XA(m,Cd,{duration:200},!0)),E.run(1))}),P=!0)},o(Z){Z&&(E||(E=XA(m,Cd,{duration:200},!1)),E.run(0)),P=!1},d(Z){Z&&He(m),Z&&E&&E.end()}}}function Om(V){let m,I=V[0]&&Ed();return{c(){I&&I.c(),m=Cr()},l(E){I&&I.l(E),m=Cr()},m(E,P){I&&I.m(E,P),Ft(E,m,P)},p(E,[P]){E[0]?I?P&1&&Dr(I,1):(I=Ed(),I.c(),Dr(I,1),I.m(m.parentNode,m)):I&&(Md(),dn(I,1,1,()=>{I=null}),Td())},i(E){Dr(I)},o(E){dn(I)},d(E){E&&He(m),I&&I.d(E)}}}function qm(V,m,I){let E;return Cn(V,Au,P=>I(0,E=P)),[E]}class Vm extends ls{constructor(m){super(),cs(this,m,qm,Om,os,{})}}function Qd(V){let m,I;return m=new Rm({}),{c(){Cs(m.$$.fragment)},l(E){Bs(m.$$.fragment,E)},m(E,P){xs(m,E,P),I=!0},i(E){I||(Dr(m.$$.fragment,E),I=!0)},o(E){dn(m.$$.fragment,E),I=!1},d(E){vs(m,E)}}}function Hm(V){let m,I,E,P,Z,S,c,he,Ee,Fe,Qe,me,$e,rt,je,bt,Bt,ht,Xe,We,dt,zt;E=new Qm({}),Z=new Zp({props:{mapTilerKey:Xg}}),c=new nm({}),Fe=new Dm({}),me=new om({}),rt=new tm({});let ut=V[0].activeLayer==="activity"&&Qd();return Bt=new zm({}),Xe=new Nm({}),dt=new Vm({}),{c(){m=Mt(),I=tt("div"),Cs(E.$$.fragment),P=Mt(),Cs(Z.$$.fragment),S=Mt(),Cs(c.$$.fragment),he=Mt(),Ee=tt("div"),Cs(Fe.$$.fragment),Qe=Mt(),Cs(me.$$.fragment),$e=Mt(),Cs(rt.$$.fragment),je=Mt(),ut&&ut.c(),bt=Mt(),Cs(Bt.$$.fragment),ht=Mt(),Cs(Xe.$$.fragment),We=Mt(),Cs(dt.$$.fragment),this.h()},l(ft){jg("svelte-1wptagv",document.head).forEach(He),m=Dt(ft),I=et(ft,"DIV",{class:!0});var Gt=Pt(I);Bs(E.$$.fragment,Gt),P=Dt(Gt),Bs(Z.$$.fragment,Gt),S=Dt(Gt),Bs(c.$$.fragment,Gt),he=Dt(Gt),Ee=et(Gt,"DIV",{class:!0});var St=Pt(Ee);Bs(Fe.$$.fragment,St),St.forEach(He),Qe=Dt(Gt),Bs(me.$$.fragment,Gt),$e=Dt(Gt),Bs(rt.$$.fragment,Gt),je=Dt(Gt),ut&&ut.l(Gt),Gt.forEach(He),bt=Dt(ft),Bs(Bt.$$.fragment,ft),ht=Dt(ft),Bs(Xe.$$.fragment,ft),We=Dt(ft),Bs(dt.$$.fragment,ft),this.h()},h(){document.title="IncusGrid - Lightning Risk Map",Te(Ee,"class","controls-left svelte-1875alc"),Te(I,"class","app svelte-1875alc")},m(ft,Nt){Ft(ft,m,Nt),Ft(ft,I,Nt),xs(E,I,null),Ge(I,P),xs(Z,I,null),Ge(I,S),xs(c,I,null),Ge(I,he),Ge(I,Ee),xs(Fe,Ee,null),Ge(I,Qe),xs(me,I,null),Ge(I,$e),xs(rt,I,null),Ge(I,je),ut&&ut.m(I,null),Ft(ft,bt,Nt),xs(Bt,ft,Nt),Ft(ft,ht,Nt),xs(Xe,ft,Nt),Ft(ft,We,Nt),xs(dt,ft,Nt),zt=!0},p(ft,[Nt]){ft[0].activeLayer==="activity"?ut?Nt&1&&Dr(ut,1):(ut=Qd(),ut.c(),Dr(ut,1),ut.m(I,null)):ut&&(Md(),dn(ut,1,1,()=>{ut=null}),Td())},i(ft){zt||(Dr(E.$$.fragment,ft),Dr(Z.$$.fragment,ft),Dr(c.$$.fragment,ft),Dr(Fe.$$.fragment,ft),Dr(me.$$.fragment,ft),Dr(rt.$$.fragment,ft),Dr(ut),Dr(Bt.$$.fragment,ft),Dr(Xe.$$.fragment,ft),Dr(dt.$$.fragment,ft),zt=!0)},o(ft){dn(E.$$.fragment,ft),dn(Z.$$.fragment,ft),dn(c.$$.fragment,ft),dn(Fe.$$.fragment,ft),dn(me.$$.fragment,ft),dn(rt.$$.fragment,ft),dn(ut),dn(Bt.$$.fragment,ft),dn(Xe.$$.fragment,ft),dn(dt.$$.fragment,ft),zt=!1},d(ft){ft&&(He(m),He(I),He(bt),He(ht),He(We)),vs(E),vs(Z),vs(c),vs(Fe),vs(me),vs(rt),ut&&ut.d(),vs(Bt,ft),vs(Xe,ft),vs(dt,ft)}}}function jm(V,m,I){let E;return Cn(V,Qs,P=>I(0,E=P)),gh(async()=>{await Up()}),[E]}class Wm extends ls{constructor(m){super(),cs(this,m,jm,Hm,os,{})}}export{Wm as component};
